"use strict";(self.webpackChunkassets=self.webpackChunkassets||[]).push([["172"],{23529:function(e,t,n){n.d(t,{ML:()=>y,SA:()=>b}),n(20316);var r=n(72668),o=n(90113),a=n(66547),i=n(42055),c=n(51647),u=n(81600);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function p(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,c=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(c)throw r}}return a}}(e,t)||d(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}}function y(e){var t=e.uss,n=e.setUss,y=e.typeEnvironment,x=e.results,w=e.placeholder,k=e.selection,E=e.setSelection,S=e.eRef,O=(0,r.useRef)(E);O.current=E;var I=(0,r.useMemo)(function(){return(0,u.M6)(t)},[t]),A=(0,a.cI)(),C=(0,r.useRef)(null),j=f((0,r.useState)(void 0),2),T=j[0],L=j[1],M=f((0,r.useState)(0),2),N=M[0],U=M[1],B=(0,r.useRef)(new Map),D=(0,r.useCallback)(function(e){B.current.clear();var t=(0,u._h)(e,A,x.filter(function(e){return"success"!==e.kind}),function(t,n){(null==T?void 0:T.location.end.charIdx)===t.location.end.charIdx&&"identifier"===t.token.type&&n.push(T.element),void 0!==w&&e.tokens.every(function(e){return"operator"===e.token.type&&"EOL"===e.token.value})&&0===t.location.end.charIdx&&n.push((0,u.IO)(A,w))},function(e,t){B.current.set(t,e)}),n=C.current;n.replaceChildren.apply(n,function(e){if(Array.isArray(e))return l(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||d(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())},[A,x,T,w]),P=(0,r.useRef)(D),R=(0,r.useRef)(void 0);(0,r.useEffect)(function(){var e=C.current;(I!==R.current||D!==P.current)&&D(I),(0,u.n$)(e,k),P.current=D,R.current=I},[D,I,k]);var q=(0,r.useCallback)(function(e,t){var r=(0,u.M6)(e);D(r),(0,u.n$)(C.current,t),n(r.uss),E(t),L(void 0)},[D,n,E]);(0,r.useEffect)(function(){var e=function(){var e=(0,u.rx)(C.current);O.current(e),L(function(t){return(null==t?void 0:t.kind)==="autocomplete"&&(t.location.end.charIdx!==(null==e?void 0:e.start)||t.location.end.charIdx!==e.end)?void 0:t})};return document.addEventListener("selectionchange",e),function(){document.removeEventListener("selectionchange",e)}},[]),(0,r.useEffect)(function(){var e=C.current,t=function(){var t=(0,u.rx)(e),r=(0,u.M6)((0,u.Gq)(e)),o=null!==t&&t.start===t.end?r.tokens.find(function(e){return"identifier"===e.token.type&&e.location.end.charIdx===t.start}):void 0;if(void 0!==o){var a=o.token.value,i=(0,u.Eu)(y,r.tokens,a);0===i.length?L(void 0):(L({kind:"autocomplete",location:o.location,options:i,element:(0,u.pR)(A),apply:function(e){var t=i[e],n=t.length-a.length;q(r.uss.slice(0,o.location.start.charIdx)+t+r.uss.slice(o.location.end.charIdx),{start:o.location.end.charIdx+n,end:o.location.end.charIdx+n})}}),U(0))}else L(void 0);n(r.uss),E(t)};return e.addEventListener("input",t),function(){e.removeEventListener("input",t)}},[y,A,q,n,E]),(0,r.useEffect)(function(){var e=C.current,t=function(t){if((null==T?void 0:T.kind)==="autocomplete")switch(t.key){case"Enter":case"Tab":t.preventDefault(),T.apply(N);return;case"Escape":t.preventDefault(),L(void 0);return;case"ArrowDown":case"ArrowUp":t.preventDefault(),"ArrowDown"===t.key?U(function(e){return e+1>=T.options.length?0:e+1}):U(function(e){return e-1<0?T.options.length-1:e-1});return}if("Tab"===t.key){t.preventDefault();var n=(0,u.rx)(e);null!==n&&q("".concat(I.uss.slice(0,n.start),"    ").concat(I.uss.slice(n.end)),{start:n.start+4,end:n.start+4})}else if("Backspace"===t.key){var r=(0,u.rx)(e);null!==r&&r.start===r.end&&r.start>=4&&"    "===I.uss.slice(r.start-4,r.start)&&(t.preventDefault(),q("".concat(I.uss.slice(0,r.start-4)).concat(I.uss.slice(r.start)),{start:r.start-4,end:r.start-4}))}};return e.addEventListener("keydown",t),function(){e.removeEventListener("keydown",t)}},[I,D,T,N,q]),(0,r.useEffect)(function(){var e=C.current,t=function(){L(void 0)};return e.addEventListener("blur",t),function(){e.removeEventListener("blur",t)}},[]),(0,r.useEffect)(function(){var e,t=function(t){var n=!0,r=!1,o=void 0;try{for(var a,i=document.elementsFromPoint(t.clientX,t.clientY)[Symbol.iterator]();!(n=(a=i.next()).done);n=!0){var c=function(){var t=a.value,n=void 0,r=void 0,o=void 0;if(void 0!==(n=B.current.get(t))&&"identifier"===n.token.type&&(r=n.token.value)&&void 0!==(o=y.get(r))){e=n;var i={location:n.location,name:r,value:o};return setTimeout(function(){e===n&&L(p(s({kind:"documentation"},i),{element:(0,u.pi)(A)}))},500),{v:void 0}}if((null==T?void 0:T.kind)==="documentation"&&T.element===t)return e=void 0,{v:void 0}}();if("object"==(c&&"undefined"!=typeof Symbol&&c.constructor===Symbol?"symbol":typeof c))return c.v}}catch(e){r=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}e=void 0,(null==T?void 0:T.kind)==="documentation"&&L(void 0)};return document.addEventListener("mousemove",t),function(){document.removeEventListener("mousemove",t)}},[A,y,T]);var V=h(v(x));return r.createElement("div",{style:{marginTop:"0.25em"}},r.createElement("pre",{id:"test-editor-body",style:p(s({},m),{caretColor:c.k.shared.isTesting?"transparent":A.textMain,border:"1px solid ".concat(V),borderRadius:c.k.shared.isTesting?0:x.length>0?"5px 5px 0 0":"5px"}),ref:function(e){C.current=e,void 0!==S&&(S.current=e)},contentEditable:"plaintext-only",spellCheck:"false"}),r.createElement(b,{results:x,editor:!0}),void 0===T?null:(0,o.createPortal)("autocomplete"===T.kind?r.createElement(g,{state:T,selectionIdx:N,setSelectionIdx:U,apply:function(e){T.apply(e)}}):r.createElement(i.LongFormDocumentation,{name:T.name,value:T.value}),T.element))}var m={whiteSpace:"pre-wrap",fontFamily:"Inconsolata, monospace",fontWeight:500,lineHeight:"175%",margin:0,padding:"1em"};function v(e){switch(!0){case e.some(function(e){return"error"===e.kind}):return"r";case e.some(function(e){return"warning"===e.kind}):return"o";case e.some(function(e){return"success"===e.kind}):return"g";default:return"s"}}function h(e){var t=(0,a.cI)();switch(e){case"r":return t.hueColors.red;case"o":return t.hueColors.orange;case"g":return t.hueColors.green;case"s":return t.borderShadow}}function b(e){var t=(0,a.cI)(),n=v(e.results),o=h(n);if(0!==e.results.length){var i="2px solid ".concat(o),l=p(s({},m),{borderRadius:c.k.shared.isTesting?0:e.editor?"0 0 5px 5px":"5px",backgroundColor:t.slightlyDifferentBackground,color:t.textMain,borderTop:e.editor?"none":i,borderRight:i,borderBottom:i,borderLeft:i,marginTop:e.editor?"0":"0.25em"});return r.createElement("div",{id:"test-editor-result",className:"color-".concat(n)},r.createElement("pre",{style:l},e.results.map(function(t,n,r){return"".concat(r.length>1?"- ":"").concat((0,u.l9)(t,e.editor))}).join("\n")))}}function g(e){return e.state.options.map(function(t,n){return r.createElement(x,{key:t,option:t,index:n,selected:n===e.selectionIdx,apply:function(){e.apply(n)}})})}function x(e){var t=(0,a.cI)(),n=f((0,r.useState)(!1),2),o=n[0],i=n[1],c={cursor:"pointer",backgroundColor:e.selected||o?t.slightlyDifferentBackgroundFocused:e.index%2==0?t.background:t.slightlyDifferentBackground,padding:"0 0.5em"},u=(0,r.useRef)(null);return(0,r.useEffect)(function(){var e;null==(e=u.current)||e.scrollIntoView({block:"nearest"})},[e.selected]),r.createElement("div",{ref:u,style:c,onMouseEnter:function(){i(!0)},onMouseLeave:function(){i(!1)},onClick:e.apply},e.option)}},1913:function(e,t,n){n.d(t,{D:()=>v,e:()=>h});var r=n(72668),o=n(23529),a=n(12132),i=n(81600),c=n(88452),u=n(84635);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){n(e);return}c.done?t(u):Promise.resolve(u).then(r,o)}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function f(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,c=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(c)throw r}}return a}}(e,t)||m(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||m(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}}function v(e){var t=(0,r.useRef)(null),n=h(f(p({},e),{getSelection:function(){return null},undoRedoOptions:{onlyElement:t}})),a=n.uss,i=n.setUss,c=n.typeEnvironment,u=n.results,l=n.selection,s=n.setSelection,d=n.undoRedoUi;return r.createElement("div",{id:"test-editor-panel"},r.createElement(o.ML,{uss:a,setUss:i,typeEnvironment:c,results:u,placeholder:"Enter Urban Stats Script",selection:l,setSelection:s,eRef:t}),d)}function h(e){var t=e.ident,n=e.getCode,o=e.onChange,l=e.getSelection,m=e.undoRedoOptions,v=d((0,r.useState)([]),2),h=v[0],b=v[1],g=d((0,r.useState)(n),2),x=g[0],w=g[1],k=(0,r.useRef)(0),E=d((0,r.useState)(l),2),S=E[0],O=E[1],I=function(e){var n;return(n=function(){var n,r,a;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(u){var l=[c,u];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(i){switch(i.label){case 0:if(w(e),n=++k.current,null==o||o(e),"error"===(r=(0,c.Qc)(e,{type:"single",ident:t})).type)return b(r.errors.map(function(e){return f(p({},e),{kind:"error"})})),[2];return[4,(0,u.W)({descriptor:{kind:"generic"},stmts:r})];case 1:return a=i.sent(),n===k.current&&b(y(void 0!==a.resultingValue?[{kind:"success",result:a.resultingValue}]:[]).concat(y(a.error))),[2]}})},function(){var e=this,t=arguments;return new Promise(function(r,o){var a=n.apply(e,t);function i(e){s(a,r,o,i,c,"next",e)}function c(e){s(a,r,o,i,c,"throw",e)}i(void 0)})})()},A=(0,i.C5)(x,S,I,O,m),C=A.addState,j=A.updateCurrentSelection,T=A.ui;return(0,r.useEffect)(function(){I(n())},[]),{uss:x,setUss:function(e){I(e),C(e,S)},setSelection:function(e){O(e),j(e)},typeEnvironment:a.Z,selection:S,results:h,undoRedoUi:T}}},34672:function(e,t,n){n.d(t,{LU:()=>c,ZP:()=>l,_x:()=>function e(t){switch(t.type){case"assignment":return u(t.value);case"statements":return e(t.result[t.result.length-1]);case"parseError":return o()(t.errors.length>0,"parseError node must have at least one error"),t.errors[0].location;default:return u(t)}},qT:()=>s,x9:()=>u});var r=n(39343),o=n.n(r);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}}function c(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o()(t.length>0,"At least one location must be provided for unification");var r=t.reduce(function(e,t){return Math.min(e,t.start.lineIdx)},Number.MAX_VALUE),a=t.reduce(function(e,t){return Math.max(e,t.end.lineIdx)},-Number.MAX_VALUE),i=t.reduce(function(e,t){return Math.min(e,t.start.colIdx)},Number.MAX_VALUE),c=t.reduce(function(e,t){return Math.max(e,t.end.colIdx)},-Number.MAX_VALUE),u=t.reduce(function(e,t){return Math.min(e,t.start.charIdx)},Number.MAX_VALUE),l=t.reduce(function(e,t){return Math.max(e,t.end.charIdx)},-Number.MAX_VALUE);return{start:{block:t[0].start.block,lineIdx:r,colIdx:i,charIdx:u},end:{block:t[0].end.block,lineIdx:a,colIdx:c,charIdx:l}}}function u(e){switch(e.type){case"unnamed":case"expression":return u(e.value);case"named":return c(e.name.location,u(e.value));case"constant":return e.value.location;case"identifier":return e.name.location;case"attribute":return c(e.name.location,u(e.expr));case"call":case"objectLiteral":case"vectorLiteral":case"if":case"do":case"condition":case"statements":case"customNode":return e.entireLoc;case"unaryOperator":return c(e.operator.location,u(e.expr));case"binaryOperator":return c(u(e.left),u(e.right),e.operator.location);case"assignment":return c(u(e.lhs),u(e.value));case"parseError":return o()(e.errors.length>0,"parseError node must have at least one error"),e.errors[0].location}}function l(e){var t=[];return!function e(n){switch(n.type){case"unnamed":case"named":case"expression":e(n.value);break;case"constant":case"identifier":break;case"attribute":case"unaryOperator":case"customNode":e(n.expr);break;case"call":e(n.fn),n.args.forEach(e);break;case"binaryOperator":e(n.left),e(n.right);break;case"objectLiteral":n.properties.forEach(function(t){e((function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,c=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),a.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(c)throw r}}return a}}(t,2)||i(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[1])});break;case"vectorLiteral":n.elements.forEach(e);break;case"if":e(n.condition),e(n.then),n.else&&e(n.else);break;case"do":n.statements.forEach(e);break;case"assignment":e(n.lhs),e(n.value);break;case"statements":n.result.forEach(e);break;case"condition":e(n.condition),n.rest.forEach(e);break;case"parseError":var r;t.push.apply(t,function(e){if(Array.isArray(e))return a(e)}(r=n.errors)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||i(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}}(e),t}function s(e){switch(e.type){case"statements":case"assignment":case"expression":case"condition":case"parseError":return e;default:return{type:"expression",value:e}}}},24714:function(e,t,n){n.d(t,{B8:()=>m,De:()=>y,IB:()=>h,Q_:()=>E,XF:()=>b,_l:()=>d,io:()=>x,mC:()=>v,v1:()=>w});var r,o=n(78970),a=n(24342),i=n(88452),c=n(89080),u=n(54509),l=n(78415);function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}}var f={type:"opaque",name:"color"};function d(e,t,n,r,o){if(e<0||e>1||t<0||t>1||n<0||n>1||r<0||r>1){if(o)return;throw Error("RGB values must be between 0 and 1, got (".concat(e,", ").concat(t,", ").concat(n,", ").concat(r,")"))}return{r:Math.round(255*e),g:Math.round(255*t),b:Math.round(255*n),a:Math.round(255*r)}}function y(e,t,n,r,a){if(e<0||e>360||t<0||t>1||n<0||n>1||r<0||r>1){if(a)return;throw Error("HSV values must be (hue: 0-360, saturation: 0-1, value: 0-1, alpha: 0-1), got (".concat(e,", ").concat(t,", ").concat(n,", ").concat(r,")"))}var i=o.Z.hsv(e,100*t,100*n);return{r:Math.round(i.red()),g:Math.round(i.green()),b:Math.round(i.blue()),a:Math.round(255*r)}}var m={type:{type:"function",posArgs:[{type:"concrete",value:{type:"number"}},{type:"concrete",value:{type:"number"}},{type:"concrete",value:{type:"number"}}],namedArgs:{a:{type:{type:"concrete",value:{type:"number"}},defaultValue:(0,c._N)(1)}},returnType:{type:"concrete",value:f}},value:function(e,t,n){var r=n.a;return{type:"opaque",opaqueType:"color",value:d(t[0],t[1],t[2],r)}},documentation:{humanReadableName:"Color (RGB)",category:"color",namedArgs:{a:"Alpha"},longDescription:"Creates a color using RGB (Red, Green, Blue) values. Each component ranges from 0 to 1, where 0 is no color and 1 is full intensity."}},v={type:{type:"function",posArgs:[{type:"concrete",value:{type:"number"}},{type:"concrete",value:{type:"number"}},{type:"concrete",value:{type:"number"}}],namedArgs:{a:{type:{type:"concrete",value:{type:"number"}},defaultValue:(0,c._N)(1)}},returnType:{type:"concrete",value:f}},value:function(e,t,n){var r=n.a;return{type:"opaque",opaqueType:"color",value:y(t[0],t[1],t[2],r)}},documentation:{humanReadableName:"Color (HSV)",category:"color",longDescription:"Creates a color using HSV (Hue, Saturation, Value) values. Hue ranges from 0 to 360 degrees, saturation and value range from 0 to 1."}},h={type:{type:"function",posArgs:[{type:"concrete",value:f}],namedArgs:{},returnType:{type:"concrete",value:{type:"string"}}},value:function(e,t,n){return b(t[0].value)},documentation:{humanReadableName:"Color to String",category:"color",longDescription:'Converts a color object to its hexadecimal string representation (e.g., "#ff0000" for red). If the alpha channel is not 255, it will be included in the string, e.g., "#ff000088" for red with 50% opacity.'}};function b(e,t){var n=function(e){var t=(e=Math.round(e)).toString(16);return 1===t.length?"0".concat(t):t},r="#".concat(n(e.r)).concat(n(e.g)).concat(n(e.b));return 255===e.a||t||(r+=n(e.a)),r}function g(e,t,n,r,o,a){var i=void 0!==a?function(e){return e.toFixed(a)}:function(e){return e.toString()},c=255!==o?", a=".concat(i(o/255)):"";return"".concat(e,"(").concat(i(t),", ").concat(i(n),", ").concat(i(r)).concat(c,")")}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.forceAlpha,r=t.round;return g("rgb",e.r/255,e.g/255,e.b/255,null!=n?n:e.a,r)}function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.forceAlpha,r=t.round,a=o.Z.rgb(e.r,e.g,e.b);return g("hsv",a.hue(),a.saturationv()/100,a.value()/100,null!=n?n:e.a,r)}function k(e,t,n){var r=(0,l.g)(e),o=e.charAt(0).toUpperCase()+e.slice(1),a=(0,u.u)(t);return["color".concat(o),{type:f,value:{type:"opaque",opaqueType:"color",value:a},documentation:{humanReadableName:r,category:"color",equivalentExpressions:[(0,i.hc)(x(a,{round:3}),""),(0,i.hc)(w(a,{round:3}),"")],isDefault:n,longDescription:"Predefined color constant representing ".concat(r.toLowerCase(),"."),documentationTable:"predefined-colors",selectorRendering:{kind:"gradientBackground",ramp:[[0,t],[1,t]]}}}]}var E=((function(e){if(Array.isArray(e))return s(e)})(r=Object.entries(a.Z).map(function(e){var t=function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,c=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),a.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(c)throw r}}return a}}(e,2)||p(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();return k(t[0],t[1])}))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||p(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([k("white","#ffffff"),k("black","#000000",!0)])},44640:function(e,t,n){n.d(t,{Et:()=>f,F6:()=>h,HC:()=>v,HE:()=>d,Rf:()=>m,Yw:()=>s});var r=n(51859),o=n(88452);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,c=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(c)throw r}}return a}}(e,t)||u(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||u(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}}var l={type:"opaque",name:"inset"},s={type:"opaque",name:"insets"},p={type:"object",properties:new Map([["west",{type:"number"}],["east",{type:"number"}],["north",{type:"number"}],["south",{type:"number"}]])},f={type:{type:"function",posArgs:[],namedArgs:{screenBounds:{type:{type:"concrete",value:p}},mapBounds:{type:{type:"concrete",value:p}},mainMap:{type:{type:"concrete",value:{type:"boolean"}}},name:{type:{type:"concrete",value:{type:"string"}}}},returnType:{type:"concrete",value:l}},value:function(e,t,n){var r,o,a=n.screenBounds,i=n.mapBounds,c=n.mainMap,u=n.name;return r={west:a.get("west"),east:a.get("east"),north:a.get("north"),south:a.get("south")},o={west:i.get("west"),east:i.get("east"),north:i.get("north"),south:i.get("south")},{type:"opaque",opaqueType:"inset",value:{bottomLeft:[r.west,r.south],topRight:[r.east,r.north],coordBox:[o.west,o.south,o.east,o.north],mainMap:c,name:u}}},documentation:{humanReadableName:"Custom Inset",category:"inset",longDescription:"Creates a custom map inset with specified screen bounds (bounding box of the inset on the screen, where bottom left corner has (0, 0) and top right corner has (1, 1)), map bounds (bounding box of the inset on the map, in longitude and latitude), and whether it is the main map (the interactive map).",selectorRendering:{kind:"subtitleLongDescription"},customConstructor:!0}},d={type:{type:"function",posArgs:[{type:"concrete",value:{type:"vector",elementType:l}}],namedArgs:{},returnType:{type:"concrete",value:s}},value:function(e,t,n){return{type:"opaque",opaqueType:"insets",value:t[0].map(function(e){return e.value})}},documentation:{humanReadableName:"Custom Insets",category:"inset",isDefault:!0,longDescription:"Creates a collection of map insets.",customConstructor:!0}};function y(e){return e=(e=e.replace(/[\s,().-]/g,"")).replaceAll("+","Plus"),e="inset".concat(e)}function m(e){var t="constructInset(screenBounds={ north: ".concat(e.topRight[1],", east: ").concat(e.topRight[0],", south: ").concat(e.bottomLeft[1],", west: ").concat(e.bottomLeft[0]," }, mapBounds={ north: ").concat(e.coordBox[3],", east: ").concat(e.coordBox[2],", south: ").concat(e.coordBox[1],", west: ").concat(e.coordBox[0]," }, mainMap=").concat(e.mainMap,', name="').concat(e.name,'")');return(0,o.hc)(t,"")}var v=Object.entries(r.Z).flatMap(function(e){return i(e,2)[1].map(function(e){var t=e.name;return[y(t),{type:l,value:{type:"opaque",opaqueType:"inset",value:{bottomLeft:c(e.bottomLeft),topRight:c(e.topRight),coordBox:c(e.coordBox),mainMap:e.mainMap,name:e.name}},documentation:{humanReadableName:t,category:"inset",equivalentExpressions:[m(e)],longDescription:'Predefined map inset for the region "'.concat(t,'".'),documentationTable:"predefined-insets"}}]})}),h=new Map(Object.entries(r.Z).flatMap(function(e){return i(e,2)[1].map(function(e){var t=e.name;return[t,y(t)]})}))},69851:function(e,t,n){n.d(t,{_K:()=>function e(t){switch(t.kind){case"linear":var n=t.min,r=t.max;if(n===r)return{forward:function(e){return .5+e-n},inverse:function(e){return e-.5+n}};var o=r-n;return{forward:function(e){return(e-n)/o},inverse:function(e){return e*o+n}};case"log":var a=e(t.linearScale),i=a.forward,c=a.inverse;return{forward:function(e){return i(Math.log(e))},inverse:function(e){return Math.exp(c(e))}}}},d3:()=>l,iu:()=>u});var r=n(89080);function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function a(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var i={type:"opaque",name:"scale"},c=function(e,t,n,r){e=e.filter(function(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)});var o,i,c=null!=t?t:(o=Math).min.apply(o,a(e)),u=null!=n?n:(i=Math).max.apply(i,a(e));if(void 0!==r)if(void 0!==t&&void 0!==n){if(Math.abs(r-(t+n)/2)>1e-10)throw Error("Inconsistent parameters: center ".concat(r," does not equal (min + max) / 2 = ").concat(t+n," / 2"))}else if(void 0!==t)u=2*r-t;else if(void 0!==n)c=2*r-n;else{var l=Math.max(u-r,r-c);c=r-l,u=r+l}return{kind:"linear",min:c,max:u}},u={type:{type:"function",posArgs:[],namedArgs:{min:{type:{type:"concrete",value:{type:"number"}},defaultValue:(0,r._N)(null)},center:{type:{type:"concrete",value:{type:"number"}},defaultValue:(0,r._N)(null)},max:{type:{type:"concrete",value:{type:"number"}},defaultValue:(0,r._N)(null)}},returnType:{type:"concrete",value:i}},value:function(e,t,n){var r=n.min,o=n.max,a=n.center;return{type:"opaque",opaqueType:"scale",value:function(e){return c(e,null!=r?r:void 0,null!=o?o:void 0,null!=a?a:void 0)}}},documentation:{humanReadableName:"Linear Scale",category:"scale",isDefault:!0,longDescription:"Creates a linear scale that maps numeric values to a range. If min/max are not specified, they are computed from the data. Center parameter can be used to create symmetric ranges.",selectorRendering:{kind:"subtitleLongDescription"}}},l={type:{type:"function",posArgs:[],namedArgs:{min:{type:{type:"concrete",value:{type:"number"}},defaultValue:(0,r._N)(null)},center:{type:{type:"concrete",value:{type:"number"}},defaultValue:(0,r._N)(null)},max:{type:{type:"concrete",value:{type:"number"}},defaultValue:(0,r._N)(null)}},returnType:{type:"concrete",value:i}},value:function(e,t,n){var r=n.min,o=n.max,a=n.center;return{type:"opaque",opaqueType:"scale",value:function(e){var t,n,i;return t=null!=r?r:void 0,n=null!=o?o:void 0,i=null!=a?a:void 0,{kind:"log",linearScale:c(e.map(Math.log),void 0!==t?Math.log(t):void 0,void 0!==n?Math.log(n):void 0,void 0!==i?Math.log(i):void 0)}}}},documentation:{humanReadableName:"Logarithmic Scale",category:"scale",longDescription:"Creates a logarithmic scale that maps numeric values to a range using log transformation. Useful for data with wide ranges or exponential distributions. If min/max are not specified, they are computed from the data. Center parameter can be used to create symmetric ranges.",selectorRendering:{kind:"subtitleLongDescription"}}}},2680:function(e,t,n){n.d(t,{_:()=>d});var r=n(39343),o=n.n(r);function a(e,t,n){if(!t.has(e))throw TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function i(e,t){var n=a(e,t,"get");return n.get?n.get.call(e):n.value}function c(e,t,n){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object");t.set(e,n)}function u(e,t,n){var r=a(e,t,"set");if(r.set)r.set.call(e,n);else{if(!r.writable)throw TypeError("attempted to set read only private field");r.value=n}return n}var l=new WeakMap,s=new WeakMap,p=new WeakMap,f=new WeakMap,d=function(){var e;function t(e,n,r,a){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");c(this,l,{writable:!0,value:void 0}),c(this,s,{writable:!0,value:void 0}),c(this,p,{writable:!0,value:void 0}),c(this,f,{writable:!0,value:void 0}),u(this,l,e),u(this,s,n),u(this,p,r),u(this,f,a);var i=!0,d=!1,y=void 0;try{for(var m,v=a.keys()[Symbol.iterator]();!(i=(m=v.next()).done);i=!0){var h=m.value;o()(!r.has(h),'Variable name "'.concat(h,'" conflicts with a constant'))}}catch(e){d=!0,y=e}finally{try{i||null==v.return||v.return()}finally{if(d)throw y}}}return e=[{key:"effect",value:function(e){i(this,l).call(this,e)}},{key:"error",value:function(e,t){return i(this,s).call(this,e,t)}},{key:"getVariable",value:function(e){return i(this,p).has(e)?i(this,p).get(e):i(this,f).get(e)}},{key:"assignVariable",value:function(e,t){if(i(this,p).has(e))return'Cannot assign to constant "'.concat(e,'"');i(this,f).set(e,t)}},{key:"variableEntries",value:function(){return i(this,f).entries()}},{key:"evolveVariables",value:function(e){return new t(i(this,l),i(this,s),i(this,p),e)}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()},81600:function(e,t,n){n.d(t,{pR:()=>E,Gq:()=>v,M6:()=>y,C5:()=>I,Eu:()=>k,n$:()=>g,pi:()=>S,rx:()=>h,_h:()=>m,l9:()=>d,IO:()=>O});var r=n(72668),o=n(79074),a=n(51647),i=n(36195),c=n(52594),u=n(5855),l=n(89080);function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,c=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(c)throw r}}return a}}(e,t)||f(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}}function d(e,t){switch(e.kind){case"error":case"warning":return t?"".concat(e.value," at ").concat((0,c.i7)(e.location)):e.value;case"success":return(0,l.Q2)(e.result)}}function y(e){return e.endsWith("\n")||(e="".concat(e,"\n")),{uss:e,tokens:(0,u.jx)({type:"single",ident:"editor"},e)}}function m(e,t,n,r,a){for(var i=(m=t,v=new o.G(function(){return 0}),h=["true","false","null"],function(e,t){var n,r={position:"relative"};switch(e.type){case"bracket":function o(e){switch(e%3){case 0:return m.hueColors.yellow;case 1:return m.hueColors.pink;case 2:return m.hueColors.blue;default:throw Error()}}if("("===e.value||"["===e.value||"{"===e.value){var a=Array.from(v.values()).reduce(function(e,t){return e+t},0);v.set(e.value,v.get(e.value)+1),r.color=o(a)}else{var i={")":"(","]":"[","}":"{"}[e.value];0===v.get(i)?r.color=m.hueColors.red:(v.set(i,v.get(i)-1),r.color=o(Array.from(v.values()).reduce(function(e,t){return e+t},0)))}break;case"number":r.color=m.hueColors.blue;break;case"string":r.color=m.hueColors.green;break;case"error":r["text-decoration-color"]=m.hueColors.red,r["text-decoration-style"]="wavy",r["text-decoration-line"]="underline",r["text-decoration-skip-ink"]="none",n=e.value;break;case"operator":r.color=m.hueColors.orange;break;case"identifier":h.includes(e.value)&&(r.color=m.hueColors.orange);break;case"keyword":r.color=m.hueColors.purple}var c=document.createElement("span");return c.setAttribute("style",w(r)),c.title=null!=n?n:"",c.replaceChildren.apply(c,function(e){if(Array.isArray(e))return s(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||f(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c}),c=[],u=void 0,l=0,p=0,d=0;p<e.tokens.length&&l<e.uss.length;){d<n.length&&l>=n[d].location.start.charIdx&&(u={spans:[],error:n[d]},d++),void 0!==u&&l>=u.error.location.end.charIdx&&(c.push(i(u.error,u.spans)),u=void 0);var y=e.tokens[p];if(l===y.location.start.charIdx){var m,v,h,b,g,x=[document.createTextNode(e.uss.slice(y.location.start.charIdx,y.location.end.charIdx))];r(y,x);var k=i(y.token,x);a(y,k),(null!=(g=null==u?void 0:u.spans)?g:c).push(k),l=y.location.end.charIdx,p++}else if(l<y.location.start.charIdx)(null!=(b=null==u?void 0:u.spans)?b:c).push(document.createTextNode(e.uss.slice(l,y.location.start.charIdx))),l=y.location.start.charIdx;else throw Error("invalid state")}return void 0!==u&&(c.push(i(u.error,u.spans)),u=void 0),c}function v(e){var t,n;return(null!=(t=HTMLElement)&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t)?e.isContentEditable?Array.from(e.childNodes).map(v).join(""):"":null!=(n=e.textContent)?n:""}function h(e){var t=window.getSelection();if((null==t?void 0:t.rangeCount)===1){var n=t.getRangeAt(0);if(e.contains(n.startContainer)&&e.contains(n.endContainer))return e===n.startContainer||e===n.endContainer?{start:0,end:0}:{start:b(e,n.startContainer,n.startOffset),end:b(e,n.endContainer,n.endOffset)}}return null}function b(e,t,n){for(;t!==e;){for(var r=t.previousSibling;null!==r;)n+=v(r).length,r=r.previousSibling;t=t.parentNode}return n}function g(e,t){var n=h(e);if((null==n?void 0:n.start)!==(null==t?void 0:t.start)||(null==n?void 0:n.end)!==(null==t?void 0:t.end)){var r=window.getSelection();if(null===t){r.removeAllRanges(),e.blur();return}null===n&&e.focus();var o=p(x(e,t.start),2),a=o[0],i=o[1],c=p(x(e,t.end),2),u=c[0],l=c[1];r.setBaseAndExtent(a,i,u,l)}}function x(e,t){for(var n=0;e.childNodes.length>0;)for(e=e.childNodes.item(0);n+v(e).length<t&&null!==e.nextSibling;)n+=v(e).length,e=e.nextSibling;return[e,t-n]}function w(e){return Object.entries(e).map(function(e){var t=p(e,2),n=t[0],r=t[1];return"".concat(n,":").concat(r,";")}).join("")}function k(e,t,n){var r=new Set,o=!0,a=!1,i=void 0;try{for(var c,u=t[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var l=c.value;"identifier"===l.token.type&&r.add(l.token.value)}}catch(e){a=!0,i=e}finally{try{o||null==u.return||u.return()}finally{if(a)throw i}}var s=!0,f=!1,d=void 0;try{for(var y,m=e[Symbol.iterator]();!(s=(y=m.next()).done);s=!0){var v=p(y.value,1)[0];r.add(v)}}catch(e){f=!0,d=e}finally{try{s||null==m.return||m.return()}finally{if(f)throw d}}return r.delete(n),Array.from(r).flatMap(function(e){var t=function(e,t){for(var n=0,r=0,o=!0,a=0;a<t.length;a++)if(e[n]===t[a]?(n++,o&&r++,o=!0):o=!1,n===e.length)return r+1;return 0}(n.toLowerCase(),e.toLowerCase());return 0===t?[]:[{option:e,match:t}]}).sort(function(e,t){return e.match!==t.match?t.match-e.match:e.option.length!==t.option.length?e.option.length-t.option.length:e.option.localeCompare(t.option)}).map(function(e){return e.option})}function E(e){var t={position:"absolute",top:"100%",left:"100%","user-select":"none","z-index":"3",overflow:"scroll","max-height":"10lh","border-radius":a.k.shared.isTesting?"0":"5px",border:"1px solid ".concat(e.borderNonShadow),color:e.textMain},n=document.createElement("div");return n.setAttribute("contenteditable","false"),n.setAttribute("style",w(t)),n}function S(e){var t={position:"absolute",top:"100%",left:"0%","user-select":"none","z-index":"3",overflow:"scroll","max-height":"10lh","border-radius":a.k.shared.isTesting?"0":"5px",border:"1px solid ".concat(e.borderNonShadow),color:e.textMain,"background-color":e.slightlyDifferentBackground,width:"33vw",padding:"0 1.33em"},n=document.createElement("div");return n.setAttribute("contenteditable","false"),n.setAttribute("style",w(t)),n.className="serif",n}function O(e,t){var n={position:"absolute","user-select":"none","white-space":"pre",color:e.hueColors.grey,"pointer-events":"none"},r=document.createElement("span");return r.setAttribute("contenteditable","false"),r.setAttribute("style",w(n)),r.textContent=t,r}function I(e,t,n,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},c=i.undoChunking,u=void 0===c?1e3:c,l=i.undoHistory,s=void 0===l?100:l,f=i.onlyElement,d=(0,r.useRef)([{time:0,state:e,selection:t}]),y=(0,r.useRef)([]),m=p((0,r.useState)(!1),2),v=m[0],h=m[1],b=p((0,r.useState)(!1),2),g=b[0],x=b[1],w=(0,r.useCallback)(function(e,t){var n=d.current[d.current.length-1];if(n.time+u>Date.now())n.state=e,n.selection=t;else{for(d.current.push({time:Date.now(),state:e,selection:t});d.current.length>s;)d.current.shift();h(!0)}y.current=[],x(!1)},[u,s]),k=(0,r.useCallback)(function(e){d.current[d.current.length-1].selection=e},[]),E=(0,r.useCallback)(function(){if(d.current.length>=2){var e=d.current[d.current.length-2];y.current.push(d.current.pop()),n(e.state),o(e.selection),x(!0),h(d.current.length>=2)}},[n,o]),S=(0,r.useCallback)(function(){var e=y.current.pop();void 0!==e&&(d.current.push(e),n(e.state),o(e.selection),h(!0),x(y.current.length>=1))},[n,o]),O=(0,r.useCallback)(function(){return void 0===f||null!==document.activeElement&&document.activeElement===f.current},[f]);(0,r.useEffect)(function(){var e=function(e){if(O()){var t=navigator.userAgent.includes("Mac")&&!a.k.shared.isTesting;(t?"z"===e.key.toLowerCase()&&e.metaKey&&!e.shiftKey:"z"===e.key.toLowerCase()&&e.ctrlKey)?(e.preventDefault(),E()):(t?"z"===e.key.toLowerCase()&&e.metaKey&&e.shiftKey:"y"===e.key.toLowerCase()&&e.ctrlKey)&&(e.preventDefault(),S())}};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}},[E,S,O]);var I=p((0,r.useState)(O),2),C=I[0],j=I[1];return(0,r.useEffect)(function(){var e=function(){j(O())};return window.addEventListener("focusin",e),window.addEventListener("focusout",e),e(),function(){window.removeEventListener("focusin",e),window.removeEventListener("focusout",e)}},[O]),{addState:w,updateCurrentSelection:k,ui:C?r.createElement(A,{doUndo:E,doRedo:S,canUndo:v,canRedo:g}):null}}function A(e){var t=e.doUndo,n=e.doRedo,o=e.canUndo,a=e.canRedo,c=(0,r.useRef)(null),u=(0,r.useRef)(null),l=(0,r.useCallback)(function(){if(null!==c.current&&null!==u.current){var e,t,n,r,o=c.current.getBoundingClientRect();u.current.style.top="".concat((null!=(n=null==(e=window.visualViewport)?void 0:e.height)?n:window.innerHeight)-o.top-50,"px"),u.current.style.left="".concat((null!=(r=null==(t=window.visualViewport)?void 0:t.width)?r:window.innerWidth)-o.left-150,"px")}},[]);if((0,r.useEffect)(l),(0,r.useEffect)(function(){var e;return window.addEventListener("scroll",l),window.addEventListener("resize",l),null==(e=window.visualViewport)||e.addEventListener("resize",l),function(){var e;window.removeEventListener("scroll",l),window.removeEventListener("resize",l),null==(e=window.visualViewport)||e.removeEventListener("resize",l)}},[l]),!(0,i.wd)())return null;var s={flex:1,touchAction:"manipulation",zIndex:100};return r.createElement("div",{ref:c,style:{position:"absolute"}},r.createElement("div",{ref:u,style:{position:"absolute",display:"flex",width:"".concat(150,"px"),height:"".concat(50,"px"),gap:"".concat(10,"px"),padding:"".concat(10,"px")}},r.createElement("button",{onPointerDown:function(e){e.preventDefault(),t()},disabled:!o,style:s},"Undo"),r.createElement("button",{onPointerDown:function(e){e.preventDefault(),n()},disabled:!a,style:s},"Redo")))}},52594:function(e,t,n){n.d(t,{Lv:()=>x,ht:()=>k,i7:()=>g,ku:()=>w});var r=n(77053),o=n(34672),a=n(74968),i=n(34415),c=n(80555),u=n(89080);function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t,n){return(s=b()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&y(o,n.prototype),o}).apply(null,arguments)}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function v(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}}function h(e){var t="function"==typeof Map?new Map:void 0;return(h=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return s(e,arguments,f(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),y(n,e)})(e)}function b(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(b=function(){return!!e})()}function g(e){return e.start.lineIdx===e.end.lineIdx?e.start.colIdx+1===e.end.colIdx?"".concat(e.start.lineIdx+1,":").concat(e.start.colIdx+1):"".concat(e.start.lineIdx+1,":").concat(e.start.colIdx+1,"-").concat(e.end.colIdx):"".concat(e.start.lineIdx+1,":").concat(e.start.colIdx+1," - ").concat(e.end.lineIdx+1,":").concat(e.end.colIdx)}var x=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e,n){var r,o,a;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");return o=t,a=["".concat(e," at ").concat(g(n))],o=f(o),p(r=function(e,t){if(t&&("object"===m(t)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,b()?Reflect.construct(o,a||[],f(this).constructor):o.apply(this,a)),"location",void 0),p(r,"value",void 0),r.location=n,r.name="InterpretationError",r.value=e,r.location=n,r}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e),t}(h(Error));function w(e,t){switch(e.type){case"constant":var n=e.value.node;if("number"===n.type)return(0,u.xr)(n.value,{type:"number"});return(0,u.xr)(n.value,{type:"string"});case"identifier":var l=e.name.node,s=t.getVariable(l);if(void 0!==s)return s;throw t.error("Undefined variable: ".concat(l),e.name.location);case"attribute":var p=E(w(e.expr,t),e.name.node,void 0);if("error"===p.type)throw t.error(p.message,(0,o.x9)(e));return p.value;case"call":var f=w(e.fn,t),d=e.args.map(function(e){var n=e,r=t;switch(n.type){case"named":return{type:"named",name:n.name.node,value:w(n.value,r)};case"unnamed":return{type:"unnamed",value:w(n.value,r)}}}),y=(0,a.NG)(f,d,t,(0,o.x9)(e));if("error"===y.type)throw t.error(y.message,(0,o.x9)(e));return y.result;case"unaryOperator":return function(e,t,n,o){var c=i.cP.get(t);(0,r.h)((null==c?void 0:c.unary)!==void 0,"Unknown operator: ".concat(t));var u=(0,a.pe)(c.unary(t,o),[e],[],n,o);if("error"===u.type)throw n.error(u.message,o);return u.result}(w(e.expr,t),e.operator.node,t,(0,o.x9)(e));case"binaryOperator":return function(e,t,n,o,c){var u=i.cP.get(n);(0,r.h)((null==u?void 0:u.binary)!==void 0,"Unknown operator: ".concat(n));var l=(0,a.pe)(u.binary(n,c),[e,t],[],o,c);if("error"===l.type)throw o.error(l.message,c);return l.result}(w(e.left,t),w(e.right,t),e.operator.node,t,(0,o.x9)(e));case"vectorLiteral":var m=e.elements.map(function(e){return w(e,t)}),h={type:"elementOfEmptyVector"},b=!0,g=!1,x=void 0;try{for(var S,O=m[Symbol.iterator]();!(b=(S=O.next()).done);b=!0)!function(){var n=S.value;h=(0,u.gs)(h,n.type,function(){return(0,r.h)("elementOfEmptyVector"!==h.type,"Unreachable: elementType should not be elementOfEmptyVector at ".concat(JSON.stringify(n.value))),t.error("vector literal contains heterogenous types ".concat((0,u.wB)(h)," and ").concat((0,u.wB)(n.type)),(0,o.x9)(e))})}()}catch(e){g=!0,x=e}finally{try{b||null==O.return||O.return()}finally{if(g)throw x}}return(0,u.xr)(m.map(function(e){return e.value}),{type:"vector",elementType:h});case"objectLiteral":var I=new Map,A=new Map,C=!0,j=!1,T=void 0;try{for(var L,M=e.properties[Symbol.iterator]();!(C=(L=M.next()).done);C=!0){var N,U=(N=L.value,function(e){if(Array.isArray(e))return e}(N)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,c=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),a.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(c)throw r}}return a}}(N,2)||v(N,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),B=U[0],D=U[1],P=w(D,t);if(I.has(B))throw t.error("Duplicate key ".concat(B," in object literal"),(0,o.x9)(D));I.set(B,P.type),A.set(B,P.value)}}catch(e){j=!0,T=e}finally{try{C||null==M.return||M.return()}finally{if(j)throw T}}return(0,u.xr)(A,{type:"object",properties:I});case"if":var R=w(e.condition,t);return(0,c.i1)(t,R,function(n,r){if("boolean"!==n.type.type)throw t.error("Condition in if statement must be a boolean, but got ".concat((0,u.wB)(n.type)),(0,o.x9)(e.condition));return n.value?k(e.then,r):void 0===e.else?(0,u.xr)(null,{type:"null"}):k(e.else,r)},(0,o.x9)(e.condition),(0,o.x9)(e));case"do":if(0===e.statements.length)return(0,u.xr)(null,{type:"null"});var q=k(e.statements[0],t),V=!0,F=!1,z=void 0;try{for(var _,Z=e.statements.slice(1)[Symbol.iterator]();!(V=(_=Z.next()).done);V=!0){var K=_.value;q=k(K,t)}}catch(e){F=!0,z=e}finally{try{V||null==Z.return||Z.return()}finally{if(F)throw z}}return q;case"customNode":var H=k(e.expr,t);if(e.expectedType&&!e.expectedType.some(function(e){return(0,u.j6)(H.type,e)}))throw t.error("Custom expression expected to return type ".concat(e.expectedType.map(function(e){return(0,u.wB)(e)}).join(" or "),", but got ").concat((0,u.wB)(H.type)),(0,o.x9)(e));return H}}function k(e,t){switch(e.type){case"condition":var n;if(0===e.rest.length)throw t.error("condition(..) must be followed by at least one statement",(0,o.x9)(e));return w({type:"if",condition:e.condition,then:{type:"statements",result:e.rest,entireLoc:o.LU.apply(void 0,function(e){if(Array.isArray(e))return l(e)}(n=e.rest.map(o.x9))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||v(n)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())},entireLoc:e.entireLoc},t);case"assignment":var a=w(e.value,t);return function(e,t,n){switch(e.type){case"identifier":var r=e.name.node,a=n.assignVariable(r,t);if(void 0!==a)throw n.error(a,(0,o.x9)(e));return;case"attribute":var i=E(w(e.expr,n),e.name.node,t);if("error"===i.type)throw n.error(i.message,(0,o.x9)(e));return}}(e.lhs,a,t),a;case"expression":return w(e.value,t);case"statements":if(0===e.result.length)return(0,u.xr)(null,{type:"null"});var i=k(e.result[0],t),c=!0,s=!1,p=void 0;try{for(var f,d=e.result.slice(1)[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var y=f.value;i=k(y,t)}}catch(e){s=!0,p=e}finally{try{c||null==d.return||d.return()}finally{if(s)throw p}}return i;case"parseError":throw(0,r.h)(e.errors.length>0,"parseError node must have at least one error"),t.error("Parse error: ".concat(e.errors.map(function(e){return e.value}).join(", ")),e.errors[0].location)}}function E(e,t,n){var o=e.type;if("object"===o.type){var i=e.value;(0,r.h)(d(i,Map),"Expected object type because of ".concat((0,u.wB)(o),", but got ").concat(void 0===i?"undefined":m(i)," at ").concat(JSON.stringify(e.value)));var c=o.properties.get(t);if(void 0===c)return{type:"error",message:"Attribute ".concat(t," not found in object of type ").concat((0,u.wB)(o))};if(void 0!==n)return(0,u.wB)(c)!==(0,u.wB)(n.type)?{type:"error",message:"Type mismatch: expected ".concat((0,u.wB)(c)," but got ").concat((0,u.wB)(n.type)," for attribute ").concat(t," in object of type ").concat((0,u.wB)(o))}:(i.set(t,n.value),{type:"success",value:(0,u.xr)(n.value,c)});var l=i.get(t);return(0,r.h)(void 0!==l,"Expected attribute ".concat(t," to be defined in object, but got undefined at ").concat(JSON.stringify(e.value))),{type:"success",value:(0,u.xr)(i.get(t),c)}}if("vector"===o.type){var s=e.value;(0,r.h)(d(s,Array),"Expected vector type because of ".concat((0,u.wB)(o),", but got ").concat(void 0===s?"undefined":m(s)," at ").concat(JSON.stringify(e.value)));var p=function(){};if(void 0!==n){if("vector"!==n.type.type&&(n=(0,u.xr)((0,a.OS)([s.length],n.value),{type:"vector",elementType:n.type})),(0,r.h)(Array.isArray(n.value),"It should be an array at this point"),n.value.length!==s.length)return{type:"error",message:"Expected vector of length ".concat(s.length," but got ").concat(n.value.length," for attribute ").concat(t," in object of type ").concat((0,u.wB)(o))};var f=n.value,y=n.type.elementType;(0,r.h)("elementOfEmptyVector"!==y.type,"Unreachable: elementType should not be elementOfEmptyVector at ".concat(JSON.stringify(n.value))),p=function(e){return(0,u.xr)(f[e],y)}}var v=s.map(function(n,a){return(0,r.h)("elementOfEmptyVector"!==o.elementType.type,"Unreachable: elementType should not be elementOfEmptyVector at ".concat(JSON.stringify(e.value))),E((0,u.xr)(n,o.elementType),t,p(a))});if(v.some(function(e){return"error"===e.type}))return{type:"error",message:v.filter(function(e){return"error"===e.type}).map(function(e){return e.message})[0]};var h=v.map(function(e){return e.value}),b=h.map(function(e){return e.value}),g=h[0].type;return{type:"success",value:(0,u.xr)(b,{type:"vector",elementType:g})}}return{type:"error",message:"Cannot access attribute of type ".concat((0,u.wB)(o),". Only objects and vectors support attributes.")}}},5855:function(e,t,n){n.d(t,{PS:()=>d,jx:()=>h,p3:()=>y});var r=n(77053),o=n(34415);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,c=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(c)throw r}}return a}}(e,t)||c(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}}var u=["=",",",";",".",":"],l="!@$%^&*-+=~`<>/?:|,;.",s=["if","do","else","customNode","condition"];function p(e){return e>="0"&&e<="9"}function f(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||"_"===e}function d(e){return{start:{block:{type:"single",ident:e},lineIdx:0,colIdx:0,charIdx:0},end:{block:{type:"single",ident:e},lineIdx:0,colIdx:0,charIdx:0}}}function y(e){if(/^-?\d*(\.\d+)?([eE][+-]?\d+)?$/i.test(e)){var t=parseFloat(e);if(isNaN(t))return;return t}if(e.endsWith("k")){var n=y(e.slice(0,-1));if(void 0===n)return;return 1e3*n}if(e.endsWith("m")){var r=y(e.slice(0,-1));if(void 0===r)return;return 1e6*r}}var m={firstToken:f,innerToken:function(e){return f(e)||p(e)},parse:function(e){return{type:s.includes(e)?"keyword":"identifier",value:e}}},v={firstToken:function(e){return l.includes(e)},innerToken:function(e){return l.includes(e)},parse:function(e){return u.includes(e)||o.cP.has(e)?{type:"operator",value:e}:{type:"error",value:"Invalid operator: ".concat(e)}}};function h(e,t){for(var n=[],o=t.split("\n"),u=0,l=0;l<o.length;l++){var s=o[l],f=function(e,t,n,o){var a=[];(0,r.h)(!e.includes("\n"),"Input contains new line characters");var c=0;e:for(;c<e.length;){var u,l=e[c];if(" "===l){c++;continue}if("("===l||")"===l||"{"===l||"}"===l||"["===l||"]"===l){var s={token:{type:"bracket",value:l},location:{start:{block:t,lineIdx:n,colIdx:c,charIdx:o+c},end:{block:t,lineIdx:n,colIdx:c+1,charIdx:o+c+1}}};a.push(s),c++;continue}if(p(l)){var f,d=void 0;if(c=(f=i(function(e,t,n,r,o){var a=/^\d+(\.\d+)?([eE][+-]?\d+|k|m)?/i.exec(e.slice(t));if(!a)return[t,void 0];var i=a[0],c=y(i);if(void 0===c)return[t+i.length,{token:{type:"error",value:"Invalid number format: ".concat(i)},location:{start:{block:n,lineIdx:r,colIdx:t,charIdx:o+t},end:{block:n,lineIdx:r,colIdx:t+i.length,charIdx:o+t+i.length}}}];var u={token:{type:"number",value:c},location:{start:{block:n,lineIdx:r,colIdx:t,charIdx:o+t},end:{block:n,lineIdx:r,colIdx:t+i.length,charIdx:o+t+i.length}}};return[t+i.length,u]}(e,c,t,n,o),2))[0],void 0!==(d=f[1])){a.push(d);continue}}for(var h=0,b=[m,v];h<b.length;h++){var g,x=b[h],w=void 0;if(c=(g=i(function(e,t,n,r,o,a){if(!o.firstToken(e[t]))return[t,void 0];for(var i=t;t<e.length&&o.innerToken(e[t]);)t++;var c={token:o.parse(e.slice(i,t)),location:{start:{block:n,lineIdx:r,colIdx:i,charIdx:a+i},end:{block:n,lineIdx:r,colIdx:t,charIdx:a+t}}};return[t,c]}(e,c,t,n,x,o),2))[0],void 0!==(w=g[1])){a.push(w);continue e}}var k=void 0;if(c=(u=i(function(e,t,n,o,a){if('"'!==e[t])return[t,void 0];var i,c=t;for(t++;;){if(t>=e.length)return[t,{token:{type:"error",value:"Unterminated string"},location:{start:{block:n,lineIdx:o,colIdx:c,charIdx:a+c},end:{block:n,lineIdx:o,colIdx:t,charIdx:a+c}}}];if('"'===e[t]){t++;break}if("\\"===e[t]){t+=2;continue}t++}try{var u=JSON.parse(e.slice(c,t));(0,r.h)("string"==typeof u,"Invalid string: ".concat(e.slice(c,t))),i=u}catch(r){return[t,{token:{type:"error",value:"Invalid string: ".concat(e.slice(c,t),": ").concat(r)},location:{start:{block:n,lineIdx:o,colIdx:c,charIdx:a+c},end:{block:n,lineIdx:o,colIdx:t,charIdx:a+t}}}]}var l={token:{type:"string",value:i},location:{start:{block:n,lineIdx:o,colIdx:c,charIdx:a+c},end:{block:n,lineIdx:o,colIdx:t,charIdx:a+t}}};return[t,l]}(e,c,t,n,o),2))[0],void 0!==(k=u[1])){a.push(k);continue}a.push({token:{type:"error",value:"Unexpected character: ".concat(l)},location:{start:{block:t,lineIdx:n,colIdx:c,charIdx:o+c},end:{block:t,lineIdx:n,colIdx:c+1,charIdx:o+c+1}}}),c++}return a}(s,e,l,u);n.push.apply(n,function(e){if(Array.isArray(e))return a(e)}(f)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(f)||c(f)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u+=s.length,n.push({token:{type:"operator",value:"EOL"},location:{start:{block:e,lineIdx:l,colIdx:s.length,charIdx:u},end:{block:e,lineIdx:l,colIdx:s.length,charIdx:u}}}),u+=1}return n}},27193:function(e,t,n){n.d(t,{AY:()=>i,EU:()=>a,ZM:()=>o,tU:()=>r,zt:()=>c});var r={start:{block:{type:"multi"},lineIdx:0,colIdx:0,charIdx:0},end:{block:{type:"multi"},lineIdx:0,colIdx:0,charIdx:0}};function o(e,t){return"".concat(e,"_pos_").concat(t)}function a(e,t){return"".concat(e,"_").concat(t)}function i(e,t){return"".concat(e,"_el_").concat(t)}function c(e,t){return"".concat(e,"_prop_").concat(t)}},88452:function(e,t,n){n.d(t,{Fc:()=>x,Qc:()=>v,Z2:()=>function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};function a(e){return"identifier"===e.type||"vectorLiteral"===e.type||"constant"===e.type||"customNode"===e.type}function i(e){return"    ".repeat(e)}switch(n.inline&&(0,r.h)(null!=(h=n.expressionalContext)&&h,"inline must be true if expressionalContext is true"),n.indent=null!=(b=n.indent)?b:0,t.type){case"customNode":if(!n.simplify)return"customNode(".concat(JSON.stringify(t.originalCode.trim()),")");if(n.expressionalContext&&"expression"!==t.expr.type)return e({type:"do",statements:[t.expr],entireLoc:(0,o.x9)(t.expr)},p(s({},n),{inline:!0}));return t.originalCode.trim();case"parseError":return t.originalCode;case"constant":if("string"===t.value.node.type)return'"'.concat(t.value.node.value,'"');return t.value.node.value.toString();case"identifier":return t.name.node;case"attribute":var u=e(t.expr,p(s({},n),{inline:!0,expressionalContext:!0}));return"".concat(u,".").concat(t.name.node);case"call":var l=e(t.fn,p(s({},n),{inline:!0,expressionalContext:!0})),d=t.args.map(function(t){switch(t.type){case"unnamed":return e(t.value,p(s({},n),{inline:!0,expressionalContext:!0}));case"named":return"".concat(t.name.node,"=").concat(e(t.value,p(s({},n),{inline:!0,expressionalContext:!0})))}}),y=!a(t.fn);return"".concat(y?"(".concat(l,")"):l,"(").concat(d.join(", "),")");case"unaryOperator":var m=e(t.expr,p(s({},n),{inline:!0,expressionalContext:!0})),v=!a(t.expr);return"".concat(t.operator.node).concat(v?"(".concat(m,")"):m);case"binaryOperator":var h,b,g,x,w,k,E,S,O=e(t.left,p(s({},n),{inline:!0,expressionalContext:!0})),I=e(t.right,p(s({},n),{inline:!0,expressionalContext:!0})),A=null!=(x=null==(g=c.cP.get(t.operator.node))?void 0:g.precedence)?x:0,C=O;"binaryOperator"===t.left.type?(null!=(k=null==(w=c.cP.get(t.left.operator.node))?void 0:w.precedence)?k:0)<A&&(C="(".concat(O,")")):a(t.left)||(C="(".concat(O,")"));var j=I;return"binaryOperator"===t.right.type?(null!=(S=null==(E=c.cP.get(t.right.operator.node))?void 0:E.precedence)?S:0)<=A&&(j="(".concat(I,")")):a(t.right)||(j="(".concat(I,")")),"".concat(C," ").concat(t.operator.node," ").concat(j);case"vectorLiteral":var T=t.elements.map(function(t){return e(t,p(s({},n),{inline:!0,expressionalContext:!0}))});return"[".concat(T.join(", "),"]");case"objectLiteral":var L=t.properties.map(function(t){var r=f(t,2),o=r[0],a=e(r[1],p(s({},n),{inline:!0,expressionalContext:!0}));return"".concat(o,": ").concat(a)});return"{".concat(L.join(", "),"}");case"assignment":var M=e(t.lhs,p(s({},n),{expressionalContext:!0})),N=e(t.value,p(s({},n),{expressionalContext:!0}));return n.inline?"".concat(M," = ").concat(N):"".concat(i(n.indent)).concat(M," = ").concat(N);case"expression":return n.inline?e(t.value,n):"".concat(i(n.indent)).concat(e(t.value,n));case"statements":return t.result.map(function(t){return e(t,n)}).filter(function(e){return""!==e&&"do {  }"!==e}).join(n.inline?"; ":";\n");case"if":var U=e(t.condition,p(s({},n),{expressionalContext:!0})),B=e(t.then,p(s({},n),{indent:n.indent+1})),D=n.inline?"if (".concat(U,") { ").concat(B," }"):"if (".concat(U,") {\n").concat(B,"\n").concat(i(n.indent),"}");if(t.else){var P=e(t.else,p(s({},n),{indent:n.indent+1}));D+=n.inline?" else { ".concat(P," }"):" else {\n".concat(P,"\n").concat(i(n.indent),"}")}return D;case"do":var R=e({type:"statements",result:t.statements,entireLoc:t.entireLoc},p(s({},n),{indent:n.indent+1}));return n.inline?"do { ".concat(R," }"):"do {\n".concat(R,"\n").concat(i(n.indent),"}");case"condition":var q=e(t.condition,p(s({},n),{expressionalContext:!0})),V=e({type:"statements",result:t.rest,entireLoc:t.entireLoc},n);if(n.simplify&&"identifier"===t.condition.type&&"true"===t.condition.name.node)return V;return"".concat(i(n.indent),"condition (").concat(q,")\n").concat(V)}},gD:()=>b,hc:()=>w});var r=n(77053),o=n(34672),a=n(5855),i=n(27193),c=n(34415);function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){l(e,t,n[t])})}return e}function p(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,c=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(c)throw r}}return a}}(e,t)||y(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||y(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}}var m=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");l(this,"tokens",void 0),l(this,"index",void 0),this.tokens=e,this.index=0}return e=[{key:"skipEOL",value:function(){if(this.index>=this.tokens.length)return!1;var e=this.tokens[this.index];return"operator"===e.token.type&&"EOL"===e.token.value&&(this.index++,!0)}},{key:"consumeTokenOfType",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(this.index>=this.tokens.length)return!1;var o=this.tokens[this.index];if(o.token.type===e&&(0===n.length||n.includes(o.token.value)))return this.index++,!0;if(this.skipEOL()){if(this.consumeTokenOfType.apply(this,[e].concat(d(n))))return!0;this.index--}return!1}},{key:"consumeOperator",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.consumeTokenOfType.apply(this,["operator"].concat(d(t)))}},{key:"consumeBracket",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.consumeTokenOfType.apply(this,["bracket"].concat(d(t)))}},{key:"consumeIdentifier",value:function(){return this.consumeTokenOfType("identifier")}},{key:"consumeKeyword",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.consumeTokenOfType.apply(this,["keyword"].concat(d(t)))}},{key:"maybeLastNonEOLToken",value:function(e){for(var t=this.index+e;t>=0;t--){var n=this.tokens[t];if("operator"!==n.token.type||"EOL"!==n.token.value)return n}return this.tokens[this.index+e]}},{key:"parseSingleExpression",value:function(){for(;this.skipEOL(););if(this.index>=this.tokens.length)return{type:"error",value:"Unexpected end of input",location:this.maybeLastNonEOLToken(-1).location};var e=this.tokens[this.index];switch(e.token.type){case"number":return this.index++,{type:"constant",value:{node:{type:"number",value:e.token.value},location:e.location}};case"string":return this.index++,{type:"constant",value:{node:{type:"string",value:e.token.value},location:e.location}};case"identifier":return this.index++,{type:"identifier",name:{node:e.token.value,location:e.location}};case"keyword":throw Error("Unexpected keyword ".concat(e.token.value));case"bracket":switch(e.token.value){case"(":this.index++;var t=this.parseExpression();if("error"===t.type)return t;if(!this.consumeBracket(")"))return{type:"error",value:"Expected closing bracket ) to match this one",location:e.location};return t;case"{":this.index++;for(var n=e.location,a=[];!this.consumeBracket("}");){if(a.length>0&&!this.consumeOperator(","))return{type:"error",value:"Expected comma , or closing bracket } after object field name; instead received ".concat(this.tokens[this.index].token.value),location:this.tokens[this.index].location};if(!this.consumeIdentifier())return{type:"error",value:"Expected identifier for object field name",location:this.maybeLastNonEOLToken(-1).location};var i=this.tokens[this.index-1];if((0,r.h)("identifier"===i.token.type,"Expected identifier token, but got ".concat(i.token.type)),!this.consumeOperator(":"))return{type:"error",value:"Expected : token after object field name",location:i.location};var c=this.parseExpression();if("error"===c.type)return c;a.push([i.token.value,c])}var u=this.tokens[this.index-1].location;return{type:"objectLiteral",entireLoc:(0,o.LU)(n,u),properties:a};case"[":this.index++;for(var l=e.location,s=[];!this.consumeBracket("]");){if(s.length>0&&!this.consumeOperator(","))return{type:"error",value:"Expected comma , or closing bracket ] after vector element",location:this.maybeLastNonEOLToken(0).location};var p=this.parseExpression();if("error"===p.type)return p;s.push(p)}var f=this.tokens[this.index-1].location;return{type:"vectorLiteral",entireLoc:(0,o.LU)(l,f),elements:s}}return{type:"error",value:"Unexpected bracket ".concat(e.token.value),location:e.location};case"operator":return{type:"error",value:"Unexpected operator ".concat(e.token.value),location:e.location}}}},{key:"parseArg",value:function(){var e=this.parseExpression();if("error"===e.type)return e;if(!this.consumeOperator("="))return{type:"unnamed",value:e};var t=this.parseExpression();return"error"===t.type?t:"identifier"!==e.type?{type:"error",value:"Expected identifier for named argument",location:(0,o.x9)(e)}:{type:"named",name:{node:e.name.node,location:e.name.location},value:t}}},{key:"parseParenthesizedArgs",value:function(){if(this.consumeBracket("("))for(var e=this.tokens[this.index-1].location,t=[];;){if(this.consumeBracket(")")){var n=this.tokens[this.index-1].location;return{type:"args",args:[t,(0,o.LU)(e,n)]}}if(t.length>0&&!this.consumeOperator(","))return{type:"error",value:"Expected comma , or closing bracket ); instead received ".concat(this.tokens[this.index].token.value),location:this.tokens[this.index].location};var r=this.parseArg();if("error"===r.type)return r;t.push(r)}}},{key:"parseFunctionalExpression",value:function(){if(this.consumeKeyword("customNode"))return this.parseCustomNodeExpression();var e=this.parseSingleExpression();if("error"===e.type)return e;for(;;){var t=!0,n=this.parseParenthesizedArgs();if(void 0!==n){if(t=!1,"error"===n.type)return n;e={type:"call",fn:e,entireLoc:(0,o.LU)((0,o.x9)(e),n.args[1]),args:n.args[0]}}if(this.consumeOperator(".")){if(t=!1,!this.consumeIdentifier())return{type:"error",value:"Expected identifier after the dot",location:this.maybeLastNonEOLToken(-1).location};var a=this.tokens[this.index-1];(0,r.h)("identifier"===a.token.type,"Expected identifier token, but got ".concat(a.token.type)),e={type:"attribute",expr:e,name:{node:a.token.value,location:a.location}}}if(t)break}return e}},{key:"parseExpression",value:function(){if(this.consumeKeyword("if"))return this.parseIfExpression();if(this.consumeKeyword("do"))return this.parseDoExpression();var e=[],t="expressionOrUnaryOperator";t:for(;;)switch(t){case"expressionOrUnaryOperator":if(this.consumeOperator.apply(this,d(c.mL))){var n=this.tokens[this.index-1];(0,r.h)("operator"===n.token.type,"Expected operator token"),e.push({type:"operator",operatorType:"unary",value:{node:n.token.value,location:n.location}});continue}var o=this.parseFunctionalExpression();if("error"===o.type)return o;e.push(o),t="binaryOperator";break;case"binaryOperator":if(this.consumeOperator.apply(this,d(c.iD))){var a=this.tokens[this.index-1];(0,r.h)("operator"===a.token.type,"Expected operator token"),e.push({type:"operator",operatorType:"binary",value:{node:a.token.value,location:a.location}}),t="expressionOrUnaryOperator"}else break t}return this.parseInfixSequence(e)}},{key:"parseInfixSequence",value:function(e){if((0,r.h)(0!==e.length,"Expected expression"),1===e.length)return(0,r.h)("operator"!==e[0].type,"Unexpected operator ".concat(JSON.stringify(e[0])," at beginning of infix sequence")),e[0];var t,n=e.map(function(e){var t,n;return"operator"===e.type&&null!=(n=null==(t=c.cP.get(e.value.node))?void 0:t.precedence)?n:0}),o=(t=Math).max.apply(t,d(n));(0,r.h)(o>0,"No valid operator found in infix sequence");var a=n.findIndex(function(e){return e===o});return(0,r.h)(a>-1,"No operator found with maximum precedence; this should not happen"),this.parseInfixSequence(this.resolveOperator(e,a))}},{key:"resolveOperator",value:function(e,t){(0,r.h)("operator"===e[t].type,"Expected operator at index ".concat(t,", but found expression: ").concat(JSON.stringify(e[t])));var n=e[t+1];if("operator"===n.type)return this.resolveOperator(e,t+1);switch(e[t].operatorType){case"unary":return d(e.slice(0,t)).concat([{type:"unaryOperator",operator:e[t].value,expr:n}],d(e.slice(t+2)));case"binary":var o=e[t-1],a=e[t+1];return(0,r.h)("operator"!==o.type&&"operator"!==a.type,"unreachable: left or right should not be an operator"),d(e.slice(0,t-1)).concat([{type:"binaryOperator",operator:e[t].value,left:o,right:a}],d(e.slice(t+2)))}}},{key:"checkLHS",value:function(e){switch(e.type){case"identifier":case"attribute":return e;case"constant":case"call":case"unaryOperator":case"binaryOperator":case"vectorLiteral":case"objectLiteral":case"if":case"do":case"customNode":return{type:"error",value:"Cannot assign to this expression",location:(0,o.x9)(e)}}}},{key:"parseStatement",value:function(){if(this.consumeKeyword("condition"))return this.parseConditionStatement();var e=this.parseExpression();if("error"===e.type)return e;if(this.consumeOperator("=")){var t=this.parseExpression();if("error"===t.type)return t;var n=this.checkLHS(e);return"error"===n.type?n:{type:"assignment",lhs:n,value:t}}return{type:"expression",value:e}}},{key:"parseIfExpression",value:function(){var e=this,t=this.tokens[this.index-1];if(!this.consumeBracket("("))return{type:"error",value:"Expected opening bracket ( after if",location:this.maybeLastNonEOLToken(-1).location};var n=this.parseExpression();if("error"===n.type)return n;if(!this.consumeBracket(")"))return{type:"error",value:"Expected closing bracket ) after if condition",location:this.maybeLastNonEOLToken(-1).location};if(!this.consumeBracket("{"))return{type:"error",value:"Expected opening bracket { after if condition",location:this.maybeLastNonEOLToken(-1).location};var r=this.parseStatements(!0,function(){return e.consumeBracket("}")},"Expected } after if block");if("error"===r.type)return r;var a=void 0;if(this.consumeKeyword("else")){if(!this.consumeBracket("{"))return{type:"error",value:"Expected opening bracket { after else",location:this.maybeLastNonEOLToken(-1).location};var i=this.parseStatements(!0,function(){return e.consumeBracket("}")},"Expected } after else block");if("error"===i.type)return i;a=i}var c=this.tokens[this.index-1];return{type:"if",entireLoc:(0,o.LU)(t.location,c.location),condition:n,then:r,else:a}}},{key:"parseDoExpression",value:function(){var e=this,t=this.tokens[this.index-1];if(!this.consumeBracket("{"))return{type:"error",value:"Expected opening bracket { after do",location:this.maybeLastNonEOLToken(-1).location};var n=this.parseStatements(!0,function(){return e.consumeBracket("}")},"Expected } after do block");if("error"===n.type)return n;var r=this.tokens[this.index-1];return{type:"do",entireLoc:(0,o.LU)(t.location,r.location),statements:"statements"===n.type?n.result:[n]}}},{key:"parseConditionStatement",value:function(){var e=this.tokens[this.index-1];if(!this.consumeBracket("("))return{type:"error",value:"Expected opening bracket ( after condition",location:this.maybeLastNonEOLToken(-1).location};var t=this.parseExpression();return"error"===t.type?t:this.consumeBracket(")")?{type:"condition",entireLoc:(0,o.LU)(e.location,this.tokens[this.index-1].location),condition:t,rest:[]}:{type:"error",value:"Expected closing bracket ) after condition",location:this.maybeLastNonEOLToken(-1).location}}},{key:"parseStatements",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!1},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Expected end of line or ; after",r=[];this.index<this.tokens.length&&!t();){for(;this.skipEOL(););if(this.index>=this.tokens.length)break;var a=this.parseStatement();if("error"===a.type)return a;if(r.push(a),t())break;if(!this.consumeOperator("EOL",";"))return{type:"error",value:n,location:this.maybeLastNonEOLToken(-1).location};for(;this.skipEOL(););}return this.index===this.tokens.length&&e?{type:"error",value:n,location:this.maybeLastNonEOLToken(-1).location}:function(e,t){if(1===(e=function e(t){for(var n=[],r=0;r<t.length;r++){var o,a=t[r];if("condition"===a.type){(o=a.rest).push.apply(o,d(e(t.slice(r+1)))),n.push(a);break}n.push(a)}return n}(e)).length)return e[0];var n=e.length>0?o.LU.apply(void 0,d(e.map(o.x9))):null!=t?t:i.tU;return{type:"statements",result:e,entireLoc:n}}(r,this.index>0?this.tokens[this.index-1].location:void 0)}},{key:"parseCustomNodeExpression",value:function(){var e=this.parseParenthesizedArgs();if(void 0===e)return{type:"error",value:"Expected arguments for customNode",location:this.maybeLastNonEOLToken(-1).location};if("error"===e.type)return e;var t=f(e.args,2),n=t[0],r=t[1],a=n[0];if(1!==n.length||"unnamed"!==a.type)return{type:"error",value:"Incorrect arguments for customNode, expected 1 unnamed argument",location:e.args[1]};if("constant"!==a.value.type||"string"!==a.value.value.node.type)return{type:"error",value:"Expected string constant as argument to customNode",location:(0,o.x9)(a)};var i=v(a.value.value.node.value,a.value.value.location.start.block);return"error"===i.type?{type:"customNode",expr:{type:"parseError",errors:i.errors,originalCode:a.value.value.node.value},originalCode:a.value.value.node.value,entireLoc:r}:{type:"customNode",expr:i,originalCode:a.value.value.node.value,entireLoc:r}}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}();function v(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=e.filter(function(e){return"error"===e.token.type});if(o.length>0){var a=o.map(function(e){return{type:"error",value:"Unrecognized token: ".concat(e.token.value),location:e.location}});return n?{type:"parseError",originalCode:t,errors:a}:{type:"error",errors:a}}var i=new m(e),c=i.parseStatements();return"error"===c.type?n?{type:"parseError",originalCode:t,errors:[c]}:{type:"error",errors:[c]}:((0,r.h)(i.index===i.tokens.length,"Parser did not consume all tokens: ".concat(i.index," < ").concat(i.tokens.length)),c)}((0,a.jx)(null!=t?t:{type:"multi"},e),e,n)}function h(e){var t,n=new Set;return(t=[],!function e(n){switch(n.type){case"unnamed":case"expression":return e(n.value),!0;case"named":return t.push(n.value),e(n.value),!0;case"constant":case"identifier":return t.push(n),!0;case"attribute":case"unaryOperator":return t.push(n),e(n.expr),!0;case"call":return t.push(n),e(n.fn),n.args.forEach(e),!0;case"binaryOperator":return t.push(n),e(n.left),e(n.right),!0;case"objectLiteral":return t.push(n),n.properties.forEach(function(r){var o=f(r,2),a=o[0],i=o[1];t.push({type:"constant",value:{node:{type:"string",value:a},location:n.entireLoc}}),e(i)}),!0;case"vectorLiteral":return t.push(n),n.elements.forEach(e),!0;case"assignment":return e(n.lhs),e(n.value),!0;case"statements":return n.result.forEach(e),!0;case"if":return e(n.condition),e(n.then),n.else&&e(n.else),!0;case"do":return n.statements.forEach(e),!0;case"condition":return e(n.condition),n.rest.forEach(e),!0;case"parseError":return!0;case"customNode":return e(n.expr),!0}}(e),t).forEach(function(e){"identifier"===e.type&&n.add(e.name.node)}),n}function b(e,t){for(var n=h(e);"break"!==function(){var e=new Set;if(n.forEach(function(r){var o,a=null==(o=t.getVariable(r))?void 0:o.type;void 0!==a&&"function"===a.type&&Object.entries(a.namedArgs).forEach(function(t){var r=f(t,2)[1].defaultValue;void 0!==r&&h(r).forEach(function(t){n.has(t)||e.add(t)})})}),0===e.size)return"break";e.forEach(function(e){return n.add(e)})}(););return n}function g(e,t){var n=v(e,{type:"single",ident:t},!0);return(0,r.h)("error"!==n.type,"Should not have an error"),n}function x(e,t,n){return(0,r.h)(!t.startsWith("undefined"),'blockId must not start with "undefined"'),{type:"customNode",expr:g(e,t),originalCode:e,expectedType:n,entireLoc:(0,a.PS)(t)}}function w(e,t){var n=g(e,t);return(0,r.h)("expression"===n.type,"Must be expression"),n.value}},89080:function(e,t,n){n.d(t,{Kz:()=>function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(0===n){if("number"==typeof t)return{type:"number"};if("string"==typeof t)return{type:"string"};if("boolean"==typeof t)return{type:"boolean"};if(null===t)return{type:"null"}}return(0,r.h)(Array.isArray(t),"Expected a primitive value, but got ".concat(void 0===t?"undefined":s(t))),e(t[0],n-1)},Mu:()=>m,Q2:()=>function e(t){return function t(n,r){var a=n.type;switch(a.type){case"boolean":case"null":case"number":return"".concat(n.value);case"string":return'"'.concat(n.value,'"');case"opaque":var i=n.value;switch(i.opaqueType){case"scale":case"pMap":case"cMap":case"cMapRGB":case"basemap":case"inset":case"insets":case"geoFeatureHandle":case"geoCentroidHandle":case"unit":return"[".concat(i.opaqueType," object]");case"color":var c=i.value;if(255===c.a)return"rgb(".concat(c.r/255,", ").concat(c.g/255,", ").concat(c.b/255,")");return"rgb(".concat(c.r/255,", ").concat(c.g/255,", ").concat(c.b/255,", a=").concat(c.a/255,")");case"outline":var l=i.value,s=l.color;if(255===s.a)return"constructOutline(color=rgb(".concat(s.r/255,", ").concat(s.g/255,", ").concat(s.b/255,"), weight=").concat(l.weight,")");return"constructOutline(color=rgb(".concat(s.r/255,", ").concat(s.g/255,", ").concat(s.b/255,", a=").concat(s.a/255,"), weight=").concat(l.weight,")");case"ramp":var p=d(i.value.map(function(e){var t=u(e,2),n=t[0],r=t[1];return new Map([["value",n],["color",{type:"opaque",opaqueType:"color",value:(0,o.u)(r)}]])}),{type:"vector",elementType:{type:"object",properties:new Map([["value",{type:"number"}],["color",{type:"opaque",name:"color"}]])}});return"[ramp ".concat(e(p),"]")}case"vector":var f=n.value;if(0===f.length)return"[]";return"[\n".concat(f.map(function(e){return"".concat(r,"    ").concat(t(d(e,a.elementType),"".concat(r,"    ")))}).join(",\n"),"\n").concat(r,"]");case"object":var y=n.value;if(0===y.size)return"{}";return"{\n".concat(Array.from(y.entries()).map(function(e){var n=u(e,2),o=n[0],i=n[1];return"".concat(r,"    ").concat(o,": ").concat(t(d(i,a.properties.get(o)),"".concat(r,"    ")))}).join(",\n"),"\n").concat(r,"}");case"function":return v(a)}}(t,"")},_N:()=>y,al:()=>f,gs:()=>function e(t,n,o){if("elementOfEmptyVector"===t.type)return n;if("elementOfEmptyVector"===n.type||v(t)===v(n))return t;if("vector"===t.type&&"vector"===n.type)return{type:"vector",elementType:e(t.elementType,n.elementType,o)};if("object"===t.type&&"object"===n.type){if(JSON.stringify(l(t.properties.keys()).sort())!==JSON.stringify(l(n.properties.keys()).sort()))throw o();var a=new Map,i=!0,c=!1,s=void 0;try{for(var p,f=t.properties[Symbol.iterator]();!(i=(p=f.next()).done);i=!0){var d=u(p.value,2),y=d[0],m=d[1];a.set(y,m)}}catch(e){c=!0,s=e}finally{try{i||null==f.return||f.return()}finally{if(c)throw s}}var h=!0,b=!1,g=void 0;try{for(var x,w=n.properties[Symbol.iterator]();!(h=(x=w.next()).done);h=!0){var k=u(x.value,2),E=k[0],S=k[1],O=e(a.get(E),S,o);(0,r.h)("elementOfEmptyVector"!==O.type,"Unreachable"),a.set(E,O)}}catch(e){b=!0,g=e}finally{try{h||null==w.return||w.return()}finally{if(b)throw g}}return{type:"object",properties:a}}throw o()},j6:()=>function e(t,n){if(v(t)===v(n))return!0;switch(n.type){case"number":case"string":case"boolean":case"null":case"opaque":case"function":return!1;case"vector":return(0,r.h)("elementOfEmptyVector"!==n.elementType.type,"Unreachable"),e(t,n.elementType);case"object":if("object"!==t.type||t.properties.size!==n.properties.size||!l(t.properties.keys()).every(function(e){return n.properties.has(e)}))return!1;return l(t.properties.keys()).every(function(r){return e(t.properties.get(r),n.properties.get(r))})}},vR:()=>h,wB:()=>v,xr:()=>d});var r=n(77053),o=n(54509),a=n(27193),i=n(88452);function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,c=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(c)throw r}}return a}}(e,t)||p(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function p(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}}var f=["basic","color","math","regression","mapper","logic","map","scale","ramp","unit","inset"];function d(e,t){return{type:t,value:e,documentation:void 0}}function y(e){return"number"==typeof e?{type:"constant",value:{node:{type:"number",value:e},location:a.tU}}:"string"==typeof e?{type:"constant",value:{node:{type:"string",value:e},location:a.tU}}:"boolean"==typeof e?{type:"identifier",name:{node:e.toString(),location:a.tU}}:{type:"identifier",name:{node:"null",location:a.tU}}}function m(e,t){return"concrete"===e.type?v(e.value)===v(t):"number"===t.type||"string"===t.type||"boolean"===t.type||"null"===t.type}function v(e){var t,n,o;if("number"===e.type)return"number";if("string"===e.type)return"string";if("boolean"===e.type)return"boolean";if("vector"===e.type)return"[".concat("elementOfEmptyVector"===e.elementType.type?"":v(e.elementType),"]");if("object"===e.type){return(0,r.h)((t=e.properties,null!=(n=Map)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?!!n[Symbol.hasInstance](t):t instanceof n),"Expected properties to be a Map, got ".concat(s(e.properties))),"{".concat(l(e.properties.entries()).sort().map(function(e){var t=u(e,2),n=t[0],r=t[1];return"".concat(n,": ").concat(v(r))}).join(", "),"}")}return"null"===e.type?"null":"opaque"===e.type?e.name:"(".concat(e.posArgs.map(h).join(", "),"; ").concat(Object.entries(e.namedArgs).map(function(e){var t,n,r=u(e,2),o=r[0],a=r[1];return"".concat(o,": ").concat((n=h((t=a).type),void 0!==t.defaultValue?"".concat(n," = ").concat((0,i.Z2)(t.defaultValue)):n))}).join(", "),") -> ").concat("concrete"===(o=e.returnType).type?v(o.value):"any")}function h(e){return"concrete"===e.type?v(e.value):"any"}},39517:function(e,t,n){n.d(t,{U:()=>C,z:()=>A});var r,o=n(84962),a=n(51859),i=n(21791),c=n(18848),u=n(22379),l=n(45375),s=n(36405),p=n(45437),f=n(77053),d=n(34672),y=n(44640),m=n(52594),v=n(27193),h=n(89080),b=n(20110);function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function x(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){n(e);return}c.done?t(u):Promise.resolve(u).then(r,o)}function w(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){x(a,r,o,i,c,"next",e)}function c(e){x(a,r,o,i,c,"throw",e)}i(void 0)})}}function k(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,c=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(c)throw r}}return a}}(e,t)||O(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||O(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){if(e){if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,t)}}function I(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(u){var l=[c,u];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}function A(e){var t=a.Z[e];return(0,f.h)(t.length>0,"No insets for universe ".concat(e)),(0,f.h)(t[0].mainMap,"No main map for universe ".concat(e)),t.map(function(e){return{bottomLeft:[e.bottomLeft[0],e.bottomLeft[1]],topRight:[e.topRight[0],e.topRight[1]],coordBox:S(e.coordBox),mainMap:e.mainMap}})}function C(e){var t=a.Z[e].map(function(e){return e.name}).map(function(e){var t=y.F6.get(e);return(0,f.h)(void 0!==t,"No inset constant for ".concat(e)),{type:"identifier",name:{node:t,location:v.tU}}});return{type:"call",fn:{type:"identifier",name:{node:"constructInsets",location:v.tU}},args:[{type:"unnamed",value:{type:"vectorLiteral",elements:t,entireLoc:v.tU}}],entireLoc:v.tU}}onmessage=function(e){return w(function(){return I(this,function(t){switch(t.label){case 0:var n;if(!("request"in e.data))return[2];return[4,(n=e.data.request,w(function(){var e,t,a,y,g,x,O;return I(this,function(C){switch(C.label){case 0:var j;return C.trys.push([0,2,,3]),[4,(j=n,w(function(){var e,t;return I(this,function(n){switch(n.label){case 0:switch(e=[],t=function(){return e.filter(function(e){return"warning"===e.type}).map(function(e){return{type:"error",value:e.message,location:e.location,kind:"warning"}})},j.descriptor.kind){case"generic":return[3,1];case"mapper":return[3,2]}return[3,4];case 1:return[2,[(0,o.Vh)(e),t]];case 2:var a,d;return[4,(a=j,d=e,w(function(){var e,t,n,o,y,m;return I(this,function(v){switch(v.label){case 0:if(e=a.descriptor.geographyKind,t=a.descriptor.universe,n=(0,s.A)(t),!i.Z.includes(e))throw Error("invalid geography");if((null==r?void 0:r.geographyKind)!==e||r.universe!==t)return[3,1];return o=r.longnames,[3,3];case 1:return[4,(0,l.gi)((0,p.Tw)(t,e),"ArticleOrderingList")];case 2:o=v.sent().longnames,r={universe:t,geographyKind:e,longnames:o,dataCache:new Map},v.label=3;case 3:return y=function(e,t){var r=n.get(e);return(0,f.h)(void 0!==r,"Type info for ".concat(e," not found")),{type:r.type,documentation:r.documentation,value:t}},m=function(n){return w(function(){var i,s,p,d,m;return I(this,function(v){switch(v.label){case 0:if((0,f.h)(void 0!==r,"mapperCache was initialized above and is never undefined after that"),"geoName"===n)return[2,y("geoName",o)];if("geo"===n)return[2,y("geo",o.map(function(e){return{type:"opaque",opaqueType:"geoFeatureHandle",value:e}}))];if("geoCentroid"===n)return[2,y("geoCentroid",o.map(function(e){return{type:"opaque",opaqueType:"geoCentroidHandle",value:e}}))];if("defaultInsets"===n)return[2,y("defaultInsets",{type:"opaque",opaqueType:"insets",value:A(a.descriptor.universe)})];if(!(i=u.Z.variableNames.find(function(e){return e.varName===n})))return[2,void 0];if(s=i.index,void 0!==(p=r.dataCache.get(n)))return[2,y(n,p)];return d=c.Z[s],[4,(0,l.Tm)(t,d,e)];case 1:return m=v.sent(),(0,f.h)(Array.isArray(m.value),"Expected variable data for ".concat(n," to be an array")),r.dataCache.set(n,m.value),[2,y(n,m.value)]}})})()},[4,(0,s.l)(a.stmts,m,d,t)];case 4:return[2,v.sent()]}})})())];case 3:return[2,[n.sent(),t]];case 4:return[2]}})})())];case 1:switch(e=(a=E.apply(void 0,[C.sent(),2]))[0],t=a[1],y=(0,m.ht)(n.stmts,e),n.descriptor.kind){case"generic":break;case"mapper":if("cMap"!==(0,h.wB)(y.type)&&"cMapRGB"!==(0,h.wB)(y.type)&&"pMap"!==(0,h.wB)(y.type))throw new m.Lv("USS expression did not return a cMap, cMapRGB, or pMap type, got: ".concat((0,h.wB)(y.type)),(0,d._x)(n.stmts))}return[2,{resultingValue:{type:y.type,value:function e(t){return k(t,Function)?null:Array.isArray(t)?t.map(e):k(t,Map)?new Map(Array.from(t.entries()).map(function(t){var n=E(t,2);return[n[0],e(n[1])]})):k(t,Object)&&k(t.value,Function)?((0,f.h)("scale"===t.opaqueType,"only scales can have functions in their value"),null):t}(y.value)},error:t(),context:new Map(S(e.variableEntries()).filter(function(e){var t;return null==(t=E(e,2)[1].documentation)?void 0:t.includedInOutputContext}))}];case 2:return k(g=C.sent(),m.Lv)?x=g:(b.error("Unknown interpretation error",g),x=new m.Lv("Unknown interpretation error",v.tU)),[2,{error:[{type:"error",value:x.value,location:x.location,kind:"error"}].concat(S(null!=(O=null==t?void 0:t())?O:[])),context:new Map}];case 3:return[2]}})})())];case 1:return postMessage({result:t.sent(),id:e.data.id}),[2]}})})()}},84635:function(e,t,n){var r;function o(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){n(e);return}c.done?t(u):Promise.resolve(u).then(r,o)}function a(e){var t;return(t=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(u){var l=[c,u];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(t){switch(t.label){case 0:return void 0===r&&(r=function(){var e,t=new Worker(new URL(n.p+n.u("438"),n.b),Object.assign({},{name:"sharedUSSWorker"},{type:void 0})),o=new Map;function a(){clearTimeout(e),e=setTimeout(function(){o.size>0?a():(t.terminate(),r=void 0)},1e4)}t.addEventListener("message",function(e){o.get(e.data.id)(e.data.result),o.delete(e.data.id)}),a();var i=0;return function(e){a();var n=++i;return t.postMessage({request:e,id:n}),new Promise(function(e){o.set(n,e)})}}()),[4,r(e)];case 1:return[2,t.sent()]}})},function(){var e=this,n=arguments;return new Promise(function(r,a){var i=t.apply(e,n);function c(e){o(i,r,a,c,u,"next",e)}function u(e){o(i,r,a,c,u,"throw",e)}c(void 0)})})()}n.d(t,{W:()=>a})},42055:function(e,t,n){n.r(t),n.d(t,{LongFormDocumentation:()=>k,USSDocumentationPanel:()=>h});var r=n(91410),o=n(72668),a=n(34837);n(21013),n(71540);var i=n(36405),c=n(66547),u=n(79779),l=n(1913),s=n(12132),p=n(34415),f=n(89080),d=n(77053),y=n(36195);function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,c=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){c=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(c)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(){var e=(0,y.Kn)();return o.createElement(r.Z,null,o.createElement(u.P,null,o.createElement(a.FootnotesProvider,null,o.createElement("div",{className:"serif"},o.createElement("div",{className:e},"USS Documentation"),o.createElement(S,{title:"Urban Stats Script (USS)",header:"h1",ident:"uss-title"},o.createElement("p",null,"Urban Stats Script (USS) is a scripting language for describing operations on data. It is designed to allow users to describe programs as if they refer to a single row of data, while simultaneously allowing global operations like regression."),o.createElement("p",null,"The basic syntax of USS should be familiar to any programmer. Arithmetic operations are written as you would expect. Feel free to edit the code below to see how the result changes:"),o.createElement(l.D,{ident:"aritmetic",getCode:function(){return"x = 2 ** 3 + 3 * 4\ny = x + 2\ny"}}),o.createElement("p",null,"A full list of operators is available"," ",o.createElement("a",{href:"#all-operators"},"here"),"."),o.createElement(S,{title:"Lists",header:"h2",ident:"lists"},o.createElement("p",null,"The language also supports lists, which are denoted by square brackets. You can use operators on these as well:"),o.createElement(l.D,{ident:"lists",getCode:function(){return"x = [1, 2, 3]\ny = x + [4, 5, 6]\ny"}}),o.createElement("p",null,"For details on broadcasting, see the"," ",o.createElement("a",{href:"#broadcasting"},"broadcasting")," ","section.")),o.createElement(S,{title:"Objects",header:"h2",ident:"objects"},o.createElement("p",null,"The language also supports objects, which are denoted by curly braces. You can use operators on these as well:"),o.createElement(l.D,{ident:"objects",getCode:function(){return"x = {a: 1, b: 2}\ny = x.a + x.b\ny"}})),o.createElement(S,{title:"Opaque Types",header:"h2",ident:"opaque-types"},o.createElement("p",null,"USS has several opaque types, which are types that you can only interact with via functions. For example, colors are opaque types, and you can only create them using functions like"," ",o.createElement("code",null,"rgb()"),", ",o.createElement("code",null,"hsv()"),", or one of the predefined colors."),o.createElement(l.D,{ident:"opaque-types",getCode:function(){return"x = rgb(0, 0, 1)\ny = hsv(0, 1, 1)\n[x, y, colorRed]"}}),o.createElement("p",null,"And you can only interact with them using functions like"," ",o.createElement("code",null,"renderColor()")," ","or in other contexts that use color objects."),o.createElement(l.D,{ident:"opaque-types",getCode:function(){return"x = rgb(0, 0, 1)\ny = hsv(0, 1, 1)\nrenderColor([x, y, colorRed])"}})),o.createElement(S,{title:"Regressions",header:"h2",ident:"regressions"},o.createElement("p",null,"USS supports linear regression via the"," ",o.createElement("code",null,"regress(y, x1, x2, ..., weight)")," ","function, which returns an object with several properties:"),o.createElement("ul",null,o.createElement("li",null,o.createElement("code",null,"b"),": The intercept of the regression line."),o.createElement("li",null,o.createElement("code",null,"m1, m2, m3..."),": The coefficients for each independent variable."),o.createElement("li",null,o.createElement("code",null,"r2"),": The R-squared value of the regression."),o.createElement("li",null,o.createElement("code",null,"residuals"),": The residuals of the regression.")),o.createElement("p",null,"For example, to perform a regression of y on x1 and x2, with the last point weighted more heavily, you could do:"),o.createElement(l.D,{ident:"regression",getCode:function(){return"x1 = [1, 2, 3, 4, 5]\nx2 = [2, 3, 2, 3, 2]\ny = [2.2, 2.8, 3.6, 4.5, 5.1]\nw = [1, 1, 1, 1, 10]\nmodel = regression(y=y, x1=x1, x2=x2, weight=w)\nmodel"}}),o.createElement("p",null,"Note that the inputs are all named arguments and the weight is optional.")),o.createElement(S,{title:"Aggregation",header:"h2",ident:"aggregation"},o.createElement("p",null,"USS provides several functions for aggregating data, including mean, median, quantile, percentile, min, max, sum, and more."),o.createElement("p",null,"For example, to calculate the mean of a vector, you can do:"),o.createElement(l.D,{ident:"aggregation",getCode:function(){return"mean([1, 2, 3, 4, 50])"}}),o.createElement("p",null,"We can also weight the mean, for example:"),o.createElement(l.D,{ident:"aggregation",getCode:function(){return"mean([1, 2, 3, 4, 50], weights=[1, 1, 1, 1, 10])"}}),o.createElement("p",null,"The same works for median, quantile, and percentile."),o.createElement(l.D,{ident:"aggregation",getCode:function(){return"percentile([1, 2, 3, 4, 50], 10, weights=[1, 1, 1, 1, 10])"}}),o.createElement("p",null,"On the other hand, min, max, and sum do not support weights."),o.createElement(l.D,{ident:"aggregation",getCode:function(){return"min([1, 2, 3, 4, 50])"}})),o.createElement(S,{title:"Broadcasting",header:"h2",ident:"broadcasting"},o.createElement("p",null,"Broadcasting is a feature of USS that allows you to operate on lists of values."),o.createElement(S,{title:"Forward Broadcasting",header:"h3",ident:"forward-broadcasting"},o.createElement("p",null,"The main kind of broadcasting is forward broadcasting, where you can apply operations to lists of elements. For example, if you have a list of numbers and you want to add 1 to each of them, you can do:"),o.createElement(l.D,{ident:"broadcasting",getCode:function(){return"x = [1, 2, 3]\ny = x + 1\ny"}}),o.createElement("p",null,"This will result in a list of numbers, where each element is 1 greater than the corresponding element in the original list."),o.createElement("p",null,"This also works with function calls, for example:"),o.createElement(l.D,{ident:"broadcasting-function",getCode:function(){return"x = [1, 2, 3]\ny = sin(x)\ny"}}),o.createElement("p",null,"Even when the list is of functions:"),o.createElement(l.D,{ident:"broadcasting-function-list",getCode:function(){return"x = [sin, cos, tan]\ny = x(pi)\ny"}}),o.createElement("p",null,"You can also apply broadcasting to objects, for example:"),o.createElement(l.D,{ident:"broadcasting-object",getCode:function(){return"x = [{a: 1, b: 2}, {a: 3, b: 4}, {a: 5, b: 6}]\ny = x.a\ny"}}),o.createElement("p",null,"And even assigning to a property:"),o.createElement(l.D,{ident:"broadcasting-object-property",getCode:function(){return"x = [{a: 1, b: 2}, {a: 3, b: 4}, {a: 5, b: 6}]\nx.a = [10, 20, 30]\nx"}})),o.createElement(S,{title:"Split Broadcasting",header:"h3",ident:"backward-broadcasting"},"There is also split broadcasting, which is what happens when you use an if statement. For example, in the following code, the if statement is split into two branches, one for when y is greater than 65 and one for when it is not.",o.createElement(l.D,{ident:"broadcasting",getCode:function(){return"x = [1, 2, 3]\ny = [50, 61, 70]\nif (y > 65) { x = x * 10 } else { x = x + 1 }\nx"}}),o.createElement("p",null,"The if statement is split into two branches, one for when y is greater than 65 and one for when it is not."),o.createElement("p",null,"Keep in mind that this is exactly two cases, rather than one for each element. Using mean() reveals this:"),o.createElement(l.D,{ident:"broadcasting",getCode:function(){return"x = [1, 2, 3]\ny = [50, 61, 70]\nif (y > 65) { x = mean(x) } else { x = mean(x) }\nx"}}))),o.createElement(S,{title:"Detailed Tables",header:"h2",ident:"detailed-tables"},o.createElement(S,{title:"All Operators",header:"h3",ident:"all-operators"},o.createElement("p",null,"The following is a list of all operators that are available in USS."),o.createElement(g,null))),o.createElement(S,{title:"Constants and Functions",header:"h2",ident:"constants"},o.createElement("p",null,"USS provides several built-in constants and functions for mathematical operations, data visualization, and data analysis. These are organized by category below."),o.createElement(x,null)))),o.createElement(a.Footnotes,null))))}function b(e,t,n){var r={table:{width:"100%",borderCollapse:"collapse",margin:"20px 0",fontSize:"14px",color:e.textMain},header:{border:"1px solid ".concat(e.borderNonShadow),padding:"12px",textAlign:"left",verticalAlign:"top",backgroundColor:e.background,fontWeight:"bold"},cell:{border:"1px solid ".concat(e.borderNonShadow),padding:"12px",textAlign:"left",verticalAlign:"top"},code:{backgroundColor:e.slightlyDifferentBackground,padding:"2px 4px",borderRadius:"3px",fontFamily:"'Courier New', monospace",fontSize:"13px"},rowColors:{even:e.slightlyDifferentBackground,odd:e.background}};return o.createElement("table",{style:r.table},o.createElement("thead",null,o.createElement("tr",null,t.map(function(e,t){return o.createElement("th",{key:t,style:r.header},e)}))),o.createElement("tbody",null,n.map(function(e,t){return o.createElement("tr",{key:t,style:{backgroundColor:t%2==0?r.rowColors.even:r.rowColors.odd}},e.map(function(e,t){return o.createElement("td",{key:t,style:r.cell},e)}))})))}function g(){var e=(0,c.cI)(),t=Array.from(p.cP.entries()).map(function(t){var n=v(t,2),r=n[0],a=n[1];return[o.createElement("code",{key:"operator",style:{backgroundColor:e.slightlyDifferentBackground,padding:"2px 4px",borderRadius:"3px",fontFamily:"'Courier New', monospace",fontSize:"13px"}},r),a.unary&&a.binary?"Unary/Binary":a.unary?"Unary":a.binary?"Binary":"Unknown",a.precedence,a.description,a.examples.map(function(t,n){return o.createElement("span",{key:n},o.createElement("code",{style:{backgroundColor:e.slightlyDifferentBackground,padding:"2px 4px",borderRadius:"3px",fontFamily:"'Courier New', monospace",fontSize:"13px"}},t),n<a.examples.length-1&&", ")})]});return b(e,["Operator","Type","Precedence","Description","Example"],t)}function x(){var e=v((0,o.useState)(new Set(f.al)),2),t=e[0],n=e[1],r=(0,i.A)("world"),a=new Map,c=!0,u=!1,l=void 0;try{for(var p,y=s.Z[Symbol.iterator]();!(c=(p=y.next()).done);c=!0){var m,h=v(p.value,2),b=h[0],g=h[1],x=null==(m=g.documentation)?void 0:m.category;(0,d.h)(void 0!==x,"Constant ".concat(b," does not have a category defined."));var k=a.get(x);void 0===k&&(k=[],a.set(x,k)),k.push([b,g])}}catch(e){u=!0,l=e}finally{try{c||null==y.return||y.return()}finally{if(u)throw l}}var E=!0,S=!1,O=void 0;try{for(var I,A=r[Symbol.iterator]();!(E=(I=A.next()).done);E=!0){var C,j=v(I.value,2),T=j[0],L=j[1];if(!s.Z.has(T)){var M=null==(C=L.documentation)?void 0:C.category;if((0,d.h)(void 0!==M,"Constant ".concat(T," does not have a category defined.")),f.al.includes(M)){var N=a.get(M);void 0===N&&(N=[],a.set(M,N)),N.push([T,L])}}}}catch(e){S=!0,O=e}finally{try{E||null==A.return||A.return()}finally{if(S)throw O}}var U=new Map,B=!0,D=!1,P=void 0;try{for(var R,q=s.Z[Symbol.iterator]();!(B=(R=q.next()).done);B=!0){var V,F=v(R.value,2),z=F[0],_=F[1],Z=null==(V=_.documentation)?void 0:V.documentationTable;if(void 0!==Z){var K=U.get(Z);void 0===K&&(K=[],U.set(Z,K)),K.push([z,_])}}}catch(e){D=!0,P=e}finally{try{B||null==q.return||q.return()}finally{if(D)throw P}}var H=f.al,$=Array.from(a.entries()).sort(function(e,t){return H.indexOf(e[0])-H.indexOf(t[0])}),W=function(e){n(function(t){var n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})};return o.createElement("div",null,$.map(function(e){var n=v(e,2),r=n[0],a=n[1],i=t.has(r);return o.createElement("div",{key:r},o.createElement("div",{style:{cursor:"pointer",display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},onClick:function(){W(r)}},o.createElement("span",{style:{fontSize:"16px",transition:"transform 0.2s",transform:i?"rotate(0deg)":"rotate(90deg)"}},"▶"),o.createElement("h3",{id:"constants-".concat(r),style:{margin:0}},function(e){switch(e){case"logic":return"Logic and Control";case"math":return"Mathematical Functions";case"color":return"Color Functions";case"unit":return"Unit Types";case"map":return"Map and Visualization";case"scale":return"Scaling Functions";case"ramp":return"Color Ramps";case"inset":return"Map Insets";case"regression":return"Statistical Analysis";case"basic":return"Basic Functions";case"mapper":return"Mapper Data Variables"}}(r))),!i&&o.createElement(w,{category:r,constants:a}))}))}function w(e){var t=[],n=new Map,r=!0,a=!1,i=void 0;try{for(var c,u=e.constants[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var l,s=v(c.value,2),p=s[0],f=s[1],d=null==(l=f.documentation)?void 0:l.documentationTable;if(void 0!==d){var y=n.get(d);void 0===y&&(y=[],n.set(d,y)),y.push([p,f])}else t.push([p,f])}}catch(e){a=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(a)throw i}}return o.createElement(o.Fragment,null,o.createElement("p",{style:{marginLeft:"20px"}},function(e){switch(e){case"logic":return"Boolean values and control flow constants.";case"math":return"Mathematical functions for arithmetic, trigonometry, and statistical operations.";case"color":return"Functions for creating and manipulating colors using RGB, HSV, and predefined color palettes.";case"unit":return"Unit type constants for specifying measurement units in data visualization.";case"map":return"Functions for creating choropleth maps, point maps, and map styling.";case"scale":return"Functions for scaling numeric data to visualization ranges.";case"ramp":return"Functions for creating and manipulating color ramps for data visualization.";case"inset":return"Functions for creating map insets and managing multiple map views.";case"regression":return"Statistical analysis functions for linear regression.";case"basic":return"Basic utility functions for type conversion and common operations.";case"mapper":return"The mapper provides several variables relevant to the current universe and set of geographic features."}}(e.category)),t.map(function(e){var t=v(e,2),n=t[0],r=t[1];return o.createElement(k,{key:n,name:n,value:r})}),Array.from(n.entries()).map(function(e){var t=v(e,2),n=t[0],r=t[1];return o.createElement(E,{key:n,tableName:n,tableConstants:r})}))}function k(e){var t,n,r,a,i=(0,c.cI)();return o.createElement(S,{key:e.name,title:e.name,header:"h4",ident:"constant-".concat(e.name)},o.createElement("div",{style:{marginBottom:"20px",marginLeft:"20px"}},o.createElement("div",{style:{marginBottom:"10px"}},"Type:",o.createElement("code",{style:{backgroundColor:i.slightlyDifferentBackground,padding:"4px 8px",borderRadius:"3px",fontFamily:"'Courier New', monospace",fontSize:"13px",marginLeft:"10px"}},(0,f.wB)(e.value.type))),o.createElement("div",{style:{marginBottom:"10px"}},null!=(a=null==(t=e.value.documentation)?void 0:t.longDescription)?a:"No description available."),(null==(n=e.value.documentation)?void 0:n.namedArgs)&&Object.keys(e.value.documentation.namedArgs).length>0&&o.createElement("div",{style:{marginBottom:"10px"}},o.createElement("strong",null,"Named Arguments:"),o.createElement("ul",{style:{margin:"5px 0 0 20px"}},Object.entries(e.value.documentation.namedArgs).map(function(e){var t=v(e,2),n=t[0],r=t[1];return o.createElement("li",{key:n},o.createElement("code",{style:{backgroundColor:i.slightlyDifferentBackground,padding:"2px 4px",borderRadius:"3px",fontFamily:"'Courier New', monospace",fontSize:"12px"}},n),":"," ",r)}))),(null==(r=e.value.documentation)?void 0:r.isDefault)&&o.createElement("div",{style:{marginBottom:"10px",color:i.textMain,fontStyle:"italic"}},"Default value for this type")))}function E(e){var t=(0,c.cI)(),n=e.tableConstants.map(function(e){var n,r,a,i=v(e,2),c=i[0],u=i[1];return[o.createElement("span",{key:"name",style:{fontFamily:"'Courier New', monospace"}},c),o.createElement("code",{key:"type",style:{backgroundColor:t.slightlyDifferentBackground,padding:"2px 4px",borderRadius:"3px",fontFamily:"'Courier New', monospace",fontSize:"12px"}},(0,f.wB)(u.type)),o.createElement("span",{key:"description"},null!=(a=null==(n=u.documentation)?void 0:n.longDescription)?a:"No description available.",(null==(r=u.documentation)?void 0:r.isDefault)&&o.createElement("span",{key:"default-indicator",style:{fontStyle:"italic",color:t.textMain}}," ","(default)"))]});return o.createElement("div",{key:e.tableName,style:{marginTop:"20px",marginLeft:"20px"}},o.createElement("h4",{style:{marginBottom:"15px"}},function(e){switch(e){case"predefined-colors":return"Predefined Color Constants";case"unit-types":return"Unit Type Constants";case"predefined-ramps":return"Predefined Color Ramps";case"predefined-insets":return"Predefined Map Insets";case"logarithm-functions":return"Logarithm Functions";case"trigonometric-functions":return"Trigonometric Functions";case"mapper-data-variables":return"Mapper Data Variables"}}(e.tableName)),o.createElement("p",{style:{marginBottom:"15px"}},function(e){switch(e){case"predefined-colors":return"Built-in color constants for common colors like red, blue, green, etc. Each color can be used directly in USS expressions.";case"unit-types":return"Unit type constants for specifying measurement units in data visualization and analysis.";case"predefined-ramps":return"Predefined color ramps for mapping numeric values to colors in data visualizations.";case"predefined-insets":return"Predefined map inset configurations for common geographic regions and territories.";case"logarithm-functions":return"Mathematical functions for computing logarithms with different bases (natural, base-10, base-2).";case"trigonometric-functions":return"Mathematical functions for trigonometric calculations (sine, cosine, arccosine, etc.).";case"mapper-data-variables":return"Variables used in the mapper."}}(e.tableName)),b(t,["Name","Type","Description"],n))}function S(e){return o.createElement(o.Fragment,null,o.createElement(e.header,{id:e.ident},e.title),e.children)}}}]);
//# sourceMappingURL=172.js.map