"use strict";(self.webpackChunkassets=self.webpackChunkassets||[]).push([["650"],{98853:function(e,t,n){n.r(t),n.d(t,{MapperPanel:()=>tl});var r=n(72668),o=n(78970),a=n(45988),i=n(6135),u=n(65547),c=n(4050),l=n(45375),s=n(15638),f=n(45437),p=n(41623),d=n(37014),m=n(69610),v=n(46347),y=n(34672),g=n(54509),b=n(69851),h=n(27193),w=n(39517),x=n(84635),E=n(56511);function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function S(e){return function(e){if(Array.isArray(e))return O(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||j(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){if(e){if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}}function P(e,t,n){var r=function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(u)throw r}}return a}}(t,2)||j(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),o=r[0],a=r[1];return function(t){var r=e(t);return S(r.slice(0,o)).concat(S(n),S(r.slice(a)))}}function A(e,t,n){return function(r){var o=e(r),a=o[t],i=o[n],u=Array.from(o);return u[n]=a,u[t]=i,u}}function k(e,t){return{modify:function(n){e.modify(t,n)},delete:function(){e.delete(t)},duplicate:function(){e.duplicate(t)},add:e.add,moveUp:function(){e.moveUp(t)},moveDown:function(){e.moveDown(t)}}}var C=n(13736),R=n(77053);function I(e){return e*Math.PI/180*6378137}function M(e){return 6378137*Math.log(Math.tan(Math.PI/4+e*Math.PI/360))}function B(e){var t=I(e[0]),n=I(e[2]),r=M(e[1]);return Math.abs((n-t)*(M(e[3])-r))}function D(e){(0,R.h)(e.length>0,"No insets with coordBox");var t,n,r,o=e.reduce(function(e,t){return B(t.coordBox)>B(e.coordBox)?t:e}),a=o.coordBox,i=o.topRight[0]-o.bottomLeft[0],u=o.topRight[1]-o.bottomLeft[1];return t=I(a[0]),n=I(a[2]),r=M(a[1]),Math.abs(n-t)/Math.abs(M(a[3])-r)/(i/u)}var U=n(2414),L=n(64455);function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function F(e,t){return"none"===e.type?{backgroundColor:e.backgroundColor,color:e.textColor}:{backgroundColor:t.background}}function G(e){var t,n,o=(0,m.cI)();return r.createElement("div",{style:(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}({width:"100%"},F(e.basemap,o)),n=n={padding:"10px"},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t)},e.ramp&&"label"===e.ramp.type&&r.createElement("div",{className:"centered_text user_input"},e.ramp.value),e.ramp&&"ramp"===e.ramp.type&&r.createElement(K,{ramp:e.ramp.value}))}function K(e){var t,n=e.ramp,o=(0,r.useRef)(null),a=(t=(0,r.useState)(!1),function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(u)throw r}}return a}}(t,2)||function(e,t){if(e){if("string"==typeof e)return T(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}}(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0],u=a[1];(0,r.useLayoutEffect)(function(){var e=o.current;if(null!==e){var t=function(){u(Array.from(e.querySelectorAll(".containerOfXticks")).some(function(e){var t=e.querySelector(".containedOfXticks");return null!==t&&t.offsetWidth>.9*e.offsetWidth}))};t();var n=new ResizeObserver(t);return n.observe(e),function(){n.unobserve(e)}}},[n]);var c=(0,r.useMemo)(function(){return(0,C.oX)(n.ramp.map(function(e){return e[1]}))},[n]),l="".concat(100/n.interpolations.length,"%"),s=function(e){return n.interpolations.map(function(t,o){return r.createElement("div",{key:o,style:{width:l,display:"flex",alignItems:"center",justifyContent:"center"},className:"containerOfXticks"},r.createElement("div",{style:{writingMode:e?"sideways-lr":"horizontal-tb",padding:e?"0.5em":"0"},className:"containedOfXticks"},r.createElement("div",{className:"centered_text"},r.createElement(L.$k,{statname:n.label,value:t,isUnit:!1,unit:n.unit}),r.createElement(L.$k,{statname:n.label,value:t,isUnit:!0,unit:n.unit}))))})};return r.createElement("div",{style:{position:"relative"}},r.createElement("div",{style:{display:"flex",width:"100%"}},n.interpolations.map(function(e,t){return r.createElement("div",{key:t,style:{width:l,height:"1em",backgroundColor:(0,C.BM)(n.ramp,n.scale.forward(e),c),marginLeft:"1px",marginRight:"1px"}})})),r.createElement("div",{ref:o,style:{position:"absolute",top:0,left:0,display:"flex",width:"100%",visibility:"hidden"}},s(!1)),r.createElement("div",{style:{display:"flex",width:"100%"}},s(i)),r.createElement("div",{className:"centered_text user_input"},n.label))}var N=n(49196),V=n(9313),z=n(58788),H=n(6381),_=n(27281),W=n(72547),X=n(96766),Z=n(75211),$=n(81600),J=n(88452),Q=n(89147),q=n(51647),Y=n(36195);function ee(e,t,n){var r="string"==typeof t?new Blob([t],{type:n}):t,o=URL.createObjectURL(r),a=document.createElement("a");a.href=o,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a)}var et=n(36405),en=n(41486),er=n(88609),eo=n(52594),ea=n(46207),ei=n(99448);function eu(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){n(e);return}u.done?t(c):Promise.resolve(c).then(r,o)}function ec(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function el(e){var t=e.mapSettings,n=e.setMapSettings;return r.createElement("div",{style:{display:"flex",gap:"0.5em",margin:"0.5em 0"}},r.createElement("button",{onClick:function(){var e;return(e=function(){var e,t;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){var l=[u,c];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:return[4,(0,ea.c)(".uss")];case 1:if((e=r.sent())===ea.B)return[2];return[4,e.text()];case 2:if(!(t=ef.apply(void 0,[r.sent()])).success)return alert(t.error),[2];return n(t.mapSettings),[2]}})},function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){eu(a,r,o,i,u,"next",e)}function u(e){eu(a,r,o,i,u,"throw",e)}i(void 0)})})()}},"Import Script"),r.createElement("button",{onClick:function(){var e;(0,en.saveAs)(new Blob([(e=t,'meta(kind="mapper", universe="'.concat(e.universe,'", geographyKind="').concat(e.geographyKind,'")\n').concat((0,J.Z2)(e.script.uss)))]),"urban_stats_mapper.uss")}},"Export Script"))}var es=er.z.object(ec({kind:er.z.literal("mapper")},ei.mapperMetaFields.shape));function ef(e){var t,n,r=(0,J.Qc)(e);if("error"===r.type)return{success:!1,error:"Parse Errors:\n".concat(r.errors.map(function(e){return"• ".concat(e.value," at ").concat((0,eo.i7)(e.location))}).join("\n"))};var o=void 0;if("statements"===r.type&&"expression"===r.result[0].type&&"call"===r.result[0].value.type&&"identifier"===r.result[0].value.fn.type&&"meta"===r.result[0].value.fn.name.node){var a=r.result[0].value;r.result.splice(0,1);var i=[],u=!0,c=!1,l=void 0;try{for(var s,f=a.args[Symbol.iterator]();!(u=(s=f.next()).done);u=!0){var p=s.value;if("unnamed"===p.type)return{success:!1,error:'"meta" function call at '.concat((0,eo.i7)(a.entireLoc)," must have only named arguments")};if("constant"!==p.value.type)return{success:!1,error:'"meta" function argument "'.concat(p.name.node,'" must have a constant value')};i.push([p.name.node,p.value.value.node.value])}}catch(e){c=!0,l=e}finally{try{u||null==f.return||f.return()}finally{if(c)throw l}}var d=es.safeParse(Object.fromEntries(i));if(!d.success)return{success:!1,error:"Error parsing metadata: ".concat(Object.values(d.error.flatten(function(e){return'• Parameter "'.concat(e.path,'" is ').concat(e.message)}).fieldErrors).join("\n"))};o=d.data}return{success:!0,mapSettings:(0,ei.defaultSettings)((t=ec({},o),n=n={script:{uss:(0,ei.convertToMapUss)(r)}},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t))}}var ep=n(83929),ed={fontWeight:500,fontSize:"1.2em",marginBottom:"0.125em",marginTop:"0.25em"},em=n(30444),ev=n(7500);function ey(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function eg(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function eb(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function eh(e){return function(e){if(Array.isArray(e))return ey(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return ey(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ey(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ew(e){var t=e.mapSettings,n=e.setMapSettings,o=e.errors,a=e.counts,i=e.typeEnvironment,u=t.script.uss,l=(0,r.useCallback)(function(e){return{text:null!=e?e:""}},[]),s=(0,r.useMemo)(function(){return[void 0].concat(eh(c.Z))},[]),f=(0,r.useMemo)(function(){return void 0===t.universe?void 0:[void 0].concat(eh((0,ep.d)(a,t.universe)))},[t.universe,a]);return r.createElement(r.Fragment,null,r.createElement("div",{style:ed},"Universe"),r.createElement(em.S,{possibleValues:s,value:t.universe,renderValue:l,onChange:function(e){n(eb(eg({},t),{universe:e,geographyKind:void 0===e||void 0===t.geographyKind||(0,ep.d)(a,e).includes(t.geographyKind)?t.geographyKind:void 0}))}}),f&&r.createElement(r.Fragment,null,r.createElement("div",{style:ed},"Geography Kind"),r.createElement(em.S,{possibleValues:f,value:t.geographyKind,renderValue:l,onChange:function(e){n(eb(eg({},t),{geographyKind:e}))}})),r.createElement(ev.ag,{uss:u,setUss:function(e){n(eb(eg({},t),{script:{uss:e}}))},typeEnvironment:i,errors:o}))}var ex=n(65344),eE=n(44640),eO=n(73001);function eS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var ej=eO.Ry({north:eO.Rx(),east:eO.Rx(),south:eO.Rx(),west:eO.Rx()}),eP=eO.n0(eO.Rf(eO.RE({fn:eO.QU("constructInset"),unnamedArgs:[],namedArgs:{mainMap:eO.O7(),name:eO.Z_(),screenBounds:ej,mapBounds:ej}})),function(e){var t=e.namedArgs,n=t.screenBounds,r=t.mapBounds,o=t.mainMap,a=t.name;return{bottomLeft:[n.west,n.south],topRight:[n.east,n.north],coordBox:[r.west,r.south,r.east,r.north],mainMap:o,name:a}}),eA=eO.n0(eO.RE({fn:eO.QU("constructInsets"),namedArgs:{},unnamedArgs:[eO.sS(eP)]}),function(e){return e.unnamedArgs[0]}),ek=eO.x2(eO.gh([eO.ID(),eO.s2({condition:eO.ID(),rest:[eO.th(eO.Hw(ev.Qc,ev.Py,eO.RE({fn:eO.ID(),unnamedArgs:[],namedArgs:{insets:eO.eP(eO.jt(eO.Rf(eA)))}})))]})]),function(e){return e[1].rest[0].namedArgs.insets});function eC(e,t){if("statements"===e.script.uss.type)try{var n,r=ek.parse(e.script.uss,t);if(void 0===r.currentValue&&void 0!==e.universe)return(0,w.v)(e.universe);return null==(n=r.currentValue)?void 0:n.currentValue}catch(e){}}function eR(e,t,n){var r=function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(u)throw r}}return a}}(t,2)||function(e,t){if(e){if("string"==typeof e)return eS(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eS(e,t)}}(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),o=r[0],a=r[1];return{insets:P(e.insets,[o,a],n),ast:P(e.ast,[o,a],n.map(eE.Rf))}}function eI(e,t,n){return{insets:A(e.insets,t,n),ast:A(e.ast,t,n)}}var eM=n(41277);function eB(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var eD={size:eO.jt(eO.Rx()),font:eO.jt(eO.Z_()),color:eO.jt(eO.n0(eM.VB,function(e){return null==e?void 0:e.color})),bold:eO.jt(eO.O7()),italic:eO.jt(eO.O7()),underline:eO.jt(eO.O7()),list:eO.jt(eO.n0(eO.G0(Object.keys(X.el).map(eO.QU)),function(e){return X.el[e]})),indent:eO.jt(eO.Rx()),align:eO.jt(eO.n0(eO.G0(Object.keys(X.D$).map(eO.QU)),function(e){return X.D$[e]}))},eU=eO.G0([["rtfString",function(e){return e}],["rtfFormula",function(e){return{formula:e}}],["rtfImage",function(e){return{image:e}}]].map(function(e){var t=function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(u)throw r}}return a}}(e,2)||function(e,t){if(e){if("string"==typeof e)return eB(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eB(e,t)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=t[0],r=t[1];return eO.n0(eO.RE({fn:eO.QU(n),unnamedArgs:[eO.Z_()],namedArgs:eD}),function(e){return{insert:r(e.unnamedArgs[0]),attributes:e.namedArgs}})})),eL=eO.n0(eO.RE({fn:eO.QU("rtfDocument"),unnamedArgs:[eO.xr(eU)],namedArgs:{}}),function(e){return e.unnamedArgs[0]}),eT=eO.n0(eO.RE({fn:eO.QU("textBox"),unnamedArgs:[],namedArgs:{screenBounds:ej,text:eL,backgroundColor:eO.n0(eO.jt(eM.VB),function(e){var t;return null!=(t=null==e?void 0:e.color)?t:Z.ce.backgroundColor}),borderColor:eO.n0(eO.jt(eM.VB),function(e){var t;return null!=(t=null==e?void 0:e.color)?t:Z.ce.borderColor}),borderWidth:eO.n0(eO.jt(eO.Rx()),function(e){return null!=e?e:Z.ce.borderWidth})}}),function(e){var t=e.namedArgs.screenBounds,n=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e.namedArgs,["screenBounds"]);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}({bottomLeft:[t.west,t.south],topRight:[t.east,t.north]},n)}),eF=eO.x2(eO.gh([eO.ID(),eO.s2({condition:eO.ID(),rest:[eO.th(eO.Hw(ev.Qc,ev.Py,eO.RE({fn:eO.ID(),unnamedArgs:[],namedArgs:{textBoxes:eO.eP(eO.jt(eO.xr(eT)))}})))]})]),function(e){return e[1].rest[0].namedArgs.textBoxes});function eG(e,t){if("statements"===e.script.uss.type)try{var n;return null!=(n=eF.parse(e.script.uss,t).currentValue)?n:[]}catch(e){}}function eK(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function eN(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){n(e);return}u.done?t(c):Promise.resolve(c).then(r,o)}function eV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function ez(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function eH(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(u)throw r}}return a}}(e,t)||eW(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e_(e){return function(e){if(Array.isArray(e))return eK(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||eW(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eW(e,t){if(e){if("string"==typeof e)return eK(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eK(e,t)}}function eX(e){var t=eH((0,r.useState)(e.mapSettings),2),n=t[0],o=t[1],a=eH((0,r.useState)("uss"),2),i=a[0],u=a[1],c=(0,r.useMemo)(function(){return new Q.Z(void 0)},[]),l=(0,$.C5)(n,c.value,o,function(e){c.value=e},{undoChunking:q.k.shared.isTesting?2e3:1e3,onlyElement:"uss"!==i?{current:null}:void 0}),s=l.updateCurrentSelection,f=l.addState,p=(0,r.useCallback)(function(e){o(e),f(e,c.value)},[c,f]),d=(0,r.useRef)(!0);(0,r.useEffect)(function(){d.current?d.current=!1:(p(e.mapSettings),u("uss"))},[e.mapSettings,p]);var m=JSON.stringify(ez(eV({},n),{script:{uss:(0,J.Z2)(n.script.uss)}})),v=(0,r.useContext)(H.C.Context);(0,r.useEffect)(function(){if(e.mapSettings!==n){var t=(0,z.gzipSync)(m).toString("base64");v.setMapperSettings(t)}},[m,v]);var y=(0,r.useMemo)(function(){return(0,et.A)(n.universe)},[n.universe]);(0,r.useEffect)(function(){var e=function(){s(c.value)};return c.observers.add(e),function(){c.observers.delete(e)}},[c,s]);var g=tt({mapSettings:n}),b={mapSettings:n,setMapSettings:p,typeEnvironment:y,setMapEditorMode:u,mapGenerator:g};return r.createElement(ex.I.Provider,{value:c},"textBoxes"===i&&r.createElement(e1,b),"insets"===i&&r.createElement(eq,b),"uss"===i&&r.createElement(r.Fragment,null,r.createElement(eZ,ez(eV({},b),{counts:e.counts})),l.ui))}function eZ(e){var t=e.mapSettings,n=e.setMapSettings,o=e.counts,a=e.typeEnvironment,i=e.setMapEditorMode,u=e.mapGenerator,c=u.ui({mode:"uss"}),l=c.exportImage,s=l?function(){var e;return(e=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){var l=[u,c];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(e){switch(e.label){case 0:return[4,l()];case 1:return[4,fetch(e.sent().toDataURL("image/png"))];case 2:return[4,e.sent().blob()];case 3:return ee("map.png",e.sent(),"image/png"),[2]}})},function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){eN(a,r,o,i,u,"next",e)}function u(e){eN(a,r,o,i,u,"throw",e)}i(void 0)})})()}:void 0;return r.createElement(W.P,{csvExportData:u.exportCSV,screencap:s,showFooter:!1},r.createElement(eJ,{error:u.errors.some(function(e){return"error"===e.kind}),left:r.createElement(ew,{mapSettings:t,setMapSettings:n,errors:u.errors,counts:o,typeEnvironment:a}),right:r.createElement(r.Fragment,null,r.createElement("div",{style:{display:"flex",justifyContent:"space-between",gap:"0.5em"}},r.createElement(e0,{pngExport:s,geoJSONExport:u.exportGeoJSON}),eC(t,a)&&r.createElement("div",{style:{display:"flex",gap:"0.5em",margin:"0.5em 0"}},r.createElement("button",{onClick:function(){i("insets")}},"Edit Insets")),eG(t,a)&&r.createElement("div",{style:{display:"flex",gap:"0.5em",margin:"0.5em 0"}},r.createElement("button",{onClick:function(){i("textBoxes")}},"Edit Text Boxes")),r.createElement(el,{mapSettings:t,setMapSettings:n})),r.createElement("div",{style:{position:"relative",flex:1}},c.node))}))}var e$=r.createContext(!1);function eJ(e){var t=e.left,n=e.right,o=e.error;return(0,Y.wd)()?r.createElement(r.Fragment,null,t,n):r.createElement(eQ,{error:o,left:t,right:n})}function eQ(e){var t=e.left,n=e.right,o=e.error,a=eH((0,r.useState)(0),2),i=a[0],u=a[1],c=(0,r.useRef)(null),l=(0,m.cI)(),s=(0,r.useCallback)(function(){if(c.current){var e=c.current.getBoundingClientRect();u(window.innerHeight-e.top-8)}},[]);(0,r.useLayoutEffect)(function(){return s(),window.addEventListener("resize",s),function(){window.removeEventListener("resize",s)}},[s]);var f=eH((0,_.yu)("mapperSettingsColumnProp"),2),p=f[0],d=f[1],v=eH((0,r.useState)(void 0),2),y=v[0],g=v[1],b=(0,r.useRef)(null),h=function(){return w/c.current.offsetWidth};(0,r.useEffect)(function(){null!==b.current&&(b.current.style.cursor=p===h()?"e-resize":p===E?"w-resize":"col-resize")});var w=540*!!t,x=t?"".concat(100*p,"%"):"0%",E=.5;return r.createElement(e$.Provider,{value:!0},r.createElement("div",{style:{display:"flex",height:i,position:"relative"},ref:c},t&&r.createElement(r.Fragment,null,r.createElement("div",{"data-test":"split-left",style:{width:x,minWidth:w,overflowY:"scroll",backgroundColor:(0,C.bt)(l.hueColors.red,o?.8:1,l.slightlyDifferentBackground),padding:"1em",borderRadius:"5px"}},t),r.createElement("div",{ref:b,style:{width:"1em",position:"relative"},onPointerDown:function(e){if(void 0===y){var t=e.target;g({pointerId:e.pointerId,startOffsetX:e.nativeEvent.offsetX+t.offsetLeft,startProp:Math.max(h(),p)}),t.setPointerCapture(e.pointerId)}},onPointerMove:function(e){if(e.pointerId===(null==y?void 0:y.pointerId)){var t=(e.target.offsetLeft+e.nativeEvent.offsetX-y.startOffsetX)/c.current.offsetWidth;d(Math.max(h(),Math.min(y.startProp+t,E)))}},onPointerCancel:function(e){(null==y?void 0:y.pointerId)===e.pointerId&&g(void 0)},onPointerUp:function(e){(null==y?void 0:y.pointerId)===e.pointerId&&g(void 0)}},r.createElement("div",{style:{backgroundColor:l.borderNonShadow,borderRadius:"5px",position:"absolute",width:"5px",left:"calc(50% - 2px)",height:"50%",top:"25%",pointerEvents:"none"}}))),r.createElement("div",{style:{width:"calc(100% - max(".concat(w,"px, ").concat(x,") - ").concat("1em",")"),display:"flex",flexDirection:"column",justifyContent:"center"}},n)))}function eq(e){var t=e.mapSettings,n=e.setMapSettings,o=e.typeEnvironment,a=e.setMapEditorMode,i=e.mapGenerator,u=(0,m.cI)(),c=eH((0,r.useState)({ast:function(e){return e},insets:function(e){return e}}),2),l=c[0],s=c[1],f=(0,$.C5)(l,void 0,s,function(){}),p=f.addState,d=f.ui,v=f.canUndo,y=l.insets(eC(t,o)),g=function(e){s(e),p(e,void 0)},b=i.ui({mode:"insets",editInsets:{add:function(){var e,n=ez(eV({},(0,w.v)(null!=(e=t.universe)?e:"world")[0]),{bottomLeft:[.25,.25],topRight:[.75,.75],mainMap:!1});g(eR(l,[y.length,y.length],[eY(n,y)]))},modify:function(e,t){g(eR(l,[e,e+1],[eV({},y[e],t)]))},delete:function(e){g(eR(l,[e,e+1],[]))},duplicate:function(e){g(eR(l,[e+1,e+1],[eY(y[e],y)]))},moveUp:function(e){(0,R.h)(e+1<y.length,"Cannot move inset ".concat(e," up, already top")),g(eI(l,e,e+1))},moveDown:function(e){(0,R.h)(e>0,"Cannot move inset ".concat(e," down, already bottom")),g(eI(l,e,e-1))},edited:y}});return r.createElement(W.P,{csvExportData:i.exportCSV,showFooter:!1},r.createElement(eJ,{left:void 0,error:!1,right:r.createElement(r.Fragment,null,r.createElement("div",{style:{backgroundColor:u.slightlyDifferentBackgroundFocused,borderRadius:"5px",padding:"10px",margin:"10px 0",display:"flex",justifyContent:"space-between",gap:"0.5em"}},r.createElement("div",null,r.createElement("b",null,"Editing Insets.")," ","Pans and zooms to maps will be reflected permanently. Drag inset frames to reposition and resize."),r.createElement("div",{style:{display:"flex",gap:"10px"}},r.createElement("button",{onClick:function(){a("uss")}},"Cancel"),r.createElement("button",{onClick:function(){var e,r,i;n(ez(eV({},t),{script:{uss:((0,R.h)("statements"===t.script.uss.type,"Trying to do an inset edit on USS that is not inset editable"),r=ek.parse(t.script.uss,o),(0,R.h)(void 0!==t.universe,"Trying to do an inset edit on USS that is not inset editable"),e=void 0!==r.currentValue?r.expr:(0,w.U)(t.universe),i=eA.parse(e,o).edit(l.ast),r.edit(i))}})),a("uss")},disabled:!v},"Accept"))),r.createElement("div",{style:{flex:1,position:"relative"}},b.node))}),d)}function eY(e,t){for(var n=0;n<1;n+=.05)for(var r=0,o=[[n,n],[-n,-n],[-n,n],[n,-n]];r<o.length;r++){var a=function(n,r){var o=eH(r[n],2),a=o[0],i=o[1],u=ez(eV({},e),{bottomLeft:[e.bottomLeft[0]+a,e.bottomLeft[1]+i],topRight:[e.topRight[0]+a,e.topRight[1]+i]});if(u.bottomLeft.concat(u.topRight).every(function(e){return e>=0&&e<=1})&&!t.some(function(e){return u.bottomLeft[0]===e.bottomLeft[0]&&u.bottomLeft[1]===e.bottomLeft[1]&&u.topRight[0]===e.topRight[0]&&u.topRight[1]===e.topRight[1]}))return{v:u}}(r,o);if("object"==(a&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a))return a.v}return e}function e0(e){var t=function(){void 0!==e.pngExport&&e.pngExport()},n=function(){void 0!==e.geoJSONExport&&ee("map.geojson",e.geoJSONExport(),"application/geo+json")};return r.createElement("div",{style:{display:"flex",gap:"0.5em",margin:"0.5em 0"}},r.createElement("button",{disabled:void 0===e.pngExport,onClick:function(){t()}},"Export as PNG"),r.createElement("button",{disabled:void 0===e.geoJSONExport,onClick:function(){n()}},"Export as GeoJSON"),r.createElement("button",{onClick:function(){var e=new URLSearchParams(window.location.search);e.set("view","true"),window.open("?".concat(e.toString()),"_blank")}},"View as Zoomable Page"))}function e1(e){var t=e.mapSettings,n=e.setMapSettings,o=e.typeEnvironment,a=e.setMapEditorMode,i=e.mapGenerator,u=(0,m.cI)(),c=eH((0,r.useState)(function(){return eG(t,o)}),2),l=c[0],s=c[1],f=(0,r.useMemo)(function(){return new Q.Z(void 0)},[]),p=(0,$.C5)(l,void 0,s,function(e){f.value=e}),d=p.addState,v=p.ui,y=p.canUndo,g=p.updateCurrentSelection;(0,r.useEffect)(function(){var e=function(){g(f.value)};return f.observers.add(e),function(){f.observers.delete(e)}},[f,g]);var b=function(e){s(e),d(e,f.value)},w=i.ui({mode:"textBoxes",editTextBoxes:{add:function(){var e=eV({bottomLeft:[.25,.25],topRight:[.75,.75],text:[{insert:"\n"}]},Z.ce);b(e_(l).concat([eY(e,l)])),f.value={index:l.length,range:{index:0,length:0}}},modify:function(e,t){b(l.map(function(n,r){return e===r?eV({},n,t):n}))},delete:function(e){var t;b(l.filter(function(t,n){return n!==e})),(null==(t=f.value)?void 0:t.index)===e&&(f.value=void 0)},duplicate:function(e){b(e_(l).concat([eY(l[e],l)])),f.value={index:l.length,range:{index:0,length:(0,X.Ie)(l[e].text)}}},moveUp:function(e){var t;(0,R.h)(e+1<l.length,"Cannot move text box ".concat(e," up, already top")),b(l.map(function(t,n){switch(n){case e:return l[e+1];case e+1:return l[e];default:return t}})),(null==(t=f.value)?void 0:t.index)===e&&(f.value=ez(eV({},f.value),{index:e+1}))},moveDown:function(e){var t;(0,R.h)(e>0,"Cannot move inset ".concat(e," down, already bottom")),b(l.map(function(t,n){switch(n){case e:return l[e-1];case e-1:return l[e];default:return t}})),(null==(t=f.value)?void 0:t.index)===e&&(f.value=ez(eV({},f.value),{index:e-1}))},edited:l}});return r.createElement(W.P,{csvExportData:i.exportCSV,showFooter:!1},r.createElement(V.Iw.Provider,{value:f},r.createElement(eJ,{left:void 0,error:!1,right:r.createElement(r.Fragment,null,r.createElement("div",{style:{backgroundColor:u.slightlyDifferentBackgroundFocused,borderRadius:"5px",padding:"10px",margin:"10px 0",display:"flex",justifyContent:"space-between",gap:"0.5em"}},r.createElement("div",null,r.createElement("b",null,"Editing Text Boxes.")),r.createElement("div",{style:{display:"flex",gap:"10px"}},r.createElement("button",{onClick:function(){a("uss")}},"Cancel"),r.createElement("button",{onClick:function(){n(ez(eV({},t),{script:{uss:((0,R.h)("statements"===t.script.uss.type,"Trying to do an text boxes edit on USS that is not text boxes editable"),eF.parse(t.script.uss,o).edit(0===l.length?void 0:{type:"vectorLiteral",elements:l.map(Z.Rf),entireLoc:h.tU}))}})),a("uss")},disabled:!y},"Accept"))),r.createElement("div",{style:{flex:1,position:"relative"}},w.node))}),v))}function e2(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function e5(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){n(e);return}u.done?t(c):Promise.resolve(c).then(r,o)}function e4(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){e5(a,r,o,i,u,"next",e)}function u(e){e5(a,r,o,i,u,"throw",e)}i(void 0)})}}function e3(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function e6(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function e7(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(u)throw r}}return a}}(e,t)||e9(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e8(e){return function(e){if(Array.isArray(e))return e2(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||e9(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e9(e,t){if(e){if("string"==typeof e)return e2(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e2(e,t)}}function te(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){var l=[u,c];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}function tt(e){var t=e.mapSettings,n=(0,r.useRef)({}),o=(0,r.useRef)(Date.now()),a=e7((0,r.useState)(function(){return tn({mapSettings:t,cache:n.current,previousGenerator:void 0})}),2),i=a[0],u=a[1];(0,r.useEffect)(function(){var e=Date.now()-o.current;if(e>500){o.current=Date.now(),u(function(e){return tn({mapSettings:t,cache:n.current,previousGenerator:e})});return}o.current=Date.now();var r=setTimeout(function(){u(function(e){return tn({mapSettings:t,cache:n.current,previousGenerator:e})})},500-e);return function(){clearTimeout(r)}},[t]);var c=(0,U.a)(i),l=c.result,s=c.loading;return void 0!==l?e6(e3({},l),{ui:function(e){return l.ui(e6(e3({},e),{loading:s}))}}):{ui:function(){return{node:r.createElement(ti,{universe:t.universe,loading:s})}},errors:[]}}function tn(e){return e4(function(e){var t,n,p,w,O,S,j,P,A,R,I,M,B,U,L,T,K,z;function H(e){var t=e.props,n=e.exportImageRef,a=[],i=(0,r.useRef)(null),c=(0,r.useRef)(null),l=("insets"===t.mode?t.editInsets.edited:M.value.insets).flatMap(function(e){var n,r,o,a=(n=e,r=T,o=n.coordBox,n.mainMap||(r=r.filter(function(e){var t=(0,s.boundingBox)(e.geometry);return t.getWest()<o[2]&&t.getEast()>o[0]&&t.getNorth()>o[1]&&t.getSouth()<o[3]})),r);return 0===a.length&&"insets"!==t.mode?[]:[{inset:e,insetFeatures:a}]}),f=l.map(function(e,n,o){var u=e.inset,c=e.insetFeatures;return r.createElement(N.f,{i:n,key:n,inset:u,ref:function(e){return a[n]=e},container:i,numInsets:o.length,editInset:"insets"===t.mode?k(t.editInsets,n):void 0,interactive:"textBoxes"!==t.mode},K(c,["uss","view"].includes(t.mode)))}),p=l.map(function(e){return e.inset}),v=r.createElement(G,{ramp:z,basemap:M.value.basemap}),y=e7((0,r.useState)(!1),2),g=y[0],b=y[1],h=(0,m.cI)();n(function(){return e4(function(){var e;return te(this,function(t){return b(!0),e=a.map(function(e){return e.getMap()}).map(to),[2,new Promise(function(t){setTimeout(function(){return e4(function(){return te(this,function(n){switch(n.label){case 0:return[4,(0,u.d_)(c.current,tu*tr,1,{mapBorderRadius:0,testing:!1})];case 1:var r,a,i;return[4,(r=n.sent(),a=M.value.basemap,i=h,e4(function(){var e,t,n,u,c,l,s,f,p,m;return te(this,function(v){switch(v.label){case 0:return t=(e=F(a,i)).backgroundColor,u=void 0===(n=e.color)?i.screenshotFooterUrl:d.J[50>(0,o.Z)(n).l()?"Light Mode":"Dark Mode"].screenshotFooterUrl,[4,(0,E.p)(u)];case 1:return c=v.sent(),l=50*tr,s=c.width*(l/c.height),f=10*tr,m=(p=document.createElement("canvas")).getContext("2d"),p.width=r.width,p.height=r.height+l-f,m.drawImage(r,0,0),m.fillStyle=t,m.fillRect(0,r.height,r.width,l),m.drawImage(c,p.width-s,p.height-l,s,l),[2,p]}})})())];case 2:return t(n.sent()),b(!1),e.forEach(function(e){e()}),[2]}})})()})})]})})()});var w="insets"===t.mode?void 0:r.createElement(m.AV,{theme:"Light Mode"},("textBoxes"===t.mode?t.editTextBoxes.edited:M.value.textBoxes).map(function(e,n,o){return r.createElement(V.P0,{container:i,key:n,textBox:e,i:n,count:o.length,edit:"textBoxes"===t.mode?k(t.editTextBoxes,n):void 0})}).concat("textBoxes"===t.mode?[r.createElement(V.bs,{key:"add",container:i,add:t.editTextBoxes.add})]:[]));return r.createElement(u.t.Provider,{value:g},r.createElement(ta,{maps:f,loading:t.loading,colorbar:v,aspectRatio:D(p),mapsContainerRef:i,wholeRenderRef:c,textBoxes:w}))}return te(this,function(o){switch(o.label){case 0:if(t=e.mapSettings,n=e.cache,p=e.previousGenerator,w=function(e){var n=e.loading;return{node:r.createElement(ti,{universe:t.universe,loading:n})}},void 0===t.geographyKind||void 0===t.universe)return[2,{ui:w,errors:[{kind:"error",type:"error",value:"Select a Universe and Geography Kind",location:h.tU}]}];if(O=(0,ei.computeUSS)(t.script),!((S=(0,y.ZP)(O)).length>0))return[3,2];return[4,p];case 1:return[2,e6(e3({},j=o.sent()),{ui:null!=(P=null==j?void 0:j.ui)?P:w,errors:S.map(function(e){return e6(e3({},e),{kind:"error"})})})];case 2:return[4,(0,x.W)({descriptor:{kind:"mapper",geographyKind:t.geographyKind,universe:t.universe},stmts:O})];case 3:if(void 0!==(A=o.sent()).resultingValue)return[3,5];return[4,p];case 4:return[2,e6(e3({},R=o.sent()),{ui:null!=(I=null==R?void 0:R.ui)?I:w,errors:A.error})];case 5:return M=A.resultingValue.value,B=(0,a.lM)(M,A.context),U="".concat(t.geographyKind,"-").concat(t.universe,"-data.csv"),[4,function(e){return e4(function(e){var t,n,o,a,u,p,d,m,y,h,w,x,E,O,S;return te(this,function(j){var P,A,k,R,I,M,B,D;switch(j.label){case 0:switch(n=(t=e.mapResultMain).opaqueType,o=t.value,a=e.universe,u=e.geographyKind,p=e.cache,n){case"pMap":case"cMap":y=(0,b._K)(o.scale),h=(0,C.oX)(o.ramp.map(function(e){return e[1]})),w=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1].map(y.inverse),d={type:"ramp",value:{ramp:o.ramp,interpolations:w,scale:y,label:o.label,unit:o.unit}},m=o.data.map(function(e){return(0,C.BM)(o.ramp,y.forward(e),h)});break;case"cMapRGB":m=o.dataR.map(function(e,t){return(0,g.XF)({r:e,g:o.dataG[t],b:o.dataB[t],a:1})}),d={type:"label",value:o.label}}switch(n){case"pMap":return[3,1];case"cMap":case"cMapRGB":return[3,3]}return[3,5];case 1:return O=Array.from(o.data.entries()).map(function(e){var t=e7(e,2),n=t[0],r=t[1];return{name:o.geo[n],fillColor:m[n],fillOpacity:1,radius:Math.sqrt(o.relativeArea[n])*o.maxRadius,statistic:r}}),[4,(P=u,A=a,k=O,R=p,e4(function(){var e,t,n,r,o;return te(this,function(a){switch(a.label){case 0:if((null==(e=R.geo)?void 0:e.type)==="points"&&R.geo.universe===A&&R.geo.geographyKind===P)return[3,3];return t=(0,f.Tw)(A,P),[4,(0,l.gi)(t,"ArticleOrderingList")];case 1:return n=a.sent(),[4,(0,v.y7)(A,P,n.longnames)];case 2:r=a.sent(),R.geo={type:"points",universe:A,geographyKind:P,centroidsByName:new Map(n.longnames.map(function(e,t){return[e,r[t]]}))},a.label=3;case 3:return o=R.geo,[2,k.map(function(e){var t=o.centroidsByName.get(e.name);return{type:"Feature",properties:e3({},e),geometry:{type:"Point",coordinates:[t.lon,t.lat]}}})]}})})())];case 2:return x=j.sent(),E=function(e,t){return r.createElement(i.Oy,{features:e,clickable:t})},[3,5];case 3:return S=Array.from(m.entries()).map(function(e){var t,r=e7(e,2),a=r[0],i=r[1];switch(n){case"cMap":t={statistic:o.data[a]};break;case"cMapRGB":t={statistic:[o.dataR[a],o.dataG[a],o.dataB[a]]}}return e3({name:o.geo[a],fillColor:i,fillOpacity:1,color:(0,g.XF)(o.outline.color),weight:o.outline.weight},t)}),[4,(I=u,M=a,B=S,D=p,e4(function(){var e,t,n,r,o,a;return te(this,function(i){switch(i.label){case 0:if((null==(e=D.geo)?void 0:e.type)==="polygons"&&D.geo.universe===M&&D.geo.geographyKind===I)return[3,2];return t=c.Z.indexOf(M),[4,(0,l.gi)((0,f.UM)(I),"ConsolidatedShapes")];case 1:for(o=0,n=i.sent(),r=new Map;o<n.longnames.length;o++)n.universes[o].universeIdxs.includes(t)&&r.set(n.longnames[o],(0,s.geometry)(n.shapes[o]));D.geo={type:"polygons",universe:M,geographyKind:I,polygonsByName:r},i.label=2;case 2:return a=D.geo,[2,B.map(function(e){return{type:"Feature",properties:e3({},e),geometry:a.polygonsByName.get(e.name)}})]}})})())];case 4:return x=j.sent(),E=function(e,t){return r.createElement(i.uy,{features:e,clickable:t})},[3,5];case 5:return[2,{features:x,mapChildren:function(e,t){return r.createElement(r.Fragment,null,E(e,t),r.createElement(i.Es,{basemap:o.basemap}))},ramp:d}]}})}).apply(this,arguments)}({mapResultMain:M,universe:t.universe,geographyKind:t.geographyKind,cache:n})];case 6:return T=(L=o.sent()).features,K=L.mapChildren,z=L.ramp,[2,{errors:A.error,exportCSV:{csvData:B,csvFilename:U},exportGeoJSON:function(){return JSON.stringify({type:"FeatureCollection",features:T},null,2)},ui:function(e){var t;return{node:r.createElement(H,{props:e,exportImageRef:function(e){return t=e}}),exportImage:function(){return t()}}}}]}})}).apply(this,arguments)}var tr=4;function to(e){var t,n=e.getPixelRatio();e.setPixelRatio(tr);var r=e.getContainer().querySelector(".maplibregl-ctrl-attrib");if(null!==r){var o=r.style.display;r.style.display="none",t=function(){return r.style.display=o}}return function(){e.setPixelRatio(n),null==t||t()}}function ta(e){var t=e.maps,n=e.colorbar,o=e.loading,a=e.mapsContainerRef,i=e.aspectRatio,u=e.wholeRenderRef,c=e.textBoxes;return r.createElement(tc,null,r.createElement("div",{ref:u,style:{display:"flex",flexDirection:"column",position:"relative",minHeight:0}},r.createElement(p._h,{loading:o}),r.createElement("div",{style:{width:"100%",aspectRatio:i}},r.createElement("div",{ref:a,style:{aspectRatio:i,position:"relative",maxHeight:"100%",margin:"auto"}},t,c)),n))}function ti(e){var t=e.universe,n=e.loading,o=(0,w.v)(null!=t?t:"world");return r.createElement(ta,{maps:o.map(function(e,t){return r.createElement(N.f,{i:t,key:t,inset:e,container:r.createRef(),numInsets:o.length,interactive:!1},null)}),textBoxes:null,loading:n,colorbar:null,aspectRatio:D(o)})}var tu=1200;function tc(e){var t=e.children,n=e7((0,r.useState)({scale:1,top:0,left:0,selfDeterminedHeight:0}),2),o=n[0],a=n[1],i=(0,r.useRef)(null),u=(0,r.useRef)(null);return(0,r.useEffect)(function(){var e=function(){if(null!==i.current&&null!==u.current){var e,t=(e=Math).min.apply(e,e8([i.current.offsetWidth/tu].concat(e8(i.current.offsetHeight>0?[i.current.offsetHeight/u.current.offsetHeight]:[]))));a({scale:t,top:Math.max(0,(i.current.offsetHeight-u.current.offsetHeight*t)/2),left:Math.max(0,(i.current.offsetWidth-u.current.offsetWidth*t)/2),selfDeterminedHeight:u.current.offsetHeight*t})}};e();var t=new ResizeObserver(e);return t.observe(i.current),t.observe(u.current),function(){t.disconnect()}},[]),r.createElement("div",{ref:i,style:e6(e3({},(0,r.useContext)(e$)?{position:"absolute"}:{height:o.selfDeterminedHeight}),{inset:0})},r.createElement("div",{ref:u,style:{transform:"scale(".concat(o.scale,")"),transformOrigin:"top left",width:"".concat(tu,"px"),position:"relative",top:"".concat(o.top,"px"),left:"".concat(o.left,"px")}},t))}function tl(e){return e.view?r.createElement(ts,{mapSettings:e.mapSettings}):r.createElement(eX,e)}function ts(e){var t=tt({mapSettings:e.mapSettings});return r.createElement(r.Fragment,null,t.ui({mode:"view"}).node)}},46207:function(e,t,n){n.d(t,{B:()=>r,c:()=>o});var r=Symbol();function o(e){var t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept",e),t.style.display="none";var n=new Promise(function(e){t.onchange=function(){e(t.files[0]),t.remove()},t.oncancel=function(){e(r),t.remove()}});return document.body.appendChild(t),t.click(),n}}}]);
//# sourceMappingURL=650.js.map