"use strict";(self.webpackChunkassets=self.webpackChunkassets||[]).push([["650"],{98853:function(e,t,n){n.r(t),n.d(t,{MapperPanel:()=>tc});var r=n(72668),o=n(78970),a=n(45988),i=n(6135),u=n(65547),c=n(4050),l=n(45375),s=n(15638),f=n(45437),p=n(41623),d=n(37014),m=n(69610),v=n(46347),y=n(34672),g=n(54509),b=n(69851),h=n(27193),w=n(84635),x=n(56511);function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function O(e){return function(e){if(Array.isArray(e))return E(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||S(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){if(e){if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}}function j(e,t,n){var r=function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(u)throw r}}return a}}(t,2)||S(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),o=r[0],a=r[1];return function(t){var r=e(t);return O(r.slice(0,o)).concat(O(n),O(r.slice(a)))}}function P(e,t,n){return function(r){var o=e(r),a=o[t],i=o[n],u=Array.from(o);return u[n]=a,u[t]=i,u}}function A(e,t){return{modify:function(n){e.modify(t,n)},delete:function(){e.delete(t)},duplicate:function(){e.duplicate(t)},add:e.add,moveUp:function(){e.moveUp(t)},moveDown:function(){e.moveDown(t)}}}var k=n(13736),C=n(77053);function R(e){return e*Math.PI/180*6378137}function I(e){return 6378137*Math.log(Math.tan(Math.PI/4+e*Math.PI/360))}function M(e){var t=R(e[0]),n=R(e[2]),r=I(e[1]);return Math.abs((n-t)*(I(e[3])-r))}function B(e){(0,C.h)(e.length>0,"No insets with coordBox");var t,n,r,o=e.reduce(function(e,t){return M(t.coordBox)>M(e.coordBox)?t:e}),a=o.coordBox,i=o.topRight[0]-o.bottomLeft[0],u=o.topRight[1]-o.bottomLeft[1];return t=R(a[0]),n=R(a[2]),r=I(a[1]),Math.abs(n-t)/Math.abs(I(a[3])-r)/(i/u)}var D=n(2414),U=n(64455);function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function L(e,t){return"none"===e.type?{backgroundColor:e.backgroundColor,color:e.textColor}:{backgroundColor:t.background}}function F(e){var t,n,o=(0,m.cI)();return r.createElement("div",{style:(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}({width:"100%"},L(e.basemap,o)),n=n={padding:"10px"},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t)},e.ramp&&"label"===e.ramp.type&&r.createElement("div",{className:"centered_text user_input"},e.ramp.value),e.ramp&&"ramp"===e.ramp.type&&r.createElement(G,{ramp:e.ramp.value}))}function G(e){var t,n=e.ramp,o=(0,r.useRef)(null),a=(t=(0,r.useState)(!1),function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(u)throw r}}return a}}(t,2)||function(e,t){if(e){if("string"==typeof e)return T(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}}(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0],u=a[1];(0,r.useLayoutEffect)(function(){var e=o.current;if(null!==e){var t=function(){u(Array.from(e.querySelectorAll(".containerOfXticks")).some(function(e){var t=e.querySelector(".containedOfXticks");return null!==t&&t.offsetWidth>.9*e.offsetWidth}))};t();var n=new ResizeObserver(t);return n.observe(e),function(){n.unobserve(e)}}},[n]);var c=(0,r.useMemo)(function(){return(0,k.oX)(n.ramp.map(function(e){return e[1]}))},[n]),l="".concat(100/n.interpolations.length,"%"),s=function(e){return n.interpolations.map(function(t,o){return r.createElement("div",{key:o,style:{width:l,display:"flex",alignItems:"center",justifyContent:"center"},className:"containerOfXticks"},r.createElement("div",{style:{writingMode:e?"sideways-lr":"horizontal-tb",padding:e?"0.5em":"0"},className:"containedOfXticks"},r.createElement("div",{className:"centered_text"},r.createElement(U.$k,{statname:n.label,value:t,isUnit:!1,unit:n.unit}),r.createElement(U.$k,{statname:n.label,value:t,isUnit:!0,unit:n.unit}))))})};return r.createElement("div",{style:{position:"relative"}},r.createElement("div",{style:{display:"flex",width:"100%"}},n.interpolations.map(function(e,t){return r.createElement("div",{key:t,style:{width:l,height:"1em",backgroundColor:(0,k.BM)(n.ramp,n.scale.forward(e),c),marginLeft:"1px",marginRight:"1px"}})})),r.createElement("div",{ref:o,style:{position:"absolute",top:0,left:0,display:"flex",width:"100%",visibility:"hidden"}},s(!1)),r.createElement("div",{style:{display:"flex",width:"100%"}},s(i)),r.createElement("div",{className:"centered_text user_input"},n.label))}var K=n(49196),N=n(9313),V=n(91435),z=n(58788),H=n(6381),_=n(27281),W=n(72547),X=n(96766),Z=n(75211),$=n(81600),J=n(88452),Q=n(89147),q=n(51647),Y=n(36195);function ee(e,t,n){var r="string"==typeof t?new Blob([t],{type:n}):t,o=URL.createObjectURL(r),a=document.createElement("a");a.href=o,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a)}var et=n(41486),en=n(88609),er=n(52594),eo=n(46207),ea=n(89408);function ei(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){n(e);return}u.done?t(c):Promise.resolve(c).then(r,o)}function eu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function ec(e){var t=e.mapSettings,n=e.setMapSettings;return r.createElement("div",{style:{display:"flex",gap:"0.5em",margin:"0.5em 0"}},r.createElement("button",{onClick:function(){var e;return(e=function(){var e,t;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){var l=[u,c];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:return[4,(0,eo.c)(".uss")];case 1:if((e=r.sent())===eo.B)return[2];return[4,e.text()];case 2:if(!(t=es.apply(void 0,[r.sent()])).success)return alert(t.error),[2];return n(t.mapSettings,{}),[2]}})},function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){ei(a,r,o,i,u,"next",e)}function u(e){ei(a,r,o,i,u,"throw",e)}i(void 0)})})()}},"Import Script"),r.createElement("button",{onClick:function(){var e;(0,et.saveAs)(new Blob([(e=t,'meta(kind="mapper", universe="'.concat(e.universe,'", geographyKind="').concat(e.geographyKind,'")\n').concat((0,J.Z2)(e.script.uss)))]),"urban_stats_mapper.uss")}},"Export Script"))}var el=en.z.object(eu({kind:en.z.literal("mapper")},ea.mapperMetaFields.shape));function es(e){var t,n,r=(0,J.Qc)(e);if("error"===r.type)return{success:!1,error:"Parse Errors:\n".concat(r.errors.map(function(e){return"• ".concat(e.value," at ").concat((0,er.i7)(e.location))}).join("\n"))};var o=void 0;if("statements"===r.type&&"expression"===r.result[0].type&&"call"===r.result[0].value.type&&"identifier"===r.result[0].value.fn.type&&"meta"===r.result[0].value.fn.name.node){var a=r.result[0].value;r.result.splice(0,1);var i=[],u=!0,c=!1,l=void 0;try{for(var s,f=a.args[Symbol.iterator]();!(u=(s=f.next()).done);u=!0){var p=s.value;if("unnamed"===p.type)return{success:!1,error:'"meta" function call at '.concat((0,er.i7)(a.entireLoc)," must have only named arguments")};if("constant"!==p.value.type)return{success:!1,error:'"meta" function argument "'.concat(p.name.node,'" must have a constant value')};i.push([p.name.node,p.value.value.node.value])}}catch(e){c=!0,l=e}finally{try{u||null==f.return||f.return()}finally{if(c)throw l}}var d=el.safeParse(Object.fromEntries(i));if(!d.success)return{success:!1,error:"Error parsing metadata: ".concat(Object.values(d.error.flatten(function(e){return'• Parameter "'.concat(e.path,'" is ').concat(e.message)}).fieldErrors).join("\n"))};o=d.data}return{success:!0,mapSettings:(0,ea.defaultSettings)((t=eu({},o),n=n={script:{uss:(0,ea.convertToMapUss)(r)}},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t))}}var ef=n(83929),ep={fontWeight:500,fontSize:"1.2em",marginBottom:"0.125em",marginTop:"0.25em"},ed=n(30444),em=n(7500);function ev(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ey(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function eg(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function eb(e){return function(e){if(Array.isArray(e))return ev(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return ev(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ev(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eh(e){var t=e.mapSettings,n=e.setMapSettings,o=e.errors,a=e.counts,i=e.typeEnvironment,u=e.targetOutputTypes,l=t.script.uss,s=(0,r.useCallback)(function(e){return{text:null!=e?e:""}},[]),f=(0,r.useMemo)(function(){return[void 0].concat(eb(c.Z))},[]),p=(0,r.useMemo)(function(){return void 0===t.universe?void 0:[void 0].concat(eb((0,ef.d)(a,t.universe)))},[t.universe,a]);return r.createElement(r.Fragment,null,r.createElement("div",{style:ep},"Universe"),r.createElement(ed.S,{possibleValues:f,value:t.universe,renderValue:s,onChange:function(e){n(eg(ey({},t),{universe:e,geographyKind:void 0===e||void 0===t.geographyKind||(0,ef.d)(a,e).includes(t.geographyKind)?t.geographyKind:void 0}),{})}}),p&&r.createElement(r.Fragment,null,r.createElement("div",{style:ep},"Geography Kind"),r.createElement(ed.S,{possibleValues:p,value:t.geographyKind,renderValue:s,onChange:function(e){n(eg(ey({},t),{geographyKind:e}),{})}})),r.createElement(em.ag,{uss:l,setUss:function(e,r){n(eg(ey({},t),{script:{uss:e}}),r)},typeEnvironment:i,errors:o,targetOutputTypes:u}))}var ew=n(65344),ex=n(44640),eE=n(73001);function eO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var eS=eE.Ry({north:eE.Rx(),east:eE.Rx(),south:eE.Rx(),west:eE.Rx()}),ej=eE.n0(eE.Rf(eE.RE({fn:eE.QU("constructInset"),unnamedArgs:[],namedArgs:{mainMap:eE.O7(),name:eE.Z_(),screenBounds:eS,mapBounds:eS}})),function(e){var t=e.namedArgs,n=t.screenBounds,r=t.mapBounds,o=t.mainMap,a=t.name;return{bottomLeft:[n.west,n.south],topRight:[n.east,n.north],coordBox:[r.west,r.south,r.east,r.north],mainMap:o,name:a}}),eP=eE.n0(eE.RE({fn:eE.QU("constructInsets"),namedArgs:{},unnamedArgs:[eE.sS(ej)]}),function(e){return e.unnamedArgs[0]}),eA=eE.x2(eE.gh([eE.ID(),eE.s2({condition:eE.ID(),rest:[eE.th(eE.Hw(em.Qc,em.Py,eE.RE({fn:eE.ID(),unnamedArgs:[],namedArgs:{insets:eE.eP(eE.jt(eE.Rf(eP)))}})))]})]),function(e){return e[1].rest[0].namedArgs.insets});function ek(e,t){if("statements"===e.script.uss.type)try{var n,r=eA.parse(e.script.uss,t);if(void 0===r.currentValue&&void 0!==e.universe)return(0,V.v2)(e.universe);return null==(n=r.currentValue)?void 0:n.currentValue}catch(e){}}function eC(e,t,n){var r=function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(u)throw r}}return a}}(t,2)||function(e,t){if(e){if("string"==typeof e)return eO(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eO(e,t)}}(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),o=r[0],a=r[1];return{insets:j(e.insets,[o,a],n),ast:j(e.ast,[o,a],n.map(ex.Rf))}}function eR(e,t,n){return{insets:P(e.insets,t,n),ast:P(e.ast,t,n)}}var eI=n(41277);function eM(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var eB={size:eE.jt(eE.Rx()),font:eE.jt(eE.Z_()),color:eE.jt(eE.n0(eI.VB,function(e){return null==e?void 0:e.color})),bold:eE.jt(eE.O7()),italic:eE.jt(eE.O7()),underline:eE.jt(eE.O7()),list:eE.jt(eE.n0(eE.G0(Object.keys(X.el).map(eE.QU)),function(e){return X.el[e]})),indent:eE.jt(eE.Rx()),align:eE.jt(eE.n0(eE.G0(Object.keys(X.D$).map(eE.QU)),function(e){return X.D$[e]}))},eD=eE.G0([["rtfString",function(e){return e}],["rtfFormula",function(e){return{formula:e}}],["rtfImage",function(e){return{image:e}}]].map(function(e){var t=function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(u)throw r}}return a}}(e,2)||function(e,t){if(e){if("string"==typeof e)return eM(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eM(e,t)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=t[0],r=t[1];return eE.n0(eE.RE({fn:eE.QU(n),unnamedArgs:[eE.Z_()],namedArgs:eB}),function(e){return{insert:r(e.unnamedArgs[0]),attributes:e.namedArgs}})})),eU=eE.n0(eE.RE({fn:eE.QU("rtfDocument"),unnamedArgs:[eE.xr(eD)],namedArgs:{}}),function(e){return e.unnamedArgs[0]}),eT=eE.n0(eE.RE({fn:eE.QU("textBox"),unnamedArgs:[],namedArgs:{screenBounds:eS,text:eU,backgroundColor:eE.n0(eE.jt(eI.VB),function(e){var t;return null!=(t=null==e?void 0:e.color)?t:Z.ce.backgroundColor}),borderColor:eE.n0(eE.jt(eI.VB),function(e){var t;return null!=(t=null==e?void 0:e.color)?t:Z.ce.borderColor}),borderWidth:eE.n0(eE.jt(eE.Rx()),function(e){return null!=e?e:Z.ce.borderWidth})}}),function(e){var t=e.namedArgs.screenBounds,n=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e.namedArgs,["screenBounds"]);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}({bottomLeft:[t.west,t.south],topRight:[t.east,t.north]},n)}),eL=eE.x2(eE.gh([eE.ID(),eE.s2({condition:eE.ID(),rest:[eE.th(eE.Hw(em.Qc,em.Py,eE.RE({fn:eE.ID(),unnamedArgs:[],namedArgs:{textBoxes:eE.eP(eE.jt(eE.xr(eT)))}})))]})]),function(e){return e[1].rest[0].namedArgs.textBoxes});function eF(e,t){if("statements"===e.script.uss.type)try{var n;return null!=(n=eL.parse(e.script.uss,t).currentValue)?n:[]}catch(e){}}function eG(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function eK(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){n(e);return}u.done?t(c):Promise.resolve(c).then(r,o)}function eN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function eV(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function ez(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(u)throw r}}return a}}(e,t)||e_(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eH(e){return function(e){if(Array.isArray(e))return eG(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||e_(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e_(e,t){if(e){if("string"==typeof e)return eG(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eG(e,t)}}function eW(e){var t=ez((0,r.useState)(e.mapSettings),2),n=t[0],o=t[1],a=ez((0,r.useState)(e.mapSettings),2),i=a[0],u=a[1],c=(0,r.useCallback)(function(e){o(e),u(e)},[]),l=ez((0,r.useState)("uss"),2),s=l[0],f=l[1],p=(0,r.useMemo)(function(){return new Q.Z(void 0)},[]),d=(0,$.C5)(n,p.value,c,function(e){p.value=e},{undoChunking:q.k.shared.isTesting?2e3:1e3,onlyElement:"uss"!==s?{current:null}:void 0}),m=d.updateCurrentSelection,v=d.addState,y=d.updateCurrentState,g=(0,r.useCallback)(function(e,t){!1===t.updateMap?o(e):c(e),!1===t.undoable?y(e):v(e,p.value)},[p,v,y,c]),b=(0,r.useRef)(!0);(0,r.useEffect)(function(){b.current?b.current=!1:(g(e.mapSettings,{}),f("uss"))},[e.mapSettings,g]);var h=JSON.stringify(eV(eN({},n),{script:{uss:(0,J.Z2)(n.script.uss)}})),w=(0,r.useContext)(H.C.Context);(0,r.useEffect)(function(){if(e.mapSettings!==n){var t=(0,z.gzipSync)(h).toString("base64");w.setMapperSettings(t)}},[h,w]);var x=(0,r.useMemo)(function(){return(0,V.Ag)(n.universe)},[n.universe]);(0,r.useEffect)(function(){var e=function(){m(p.value)};return p.observers.add(e),function(){p.observers.delete(e)}},[p,m]);var E={mapSettings:n,setMapSettings:g,typeEnvironment:x,setMapEditorMode:f,mapGenerator:te({mapSettings:i})};return r.createElement(ew.I.Provider,{value:p},"textBoxes"===s&&r.createElement(e0,E),"insets"===s&&r.createElement(eQ,E),"uss"===s&&r.createElement(r.Fragment,null,r.createElement(eX,eV(eN({},E),{counts:e.counts})),d.ui))}function eX(e){var t=e.mapSettings,n=e.setMapSettings,o=e.counts,a=e.typeEnvironment,i=e.setMapEditorMode,u=e.mapGenerator,c=u.ui({mode:"uss"}),l=c.exportImage,s=l?function(){var e;return(e=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){var l=[u,c];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}(this,function(e){switch(e.label){case 0:return[4,l()];case 1:return[4,fetch(e.sent().toDataURL("image/png"))];case 2:return[4,e.sent().blob()];case 3:return ee("map.png",e.sent(),"image/png"),[2]}})},function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){eK(a,r,o,i,u,"next",e)}function u(e){eK(a,r,o,i,u,"throw",e)}i(void 0)})})()}:void 0;return r.createElement(W.P,{csvExportData:u.exportCSV,screencap:s,showFooter:!1},r.createElement(e$,{error:u.errors.some(function(e){return"error"===e.kind}),left:r.createElement(eh,{mapSettings:t,setMapSettings:n,errors:u.errors,counts:o,typeEnvironment:a,targetOutputTypes:em.Py}),right:r.createElement(r.Fragment,null,r.createElement("div",{style:{display:"flex",justifyContent:"space-between",gap:"0.5em"}},r.createElement(eY,{pngExport:s,geoJSONExport:u.exportGeoJSON}),ek(t,a)&&r.createElement("div",{style:{display:"flex",gap:"0.5em",margin:"0.5em 0"}},r.createElement("button",{onClick:function(){i("insets")}},"Edit Insets")),eF(t,a)&&r.createElement("div",{style:{display:"flex",gap:"0.5em",margin:"0.5em 0"}},r.createElement("button",{onClick:function(){i("textBoxes")}},"Edit Text Boxes")),r.createElement(ec,{mapSettings:t,setMapSettings:n})),r.createElement("div",{style:{position:"relative",flex:1}},c.node))}))}var eZ=r.createContext(!1);function e$(e){var t=e.left,n=e.right,o=e.error;return(0,Y.wd)()?r.createElement(r.Fragment,null,t,n):r.createElement(eJ,{error:o,left:t,right:n})}function eJ(e){var t=e.left,n=e.right,o=e.error,a=ez((0,r.useState)(0),2),i=a[0],u=a[1],c=(0,r.useRef)(null),l=(0,m.cI)(),s=(0,r.useCallback)(function(){if(c.current){var e=c.current.getBoundingClientRect();u(window.innerHeight-e.top-8)}},[]);(0,r.useLayoutEffect)(function(){return s(),window.addEventListener("resize",s),function(){window.removeEventListener("resize",s)}},[s]);var f=ez((0,_.yu)("mapperSettingsColumnProp"),2),p=f[0],d=f[1],v=ez((0,r.useState)(void 0),2),y=v[0],g=v[1],b=(0,r.useRef)(null),h=function(){return w/c.current.offsetWidth};(0,r.useEffect)(function(){null!==b.current&&(b.current.style.cursor=p===h()?"e-resize":p===E?"w-resize":"col-resize")});var w=540*!!t,x=t?"".concat(100*p,"%"):"0%",E=.5;return r.createElement(eZ.Provider,{value:!0},r.createElement("div",{style:{display:"flex",height:i,position:"relative"},ref:c},t&&r.createElement(r.Fragment,null,r.createElement("div",{"data-test":"split-left",style:{width:x,minWidth:w,overflowY:"scroll",backgroundColor:(0,k.bt)(l.hueColors.red,o?.8:1,l.slightlyDifferentBackground),padding:"1em",borderRadius:"5px"}},t),r.createElement("div",{ref:b,style:{width:"1em",position:"relative"},onPointerDown:function(e){if(void 0===y){var t=e.target;g({pointerId:e.pointerId,startOffsetX:e.nativeEvent.offsetX+t.offsetLeft,startProp:Math.max(h(),p)}),t.setPointerCapture(e.pointerId)}},onPointerMove:function(e){if(e.pointerId===(null==y?void 0:y.pointerId)){var t=(e.target.offsetLeft+e.nativeEvent.offsetX-y.startOffsetX)/c.current.offsetWidth;d(Math.max(h(),Math.min(y.startProp+t,E)))}},onPointerCancel:function(e){(null==y?void 0:y.pointerId)===e.pointerId&&g(void 0)},onPointerUp:function(e){(null==y?void 0:y.pointerId)===e.pointerId&&g(void 0)}},r.createElement("div",{style:{backgroundColor:l.borderNonShadow,borderRadius:"5px",position:"absolute",width:"5px",left:"calc(50% - 2px)",height:"50%",top:"25%",pointerEvents:"none"}}))),r.createElement("div",{style:{width:"calc(100% - max(".concat(w,"px, ").concat(x,") - ").concat("1em",")"),display:"flex",flexDirection:"column",justifyContent:"center"}},n)))}function eQ(e){var t=e.mapSettings,n=e.setMapSettings,o=e.typeEnvironment,a=e.setMapEditorMode,i=e.mapGenerator,u=(0,m.cI)(),c=ez((0,r.useState)({ast:function(e){return e},insets:function(e){return e}}),2),l=c[0],s=c[1],f=(0,$.C5)(l,void 0,s,function(){}),p=f.addState,d=f.ui,v=f.canUndo,y=l.insets(ek(t,o)),g=function(e){s(e),p(e,void 0)},b=i.ui({mode:"insets",editInsets:{add:function(){var e,n=eV(eN({},(0,V.v2)(null!=(e=t.universe)?e:"world")[0]),{bottomLeft:[.25,.25],topRight:[.75,.75],mainMap:!1});g(eC(l,[y.length,y.length],[eq(n,y)]))},modify:function(e,t){g(eC(l,[e,e+1],[eN({},y[e],t)]))},delete:function(e){g(eC(l,[e,e+1],[]))},duplicate:function(e){g(eC(l,[e+1,e+1],[eq(y[e],y)]))},moveUp:function(e){(0,C.h)(e+1<y.length,"Cannot move inset ".concat(e," up, already top")),g(eR(l,e,e+1))},moveDown:function(e){(0,C.h)(e>0,"Cannot move inset ".concat(e," down, already bottom")),g(eR(l,e,e-1))},edited:y}});return r.createElement(W.P,{csvExportData:i.exportCSV,showFooter:!1},r.createElement(e$,{left:void 0,error:!1,right:r.createElement(r.Fragment,null,r.createElement("div",{style:{backgroundColor:u.slightlyDifferentBackgroundFocused,borderRadius:"5px",padding:"10px",margin:"10px 0",display:"flex",justifyContent:"space-between",gap:"0.5em"}},r.createElement("div",null,r.createElement("b",null,"Editing Insets.")," ","Pans and zooms to maps will be reflected permanently. Drag inset frames to reposition and resize."),r.createElement("div",{style:{display:"flex",gap:"10px"}},r.createElement("button",{onClick:function(){a("uss")}},"Cancel"),r.createElement("button",{onClick:function(){var e,r,i;n(eV(eN({},t),{script:{uss:((0,C.h)("statements"===t.script.uss.type,"Trying to do an inset edit on USS that is not inset editable"),r=eA.parse(t.script.uss,o),(0,C.h)(void 0!==t.universe,"Trying to do an inset edit on USS that is not inset editable"),e=void 0!==r.currentValue?r.expr:(0,V.U)(t.universe),i=eP.parse(e,o).edit(l.ast),r.edit(i))}}),{}),a("uss")},disabled:!v},"Accept"))),r.createElement("div",{style:{flex:1,position:"relative"}},b.node))}),d)}function eq(e,t){for(var n=0;n<1;n+=.05)for(var r=0,o=[[n,n],[-n,-n],[-n,n],[n,-n]];r<o.length;r++){var a=function(n,r){var o=ez(r[n],2),a=o[0],i=o[1],u=eV(eN({},e),{bottomLeft:[e.bottomLeft[0]+a,e.bottomLeft[1]+i],topRight:[e.topRight[0]+a,e.topRight[1]+i]});if(u.bottomLeft.concat(u.topRight).every(function(e){return e>=0&&e<=1})&&!t.some(function(e){return u.bottomLeft[0]===e.bottomLeft[0]&&u.bottomLeft[1]===e.bottomLeft[1]&&u.topRight[0]===e.topRight[0]&&u.topRight[1]===e.topRight[1]}))return{v:u}}(r,o);if("object"==(a&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a))return a.v}return e}function eY(e){var t=function(){void 0!==e.pngExport&&e.pngExport()},n=function(){void 0!==e.geoJSONExport&&ee("map.geojson",e.geoJSONExport(),"application/geo+json")};return r.createElement("div",{style:{display:"flex",gap:"0.5em",margin:"0.5em 0"}},r.createElement("button",{disabled:void 0===e.pngExport,onClick:function(){t()}},"Export as PNG"),r.createElement("button",{disabled:void 0===e.geoJSONExport,onClick:function(){n()}},"Export as GeoJSON"),r.createElement("button",{onClick:function(){var e=new URLSearchParams(window.location.search);e.set("view","true"),window.open("?".concat(e.toString()),"_blank")}},"View as Zoomable Page"))}function e0(e){var t=e.mapSettings,n=e.setMapSettings,o=e.typeEnvironment,a=e.setMapEditorMode,i=e.mapGenerator,u=(0,m.cI)(),c=ez((0,r.useState)(function(){return eF(t,o)}),2),l=c[0],s=c[1],f=(0,r.useMemo)(function(){return new Q.Z(void 0)},[]),p=(0,$.C5)(l,void 0,s,function(e){f.value=e}),d=p.addState,v=p.ui,y=p.canUndo,g=p.updateCurrentSelection;(0,r.useEffect)(function(){var e=function(){g(f.value)};return f.observers.add(e),function(){f.observers.delete(e)}},[f,g]);var b=function(e){s(e),d(e,f.value)},w=i.ui({mode:"textBoxes",editTextBoxes:{add:function(){var e=eN({bottomLeft:[.25,.25],topRight:[.75,.75],text:[{insert:"\n"}]},Z.ce);b(eH(l).concat([eq(e,l)])),f.value={index:l.length,range:{index:0,length:0}}},modify:function(e,t){b(l.map(function(n,r){return e===r?eN({},n,t):n}))},delete:function(e){var t;b(l.filter(function(t,n){return n!==e})),(null==(t=f.value)?void 0:t.index)===e&&(f.value=void 0)},duplicate:function(e){b(eH(l).concat([eq(l[e],l)])),f.value={index:l.length,range:{index:0,length:(0,X.Ie)(l[e].text)}}},moveUp:function(e){var t;(0,C.h)(e+1<l.length,"Cannot move text box ".concat(e," up, already top")),b(l.map(function(t,n){switch(n){case e:return l[e+1];case e+1:return l[e];default:return t}})),(null==(t=f.value)?void 0:t.index)===e&&(f.value=eV(eN({},f.value),{index:e+1}))},moveDown:function(e){var t;(0,C.h)(e>0,"Cannot move inset ".concat(e," down, already bottom")),b(l.map(function(t,n){switch(n){case e:return l[e-1];case e-1:return l[e];default:return t}})),(null==(t=f.value)?void 0:t.index)===e&&(f.value=eV(eN({},f.value),{index:e-1}))},edited:l}});return r.createElement(W.P,{csvExportData:i.exportCSV,showFooter:!1},r.createElement(N.Iw.Provider,{value:f},r.createElement(e$,{left:void 0,error:!1,right:r.createElement(r.Fragment,null,r.createElement("div",{style:{backgroundColor:u.slightlyDifferentBackgroundFocused,borderRadius:"5px",padding:"10px",margin:"10px 0",display:"flex",justifyContent:"space-between",gap:"0.5em"}},r.createElement("div",null,r.createElement("b",null,"Editing Text Boxes.")),r.createElement("div",{style:{display:"flex",gap:"10px"}},r.createElement("button",{onClick:function(){a("uss")}},"Cancel"),r.createElement("button",{onClick:function(){n(eV(eN({},t),{script:{uss:((0,C.h)("statements"===t.script.uss.type,"Trying to do an text boxes edit on USS that is not text boxes editable"),eL.parse(t.script.uss,o).edit(0===l.length?void 0:{type:"vectorLiteral",elements:l.map(Z.Rf),entireLoc:h.tU}))}}),{}),a("uss")},disabled:!y},"Accept"))),r.createElement("div",{style:{flex:1,position:"relative"}},w.node))}),v))}function e1(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function e2(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){n(e);return}u.done?t(c):Promise.resolve(c).then(r,o)}function e5(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){e2(a,r,o,i,u,"next",e)}function u(e){e2(a,r,o,i,u,"throw",e)}i(void 0)})}}function e4(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function e3(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function e6(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var a=[],i=!0,u=!1;try{for(o=o.call(e);!(i=(n=o.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(u)throw r}}return a}}(e,t)||e8(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e7(e){return function(e){if(Array.isArray(e))return e1(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||e8(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e8(e,t){if(e){if("string"==typeof e)return e1(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e1(e,t)}}function e9(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){var l=[u,c];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}function te(e){var t=e.mapSettings,n=(0,r.useRef)({}),o=(0,r.useRef)(Date.now()),a=e6((0,r.useState)(function(){return tt({mapSettings:t,cache:n.current,previousGenerator:void 0})}),2),i=a[0],u=a[1];(0,r.useEffect)(function(){var e=Date.now()-o.current;if(e>500){o.current=Date.now(),u(function(e){return tt({mapSettings:t,cache:n.current,previousGenerator:e})});return}o.current=Date.now();var r=setTimeout(function(){u(function(e){return tt({mapSettings:t,cache:n.current,previousGenerator:e})})},500-e);return function(){clearTimeout(r)}},[t]);var c=(0,D.a)(i),l=c.result,s=c.loading;return void 0!==l?e3(e4({},l),{ui:function(e){return l.ui(e3(e4({},e),{loading:s}))}}):{ui:function(){return{node:r.createElement(ta,{universe:t.universe,loading:s})}},errors:[]}}function tt(e){return e5(function(e){var t,n,p,E,O,S,j,P,C,R,I,M,D,U,T,G,V,z;function H(e){var t=e.props,n=e.exportImageRef,a=[],i=(0,r.useRef)(null),c=(0,r.useRef)(null),l=("insets"===t.mode?t.editInsets.edited:M.value.insets).flatMap(function(e){var n,r,o,a=(n=e,r=G,o=n.coordBox,n.mainMap||(r=r.filter(function(e){var t=(0,s.boundingBox)(e.geometry);return t.getWest()<o[2]&&t.getEast()>o[0]&&t.getNorth()>o[1]&&t.getSouth()<o[3]})),r);return 0===a.length&&"insets"!==t.mode?[]:[{inset:e,insetFeatures:a}]}),f=l.map(function(e,n,o){var u=e.inset,c=e.insetFeatures;return r.createElement(K.f,{i:n,key:n,inset:u,ref:function(e){return a[n]=e},container:i,numInsets:o.length,editInset:"insets"===t.mode?A(t.editInsets,n):void 0,interactive:"textBoxes"!==t.mode},V(c,["uss","view"].includes(t.mode)))}),p=l.map(function(e){return e.inset}),v=r.createElement(F,{ramp:z,basemap:M.value.basemap}),y=e6((0,r.useState)(!1),2),g=y[0],b=y[1],h=(0,m.cI)();n(function(){return e5(function(){var e;return e9(this,function(t){return b(!0),e=a.map(function(e){return e.getMap()}).map(tr),[2,new Promise(function(t){setTimeout(function(){return e5(function(){return e9(this,function(n){switch(n.label){case 0:return[4,(0,u.d_)(c.current,ti*tn,1,{mapBorderRadius:0,testing:!1})];case 1:var r,a,i;return[4,(r=n.sent(),a=M.value.basemap,i=h,e5(function(){var e,t,n,u,c,l,s,f,p,m;return e9(this,function(v){switch(v.label){case 0:return t=(e=L(a,i)).backgroundColor,u=void 0===(n=e.color)?i.screenshotFooterUrl:d.J[50>(0,o.Z)(n).l()?"Light Mode":"Dark Mode"].screenshotFooterUrl,[4,(0,x.p)(u)];case 1:return c=v.sent(),l=50*tn,s=c.width*(l/c.height),f=10*tn,m=(p=document.createElement("canvas")).getContext("2d"),p.width=r.width,p.height=r.height+l-f,m.drawImage(r,0,0),m.fillStyle=t,m.fillRect(0,r.height,r.width,l),m.drawImage(c,p.width-s,p.height-l,s,l),[2,p]}})})())];case 2:return t(n.sent()),b(!1),e.forEach(function(e){e()}),[2]}})})()})})]})})()});var w="insets"===t.mode?void 0:r.createElement(m.AV,{theme:"Light Mode"},("textBoxes"===t.mode?t.editTextBoxes.edited:M.value.textBoxes).map(function(e,n,o){return r.createElement(N.P0,{container:i,key:n,textBox:e,i:n,count:o.length,edit:"textBoxes"===t.mode?A(t.editTextBoxes,n):void 0})}).concat("textBoxes"===t.mode?[r.createElement(N.bs,{key:"add",container:i,add:t.editTextBoxes.add})]:[]));return r.createElement(u.t.Provider,{value:g},r.createElement(to,{maps:f,loading:t.loading,colorbar:v,aspectRatio:B(p),mapsContainerRef:i,wholeRenderRef:c,textBoxes:w}))}return e9(this,function(o){switch(o.label){case 0:if(t=e.mapSettings,n=e.cache,p=e.previousGenerator,E=function(e){var n=e.loading;return{node:r.createElement(ta,{universe:t.universe,loading:n})}},void 0===t.geographyKind||void 0===t.universe)return[2,{ui:E,errors:[{kind:"error",type:"error",value:"Select a Universe and Geography Kind",location:h.tU}]}];if(O=(0,ea.computeUSS)(t.script),!((S=(0,y.ZP)(O)).length>0))return[3,2];return[4,p];case 1:return[2,e3(e4({},j=o.sent()),{ui:null!=(P=null==j?void 0:j.ui)?P:E,errors:S.map(function(e){return e3(e4({},e),{kind:"error"})})})];case 2:return[4,(0,w.W)({descriptor:{kind:"mapper",geographyKind:t.geographyKind,universe:t.universe},stmts:O})];case 3:if(void 0!==(C=o.sent()).resultingValue)return[3,5];return[4,p];case 4:return[2,e3(e4({},R=o.sent()),{ui:null!=(I=null==R?void 0:R.ui)?I:E,errors:C.error})];case 5:return M=C.resultingValue.value,D=(0,a.lM)(M,C.context),U="".concat(t.geographyKind,"-").concat(t.universe,"-data.csv"),[4,function(e){return e5(function(e){var t,n,o,a,u,p,d,m,y,h,w,x,E,O,S;return e9(this,function(j){var P,A,C,R,I,M,B,D;switch(j.label){case 0:switch(n=(t=e.mapResultMain).opaqueType,o=t.value,a=e.universe,u=e.geographyKind,p=e.cache,n){case"pMap":case"cMap":y=(0,b._K)(o.scale),h=(0,k.oX)(o.ramp.map(function(e){return e[1]})),w=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1].map(y.inverse),d={type:"ramp",value:{ramp:o.ramp,interpolations:w,scale:y,label:o.label,unit:o.unit}},m=o.data.map(function(e){return(0,k.BM)(o.ramp,y.forward(e),h)});break;case"cMapRGB":m=o.dataR.map(function(e,t){return(0,g.XF)({r:e,g:o.dataG[t],b:o.dataB[t],a:1})}),d={type:"label",value:o.label}}switch(n){case"pMap":return[3,1];case"cMap":case"cMapRGB":return[3,3]}return[3,5];case 1:return O=Array.from(o.data.entries()).map(function(e){var t=e6(e,2),n=t[0],r=t[1];return{name:o.geo[n],fillColor:m[n],fillOpacity:1,radius:Math.sqrt(o.relativeArea[n])*o.maxRadius,statistic:r}}),[4,(P=u,A=a,C=O,R=p,e5(function(){var e,t,n,r,o;return e9(this,function(a){switch(a.label){case 0:if((null==(e=R.geo)?void 0:e.type)==="points"&&R.geo.universe===A&&R.geo.geographyKind===P)return[3,3];return t=(0,f.Tw)(A,P),[4,(0,l.gi)(t,"ArticleOrderingList")];case 1:return n=a.sent(),[4,(0,v.y7)(A,P,n.longnames)];case 2:r=a.sent(),R.geo={type:"points",universe:A,geographyKind:P,centroidsByName:new Map(n.longnames.map(function(e,t){return[e,r[t]]}))},a.label=3;case 3:return o=R.geo,[2,C.map(function(e){var t=o.centroidsByName.get(e.name);return{type:"Feature",properties:e4({},e),geometry:{type:"Point",coordinates:[t.lon,t.lat]}}})]}})})())];case 2:return x=j.sent(),E=function(e,t){return r.createElement(i.Oy,{features:e,clickable:t})},[3,5];case 3:return S=Array.from(m.entries()).map(function(e){var t,r=e6(e,2),a=r[0],i=r[1];switch(n){case"cMap":t={statistic:o.data[a]};break;case"cMapRGB":t={statistic:[o.dataR[a],o.dataG[a],o.dataB[a]]}}return e4({name:o.geo[a],fillColor:i,fillOpacity:1,color:(0,g.XF)(o.outline.color),weight:o.outline.weight},t)}),[4,(I=u,M=a,B=S,D=p,e5(function(){var e,t,n,r,o,a;return e9(this,function(i){switch(i.label){case 0:if((null==(e=D.geo)?void 0:e.type)==="polygons"&&D.geo.universe===M&&D.geo.geographyKind===I)return[3,2];return t=c.Z.indexOf(M),[4,(0,l.gi)((0,f.UM)(I),"ConsolidatedShapes")];case 1:for(o=0,n=i.sent(),r=new Map;o<n.longnames.length;o++)n.universes[o].universeIdxs.includes(t)&&r.set(n.longnames[o],(0,s.geometry)(n.shapes[o]));D.geo={type:"polygons",universe:M,geographyKind:I,polygonsByName:r},i.label=2;case 2:return a=D.geo,[2,B.map(function(e){return{type:"Feature",properties:e4({},e),geometry:a.polygonsByName.get(e.name)}})]}})})())];case 4:return x=j.sent(),E=function(e,t){return r.createElement(i.uy,{features:e,clickable:t})},[3,5];case 5:return[2,{features:x,mapChildren:function(e,t){return r.createElement(r.Fragment,null,E(e,t),r.createElement(i.Es,{basemap:o.basemap}))},ramp:d}]}})}).apply(this,arguments)}({mapResultMain:M,universe:t.universe,geographyKind:t.geographyKind,cache:n})];case 6:return G=(T=o.sent()).features,V=T.mapChildren,z=T.ramp,[2,{errors:C.error,exportCSV:{csvData:D,csvFilename:U},exportGeoJSON:function(){return JSON.stringify({type:"FeatureCollection",features:G},null,2)},ui:function(e){var t;return{node:r.createElement(H,{props:e,exportImageRef:function(e){return t=e}}),exportImage:function(){return t()}}}}]}})}).apply(this,arguments)}var tn=4;function tr(e){var t,n=e.getPixelRatio();e.setPixelRatio(tn);var r=e.getContainer().querySelector(".maplibregl-ctrl-attrib");if(null!==r){var o=r.style.display;r.style.display="none",t=function(){return r.style.display=o}}return function(){e.setPixelRatio(n),null==t||t()}}function to(e){var t=e.maps,n=e.colorbar,o=e.loading,a=e.mapsContainerRef,i=e.aspectRatio,u=e.wholeRenderRef,c=e.textBoxes;return r.createElement(tu,null,r.createElement("div",{ref:u,style:{display:"flex",flexDirection:"column",position:"relative",minHeight:0}},r.createElement(p._h,{loading:o}),r.createElement("div",{style:{width:"100%",aspectRatio:i}},r.createElement("div",{ref:a,style:{aspectRatio:i,position:"relative",maxHeight:"100%",margin:"auto"}},t,c)),n))}function ta(e){var t=e.universe,n=e.loading,o=(0,V.v2)(null!=t?t:"world");return r.createElement(to,{maps:o.map(function(e,t){return r.createElement(K.f,{i:t,key:t,inset:e,container:r.createRef(),numInsets:o.length,interactive:!1},null)}),textBoxes:null,loading:n,colorbar:null,aspectRatio:B(o)})}var ti=1200;function tu(e){var t=e.children,n=e6((0,r.useState)({scale:1,top:0,left:0,selfDeterminedHeight:0}),2),o=n[0],a=n[1],i=(0,r.useRef)(null),u=(0,r.useRef)(null);return(0,r.useEffect)(function(){var e=function(){if(null!==i.current&&null!==u.current){var e,t=(e=Math).min.apply(e,e7([i.current.offsetWidth/ti].concat(e7(i.current.offsetHeight>0?[i.current.offsetHeight/u.current.offsetHeight]:[]))));a({scale:t,top:Math.max(0,(i.current.offsetHeight-u.current.offsetHeight*t)/2),left:Math.max(0,(i.current.offsetWidth-u.current.offsetWidth*t)/2),selfDeterminedHeight:u.current.offsetHeight*t})}};e();var t=new ResizeObserver(e);return t.observe(i.current),t.observe(u.current),function(){t.disconnect()}},[]),r.createElement("div",{ref:i,style:e3(e4({},(0,r.useContext)(eZ)?{position:"absolute"}:{height:o.selfDeterminedHeight}),{inset:0})},r.createElement("div",{ref:u,style:{transform:"scale(".concat(o.scale,")"),transformOrigin:"top left",width:"".concat(ti,"px"),position:"relative",top:"".concat(o.top,"px"),left:"".concat(o.left,"px")}},t))}function tc(e){return e.view?r.createElement(tl,{mapSettings:e.mapSettings}):r.createElement(eW,e)}function tl(e){var t=te({mapSettings:e.mapSettings});return r.createElement(r.Fragment,null,t.ui({mode:"view"}).node)}},46207:function(e,t,n){n.d(t,{B:()=>r,c:()=>o});var r=Symbol();function o(e){var t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept",e),t.style.display="none";var n=new Promise(function(e){t.onchange=function(){e(t.files[0]),t.remove()},t.oncancel=function(){e(r),t.remove()}});return document.body.appendChild(t),t.click(),n}}}]);
//# sourceMappingURL=650.js.map