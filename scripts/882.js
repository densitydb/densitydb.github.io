"use strict";(self.webpackChunkassets=self.webpackChunkassets||[]).push([["882"],{65438:function(e,t,r){r.r(t),r.d(t,{getCorrectPattern:()=>B,infiniteQuiz:()=>Q,loadJuxta:()=>S,loadRetro:()=>j,loading:()=>E,nameOfQuizKind:()=>O,aCorrect:()=>z,StoredProperty:()=>x,quizHistorySchema:()=>P,quizPersonaSchema:()=>I,syncProfileSchema:()=>k,quizFriends:()=>q,wrapQuestionsModel:()=>D,QuizModel:()=>T});var n=r(41486),o=r(88609),i=r(89147),u=r(63406),a=Symbol(),c=r(54194),s=r(555);function l(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(e){r(e);return}a.done?t(c):Promise.resolve(c).then(n,o)}function f(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&p(e.prototype,t),r&&p(e,r),e}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(e,t,r){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=w(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r||e):o.value}})(e,t,r||e)}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){d(e,t,r[t])})}return e}function g(e,t,r,n){return(g="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=w(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else d(n,t,r);return!0})(e,t,r,n)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}function _(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_=function(){return!!e})()}function z(e){switch(e.kind){case"juxtastat":return e.stat_a>e.stat_b;case"retrostat":return e.a_ease>e.b_ease}}function O(e){switch(e){case"juxtastat":return"Juxtastat";case"retrostat":return"Retrostat";case"custom":return"Juxtastat Custom";case"infinite":return"Juxtastat Infinite"}}function S(e){return v({kind:"juxtastat"},e)}function j(e){return{kind:"retrostat",a:S(e.a),b:S(e.b),a_ease:e.a_ease,b_ease:e.b_ease}}var P=o.z.record(o.z.string(),o.z.object({choices:o.z.array(o.z.union([o.z.literal("A"),o.z.literal("B")])),correct_pattern:o.z.array(o.z.union([o.z.boolean(),o.z.literal(0),o.z.literal(1)]))}).strict().refine(function(e){return e.choices.length===e.correct_pattern.length},{message:"Quiz choices must be the same length as quiz correct_pattern"})),q=o.z.array(o.z.union([o.z.tuple([o.z.string(),o.z.string()]),o.z.tuple([o.z.nullable(o.z.string()),o.z.string(),o.z.number()])])),I=o.z.object({persistent_id:o.z.string(),secure_id:o.z.string(),quiz_history:P,quiz_friends:q,date_exported:o.z.optional(o.z.string().pipe(o.z.coerce.date()))}).strict(),k=o.z.object({quiz_history:P,friends:q}),x=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(e,r,n){var o,i,u;return f(this,t),o=t,i=[r(localStorage.getItem(e))],o=b(o),d(u=function(e,t){var r;if(t&&("object"==((r=t)&&"undefined"!=typeof Symbol&&r.constructor===Symbol?"symbol":typeof r)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,_()?Reflect.construct(o,i||[],b(this).constructor):o.apply(this,i)),"localStorageKey",void 0),d(u,"store",void 0),u.localStorageKey=e,u.store=n,addEventListener("storage",function(t){t.key===e&&(u.value=r(localStorage.getItem(e)))}),u}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e),h(t,[{key:"value",get:function(){return y(b(t.prototype),"value",this)},set:function(e){var r=this.store(e);null===r?localStorage.removeItem(this.localStorageKey):localStorage.setItem(this.localStorageKey,r),function(e,t,r,n,o){if(!g(e,t,r,n||e)&&o)throw Error("failed to set property")}(b(t.prototype),"value",e,this,!0)}}]),t}(i.Z),E=Symbol("loading"),T=function(){function e(){f(this,e),d(this,"history",new x("quiz_history",function(e){var t=JSON.parse(null!=e?e:"{}");return"42"in t&&"correct_pattern"in t["42"]&&t["42"].correct_pattern.length>0&&(t["42"].correct_pattern[0]=!0),t},function(e){return JSON.stringify(e)})),d(this,"friends",new x("quiz_friends",function(e){return JSON.parse(null!=e?e:"[]")},function(e){return JSON.stringify(e)})),d(this,"uniquePersistentId",new x("persistent_id",function(){return R("persistent_id")},function(e){return e})),d(this,"uniqueSecureId",new x("secure_id",function(){return R("secure_id")},function(e){return e})),d(this,"authenticationError",new i.Z(!1)),d(this,"dismissAuthNag",new x("dismiss_auth_nag",function(e){return o.z.nullable(o.z.coerce.number()).parse(e)},function(e){var t;return null!=(t=null==e?void 0:e.toString())?t:null}))}return h(e,[{key:"exportQuizPersona",value:function(){var e={date_exported:new Date,persistent_id:this.uniquePersistentId.value,secure_id:this.uniqueSecureId.value,quiz_history:this.history.value,quiz_friends:this.friends.value},t=JSON.stringify(e,null,2);(0,n.saveAs)(new Blob([t],{type:"application/json"}),"urbanstats_quiz_".concat(e.persistent_id,".json"))}},{key:"importQuizPersona",value:function(){var e;return(e=function(){var e,t,r,n,o,i,u;return function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=a(0),u.throw=a(1),u.return=a(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(a){return function(c){var s=[a,c];if(r)throw TypeError("Generator is already executing.");for(;u&&(u=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}}(this,function(c){switch(c.label){case 0:var l,f,p;return[4,(l=".json",(f=document.createElement("input")).setAttribute("type","file"),f.setAttribute("accept",l),f.style.display="none",p=new Promise(function(e){f.onchange=function(){e(f.files[0]),f.remove()},f.oncancel=function(){e(a),f.remove()}}),document.body.appendChild(f),f.click(),p)];case 1:if((e=c.sent())===a)return[2];c.label=2;case 2:return c.trys.push([2,4,,5]),[4,e.text()];case 3:if(t=c.sent(),r=I.parse(JSON.parse(t)),n=this.history.value,(i=(0,s.do)(n,r.quiz_history)).length>0)if(!confirm("The following quiz results exist both locally and in the uploaded file, and are different:\n\n".concat(i.map(function(e){return"â€¢ ".concat(e.startsWith("W")?"Retrostat":"Juxtastat"," ").concat(e)}).join("\n"),"\n\nAre you sure you want to merge them? (The lowest score will be used)")))return[2];else o=(0,s.ln)(n,r.quiz_history);else o=v({},n,r.quiz_history);return this.history.value=o,this.friends.value=r.quiz_friends,this.uniquePersistentId.value=r.persistent_id,this.uniqueSecureId.value=r.secure_id,[3,5];case 4:return u=c.sent(),alert("Could not parse file. Error: ".concat(u)),[3,5];case 5:return[2]}})},function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){l(i,n,o,u,a,"next",e)}function a(e){l(i,n,o,u,a,"throw",e)}u(void 0)})}).call(this)}},{key:"userHeaders",value:function(){return{"x-user":this.uniquePersistentId.value,"x-secure-id":this.uniqueSecureId.value}}}]),e}();function R(e){return null===localStorage.getItem(e)&&localStorage.setItem(e,(0,u.c)()),localStorage.getItem(e)}d(T,"shared",new T);var A=0;function C(){return A++,"quiz-".concat(A)}function D(e){return{questionByIndex:function(t){return Promise.resolve(e[t])},length:e.length,isDone:function(t){return t.length===e.length},uniqueKey:C()}}function Q(e,t){return{questionByIndex:function(r){return(0,c.sampleRandomQuestion)(e,t,r)},length:void 0,isDone:function(e){return(0,c.infiniteQuizIsDone)(e)},uniqueKey:C()}}function B(e,t){var r;return(null!=(r=e[t])?r:{choices:[],correct_pattern:[]}).correct_pattern.map(function(e){return!!e})}},555:function(e,t,r){r.d(t,{ln:()=>O,_7:()=>m,by:()=>w,do:()=>z});var n=r(23509),o=r.n(n),i=r(88609),u=r(51647),a=r(36129);function c(e){return(0,a.ZP)({baseUrl:"https://www.googleapis.com/drive/v3",fetch:function(t){return t.headers.append("Authorization","Bearer ".concat(e)),globalThis.fetch(t)}})}var s=r(65438),l=r(20110);function f(e,t,r,n,o,i,u){try{var a=e[i](u),c=a.value}catch(e){r(e);return}a.done?t(c):Promise.resolve(c).then(n,o)}function p(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function u(e){f(i,n,o,u,a,"next",e)}function a(e){f(i,n,o,u,a,"throw",e)}u(void 0)})}}function h(e,t,r){return(h=v()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&y(o,r.prototype),o}).apply(null,arguments)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e){var t="function"==typeof Map?new Map:void 0;return(b=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return h(e,arguments,d(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),y(r,e)})(e)}function v(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(v=function(){return!!e})()}function g(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=a(0),u.throw=a(1),u.return=a(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function a(a){return function(c){var s=[a,c];if(r)throw TypeError("Generator is already executing.");for(;u&&(u=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}}var m=function(e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function t(){var e,r;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");return e=t,r=arguments,e=d(e),function(e,t){var r;if(t&&("object"==((r=t)&&"undefined"!=typeof Symbol&&r.constructor===Symbol?"symbol":typeof r)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,v()?Reflect.construct(e,r||[],d(this).constructor):e.apply(this,r))}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e),t}(b(Error));function w(e){return p(function(){var t,r,n,u,a;return g(this,function(f){var h,d,y;switch(f.label){case 0:return[4,(h=e,p(function(){var e,t,r,n,o,u,a,f,p,d,y,b;return g(this,function(v){switch(v.label){case 0:return[4,c(h).GET("/files",{params:{query:{spaces:"appDataFolder",fields:"files(id, name)",q:"name = '".concat(S(),"'")}}})];case 1:if(r=(t=v.sent()).data,n=t.response,void 0===r){if(o="Sync problem, could not get files. Ensure Urban Stats has access to Google Drive.",401===n.status||403===n.status)throw new m(o);throw Error(o)}if(void 0!==(u=null==(e=r.files)?void 0:e[0]))return[3,3];return a=_(),f={},[4,j(h,a)];case 2:return[2,(f.fileId=v.sent(),f.profile=a,f)];case 3:return p=i.z.string().parse(u.id),[4,c(h).GET("/files/{fileId}",{params:{path:{fileId:p},query:{alt:"media"}},parseAs:"json"})];case 4:return d=v.sent().data,void 0===(y=s.syncProfileSchema.safeParse(d).data)&&l.warn("Parsing profile failed during sync... falling back to default profile"),b={quiz_history:{},friends:[]},[2,{fileId:p,profile:null!=y?y:b}];case 5:return[2]}})})())];case 1:if(r=(t=f.sent()).fileId,n=t.profile,u=_(),o()(n)===o()(u))return[2];return d=u,y=n,a={quiz_history:O(d.quiz_history,y.quiz_history),friends:function(e,t){for(var r,n,o,i,u=0,a=0,c=[],s=new Set;u<e.length&&a<t.length;)e[u][1]===t[a][1]?(s.has(e[u][1])||((null!=(o=e[u][2])?o:0)>(null!=(i=t[a][2])?i:0)?c.push(e[u]):c.push(t[a]),s.add(e[u][1])),u++,a++):(null!=(r=e[u][2])?r:0)<(null!=(n=t[a][2])?n:0)?(s.has(e[u][1])||(c.push(e[u]),s.add(e[u][1])),u++):(s.has(t[u][1])||(c.push(t[u]),s.add(t[u][1])),a++);return c.concat(e.slice(u)).concat(t.slice(a))}(d.friends,y.friends)},s.QuizModel.shared.history.value=a.quiz_history,s.QuizModel.shared.friends.value=a.friends,[4,j(e,a,r)];case 2:return f.sent(),[2]}})})()}function _(){return{quiz_history:s.QuizModel.shared.history.value,friends:s.QuizModel.shared.friends.value}}function z(e,t){return Object.keys(e).filter(function(r){return r in t&&o()(e[r])!==o()(t[r])})}function O(e,t){var r=z(e,t);return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}({},e,t,Object.fromEntries(r.map(function(r){var n,i=e[r].correct_pattern,u=t[r].correct_pattern;if(i.length!==u.length)return[r,i.length>u.length?e[r]:t[r]];var a=i.filter(function(e){return e}).length,c=u.filter(function(e){return e}).length;return n=a!==c?c>a?e[r]:t[r]:o()(c)>o()(a)?e[r]:t[r],[r,n]})))}function S(){return"".concat(window.location.host).concat(void 0!==u.k.shared.testIterationId?".".concat(u.k.shared.testIterationId):"",".profile.json")}function j(e,t,r){return p(function(){var n,u,a,c,s,l;return g(this,function(f){switch(f.label){case 0:return n={name:S(),parents:r?void 0:["appDataFolder"]},u={mimeType:"application/json",body:o()(t)},(a=new FormData).append("metadata",new Blob([JSON.stringify(n)],{type:"application/json"})),a.append("media",new Blob([u.body],{type:u.mimeType})),[4,fetch("https://www.googleapis.com/upload/drive/v3/files".concat(r?"/".concat(r):"","?uploadType=multipart"),{method:r?"PATCH":"POST",headers:{Authorization:"Bearer ".concat(e)},body:a})];case 1:if(!(c=f.sent()).ok)throw Error("Could not upload profile file");return l=(s=i.z.object({id:i.z.string()})).parse,[4,c.json()];case 2:return[2,l.apply(s,[f.sent()]).id]}})})()}},89147:function(e,t,r){r.d(t,{Z:()=>u});var n=r(72668);function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var u=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");i(this,"_value",void 0),i(this,"observers",new Set),this._value=e}return e=[{key:"value",get:function(){return this._value},set:function(e){this._value=e,this.observers.forEach(function(e){e()})}},{key:"use",value:function(){var e,t=this,r=(e=(0,n.useState)(0),function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],u=!0,a=!1;try{for(o=o.call(e);!(u=(r=o.next()).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){a=!0,n=e}finally{try{u||null==o.return||o.return()}finally{if(a)throw n}}return i}}(e,2)||function(e,t){if(e){if("string"==typeof e)return o(e,2);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[1];return(0,n.useEffect)(function(){var e=function(){r(function(e){return e+1})};return t.observers.add(e),function(){t.observers.delete(e)}},[]),this.value}}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(t.prototype,e),t}()}}]);
//# sourceMappingURL=882.js.map