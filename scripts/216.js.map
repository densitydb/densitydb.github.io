{"version":3,"file":"216.js","sources":["webpack://assets/./src/mapper/components/DebugMapTextBox.tsx"],"sourcesContent":["import React, { ReactNode, useEffect, useMemo, useRef, useState } from 'react'\n\nimport { CheckboxSettingCustom } from '../../components/sidebar'\nimport { MapTextBoxComponent, Selection, SelectionContext } from '../../mapper/components/MapTextBox'\nimport { OverrideTheme, useColors } from '../../page_template/colors'\nimport { PageTemplate } from '../../page_template/template'\nimport { defaults, TextBox } from '../../urban-stats-script/constants/text-box'\nimport { useUndoRedo } from '../../urban-stats-script/editor-utils'\nimport { Property } from '../../utils/Property'\n\nconst newLabel: TextBox = {\n    bottomLeft: [0.25, 0.25],\n    topRight: [0.75, 0.75],\n    text: [{ insert: '\\n' }], // bugs on applying attributes to empty text without this\n    ...defaults,\n}\n\n/**\n * This panel used for developing + debugging map text box functionality.\n */\nexport function DebugMapTextBoxPanel(props: { undoChunking?: number }): ReactNode {\n    const [edit, setEdit] = useState(true)\n    const [content, setContent] = useState<TextBox[]>(() => [newLabel])\n\n    const selectionProperty = useMemo(() => new Property<Selection | undefined>(undefined), [])\n\n    const { addState, updateCurrentSelection } = useUndoRedo<TextBox[], Selection | undefined>(content, undefined, setContent, (newSelection) => {\n        selectionProperty.value = newSelection\n    }, props)\n\n    // Update current selection when it changes\n    useEffect(() => {\n        const observer = (): void => {\n            // We need this setTimeout since Quill calls the selection events before any text events\n            // This way, if we get a combined text and selection event, we update the new stack item instead of the old one\n            setTimeout(() => {\n                updateCurrentSelection(selectionProperty.value)\n            })\n        }\n\n        selectionProperty.observers.add(observer)\n        return () => { selectionProperty.observers.delete(observer) }\n    }, [selectionProperty, updateCurrentSelection])\n\n    const containerRef = useRef<HTMLDivElement>(null)\n\n    const updateContent = (newContent: TextBox[]): void => {\n        setContent(newContent)\n        addState(newContent, selectionProperty.value)\n    }\n\n    const colors = useColors()\n\n    const labels = content.map((label, i) => (\n        <MapTextBoxComponent\n            key={i}\n            i={i}\n            count={content.length}\n            textBox={label}\n            container={containerRef}\n            edit={edit\n                ? {\n                        modify(n) {\n                            updateContent(content.map((l, j) => j === i ? { ...l, ...n } : l))\n                        },\n                        duplicate() {\n                            updateContent(content.flatMap((l, j) => j === i ? [l, l] : [l]))\n                        },\n                        delete() {\n                            updateContent(content.filter((l, j) => j !== i))\n                        },\n                        add() {\n                            updateContent(content.concat([newLabel]))\n                        },\n                        moveUp() {\n                            updateContent(content.slice(0, i).concat([content[i + 1], content[i]]).concat(content.slice(i + 2)))\n                        },\n                        moveDown() {\n                            updateContent(content.slice(0, i - 1).concat([content[i], content[i - 1]]).concat(content.slice(i + 1)))\n                        },\n                    }\n                : undefined}\n        />\n    ))\n\n    return (\n        <PageTemplate>\n            <CheckboxSettingCustom name=\"edit\" checked={edit} onChange={setEdit} />\n            <SelectionContext.Provider value={selectionProperty}>\n                <OverrideTheme theme=\"Light Mode\">\n                    <div\n                        style={{\n                            width: '1000px',\n                            height: '1000px',\n                            backgroundColor: colors.hueColors.red,\n                            position: 'relative',\n                        }}\n                        ref={containerRef}\n                    >\n                        {labels}\n                    </div>\n                </OverrideTheme>\n            </SelectionContext.Provider>\n        </PageTemplate>\n    )\n}\n"],"names":["newLabel","defaults","DebugMapTextBoxPanel","props","_useState","edit","setEdit","_useState1","content","setContent","selectionProperty","useMemo","Property","undefined","_useUndoRedo","newSelection","addState","updateCurrentSelection","useEffect","observer","setTimeout","containerRef","useRef","updateContent","newContent","colors","useColors","labels","label","i","MapTextBoxComponent","modify","n","l","j","duplicate","_delete","add","moveUp","moveDown","PageTemplate","CheckboxSettingCustom","SelectionContext","OverrideTheme"],"mappings":"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"}