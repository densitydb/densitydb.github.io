{"version":3,"file":"824.js","sources":["webpack://assets/./src/components/display-stats.tsx","webpack://assets/./src/components/unit-display.tsx","webpack://assets/./src/utils/coordinates.ts","webpack://assets/./src/mapper/components/Colorbar.tsx","webpack://assets/./src/mapper/components/InsetMap.tsx","webpack://assets/./src/mapper/map-generator.tsx","webpack://assets/./src/components/screenshot-map.tsx","webpack://assets/./src/mapper/settings/ImportExportCode.tsx","webpack://assets/./src/mapper/style.ts","webpack://assets/./src/mapper/settings/MapperSettings.tsx","webpack://assets/./src/utils/array-edits.ts","webpack://assets/./src/mapper/settings/insets.ts","webpack://assets/./src/mapper/settings/EditMapperPanel.tsx","webpack://assets/./src/mapper/components/MapperPanel.tsx","webpack://assets/./src/utils/upload.ts"],"sourcesContent":["import React, { CSSProperties, ReactNode } from 'react'\n\nimport { useColors } from '../page_template/colors'\nimport { useSetting } from '../page_template/settings'\nimport { UnitType } from '../utils/unit'\n\nimport { classifyStatistic, getUnitDisplay } from './unit-display'\n\nexport function Statistic(props: { style?: React.CSSProperties, statname: string, value: number, isUnit: boolean, unit?: UnitType }): ReactNode {\n    const [useImperial] = useSetting('use_imperial')\n    const [temperatureUnit] = useSetting('temperature_unit')\n\n    const statisticType = props.unit ?? classifyStatistic(props.statname)\n    const unitDisplay = getUnitDisplay(statisticType)\n    const { value, unit } = unitDisplay.renderValue(props.value, useImperial, temperatureUnit)\n\n    return (\n        <span style={props.style}>\n            {props.isUnit ? unit : value}\n        </span>\n    )\n}\n\nexport function ElectionResult(props: { value: number }): ReactNode {\n    const colors = useColors()\n    // check if value is NaN\n    if (props.value !== props.value) {\n        return <span>N/A</span>\n    }\n    const value = Math.abs(props.value) * 100\n    const places = value > 10 ? 1 : value > 1 ? 2 : value > 0.1 ? 3 : 4\n    const text = value.toFixed(places)\n    const party = props.value > 0 ? 'D' : 'R'\n    const partyColor = props.value > 0 ? colors.hueColors.blue : colors.hueColors.red\n    const spanStyle: CSSProperties = {\n        color: partyColor,\n        // So that on 4 digits, we overflow left\n        display: 'flex',\n        justifyContent: 'flex-end',\n    }\n    return (\n        <span style={spanStyle}>\n            {party}\n            +\n            {text}\n        </span>\n    )\n}\n\nexport function Percentile(props: {\n    ordinal: number\n    total: number\n    percentileByPopulation: number\n    simpleOrdinals: boolean\n}): ReactNode {\n    const ordinal = props.ordinal\n    const total = props.total\n    if (ordinal > total) {\n        return <span></span>\n    }\n    // percentile as an integer\n    // used to be keyed by a setting, but now we always use percentile_by_population\n    const percentile = props.percentileByPopulation\n    // something like Xth percentile\n    let text = `${percentile}th percentile`\n    if (props.simpleOrdinals) {\n        text = `${percentile.toString()}%`\n    }\n    else if (percentile % 10 === 1 && percentile % 100 !== 11) {\n        text = `${percentile}st percentile`\n    }\n    else if (percentile % 10 === 2 && percentile % 100 !== 12) {\n        text = `${percentile}nd percentile`\n    }\n    else if (percentile % 10 === 3 && percentile % 100 !== 13) {\n        text = `${percentile}rd percentile`\n    }\n    return <div className=\"serif\" style={{ textAlign: 'right', marginRight: props.simpleOrdinals ? '5px' : undefined }}>{text}</div>\n}\n","import React, { ReactNode } from 'react'\n\nimport { separateNumber } from '../utils/text'\nimport { UnitType } from '../utils/unit'\n\nimport { ElectionResult } from './display-stats'\n\nexport interface UnitDisplay {\n    renderValue: (value: number, useImperial?: boolean, temperatureUnit?: string) => {\n        value: ReactNode\n        unit: ReactNode\n    }\n}\n\nexport function getUnitDisplay(unitType: UnitType): UnitDisplay {\n    switch (unitType) {\n        case 'percentage':\n            return {\n                renderValue: (value: number) => {\n                    return {\n                        value: <span>{(value * 100).toFixed(2)}</span>,\n                        unit: <span>%</span>,\n                    }\n                },\n            }\n        case 'fatalities':\n            return {\n                renderValue: (value: number) => {\n                    return {\n                        value: <span>{separateNumber(value.toFixed(0))}</span>,\n                        unit: <span>&nbsp;</span>,\n                    }\n                },\n            }\n        case 'fatalitiesPerCapita':\n            return {\n                renderValue: (value: number) => {\n                    return {\n                        value: <span>{(100_000 * value).toFixed(2)}</span>,\n                        unit: <span>/100k</span>,\n                    }\n                },\n            }\n        case 'density':\n            return {\n                renderValue: (value: number, useImperial?: boolean) => {\n                    let unitName = 'km'\n                    let adjustedValue = value\n                    if (useImperial) {\n                        unitName = 'mi'\n                        adjustedValue *= 1.60934 * 1.60934\n                    }\n                    let places = 2\n                    if (adjustedValue > 10) {\n                        places = 0\n                    }\n                    else if (adjustedValue > 1) {\n                        places = 1\n                    }\n                    return {\n                        value: <span>{separateNumber(adjustedValue.toFixed(places))}</span>,\n                        unit: (\n                            <span>\n                                /&nbsp;\n                                {unitName}\n                                <sup>2</sup>\n                            </span>\n                        ),\n                    }\n                },\n            }\n        case 'population':\n            return {\n                renderValue: (value: number) => {\n                    if (value > 1e9) {\n                        return {\n                            value: <span>{(value / 1e9).toPrecision(3)}</span>,\n                            unit: <span>B</span>,\n                        }\n                    }\n                    if (value > 1e6) {\n                        return {\n                            value: <span>{(value / 1e6).toPrecision(3)}</span>,\n                            unit: <span>m</span>,\n                        }\n                    }\n                    else if (value > 1e4) {\n                        return {\n                            value: <span>{(value / 1e3).toPrecision(3)}</span>,\n                            unit: <span>k</span>,\n                        }\n                    }\n                    else {\n                        return {\n                            value: <span>{separateNumber(value.toFixed(0))}</span>,\n                            unit: <span>&nbsp;</span>,\n                        }\n                    }\n                },\n            }\n        case 'area':\n            return {\n                renderValue: (value: number, useImperial?: boolean) => {\n                    let adjustedValue = value\n                    let unit: React.ReactElement\n                    if (useImperial) {\n                        adjustedValue /= 1.60934 * 1.60934\n                        if (adjustedValue < 1) {\n                            unit = <span>acres</span>\n                            adjustedValue *= 640\n                        }\n                        else {\n                            unit = (\n                                <span>\n                                    mi\n                                    <sup>2</sup>\n                                </span>\n                            )\n                        }\n                    }\n                    else {\n                        if (adjustedValue < 0.01) {\n                            adjustedValue *= 1000 * 1000\n                            unit = (\n                                <span>\n                                    m\n                                    <sup>2</sup>\n                                </span>\n                            )\n                        }\n                        else {\n                            unit = (\n                                <span>\n                                    km\n                                    <sup>2</sup>\n                                </span>\n                            )\n                        }\n                    }\n                    let places = 3\n                    if (adjustedValue > 100) {\n                        places = 0\n                    }\n                    else if (adjustedValue > 10) {\n                        places = 1\n                    }\n                    else if (adjustedValue > 1) {\n                        places = 2\n                    }\n                    let rendered = adjustedValue.toFixed(places)\n                    if (places === 0) {\n                        rendered = separateNumber(rendered)\n                    }\n                    return {\n                        value: <span>{rendered}</span>,\n                        unit,\n                    }\n                },\n            }\n        case 'distanceInKm':\n            return {\n                renderValue: (value: number, useImperial?: boolean) => {\n                    let unit = <span>km</span>\n                    let adjustedValue = value\n                    if (useImperial) {\n                        unit = <span>mi</span>\n                        adjustedValue /= 1.60934\n                    }\n                    return {\n                        value: <span>{adjustedValue.toFixed(2)}</span>,\n                        unit,\n                    }\n                },\n            }\n        case 'distanceInM':\n            return {\n                renderValue: (value: number, useImperial?: boolean) => {\n                    let unitName = 'm'\n                    let adjustedValue = value\n                    if (useImperial) {\n                        unitName = 'ft'\n                        adjustedValue *= 3.28084\n                    }\n                    return {\n                        value: <span>{separateNumber(adjustedValue.toFixed(0))}</span>,\n                        unit: <span>{unitName}</span>,\n                    }\n                },\n            }\n        case 'democraticMargin':\n            return {\n                renderValue: (value: number) => {\n                    return {\n                        value: <ElectionResult value={value} />,\n                        unit: <span>%</span>,\n                    }\n                },\n            }\n        case 'temperature':\n            return {\n                renderValue: (value: number, useImperial?: boolean, temperatureUnit?: string) => {\n                    let unit = <span>&deg;F</span>\n                    let adjustedValue = value\n                    if (temperatureUnit === 'celsius') {\n                        unit = <span>&deg;C</span>\n                        adjustedValue = (value - 32) * (5 / 9)\n                    }\n                    return {\n                        value: <span>{adjustedValue.toFixed(1)}</span>,\n                        unit,\n                    }\n                },\n            }\n        case 'time':\n            return {\n                renderValue: (value: number) => {\n                    const hours = Math.floor(value)\n                    const minutes = Math.floor((value - hours) * 60)\n                    return {\n                        value: (\n                            <span>\n                                {hours}\n                                :\n                                {minutes.toString().padStart(2, '0')}\n                            </span>\n                        ),\n                        unit: <span>&nbsp;</span>,\n                    }\n                },\n            }\n        case 'distancePerYear':\n            return {\n                renderValue: (value: number, useImperial?: boolean) => {\n                    let adjustedValue = value * 100\n                    let unit = 'cm'\n                    if (useImperial) {\n                        unit = 'in'\n                        adjustedValue /= 2.54\n                    }\n                    return {\n                        value: <span>{adjustedValue.toFixed(1)}</span>,\n                        unit: (\n                            <span>\n                                {unit}\n                                /yr\n                            </span>\n                        ),\n                    }\n                },\n            }\n        case 'contaminantLevel':\n            return {\n                renderValue: (value: number) => {\n                    return {\n                        value: <span>{value.toFixed(2)}</span>,\n                        unit: (\n                            <span>\n                                &mu;g/m\n                                <sup>3</sup>\n                            </span>\n                        ),\n                    }\n                },\n            }\n        case 'number':\n            return {\n                renderValue: (value: number) => {\n                    return {\n                        value: <span>{value.toFixed(3)}</span>,\n                        unit: <span>&nbsp;</span>,\n                    }\n                },\n            }\n        case 'usd':\n            return {\n                renderValue: (value: number) => {\n                    if (value > 1e9) {\n                        return {\n                            value: (\n                                <span>\n                                    $\n                                    {(value / 1e9).toPrecision(3)}\n                                </span>\n                            ),\n                            unit: <span>B</span>,\n                        }\n                    }\n                    if (value > 1e6) {\n                        return {\n                            value: (\n                                <span>\n                                    $\n                                    {(value / 1e6).toPrecision(3)}\n                                </span>\n                            ),\n                            unit: <span>m</span>,\n                        }\n                    }\n                    else if (value > 1e3) {\n                        return {\n                            value: (\n                                <span>\n                                    $\n                                    {(value / 1e3).toPrecision(3)}\n                                </span>\n                            ),\n                            unit: <span>k</span>,\n                        }\n                    }\n                    else {\n                        return {\n                            value: (\n                                <span>\n                                    $\n                                    {separateNumber(value.toFixed(0))}\n                                </span>\n                            ),\n                            unit: <span>&nbsp;</span>,\n                        }\n                    }\n                },\n            }\n        case 'minutes':\n            return {\n                renderValue: (value: number) => {\n                    const hours = Math.floor(value / 60)\n                    const minutes = Math.floor(value % 60)\n\n                    if (hours > 0) {\n                        return {\n                            value: (\n                                <span>\n                                    {hours}\n                                    :\n                                    {minutes.toString().padStart(2, '0')}\n                                </span>\n                            ),\n                            unit: <span>&nbsp;</span>,\n                        }\n                    }\n                    else {\n                        return {\n                            value: <span>{minutes}</span>,\n                            unit: <span>&nbsp;</span>,\n                        }\n                    }\n                },\n            }\n    }\n}\n\nexport function classifyStatistic(statname: string): UnitType {\n    if (statname.includes('%') || statname.includes('Change') || statname.includes('(Grade)')) {\n        return 'percentage'\n    }\n    if (statname.includes('Total') && statname.includes('Fatalities')) {\n        return 'fatalities'\n    }\n    if (statname.includes('Fatalities Per Capita')) {\n        return 'fatalitiesPerCapita'\n    }\n    if (statname.includes('Density')) {\n        return 'density'\n    }\n    if (statname.includes('Elevation')) {\n        return 'distanceInM'\n    }\n    if (statname.startsWith('Population')) {\n        return 'population'\n    }\n    if (statname === 'Area') {\n        return 'area'\n    }\n    if (statname.includes('Mean distance')) {\n        return 'distanceInKm'\n    }\n    if (statname.includes('Election') || statname.includes('Swing')) {\n        return 'democraticMargin'\n    }\n    if (statname.includes('high temp') || statname.includes('low temp') || statname.includes('high heat index') || statname.includes('dewpt')) {\n        return 'temperature'\n    }\n    if (statname === 'Mean sunny hours') {\n        return 'time'\n    }\n    if (statname === 'Rainfall' || statname === 'Snowfall [rain-equivalent]') {\n        return 'distancePerYear'\n    }\n    if (statname.includes('Pollution')) {\n        return 'contaminantLevel'\n    }\n    if (statname.includes('(USD)')) {\n        return 'usd'\n    }\n    if (statname.includes('(min)')) {\n        return 'minutes'\n    }\n    return 'number'\n}\n","import { Inset } from '../urban-stats-script/constants/insets'\n\nimport { assert } from './defensive'\n\n// Web Mercator projection functions\nfunction lngToWebMercatorX(lng: number): number {\n    return lng * Math.PI / 180 * 6378137\n}\n\nfunction latToWebMercatorY(lat: number): number {\n    return 6378137 * Math.log(Math.tan(Math.PI / 4 + lat * Math.PI / 360))\n}\n\nexport function computeAspectRatio(coordBox: [number, number, number, number]): number {\n    // coordBox is [west, south, east, north]\n    const x1 = lngToWebMercatorX(coordBox[0])\n    const x2 = lngToWebMercatorX(coordBox[2])\n    const y1 = latToWebMercatorY(coordBox[1])\n    const y2 = latToWebMercatorY(coordBox[3])\n\n    const width = Math.abs(x2 - x1)\n    const height = Math.abs(y2 - y1)\n\n    return width / height\n}\n\nfunction area(coordBox: [number, number, number, number]): number {\n    // coordBox is [west, south, east, north]\n    const x1 = lngToWebMercatorX(coordBox[0])\n    const x2 = lngToWebMercatorX(coordBox[2])\n    const y1 = latToWebMercatorY(coordBox[1])\n    const y2 = latToWebMercatorY(coordBox[3])\n\n    return Math.abs((x2 - x1) * (y2 - y1))\n}\n\nexport function computeAspectRatioForInsets(mapsWithCoordBox: Inset[]): number {\n    assert(mapsWithCoordBox.length > 0, 'No insets with coordBox')\n\n    const biggestMap = mapsWithCoordBox.reduce((prev, curr) => {\n        return area(curr.coordBox) > area(prev.coordBox) ? curr : prev\n    })\n    const coordBox = biggestMap.coordBox\n    const onScreenWidth = biggestMap.topRight[0] - biggestMap.bottomLeft[0]\n    const onScreenHeight = biggestMap.topRight[1] - biggestMap.bottomLeft[1]\n    const onScreenAspectRatio = onScreenWidth / onScreenHeight\n    return computeAspectRatio(coordBox) / onScreenAspectRatio\n}\n","import React, { ReactNode, useMemo, useRef, useSyncExternalStore } from 'react'\n\nimport { Statistic } from '../../components/display-stats'\nimport { ScaleInstance } from '../../urban-stats-script/constants/scale'\nimport { furthestColor, interpolateColor } from '../../utils/color'\nimport { onWidthChange } from '../../utils/responsive'\nimport { UnitType } from '../../utils/unit'\nimport { Keypoints } from '../ramps'\nimport { Basemap } from '../settings/utils'\n\nfunction colorbarStyleFromBasemap(basemap: Basemap): React.CSSProperties {\n    switch (basemap.type) {\n        case 'osm':\n            return { }\n        case 'none':\n            return { backgroundColor: basemap.backgroundColor, color: basemap.textColor }\n    }\n}\n\ninterface EmpiricalRamp {\n    ramp: Keypoints\n    scale: ScaleInstance\n    interpolations: number[]\n    label: string\n    unit?: UnitType\n}\n\nexport type RampToDisplay = { type: 'ramp', value: EmpiricalRamp } | { type: 'label', value: string }\n\nexport function Colorbar(props: { ramp: RampToDisplay | undefined, basemap: Basemap }): ReactNode {\n    // do this as a table with 10 columns, each 10% wide and\n    // 2 rows. Top one is the colorbar, bottom one is the\n    // labels.\n    const valuesRef = useRef<HTMLDivElement>(null)\n    const shouldRotate: boolean = useSyncExternalStore(onWidthChange, () => {\n        if (valuesRef.current === null) {\n            return false\n        }\n        const current = valuesRef.current\n        const containers = current.querySelectorAll('.containerOfXticks')\n        // eslint-disable-next-line @typescript-eslint/prefer-for-of -- this isn't a loop over an array\n        for (let i = 0; i < containers.length; i++) {\n            const container = containers[i] as HTMLDivElement\n            const contained: HTMLDivElement | null = container.querySelector('.containedOfXticks')\n            if (contained === null) {\n                continue\n            }\n            if (contained.offsetWidth > container.offsetWidth * 0.9) {\n                return true\n            }\n        }\n        return false\n    })\n\n    const furthest = useMemo(() => props.ramp === undefined || props.ramp.type !== 'ramp' ? undefined : furthestColor(props.ramp.value.ramp.map(x => x[1])), [props.ramp])\n\n    if (props.ramp === undefined) {\n        return <div></div>\n    }\n\n    if (props.ramp.type === 'label') {\n        return (\n            <div className=\"centered_text\" style={colorbarStyleFromBasemap(props.basemap)}>\n                {props.ramp.value}\n            </div>\n        )\n    }\n\n    const ramp = props.ramp.value.ramp\n    const scale = props.ramp.value.scale\n    const label = props.ramp.value.label\n    const values = props.ramp.value.interpolations\n    const unit = props.ramp.value.unit\n    const style = colorbarStyleFromBasemap(props.basemap)\n\n    const createValue = (stat: number): ReactNode => {\n        return (\n            <div className=\"centered_text\" style={style}>\n                <Statistic\n                    statname={label}\n                    value={stat}\n                    isUnit={false}\n                    unit={unit}\n                />\n                <Statistic\n                    statname={label}\n                    value={stat}\n                    isUnit={true}\n                    unit={unit}\n                />\n            </div>\n        )\n    }\n\n    const width = `${100 / values.length}%`\n\n    const valuesDivs = (rotate: boolean): ReactNode[] => values.map((x, i) => (\n        <div\n            key={i}\n            style={{\n                width,\n                // height: rotate ? '2em' : '1em',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n            }}\n            className=\"containerOfXticks\"\n        >\n            <div\n                style={{\n                    // transform: rotate ? 'rotate(-45deg)' : 'none',\n                    writingMode: rotate ? 'sideways-lr' : 'horizontal-tb',\n                    padding: rotate ? '0.5em' : '0',\n                    // transformOrigin: 'center',\n                    // whiteSpace: 'nowrap',\n                    // fontSize: rotate ? '0.8em' : '1em',\n                }}\n                className=\"containedOfXticks\"\n            >\n                {createValue(x)}\n            </div>\n        </div>\n    ))\n\n    return (\n        <div style={{ ...style, position: 'relative' }}>\n            <div style={{ display: 'flex', width: '100%' }}>\n                {\n                    values.map((x, i) => (\n                        <div\n                            key={i}\n                            style={{\n                                width, height: '1em',\n                                backgroundColor: interpolateColor(ramp, scale.forward(x), furthest),\n                                marginLeft: '1px',\n                                marginRight: '1px',\n                            }}\n                        >\n                        </div>\n                    ))\n                }\n            </div>\n            <div ref={valuesRef} style={{ position: 'absolute', top: 0, left: 0, display: 'flex', width: '100%', visibility: 'hidden' }}>{valuesDivs(false)}</div>\n            <div style={{ display: 'flex', width: '100%' }}>{valuesDivs(shouldRotate)}</div>\n            <div className=\"centered_text\">\n                {label}\n            </div>\n        </div>\n    )\n}\n","import React, { HTMLAttributes, ReactNode, RefObject, useEffect, useRef, useState } from 'react'\nimport { MapRef, useMap } from 'react-map-gl/maplibre'\n\nimport { CommonMaplibreMap, CustomAttributionControlComponent, insetBorderWidth } from '../../components/map-common'\nimport { mapBorderRadius, mapBorderWidth } from '../../components/screenshot'\nimport { useColors } from '../../page_template/colors'\nimport { Inset } from '../../urban-stats-script/constants/insets'\nimport { TestUtils } from '../../utils/TestUtils'\n\n// eslint-disable-next-line no-restricted-syntax -- Forward Ref\nfunction _InsetMap({ inset, children, editInset, container, i, numInsets }: {\n    inset: Inset\n    children: ReactNode\n    container: RefObject<HTMLDivElement>\n    editInset?: {\n        modify: (newInset: Partial<Inset>) => void\n        duplicate: () => void\n        delete: () => void\n        add: () => void\n        moveUp: () => void\n        moveDown: () => void\n    }\n    i: number\n    numInsets: number\n}, ref: React.Ref<MapRef>): ReactNode {\n    const colors = useColors()\n\n    const id = `map-${i}`\n\n    return (\n        <div\n            id={id}\n            style={{ position: 'absolute',\n                left: `${inset.bottomLeft[0] * 100}%`,\n                bottom: `${inset.bottomLeft[1] * 100}%`,\n                width: `${(inset.topRight[0] - inset.bottomLeft[0]) * 100}%`,\n                height: `${(inset.topRight[1] - inset.bottomLeft[1]) * 100}%` }}\n        >\n            <CommonMaplibreMap\n                ref={ref}\n                style={{\n                    position: 'absolute',\n                    inset: 0,\n                    border: !inset.mainMap ? `${insetBorderWidth}px solid ${colors.mapInsetBorderColor}` : `${mapBorderWidth}px solid ${colors.borderNonShadow}`,\n                    borderRadius: !inset.mainMap ? '0px' : `${mapBorderRadius}px`,\n                    width: undefined,\n                    height: undefined,\n                }}\n                attributionControl={false}\n            >\n                {children}\n                <HandleInsets\n                    inset={inset}\n                    setCoordBox={(newBox) => {\n                        editInset?.modify({ coordBox: newBox })\n                    }}\n                />\n                <ExposeMapForTesting id={id} />\n                { inset.mainMap && <CustomAttributionControlComponent startShowingAttribution={true} />}\n            </CommonMaplibreMap>\n            { editInset && (\n                <EditInsetsHandles\n                    frame={[...inset.bottomLeft, ...inset.topRight]}\n                    setFrame={(newFrame) => {\n                        editInset.modify({ bottomLeft: [newFrame[0], newFrame[1]], topRight: [newFrame[2], newFrame[3]] })\n                    }}\n                    container={container}\n                    delete={inset.mainMap ? undefined : editInset.delete}\n                    duplicate={inset.mainMap ? undefined : editInset.duplicate}\n                    add={inset.mainMap ? editInset.add : undefined}\n                    shouldHaveCenterHandle={!inset.mainMap || !isFullScreenInset(inset)}\n                    /*\n                    Allowing reordering on the main map in case you want to put its corner in front of an inset or something\n                    it also eliminates the weird edge case where the main map is not the 0th inset\n                    */\n                    moveUp={i + 1 < numInsets ? () => { editInset.moveUp() } : undefined}\n                    moveDown={i > 0 ? () => { editInset.moveDown() } : undefined}\n                />\n            )}\n        </div>\n    )\n}\n\n// eslint-disable-next-line no-restricted-syntax -- Forward Ref\nexport const InsetMap = React.forwardRef(_InsetMap)\n\nfunction HandleInsets({ inset, setCoordBox }: { inset: Inset, setCoordBox: (newBox: Frame) => void }): ReactNode {\n    const map = useMap().current!\n\n    useEffect(() => {\n        const fit = (): void => {\n            map.fitBounds(inset.coordBox, { animate: false })\n        }\n        fit()\n        map.on('resize', fit)\n        return () => {\n            map.off('resize', fit)\n        }\n    }, [inset, map])\n\n    useEffect(() => {\n        const getCoordBox = (): [number, number, number, number] => {\n            const mapBounds = map.getBounds()\n            const sw = mapBounds.getSouthWest()\n            const ne = mapBounds.getNorthEast()\n            return [sw.lng, sw.lat, ne.lng, ne.lat]\n        }\n\n        const moveHandler = (e: maplibregl.MapLibreEvent): void => {\n            if (e.originalEvent === undefined) {\n                // Not a user event\n                return\n            }\n            setCoordBox(getCoordBox())\n        }\n\n        map.on('moveend', moveHandler)\n\n        return () => {\n            map.off('moveend', moveHandler)\n        }\n    }, [map, setCoordBox])\n\n    return null\n}\n\nfunction ExposeMapForTesting({ id }: { id: string }): ReactNode {\n    const map = useMap().current!.getMap()\n    TestUtils.shared.maps.set(id, new WeakRef(map))\n    return null\n}\n\ntype DragKind = 'move' | `${'top' | 'bottom'}${'Right' | 'Left'}`\n\ntype Frame = [number, number, number, number]\n\nfunction isFullScreenInset(inset: Inset): boolean {\n    const tolerance = 0.005\n    return Math.abs(inset.bottomLeft[0] - 0) < tolerance\n        && Math.abs(inset.bottomLeft[1] - 0) < tolerance\n        && Math.abs(inset.topRight[0] - 1) < tolerance\n        && Math.abs(inset.topRight[1] - 1) < tolerance\n}\n\nfunction EditInsetsHandles(props: {\n    frame: Frame\n    setFrame: (newFrame: Frame) => void\n    container: RefObject<HTMLDivElement>\n    delete?: () => void\n    duplicate?: () => void\n    add?: () => void\n    moveUp?: () => void\n    moveDown?: () => void\n    shouldHaveCenterHandle: boolean\n}): ReactNode {\n    const activeDrag = useRef<{ kind: DragKind, startX: number, startY: number, startFrame: Frame, pointerId: number } | undefined>(undefined)\n\n    const pointerHandlers = (kind: DragKind): {\n        'onPointerDown': (e: React.PointerEvent) => void\n        'onPointerMove': (e: React.PointerEvent) => void\n        'onPointerUp': (e: React.PointerEvent) => void\n        'onPointerCancel': (e: React.PointerEvent) => void\n        'data-test': string\n    } => ({\n        'data-test': kind,\n        'onPointerDown': (e: React.PointerEvent) => {\n            if (activeDrag.current !== undefined) {\n                return\n            }\n            const thisElem = e.target as HTMLDivElement\n            activeDrag.current = {\n                kind,\n                startX: e.clientX,\n                startY: e.clientY,\n                startFrame: props.frame,\n                pointerId: e.pointerId,\n            }\n            thisElem.setPointerCapture(e.pointerId)\n        },\n        'onPointerMove': (e: React.PointerEvent) => {\n            if (activeDrag.current?.pointerId !== e.pointerId) {\n                return\n            }\n            const drag = activeDrag.current\n            const rawMovementX = (e.clientX - drag.startX) / props.container.current!.clientWidth\n            const rawMovementY = -(e.clientY - drag.startY) / props.container.current!.clientHeight\n            const resizedFrame: Frame = [\n                Math.max(0, Math.min(drag.startFrame[0] + rawMovementX, drag.startFrame[2] - 0.05)),\n                Math.max(0, Math.min(drag.startFrame[1] + rawMovementY, drag.startFrame[3] - 0.1)),\n                Math.max(drag.startFrame[0] + 0.05, Math.min(drag.startFrame[2] + rawMovementX, 1)),\n                Math.max(drag.startFrame[1] + 0.1, Math.min(drag.startFrame[3] + rawMovementY, 1)),\n            ]\n            let newFrame: Frame\n            switch (drag.kind) {\n                case 'move':\n                    const movementX = Math.max(0 - drag.startFrame[0], Math.min(rawMovementX, 1 - drag.startFrame[2]))\n                    const movementY = Math.max(0 - drag.startFrame[1], Math.min(rawMovementY, 1 - drag.startFrame[3]))\n                    newFrame = [drag.startFrame[0] + movementX, drag.startFrame[1] + movementY, drag.startFrame[2] + movementX, drag.startFrame[3] + movementY]\n                    break\n                case 'topRight':\n                    newFrame = [drag.startFrame[0], drag.startFrame[1], resizedFrame[2], resizedFrame[3]]\n                    break\n                case 'bottomRight':\n                    newFrame = [drag.startFrame[0], resizedFrame[1], resizedFrame[2], drag.startFrame[3]]\n                    break\n                case 'bottomLeft':\n                    newFrame = [resizedFrame[0], resizedFrame[1], drag.startFrame[2], drag.startFrame[3]]\n                    break\n                case 'topLeft':\n                    newFrame = [resizedFrame[0], drag.startFrame[1], drag.startFrame[2], resizedFrame[3]]\n                    break\n            }\n            props.setFrame(newFrame)\n        },\n        'onPointerUp': (e: React.PointerEvent) => {\n            if (activeDrag.current?.pointerId !== e.pointerId) {\n                return\n            }\n            activeDrag.current = undefined\n        },\n        'onPointerCancel': (e: React.PointerEvent) => {\n            if (activeDrag.current?.pointerId !== e.pointerId) {\n                return\n            }\n            activeDrag.current = undefined\n        },\n    })\n\n    return (\n        <>\n            <Handle handleSize={15} style={{ right: `-${insetBorderWidth}px`, top: `-${insetBorderWidth}px`, cursor: 'nesw-resize' }} {...pointerHandlers('topRight')} />\n            <Handle handleSize={15} style={{ right: `-${insetBorderWidth}px`, bottom: `-${insetBorderWidth}px`, cursor: 'nwse-resize' }} {...pointerHandlers('bottomRight')} />\n            <Handle handleSize={15} style={{ left: `-${insetBorderWidth}px`, bottom: `-${insetBorderWidth}px`, cursor: 'nesw-resize' }} {...pointerHandlers('bottomLeft')} />\n            <Handle handleSize={15} style={{ left: `-${insetBorderWidth}px`, top: `-${insetBorderWidth}px`, cursor: 'nwse-resize' }} {...pointerHandlers('topLeft')} />\n            {props.shouldHaveCenterHandle && (\n                <Handle handleSize={20} style={{ margin: 'auto', left: `calc(50% - 10px)`, top: `calc(50% - 10px)`, cursor: 'move' }} {...pointerHandlers('move')} />\n            )}\n            {props.duplicate && (\n                <Handle handleSize={25} data-test=\"duplicate\" style={{ margin: 'auto', left: `calc(66% - 12.5px)`, textAlign: 'center', lineHeight: '25px', top: -insetBorderWidth, cursor: 'copy' }} onClick={props.duplicate} img={{ src: '/duplicate.png', alt: 'Duplicate' }} />\n            )}\n            {props.delete && (\n                <Handle handleSize={25} data-test=\"delete\" style={{ margin: 'auto', left: `calc(33% - 12.5px)`, textAlign: 'center', lineHeight: '25px', top: -insetBorderWidth, cursor: 'default' }} onClick={props.delete} img={{ src: '/close-red-small.png', alt: 'Delete' }} />\n            )}\n            {props.add && (\n                <Handle handleSize={25} data-test=\"add\" style={{ margin: 'auto', left: `calc(50% - 12.5px)`, textAlign: 'center', top: -insetBorderWidth, cursor: 'default' }} onClick={props.add} img={{ src: '/add-green-small.png', alt: 'Add' }} />\n            )}\n            {props.moveUp && (\n                <Handle handleSize={25} data-test=\"moveUp\" style={{ left: `-${insetBorderWidth}px`, textAlign: 'center', top: `calc(50% - 25px)`, cursor: 'default' }} onClick={props.moveUp} img={{ src: '/sort-up.png', alt: 'Move Up' }} />\n            )}\n            {props.moveDown && (\n                <Handle handleSize={25} data-test=\"moveDown\" style={{ left: `-${insetBorderWidth}px`, textAlign: 'center', top: `calc(50%)`, cursor: 'default' }} onClick={props.moveDown} img={{ src: '/sort-down.png', alt: 'Move Down' }} />\n            )}\n        </>\n    )\n}\n\nfunction Handle({ handleSize, style, img, ...rest }: { handleSize: number, img?: { src: string, alt: string } } & HTMLAttributes<HTMLDivElement>): ReactNode {\n    const colors = useColors()\n    const [hover, setHover] = useState(false)\n\n    const divRef = useRef<HTMLDivElement>(null)\n\n    useEffect(() => {\n        const handleMouseEnter = (): void => {\n            setHover(true)\n        }\n\n        const handleMouseLeave = (): void => {\n            setHover(false)\n        }\n\n        const div = divRef.current!\n        div.addEventListener('mouseenter', handleMouseEnter)\n        div.addEventListener('mouseleave', handleMouseLeave)\n\n        return () => {\n            div.removeEventListener('mouseenter', handleMouseEnter)\n            div.removeEventListener('mouseleave', handleMouseLeave)\n        }\n    }, [])\n\n    return (\n        <div\n            ref={divRef}\n            role=\"button\"\n            style={{\n                backgroundColor: hover ? colors.slightlyDifferentBackgroundFocused : colors.slightlyDifferentBackground,\n                border: `1px solid ${colors.textMain}`,\n                position: 'absolute',\n                width: `${handleSize}px`,\n                height: `${handleSize}px`,\n                borderRadius: '2px',\n                ...style,\n            }}\n            {...rest}\n        >\n            {img && <img src={img.src} alt={img.alt} style={{ width: '100%', height: '100%' }} />}\n        </div>\n    )\n}\n","import React, { ReactNode, useEffect, useRef, useState } from 'react'\nimport { MapRef } from 'react-map-gl/maplibre'\n\nimport { CSVExportData, generateMapperCSVData } from '../components/csv-export'\nimport { Basemap as BasemapComponent, PointFeatureCollection, Polygon, PolygonFeatureCollection } from '../components/map-common'\nimport { screencapElement } from '../components/screenshot'\nimport { renderMap } from '../components/screenshot-map'\nimport valid_geographies from '../data/mapper/used_geographies'\nimport universes_ordered from '../data/universes_ordered'\nimport { loadProtobuf } from '../load_json'\nimport { boundingBox, geometry } from '../map-partition'\nimport { consolidatedShapeLink, indexLink } from '../navigation/links'\nimport { LongLoad } from '../navigation/loading'\nimport { Colors } from '../page_template/color-themes'\nimport { loadCentroids } from '../syau/load'\nimport { Universe } from '../universe'\nimport { getAllParseErrors } from '../urban-stats-script/ast'\nimport { doRender } from '../urban-stats-script/constants/color'\nimport { Inset } from '../urban-stats-script/constants/insets'\nimport { instantiate } from '../urban-stats-script/constants/scale'\nimport { EditorError } from '../urban-stats-script/editor-utils'\nimport { noLocation } from '../urban-stats-script/location'\nimport { USSOpaqueValue } from '../urban-stats-script/types-values'\nimport { loadInsets } from '../urban-stats-script/worker'\nimport { executeAsync } from '../urban-stats-script/workerManager'\nimport { furthestColor, interpolateColor } from '../utils/color'\nimport { computeAspectRatioForInsets } from '../utils/coordinates'\nimport { ConsolidatedShapes, Feature, ICoordinate } from '../utils/protos'\nimport { NormalizeProto } from '../utils/types'\nimport { useOrderedResolve } from '../utils/useOrderedResolve'\n\nimport { Colorbar, RampToDisplay } from './components/Colorbar'\nimport { InsetMap } from './components/InsetMap'\nimport { Basemap, computeUSS, MapSettings } from './settings/utils'\n\ntype EditMultipleInsets = (index: number, newInset: Partial<Inset>) => void\ninterface EditInsets {\n    modify: EditMultipleInsets\n    editedInsets: Inset[]\n    add: () => void\n    delete: (i: number) => void\n    duplicate: (i: number) => void\n    moveUp: (i: number) => void\n    moveDown: (i: number) => void\n}\n\nconst mapUpdateInterval = 500\n\nexport function useMapGenerator({ mapSettings }: { mapSettings: MapSettings }): MapGenerator {\n    const cache = useRef<MapCache>({})\n    const updateTime = useRef(Date.now())\n\n    const [currentGenerator, setCurrentGenerator] = useState<Promise<MapGenerator<{ loading: boolean }>>>(() => makeMapGenerator({ mapSettings, cache: cache.current, previousGenerator: undefined }))\n\n    useEffect(() => {\n        const timeSinceMapUpdate = Date.now() - updateTime.current\n        if (timeSinceMapUpdate > mapUpdateInterval) {\n            updateTime.current = Date.now()\n            setCurrentGenerator(previousGenerator => makeMapGenerator({ mapSettings, cache: cache.current, previousGenerator }))\n            return\n        }\n        else {\n            updateTime.current = Date.now()\n            const timeout = setTimeout(() => {\n                setCurrentGenerator(previousGenerator => makeMapGenerator({ mapSettings, cache: cache.current, previousGenerator }))\n            }, mapUpdateInterval - timeSinceMapUpdate)\n            return () => {\n                clearTimeout(timeout)\n            }\n        }\n    }, [mapSettings]) // Do not change this effect list!!\n\n    const { result, loading } = useOrderedResolve(currentGenerator)\n\n    return result !== undefined\n        ? {\n                ...result,\n                ui: props => result.ui({ ...props, loading }),\n            }\n        : {\n                ui: () => ({ node: <EmptyMapLayout universe={mapSettings.universe} loading={loading} /> }),\n                errors: [],\n            }\n}\n\ntype MapUIProps<T> = T & ({ mode: 'view' } | { mode: 'uss' } | { mode: 'insets', editInsets: EditInsets })\n\nexport interface MapGenerator<T = unknown> {\n    ui: (props: MapUIProps<T>) => { node: ReactNode, exportPng?: (colors: Colors) => Promise<string> }\n    exportGeoJSON?: () => string\n    exportCSV?: CSVExportData\n    errors: EditorError[]\n}\n\nasync function makeMapGenerator({ mapSettings, cache, previousGenerator }: { mapSettings: MapSettings, cache: MapCache, previousGenerator: Promise<MapGenerator<{ loading: boolean }>> | undefined }): Promise<MapGenerator<{ loading: boolean }>> {\n    const emptyMap = ({ loading }: { loading: boolean }): { node: ReactNode } => ({ node: <EmptyMapLayout universe={mapSettings.universe} loading={loading} /> })\n\n    if (mapSettings.geographyKind === undefined || mapSettings.universe === undefined) {\n        return {\n            ui: emptyMap,\n            errors: [{ kind: 'error', type: 'error', value: 'Select a Universe and Geography Kind', location: noLocation }],\n        }\n    }\n\n    const stmts = computeUSS(mapSettings.script)\n\n    const parseErrors = getAllParseErrors(stmts)\n    if (parseErrors.length > 0) {\n        const prev = await previousGenerator\n        return {\n            ...prev,\n            ui: prev?.ui ?? emptyMap,\n            errors: parseErrors.map(e => ({ ...e, kind: 'error' })),\n        }\n    }\n\n    const execResult = await executeAsync({ descriptor: { kind: 'mapper', geographyKind: mapSettings.geographyKind, universe: mapSettings.universe }, stmts })\n\n    if (execResult.resultingValue === undefined) {\n        const prev = await previousGenerator\n        return {\n            ...prev,\n            ui: prev?.ui ?? emptyMap,\n            errors: execResult.error,\n        }\n    }\n\n    const mapResultMain = execResult.resultingValue.value\n\n    const csvData = generateMapperCSVData(mapResultMain, execResult.context)\n    const csvFilename = `${mapSettings.geographyKind}-${mapSettings.universe}-data.csv`\n\n    const { features, mapChildren, ramp } = await loadMapResult({ mapResultMain, universe: mapSettings.universe, geographyKind: mapSettings.geographyKind, cache })\n\n    return {\n        errors: execResult.error,\n        exportCSV: {\n            csvData,\n            csvFilename,\n        },\n        exportGeoJSON: () => exportAsGeoJSON(features),\n        ui: (props) => {\n            const mapsRef: (MapRef | null)[] = []\n\n            const mapsContainerRef = React.createRef<HTMLDivElement>()\n\n            const insetsFeatures = (props.mode === 'insets' ? props.editInsets.editedInsets : mapResultMain.value.insets).flatMap((inset) => {\n                const insetFeatures = filterOverlaps(inset, features)\n                if (insetFeatures.length === 0 && props.mode !== 'insets') {\n                    return []\n                }\n                return [{\n                    inset,\n                    insetFeatures,\n                }]\n            })\n\n            const insetMaps = insetsFeatures.map(({ inset, insetFeatures }, i, insets) => {\n                return (\n                    <InsetMap\n                        i={i}\n                        key={i}\n                        inset={inset}\n                        ref={e => mapsRef[i] = e}\n                        container={mapsContainerRef}\n                        numInsets={insets.length}\n                        editInset={props.mode === 'insets'\n                            ? {\n                                    modify: (newInset: Partial<Inset>) => { props.editInsets.modify(i, newInset) },\n                                    delete: () => { props.editInsets.delete(i) },\n                                    duplicate: () => { props.editInsets.duplicate(i) },\n                                    add: props.editInsets.add,\n                                    moveUp: () => { props.editInsets.moveUp(i) },\n                                    moveDown: () => { props.editInsets.moveDown(i) },\n                                }\n                            : undefined}\n                    >\n                        {mapChildren(insetFeatures)}\n                    </InsetMap>\n                )\n            })\n\n            const visibleInsets = insetsFeatures.map(({ inset }) => inset)\n\n            const colorbarRef = React.createRef<HTMLDivElement>()\n\n            return {\n                node: (\n                    <MapLayout\n                        maps={insetMaps}\n                        loading={props.loading}\n                        colorbar={(\n                            <Colorbar\n                                ramp={ramp}\n                                basemap={mapResultMain.value.basemap}\n                            />\n                        )}\n                        aspectRatio={computeAspectRatioForInsets(visibleInsets)}\n                        mapsContainerRef={mapsContainerRef}\n                        colorbarRef={colorbarRef}\n                    />\n                ),\n                exportPng: colors =>\n                    exportAsPng({ colors, colorbarElement: colorbarRef.current!, insets: visibleInsets, maps: mapsRef.map(r => r!.getMap()), basemap: mapResultMain.value.basemap }),\n            }\n        },\n    }\n}\n\nfunction MapLayout({ maps, colorbar, loading, mapsContainerRef, colorbarRef, aspectRatio }: {\n    maps: ReactNode\n    colorbar: ReactNode\n    loading: boolean\n    mapsContainerRef?: React.Ref<HTMLDivElement>\n    colorbarRef?: React.Ref<HTMLDivElement>\n    aspectRatio: number\n}): ReactNode {\n    return (\n        <div style={{\n            display: 'flex',\n            flexDirection: 'column',\n            position: 'relative',\n        }}\n        >\n            <RelativeLoader loading={loading} />\n            <div style={{ height: '90%', width: '100%' }}>\n                <div\n                    ref={mapsContainerRef}\n                    style={{\n                        width: '100%',\n                        minHeight: '300px',\n                        aspectRatio,\n                        position: 'relative',\n                    }}\n                >\n                    {maps}\n                </div>\n            </div>\n            <div style={{ height: '8%', width: '100%' }} ref={colorbarRef}>\n                {colorbar}\n            </div>\n        </div>\n    )\n}\n\nfunction RelativeLoader({ loading }: { loading: boolean }): ReactNode {\n    return (\n        <LongLoad containerStyleOverride={{\n            position: 'absolute',\n            transition: 'opacity 0.25s',\n            opacity: loading ? 1 : 0,\n            pointerEvents: 'none',\n        }}\n        />\n    )\n}\n\nfunction EmptyMapLayout({ universe, loading }: { universe?: Universe, loading: boolean }): ReactNode {\n    const insets = loadInsets(universe ?? 'world')\n\n    return (\n        <MapLayout\n            maps={insets.map((inset, i) => (\n                <InsetMap\n                    i={i}\n                    key={i}\n                    inset={inset}\n                    container={React.createRef()}\n                    numInsets={insets.length}\n                >\n                    {null}\n                </InsetMap>\n            ))}\n            loading={loading}\n            colorbar={null}\n            aspectRatio={computeAspectRatioForInsets(insets)}\n        />\n    )\n}\n\nasync function loadMapResult({ mapResultMain: { opaqueType, value }, universe, geographyKind, cache }:\n{\n    mapResultMain: USSOpaqueValue & { opaqueType: 'cMap' | 'cMapRGB' | 'pMap' }\n    universe: Universe\n    geographyKind: typeof valid_geographies[number]\n    cache: MapCache\n}): Promise<{ features: GeoJSON.Feature[], mapChildren: (fs: GeoJSON.Feature[]) => ReactNode, ramp: RampToDisplay }> {\n    let ramp: RampToDisplay\n    let colors: string[]\n    switch (opaqueType) {\n        case 'pMap':\n        case 'cMap':\n            const scale = instantiate(value.scale)\n            const furthest = furthestColor(value.ramp.map(x => x[1]))\n            const interpolations = [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1].map(scale.inverse)\n            ramp = { type: 'ramp', value: { ramp: value.ramp, interpolations, scale, label: value.label, unit: value.unit } }\n            colors = value.data.map(val => interpolateColor(value.ramp, scale.forward(val), furthest))\n            break\n        case 'cMapRGB':\n            colors = value.dataR.map((r, i) => doRender({\n                r: r * 255,\n                g: value.dataG[i] * 255,\n                b: value.dataB[i] * 255,\n                a: 255,\n            }))\n            ramp = { type: 'label', value: value.label }\n            break\n    }\n\n    let features: GeoJSON.Feature[]\n    let mapChildren: (fs: GeoJSON.Feature[]) => ReactNode\n    switch (opaqueType) {\n        case 'pMap':\n            const points: Point[] = Array.from(value.data.entries()).map(([i, dataValue]) => {\n                return {\n                    name: value.geo[i],\n                    fillColor: colors[i],\n                    fillOpacity: 1,\n                    radius: Math.sqrt(value.relativeArea[i]) * value.maxRadius,\n                    statistic: dataValue,\n                }\n            })\n\n            features = await pointsGeojson(geographyKind, universe, points, cache)\n\n            mapChildren = fs => <PointFeatureCollection features={fs} clickable={true} />\n\n            break\n        case 'cMap':\n        case 'cMapRGB':\n            const polys: Polygon[] = Array.from(colors.entries()).map(([i, color]) => {\n                let meta\n                switch (opaqueType) {\n                    case 'cMap':\n                        meta = { statistic: value.data[i] }\n                        break\n                    case 'cMapRGB':\n                        meta = { statistic: [value.dataR[i], value.dataG[i], value.dataB[i]] }\n                        break\n                }\n\n                return {\n                    name: value.geo[i],\n                    fillColor: color,\n                    fillOpacity: 1,\n                    color: doRender(value.outline.color),\n                    weight: value.outline.weight,\n                    ...meta,\n                }\n            })\n\n            features = await polygonsGeojson(geographyKind, universe, polys, cache)\n\n            mapChildren = fs => <PolygonFeatureCollection features={fs} clickable={true} />\n\n            break\n    }\n\n    return {\n        features,\n        mapChildren: fs => (\n            <>\n                {mapChildren(fs)}\n                <BasemapComponent basemap={value.basemap} />\n            </>\n        ),\n        ramp,\n    }\n}\n\nasync function exportAsPng({\n    colors,\n    colorbarElement,\n    insets,\n    maps,\n    basemap,\n}: {\n    colorbarElement: HTMLElement | undefined\n    colors: Colors\n    insets: Inset[]\n    maps: maplibregl.Map[]\n    basemap: Basemap\n}): Promise<string> {\n    const pixelRatio = 4\n    const width = 4096\n    const cBarPad = 40\n    const { height: colorbarHeight, width: colorbarWidth } = colorbarDimensions(colorbarElement, width * 0.8, 300 - cBarPad)\n\n    const aspectRatio = computeAspectRatioForInsets(insets)\n\n    const height = Math.round(width / aspectRatio)\n\n    const totalHeight = height + colorbarHeight + cBarPad\n\n    const params = { width, height, pixelRatio, insetBorderColor: colors.mapInsetBorderColor }\n\n    const canvas = document.createElement('canvas')\n    const ctx = canvas.getContext('2d')!\n    canvas.width = width\n    canvas.height = totalHeight\n\n    await Promise.all(maps.map(async (map, i) => {\n        const inset = insets[i]\n        await renderMap(ctx, map, inset, params)\n    }))\n\n    ctx.fillStyle = basemap.type === 'none' ? basemap.backgroundColor : colors.background\n    ctx.fillRect(0, height, width, colorbarHeight + cBarPad) // Fill the entire colorbar area\n\n    if (colorbarElement) {\n        const colorbarCanvas = await screencapElement(colorbarElement, colorbarWidth, 1)\n\n        ctx.drawImage(colorbarCanvas, (width - colorbarWidth) / 2, height + cBarPad / 2)\n    }\n\n    return canvas.toDataURL('image/png', 1.0)\n}\n\nfunction colorbarDimensions(colorbarElement: HTMLElement | undefined, maxWidth: number, maxHeight: number): { width: number, height: number } {\n    if (colorbarElement === undefined) {\n        return { width: 0, height: 0 }\n    }\n    let width = colorbarElement.offsetWidth\n    let height = colorbarElement.offsetHeight\n    {\n        // do this no matter what, to fill the space\n        const scale = maxHeight / height\n        height = maxHeight\n        width = width * scale\n    }\n    if (width > maxWidth) {\n        // rescale if it is now too wide\n        const scale = maxWidth / width\n        width = maxWidth\n        height = height * scale\n    }\n    return { width, height }\n}\n\nfunction filterOverlaps(inset: Inset, features: GeoJSON.Feature[]): GeoJSON.Feature[] {\n    const bbox = inset.coordBox\n    if (!inset.mainMap) {\n        features = features.filter((poly) => {\n            const bounds = boundingBox(poly.geometry)\n            // Check if the polygon overlaps the inset bounds\n            return bounds.getWest() < bbox[2] && bounds.getEast() > bbox[0]\n                && bounds.getNorth() > bbox[1] && bounds.getSouth() < bbox[3]\n        })\n    }\n    return features\n}\n\ninterface MapCache {\n    geo?: { universe: Universe, geographyKind: typeof valid_geographies[number] } & (\n        { type: 'points', centroidsByName: Map<string, ICoordinate> }\n        | { type: 'polygons', polygonsByName: Map<string, GeoJSON.Geometry> }\n    )\n}\n\ninterface Point {\n    name: string\n\n    fillColor: string\n    fillOpacity: number\n    radius: number\n\n    [meta: string]: unknown\n\n}\n\nasync function pointsGeojson(geographyKind: typeof valid_geographies[number], universe: Universe, points: Point[], cache: MapCache): Promise<GeoJSON.Feature[]> {\n    if (cache.geo?.type !== 'points' || cache.geo.universe !== universe || cache.geo.geographyKind !== geographyKind) {\n        const idxLink = indexLink(universe, geographyKind)\n        const articles = await loadProtobuf(idxLink, 'ArticleOrderingList')\n        const centroids = await loadCentroids(universe, geographyKind, articles.longnames)\n\n        const centroidsByName = new Map(articles.longnames.map((r, i) => [r, centroids[i]]))\n        cache.geo = {\n            type: 'points',\n            universe,\n            geographyKind,\n            centroidsByName,\n        }\n    }\n\n    const geo = cache.geo\n\n    return points.map((point) => {\n        const centroid = geo.centroidsByName.get(point.name)!\n\n        return {\n            type: 'Feature' as const,\n            properties: { ...point },\n            geometry: {\n                type: 'Point',\n                coordinates: [centroid.lon!, centroid.lat!],\n            },\n        }\n    })\n}\n\nasync function polygonsGeojson(geographyKind: typeof valid_geographies[number], universe: Universe, polygons: Polygon[], cache: MapCache): Promise<GeoJSON.Feature[]> {\n    if (cache.geo?.type !== 'polygons' || cache.geo.universe !== universe || cache.geo.geographyKind !== geographyKind) {\n        const universeIdx = universes_ordered.indexOf(universe)\n        const shapes = (await loadProtobuf(consolidatedShapeLink(geographyKind), 'ConsolidatedShapes')) as NormalizeProto<ConsolidatedShapes>\n        const polygonsByName = new Map<string, GeoJSON.Geometry>()\n        for (let i = 0; i < shapes.longnames.length; i++) {\n            if (shapes.universes[i].universeIdxs.includes(universeIdx)) {\n                polygonsByName.set(shapes.longnames[i], geometry(shapes.shapes[i] as NormalizeProto<Feature>))\n            }\n        }\n        cache.geo = {\n            type: 'polygons',\n            universe,\n            geographyKind,\n            polygonsByName,\n        }\n    }\n\n    const geo = cache.geo\n\n    return polygons.map((polygon) => {\n        return {\n            type: 'Feature' as const,\n            properties: { ...polygon },\n            geometry: geo.polygonsByName.get(polygon.name)!,\n        }\n    })\n}\n\nfunction exportAsGeoJSON(features: GeoJSON.Feature[]): string {\n    return JSON.stringify(\n        {\n            type: 'FeatureCollection',\n            features,\n        },\n        null,\n        2,\n    )\n}\n","import maplibregl from 'maplibre-gl'\n\nimport { Inset } from '../urban-stats-script/constants/insets'\n\ninterface MapScreenshotParams {\n    width: number\n    height: number\n    pixelRatio: number\n    insetBorderColor: string\n    backgroundColor?: string\n}\n\nfunction computeRelativeLocs(inset: Inset, params: MapScreenshotParams): { insetWidth: number, insetHeight: number, insetX: number, insetY: number } {\n    const [x0, y0] = inset.bottomLeft\n    const [x1, y1] = inset.topRight\n    const insetWidth = (x1 - x0) * params.width\n    const insetHeight = (y1 - y0) * params.height\n    const insetX = x0 * params.width\n    const insetY = (1 - y1) * params.height // Flip Y coordinate for canvas\n    return { insetWidth, insetHeight, insetX, insetY }\n}\n\nexport async function renderMap(\n    ctx: CanvasRenderingContext2D,\n    map: maplibregl.Map, inset: Inset,\n    params: MapScreenshotParams,\n): Promise<void> {\n    const container = map.getContainer()\n    const originalSize = {\n        width: container.style.width || '',\n        height: container.style.height || '',\n    }\n    const originalBounds = map.getBounds()\n    const originalPixelRatio = map.getPixelRatio()\n\n    const { insetWidth, insetHeight, insetX, insetY } = computeRelativeLocs(inset, params)\n\n    // resize the container to the inset size / pixel ratio, so the map renders at high resolution\n    // but text and other elements are not scaled\n    container.style.width = `${insetWidth / params.pixelRatio}px`\n    container.style.height = `${insetHeight / params.pixelRatio}px`\n\n    map.setPixelRatio(params.pixelRatio)\n\n    // Trigger map resize\n    map.resize()\n\n    const [west, south, east, north] = inset.coordBox\n    const bounds = new maplibregl.LngLatBounds(\n        new maplibregl.LngLat(west, south),\n        new maplibregl.LngLat(east, north),\n    )\n    map.fitBounds(bounds, { animate: false, padding: 0 })\n\n    // Wait for maps to re-render at high resolution\n    await new Promise(resolve => setTimeout(resolve, 1000))\n\n    const mapCanvas = map.getCanvas()\n\n    // Draw the map content onto the main canvas\n    ctx.drawImage(mapCanvas, insetX, insetY, insetWidth, insetHeight)\n\n    if (!inset.mainMap) {\n        ctx.strokeStyle = params.insetBorderColor\n        ctx.lineWidth = 4\n        ctx.strokeRect(insetX, insetY, insetWidth, insetHeight)\n    }\n    container.style.width = originalSize.width\n    container.style.height = originalSize.height\n    map.setPixelRatio(originalPixelRatio)\n    map.resize()\n    map.fitBounds(originalBounds, { animate: false })\n}\n","import { saveAs } from 'file-saver'\nimport React, { ReactNode } from 'react'\nimport { z } from 'zod'\n\nimport { renderLocInfo } from '../../urban-stats-script/interpreter'\nimport { parse, unparse } from '../../urban-stats-script/parser'\nimport { cancelled, uploadFile } from '../../utils/upload'\n\nimport { convertToMapUss, defaultSettings, mapperMetaFields, MapSettings } from './utils'\n\nexport function ImportExportCode({ mapSettings, setMapSettings }: { mapSettings: MapSettings, setMapSettings: (v: MapSettings) => void }): ReactNode {\n    return (\n        <div style={{\n            display: 'flex',\n            gap: '0.5em',\n            margin: '0.5em 0',\n        }}\n        >\n            <button onClick={async () => {\n                const file = await uploadFile('.uss')\n\n                if (file === cancelled) {\n                    return\n                }\n\n                const importResult = importMapSettings(await file.text())\n\n                if (!importResult.success) {\n                    alert(importResult.error)\n                    return\n                }\n\n                setMapSettings(importResult.mapSettings)\n            }}\n            >\n                Import Script\n            </button>\n            <button onClick={() => {\n                saveAs(new Blob([exportMapSettings(mapSettings)]), 'urban_stats_mapper.uss')\n            }}\n            >\n                Export Script\n            </button>\n        </div>\n    )\n}\n\nconst metadataSchema = z.object({\n    kind: z.literal('mapper'),\n    ...mapperMetaFields.shape,\n})\n\nfunction importMapSettings(fileContent: string): { success: true, mapSettings: MapSettings } | { success: false, error: string } {\n    const parsed = parse(fileContent)\n    if (parsed.type === 'error') {\n        return {\n            success: false,\n            error: `Parse Errors:\\n${parsed.errors.map(error => ` ${error.value} at ${renderLocInfo(error.location)}`).join('\\n')}`,\n        }\n    }\n\n    let metadata = undefined\n    if (parsed.type === 'statements'\n        && parsed.result[0].type === 'expression'\n        && parsed.result[0].value.type === 'call'\n        && parsed.result[0].value.fn.type === 'identifier'\n        && parsed.result[0].value.fn.name.node === 'meta'\n    ) {\n        const meta = parsed.result[0].value\n\n        // Remove meta from the parsed result\n        parsed.result.splice(0, 1)\n\n        const args = []\n\n        for (const arg of meta.args) {\n            if (arg.type === 'unnamed') {\n                return { success: false, error: `\"meta\" function call at ${renderLocInfo(meta.entireLoc)} must have only named arguments` }\n            }\n            if (arg.value.type !== 'constant') {\n                return { success: false, error: `\"meta\" function argument \"${arg.name.node}\" must have a constant value` }\n            }\n            args.push([arg.name.node, arg.value.value.node.value])\n        }\n\n        const metadataResult = metadataSchema.safeParse(Object.fromEntries(args))\n\n        if (!metadataResult.success) {\n            return {\n                success: false,\n                error: `Error parsing metadata: ${Object.values(metadataResult.error.flatten(issue => ` Parameter \"${issue.path}\" is ${issue.message}`).fieldErrors).join('\\n')}`,\n            }\n        }\n        metadata = metadataResult.data\n    }\n\n    const newSettings = defaultSettings({\n        ...metadata,\n        script: {\n            uss: convertToMapUss(parsed),\n        },\n    })\n\n    return { success: true, mapSettings: newSettings }\n}\n\nfunction exportMapSettings(mapSettings: MapSettings): string {\n    return `meta(kind=\"mapper\", universe=\"${mapSettings.universe}\", geographyKind=\"${mapSettings.geographyKind}\")\\n${unparse(mapSettings.script.uss)}`\n}\n","import { useColors } from '../page_template/colors'\n\nexport const settingNameStyle = {\n    fontWeight: 500,\n    fontSize: '1.2em',\n    marginBottom: '0.125em',\n    marginTop: '0.25em',\n}\n\nexport const useSettingSubNameStyle = (): React.CSSProperties => ({\n    fontWeight: 500,\n    fontSize: '1em',\n    marginBottom: '0.125em',\n    color: useColors().ordinalTextColor,\n})\n","import React, { ReactNode, useCallback, useMemo } from 'react'\n\nimport { articleTypes, CountsByUT } from '../../components/countsByArticleType'\nimport universes_ordered from '../../data/universes_ordered'\nimport { EditorError } from '../../urban-stats-script/editor-utils'\nimport { TypeEnvironment } from '../../urban-stats-script/types-values'\nimport { settingNameStyle } from '../style'\n\nimport { BetterSelector } from './BetterSelector'\nimport { TopLevelEditor } from './TopLevelEditor'\nimport { MapSettings } from './utils'\n\nexport function MapperSettings({ mapSettings, setMapSettings, errors, counts, typeEnvironment }: {\n    mapSettings: MapSettings\n    setMapSettings: (s: MapSettings) => void\n    errors: EditorError[]\n    counts: CountsByUT\n    typeEnvironment: TypeEnvironment\n}): ReactNode {\n    const uss = mapSettings.script.uss\n\n    const renderString = useCallback((universe: string | undefined) => ({ text: universe ?? '' }), [])\n\n    const universes = useMemo(() => [undefined, ...universes_ordered], [])\n\n    const geographyKinds = useMemo(() =>\n        mapSettings.universe === undefined ? undefined : [undefined, ...articleTypes(counts, mapSettings.universe)] as Exclude<MapSettings['geographyKind'], undefined>[],\n    [mapSettings.universe, counts])\n\n    return (\n        <>\n            <div style={settingNameStyle}>\n                Universe\n            </div>\n            <BetterSelector\n                possibleValues={universes}\n                value={mapSettings.universe}\n                renderValue={renderString}\n                onChange={\n                    (newUniverse) => {\n                        setMapSettings({\n                            ...mapSettings,\n                            universe: newUniverse,\n                            geographyKind: newUniverse === undefined || mapSettings.geographyKind === undefined\n                                ? mapSettings.geographyKind\n                                : articleTypes(counts, newUniverse).includes(mapSettings.geographyKind)\n                                    ? mapSettings.geographyKind\n                                    : undefined,\n                        })\n                    }\n                }\n            />\n            {geographyKinds && (\n                <>\n                    <div style={settingNameStyle}>\n                        Geography Kind\n                    </div>\n                    <BetterSelector\n                        possibleValues={geographyKinds}\n                        value={mapSettings.geographyKind}\n                        renderValue={renderString}\n                        onChange={\n                            (newGeographyKind) => {\n                                setMapSettings({\n                                    ...mapSettings,\n                                    geographyKind: newGeographyKind,\n                                })\n                            }\n                        }\n                    />\n                </>\n            )}\n            <TopLevelEditor\n                uss={uss}\n                setUss={(newUss) => {\n                    setMapSettings({\n                        ...mapSettings,\n                        script: { uss: newUss },\n                    })\n                }}\n                typeEnvironment={typeEnvironment}\n                errors={errors}\n            />\n        </>\n    )\n}\n","export type ArrayEdits<T> = (a: T[]) => T[]\n\nexport function replace<T>(edits: ArrayEdits<T>, [from, to]: [number, number], withArray: T[]): ArrayEdits<T> {\n    return (a) => {\n        const applied = edits(a)\n        return [...applied.slice(0, from), ...withArray, ...applied.slice(to)]\n    }\n}\n\nexport function swap<T>(edits: ArrayEdits<T>, indexA: number, indexB: number): ArrayEdits<T> {\n    return (a) => {\n        const array = edits(a)\n        const itemA = array[indexA]\n        const itemB = array[indexB]\n        const result = Array.from(array)\n        result[indexB] = itemA\n        result[indexA] = itemB\n        return result\n    }\n}\n","import { UrbanStatsASTExpression } from '../../urban-stats-script/ast'\nimport { deconstruct, Inset } from '../../urban-stats-script/constants/insets'\nimport { TypeEnvironment } from '../../urban-stats-script/types-values'\nimport { loadInsets, loadInsetExpression } from '../../urban-stats-script/worker'\nimport { ArrayEdits, replace, swap } from '../../utils/array-edits'\nimport { assert } from '../../utils/defensive'\n\nimport * as l from './../../urban-stats-script/literal-parser'\nimport { idOutput, MapUSS, validMapperOutputs } from './TopLevelEditor'\nimport { MapSettings } from './utils'\n\nconst neswSchema = l.object({\n    north: l.number(),\n    east: l.number(),\n    south: l.number(),\n    west: l.number(),\n})\n\nconst insetSchema = l.transformExpr(l.deconstruct(l.call({ fn: l.identifier('constructInset'), unnamedArgs: [], namedArgs: {\n    mainMap: l.boolean(),\n    name: l.string(),\n    screenBounds: neswSchema,\n    mapBounds: neswSchema,\n} })),\n({ namedArgs: { screenBounds, mapBounds, mainMap, name } }) => ({\n    bottomLeft: [screenBounds.west, screenBounds.south],\n    topRight: [screenBounds.east, screenBounds.north],\n    coordBox: [mapBounds.west, mapBounds.south, mapBounds.east, mapBounds.north],\n    mainMap,\n    name,\n} satisfies Inset))\n\nconst constructInsetsSchema = l.transformExpr(l.call({ fn: l.identifier('constructInsets'), namedArgs: {}, unnamedArgs: [l.editableVector(insetSchema)] }), call => call.unnamedArgs[0])\n\nconst mapInsetsSchema = l.transformStmt(l.statements([\n    l.ignore(),\n    l.condition({\n        condition: l.ignore(),\n        rest: [\n            l.expression(l.reparse(idOutput, validMapperOutputs,\n                l.call({\n                    fn: l.ignore(),\n                    unnamedArgs: [],\n                    namedArgs: {\n                        insets: l.edit(l.optional(l.deconstruct(constructInsetsSchema))),\n                    },\n                }))),\n        ],\n    }),\n]), (uss) => {\n    const insetArg = uss[1].rest[0].namedArgs.insets\n    const literalInsets = insetArg.currentValue ?? null\n    return {\n        ...insetArg,\n        currentValue: literalInsets,\n    }\n})\n\nexport function getInsets(settings: MapSettings, typeEnvironment: TypeEnvironment): Inset[] | undefined {\n    if (settings.script.uss.type === 'statements') {\n        const parseResult = mapInsetsSchema.parse(settings.script.uss, typeEnvironment)\n        if (parseResult === undefined) {\n            return undefined\n        }\n        if (parseResult.currentValue !== null) {\n            return parseResult.currentValue.currentValue\n        }\n        if (settings.universe !== undefined) {\n            return loadInsets(settings.universe)\n        }\n    }\n    return undefined\n}\n\nexport interface InsetEdits {\n    insets: ArrayEdits<Inset>\n    ast: ArrayEdits<UrbanStatsASTExpression>\n}\n\nexport function replaceInsets(edits: InsetEdits, [from, to]: [number, number], withArray: Inset[]): InsetEdits {\n    return {\n        insets: replace(edits.insets, [from, to], withArray),\n        ast: replace(edits.ast, [from, to], withArray.map(deconstruct)),\n    }\n}\n\nexport function swapInsets(edits: InsetEdits, indexA: number, indexB: number): InsetEdits {\n    return {\n        insets: swap(edits.insets, indexA, indexB),\n        ast: swap(edits.ast, indexA, indexB),\n    }\n}\n\nexport function doEditInsets(settings: MapSettings, edits: InsetEdits, typeEnvironment: TypeEnvironment): MapUSS {\n    assert(settings.script.uss.type === 'statements', 'Trying to do an inset edit on USS that is not inset editable')\n    const mapInsets = mapInsetsSchema.parse(settings.script.uss, typeEnvironment)\n    assert(mapInsets !== undefined && (mapInsets.currentValue !== null || settings.universe !== undefined), 'Trying to do an inset edit on USS that is not inset editable')\n\n    let currentInsetsAst: UrbanStatsASTExpression\n    if (mapInsets.currentValue !== null) {\n        currentInsetsAst = mapInsets.expr!\n    }\n    else {\n        currentInsetsAst = loadInsetExpression(settings.universe!)\n    }\n\n    const newConstructInsets = constructInsetsSchema.parse(currentInsetsAst, typeEnvironment)!.edit(edits.ast) as UrbanStatsASTExpression\n\n    const result = mapInsets.edit(newConstructInsets)\n    return result as MapUSS\n}\n","import { gzipSync } from 'zlib'\n\nimport React, { ReactNode, useCallback, useContext, useEffect, useMemo, useRef, useState } from 'react'\n\nimport { CountsByUT } from '../../components/countsByArticleType'\nimport { Navigator } from '../../navigation/Navigator'\nimport { Colors } from '../../page_template/color-themes'\nimport { useColors } from '../../page_template/colors'\nimport { PageTemplate } from '../../page_template/template'\nimport { Inset } from '../../urban-stats-script/constants/insets'\nimport { useUndoRedo } from '../../urban-stats-script/editor-utils'\nimport { unparse } from '../../urban-stats-script/parser'\nimport { TypeEnvironment } from '../../urban-stats-script/types-values'\nimport { loadInsets } from '../../urban-stats-script/worker'\nimport { Property } from '../../utils/Property'\nimport { TestUtils } from '../../utils/TestUtils'\nimport { assert } from '../../utils/defensive'\nimport { useHeaderTextClass } from '../../utils/responsive'\nimport { defaultTypeEnvironment } from '../context'\nimport { MapGenerator, useMapGenerator } from '../map-generator'\n\nimport { ImportExportCode } from './ImportExportCode'\nimport { MapperSettings } from './MapperSettings'\nimport { Selection, SelectionContext } from './SelectionContext'\nimport { doEditInsets, getInsets, InsetEdits, replaceInsets, swapInsets } from './insets'\nimport { MapSettings } from './utils'\n\ntype MapEditorMode = 'uss' | 'insets'\n\nexport function EditMapperPanel(props: { mapSettings: MapSettings, counts: CountsByUT }): ReactNode {\n    const [mapSettings, setMapSettings] = useState(props.mapSettings)\n\n    const [mapEditorMode, setMapEditorMode] = useState<MapEditorMode>('uss')\n\n    const selectionContext = useMemo(() => new Property<Selection | undefined>(undefined), [])\n\n    const undoRedo = useUndoRedo(\n        mapSettings,\n        selectionContext.value,\n        setMapSettings,\n        (selection) => {\n            selectionContext.value = selection\n        },\n        {\n            undoChunking: TestUtils.shared.isTesting ? 2000 : 1000,\n            // Prevent keyboard shortcusts when in insets editing mode, since insets has its own undo stack\n            onlyElement: mapEditorMode === 'insets' ? { current: null } : undefined,\n        },\n    )\n\n    const { updateCurrentSelection, addState } = undoRedo\n\n    const setMapSettingsWrapper = useCallback((newSettings: MapSettings): void => {\n        setMapSettings(newSettings)\n        addState(newSettings, selectionContext.value)\n    }, [selectionContext, addState])\n\n    const firstEffect = useRef(true)\n\n    useEffect(() => {\n        if (firstEffect.current) {\n            // Otherwise we add an undo state immediately\n            firstEffect.current = false\n        }\n        else {\n            // So that map settings are updated when the prop changes\n            setMapSettingsWrapper(props.mapSettings)\n            setMapEditorMode('uss')\n        }\n    }, [props.mapSettings, setMapSettingsWrapper])\n\n    const jsonedSettings = JSON.stringify({\n        ...mapSettings,\n        script: {\n            uss: unparse(mapSettings.script.uss),\n        },\n    })\n\n    const navContext = useContext(Navigator.Context)\n\n    useEffect(() => {\n        if (props.mapSettings !== mapSettings) {\n            // gzip then base64 encode\n            const encodedSettings = gzipSync(jsonedSettings).toString('base64')\n            navContext.setMapperSettings(encodedSettings)\n        }\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- props.view won't be set except from the navigator\n    }, [jsonedSettings, navContext])\n\n    const headerTextClass = useHeaderTextClass()\n\n    const typeEnvironment = useMemo(() => defaultTypeEnvironment(mapSettings.universe), [mapSettings.universe])\n\n    // Update current selection when it changes\n    useEffect(() => {\n        const observer = (): void => {\n            updateCurrentSelection(selectionContext.value)\n        }\n\n        selectionContext.observers.add(observer)\n        return () => { selectionContext.observers.delete(observer) }\n    }, [selectionContext, updateCurrentSelection])\n\n    const mapGenerator = useMapGenerator({ mapSettings })\n\n    const commonProps: CommonEditorProps = {\n        mapSettings,\n        setMapSettings: setMapSettingsWrapper,\n        typeEnvironment,\n        setMapEditorMode,\n        mapGenerator,\n    }\n\n    return (\n        <PageTemplate csvExportData={mapGenerator.exportCSV}>\n            <SelectionContext.Provider value={selectionContext}>\n                <div className={headerTextClass}>Urban Stats Mapper (beta)</div>\n                {mapEditorMode === 'insets' ? <InsetsMapEditor {...commonProps} /> : <USSMapEditor {...commonProps} counts={props.counts} />}\n                {mapEditorMode !== 'insets' ? undoRedo.ui : undefined /* Insets editor has its own undo stack */}\n            </SelectionContext.Provider>\n        </PageTemplate>\n    )\n}\n\ninterface CommonEditorProps {\n    mapSettings: MapSettings\n    setMapSettings: (s: MapSettings) => void\n    typeEnvironment: TypeEnvironment\n    setMapEditorMode: (m: MapEditorMode) => void\n    mapGenerator: MapGenerator\n}\n\nfunction USSMapEditor({ mapSettings, setMapSettings, counts, typeEnvironment, setMapEditorMode, mapGenerator }: CommonEditorProps & { counts: CountsByUT }): ReactNode {\n    const ui = mapGenerator.ui({ mode: 'uss' })\n\n    return (\n        <>\n            <MapperSettings\n                mapSettings={mapSettings}\n                setMapSettings={setMapSettings}\n                errors={mapGenerator.errors}\n                counts={counts}\n                typeEnvironment={typeEnvironment}\n            />\n            <div style={{ display: 'flex', justifyContent: 'space-between', gap: '0.5em' }}>\n                <Export pngExport={ui.exportPng} geoJSONExport={mapGenerator.exportGeoJSON} />\n                {\n                    getInsets(mapSettings, typeEnvironment) && (\n                        <div style={{\n                            display: 'flex',\n                            gap: '0.5em',\n                            margin: '0.5em 0',\n                        }}\n                        >\n                            <button onClick={() => { setMapEditorMode('insets') }}>\n                                Edit Insets\n                            </button>\n                        </div>\n                    )\n                }\n                <ImportExportCode\n                    mapSettings={mapSettings}\n                    setMapSettings={setMapSettings}\n                />\n            </div>\n            {ui.node}\n        </>\n\n    )\n}\n\nfunction InsetsMapEditor({ mapSettings, setMapSettings, typeEnvironment, setMapEditorMode, mapGenerator }: CommonEditorProps): ReactNode {\n    const colors = useColors()\n\n    const [insetEdits, setInsetEdits] = useState<InsetEdits>({\n        ast: a => a,\n        insets: i => i,\n    })\n\n    const { addState, ui: undoRedoUi, canUndo } = useUndoRedo(insetEdits, undefined, setInsetEdits, () => undefined)\n\n    const editedInsets = insetEdits.insets(getInsets(mapSettings, typeEnvironment)!)\n\n    const addInsetEdit = (edits: InsetEdits): void => {\n        setInsetEdits(edits)\n        addState(edits, undefined)\n    }\n\n    const ui = mapGenerator.ui({\n        mode: 'insets',\n        editInsets: {\n            add: () => {\n                const newInset: Inset = {\n                    ...loadInsets(mapSettings.universe ?? 'world')[0],\n                    bottomLeft: [0.25, 0.25],\n                    topRight: [0.75, 0.75],\n                    mainMap: false,\n                }\n                addInsetEdit(replaceInsets(insetEdits, [editedInsets.length, editedInsets.length], [offsetInsetInBounds(newInset, editedInsets)]))\n            },\n            modify: (i, e) => {\n                addInsetEdit(replaceInsets(insetEdits, [i, i + 1], [{ ...editedInsets[i], ...e }]))\n            },\n            delete: (i) => {\n                addInsetEdit(replaceInsets(insetEdits, [i, i + 1], []))\n            },\n            duplicate: (i) => {\n                addInsetEdit(replaceInsets(insetEdits, [i + 1, i + 1], [offsetInsetInBounds(editedInsets[i], editedInsets)]))\n            },\n            moveUp: (i) => {\n                assert(i + 1 < editedInsets.length, `Cannot move inset ${i} up, already top`)\n                addInsetEdit(swapInsets(insetEdits, i, i + 1))\n            },\n            moveDown: (i) => {\n                assert(i > 0, `Cannot move inset ${i} down, already bottom`)\n                addInsetEdit(swapInsets(insetEdits, i, i - 1))\n            },\n            editedInsets,\n        },\n    })\n\n    return (\n        <>\n            <div style={{\n                backgroundColor: colors.slightlyDifferentBackgroundFocused,\n                borderRadius: '5px',\n                padding: '10px',\n                margin: '10px 0',\n                display: 'flex',\n                justifyContent: 'space-between',\n                gap: '0.5em',\n            }}\n            >\n                <div>\n                    <b>Editing Insets.</b>\n                    {' '}\n                    Pans and zooms to maps will be reflected permanently. Drag inset frames to reposition and resize.\n                </div>\n                <div style={{ display: 'flex', gap: '10px' }}>\n\n                    <button onClick={() => { setMapEditorMode('uss') }}>\n                        Cancel\n                    </button>\n                    <button\n                        onClick={() => {\n                            setMapSettings({ ...mapSettings, script: { uss: doEditInsets(mapSettings, insetEdits, typeEnvironment) } })\n                            setMapEditorMode('uss')\n                        }}\n                        disabled={!canUndo}\n                    >\n                        Accept\n                    </button>\n                </div>\n            </div>\n            {ui.node}\n            {undoRedoUi}\n        </>\n    )\n}\n\nfunction moveInset(inset: Inset, x: number, y: number): Inset {\n    return {\n        ...inset,\n        bottomLeft: [inset.bottomLeft[0] + x, inset.bottomLeft[1] + y],\n        topRight: [inset.topRight[0] + x, inset.topRight[1] + y],\n    }\n}\n\nfunction inBounds(inset: Inset): boolean {\n    return inset.bottomLeft.concat(inset.topRight).every(c => c >= 0 && c <= 1)\n}\n\nfunction samePosition(a: Inset, b: Inset): boolean {\n    return a.bottomLeft[0] === b.bottomLeft[0] && a.bottomLeft[1] === b.bottomLeft[1] && a.topRight[0] === b.topRight[0] && a.topRight[1] === b.topRight[1]\n}\n\nfunction offsetInsetInBounds(inset: Inset, exclude: Inset[]): Inset {\n    for (let delta = 0; delta < 1; delta += 0.05) {\n        for (const [x, y] of [[delta, delta], [-delta, -delta], [-delta, delta], [delta, -delta]]) {\n            const newInset = moveInset(inset, x, y)\n            if (inBounds(newInset) && !exclude.some(i => samePosition(newInset, i))) {\n                return newInset\n            }\n        }\n    }\n    return inset\n}\n\nfunction saveAsFile(filename: string, data: string | Blob, type: string): void {\n    const blob = typeof data === 'string' ? new Blob([data], { type }) : data\n    const url = URL.createObjectURL(blob)\n    const link = document.createElement('a')\n    link.href = url\n    link.download = filename\n    document.body.appendChild(link)\n    link.click()\n    document.body.removeChild(link)\n}\n\nfunction Export(props: { pngExport?: (colors: Colors) => Promise<string>, geoJSONExport?: () => string }): ReactNode {\n    const colors = useColors()\n\n    const doPngExport = async (): Promise<void> => {\n        if (props.pngExport === undefined) {\n            return\n        }\n        const pngDataUrl = await props.pngExport(colors)\n        const data = await fetch(pngDataUrl)\n        const pngData = await data.blob()\n        saveAsFile('map.png', pngData, 'image/png')\n    }\n\n    const doGeoJSONExport = (): void => {\n        if (props.geoJSONExport === undefined) {\n            return\n        }\n        saveAsFile('map.geojson', props.geoJSONExport(), 'application/geo+json')\n    }\n\n    return (\n        <div style={{\n            display: 'flex',\n            gap: '0.5em',\n            margin: '0.5em 0',\n        }}\n        >\n            <button\n                disabled={props.pngExport === undefined}\n                onClick={() => {\n                    void doPngExport()\n                }}\n            >\n                Export as PNG\n            </button>\n            <button\n                disabled={props.geoJSONExport === undefined}\n                onClick={() => {\n                    doGeoJSONExport()\n                }}\n            >\n                Export as GeoJSON\n            </button>\n            <button onClick={() => {\n                // eslint-disable-next-line no-restricted-syntax -- We're opening a new window here\n                const params = new URLSearchParams(window.location.search)\n                params.set('view', 'true')\n                // navigate to the page in a new tab\n                window.open(`?${params.toString()}`, '_blank')\n            }}\n            >\n                View as Zoomable Page\n            </button>\n        </div>\n    )\n}\n","import React, { ReactNode } from 'react'\n\nimport { CountsByUT } from '../../components/countsByArticleType'\nimport { useMapGenerator } from '../map-generator'\nimport { EditMapperPanel } from '../settings/EditMapperPanel'\nimport { MapSettings } from '../settings/utils'\n\nexport function MapperPanel(props: { mapSettings: MapSettings, view: boolean, counts: CountsByUT }): ReactNode {\n    if (props.view) {\n        return <DisplayMap mapSettings={props.mapSettings} />\n    }\n\n    return <EditMapperPanel {...props} />\n}\n\nfunction DisplayMap({ mapSettings }: { mapSettings: MapSettings }): ReactNode {\n    const mapGenerator = useMapGenerator({ mapSettings })\n    return (\n        <>\n            {mapGenerator.ui({ mode: 'view' }).node}\n        </>\n    )\n}\n","export const cancelled = Symbol()\n\nexport function uploadFile(accept: string): Promise<File | typeof cancelled> {\n    const inputElement = document.createElement('input')\n    inputElement.setAttribute('type', 'file')\n    inputElement.setAttribute('accept', accept)\n    inputElement.style.display = 'none'\n    const result = new Promise<File | typeof cancelled>((resolve) => {\n        inputElement.onchange = () => {\n            resolve(inputElement.files![0])\n            inputElement.remove()\n        }\n        inputElement.oncancel = () => {\n            resolve(cancelled)\n            inputElement.remove()\n        }\n    })\n\n    document.body.appendChild(inputElement)\n    inputElement.click()\n\n    return result\n}\n"],"names":["Statistic","props","statname","_props_unit","useImperial","_useSetting","temperatureUnit","_useSetting1","_unitDisplay_renderValue","getUnitDisplay","unitType","value","separateNumber","unitName","adjustedValue","places","unit","rendered","ElectionResult","hours","Math","minutes","colors","useColors","text","party","partyColor","Percentile","ordinal","percentile","undefined","lngToWebMercatorX","lng","latToWebMercatorY","lat","area","coordBox","x1","x2","y1","y2","computeAspectRatioForInsets","mapsWithCoordBox","assert","biggestMap","prev","curr","onScreenWidth","onScreenHeight","computeAspectRatio","colorbarStyleFromBasemap","basemap","Colorbar","valuesRef","useRef","shouldRotate","useSyncExternalStore","onWidthChange","containers","current","i","container","contained","furthest","useMemo","furthestColor","x","ramp","scale","label","values","style","width","valuesDivs","rotate","interpolateColor","InsetMap","React","param","ref","inset","children","editInset","numInsets","id","CommonMaplibreMap","mapBorderWidth","insetBorderWidth","mapBorderRadius","HandleInsets","newBox","ExposeMapForTesting","CustomAttributionControlComponent","EditInsetsHandles","newFrame","setCoordBox","map","useMap","useEffect","fit","getCoordBox","mapBounds","sw","ne","moveHandler","e","TestUtils","WeakRef","activeDrag","pointerHandlers","kind","thisElem","_activeDrag_current","drag","rawMovementX","rawMovementY","resizedFrame","movementX","movementY","Handle","_param","handleSize","img","rest","_useState","hover","setHover","divRef","handleMouseEnter","handleMouseLeave","div","useMapGenerator","mapSettings","cache","updateTime","Date","makeMapGenerator","currentGenerator","setCurrentGenerator","timeSinceMapUpdate","previousGenerator","timeout","setTimeout","mapUpdateInterval","clearTimeout","_useOrderedResolve","result","loading","EmptyMapLayout","emptyMap","stmts","parseErrors","_prev_ui","execResult","prev1","_prev_ui1","mapResultMain","csvData","csvFilename","_ref","features","mapChildren","noLocation","computeUSS","getAllParseErrors","executeAsync","generateMapperCSVData","loadMapResult","opaqueType","universe","geographyKind","interpolations","points","polys","polygons","instantiate","val","r","doRender","Array","dataValue","_cache_geo","idxLink","articles","centroids","geo","indexLink","loadProtobuf","loadCentroids","centroidsByName","Map","point","centroid","fs","PointFeatureCollection","meta","color","universeIdx","shapes","polygonsByName","universes_ordered","consolidatedShapeLink","geometry","polygon","PolygonFeatureCollection","BasemapComponent","JSON","mapsRef","mapsContainerRef","insetsFeatures","bbox","insetFeatures","poly","bounds","boundingBox","insetMaps","insets","newInset","visibleInsets","colorbarRef","MapLayout","exportAsPng","colorbarElement","maps","cBarPad","_colorbarDimensions","colorbarHeight","colorbarWidth","aspectRatio","height","totalHeight","params","canvas","ctx","colorbarCanvas","maxWidth","maxHeight","scale1","pixelRatio","document","Promise","originalSize","originalBounds","originalPixelRatio","_computeRelativeLocs","insetWidth","insetHeight","insetX","insetY","_inset_coordBox","west","south","east","north","mapCanvas","_inset_bottomLeft","x0","y0","_inset_topRight","maplibregl","resolve","a","screencapElement","colorbar","RelativeLoader","LongLoad","loadInsets","ImportExportCode","setMapSettings","file","importResult","uploadFile","cancelled","importMapSettings","alert","saveAs","Blob","unparse","metadataSchema","z","mapperMetaFields","fileContent","parsed","parse","error","renderLocInfo","metadata","args","_iteratorError","arg","metadataResult","Object","issue","defaultSettings","convertToMapUss","settingNameStyle","MapperSettings","errors","counts","typeEnvironment","uss","renderString","useCallback","universes","geographyKinds","articleTypes","BetterSelector","newUniverse","newGeographyKind","TopLevelEditor","newUss","replace","edits","withArray","from","to","applied","swap","indexA","indexB","array","itemA","itemB","neswSchema","l","insetSchema","screenBounds","mainMap","name","constructInsetsSchema","call","mapInsetsSchema","idOutput","validMapperOutputs","_insetArg_currentValue","insetArg","literalInsets","getInsets","settings","parseResult","replaceInsets","deconstruct","swapInsets","EditMapperPanel","_useState1","mapEditorMode","setMapEditorMode","selectionContext","Property","undoRedo","useUndoRedo","selection","updateCurrentSelection","addState","setMapSettingsWrapper","newSettings","firstEffect","jsonedSettings","navContext","useContext","Navigator","encodedSettings","gzipSync","headerTextClass","useHeaderTextClass","defaultTypeEnvironment","observer","mapGenerator","commonProps","PageTemplate","SelectionContext","InsetsMapEditor","USSMapEditor","ui","Export","insetEdits","setInsetEdits","_useUndoRedo","undoRedoUi","canUndo","editedInsets","addInsetEdit","_mapSettings_universe","offsetInsetInBounds","currentInsetsAst","mapInsets","newConstructInsets","loadInsetExpression","exclude","delta","_iter","y","inBounds","c","b","saveAsFile","filename","data","type","blob","url","URL","link","doPngExport","fetch","doGeoJSONExport","URLSearchParams","window","MapperPanel","DisplayMap","Symbol","accept","inputElement"],"mappings":"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"}