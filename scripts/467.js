"use strict";(self.webpackChunkassets=self.webpackChunkassets||[]).push([["467"],{64455:function(e,t,n){n.d(t,{JZ:()=>c,gw:()=>p,$k:()=>s});var r=n(72668),a=n(66547),o=n(27281),i=n(59070);function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,u=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(u)throw r}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e){var t,n,a=l((0,o.yu)("use_imperial"),1)[0],u=l((0,o.yu)("temperature_unit"),1)[0],s=(function(e){switch(e){case"percentage":return{renderValue:function(e){return{value:r.createElement("span",null,(100*e).toFixed(2)),unit:r.createElement("span",null,"%")}}};case"fatalities":return{renderValue:function(e){return{value:r.createElement("span",null,(0,i.HT)(e.toFixed(0))),unit:r.createElement("span",null,"\xa0")}}};case"fatalitiesPerCapita":return{renderValue:function(e){return{value:r.createElement("span",null,(1e5*e).toFixed(2)),unit:r.createElement("span",null,"/100k")}}};case"density":return{renderValue:function(e,t){var n="km",a=e;t&&(n="mi",a*=2.5899752356);var o=2;return a>10?o=0:a>1&&(o=1),{value:r.createElement("span",null,(0,i.HT)(a.toFixed(o))),unit:r.createElement("span",null,"/\xa0",n,r.createElement("sup",null,"2"))}}};case"population":return{renderValue:function(e){return e>1e9?{value:r.createElement("span",null,(e/1e9).toPrecision(3)),unit:r.createElement("span",null,"B")}:e>1e6?{value:r.createElement("span",null,(e/1e6).toPrecision(3)),unit:r.createElement("span",null,"m")}:e>1e4?{value:r.createElement("span",null,(e/1e3).toPrecision(3)),unit:r.createElement("span",null,"k")}:{value:r.createElement("span",null,(0,i.HT)(e.toFixed(0))),unit:r.createElement("span",null,"\xa0")}}};case"area":return{renderValue:function(e,t){var n,a=e;t?(a/=2.5899752356)<1?(n=r.createElement("span",null,"acres"),a*=640):n=r.createElement("span",null,"mi",r.createElement("sup",null,"2")):a<.01?(a*=1e6,n=r.createElement("span",null,"m",r.createElement("sup",null,"2"))):n=r.createElement("span",null,"km",r.createElement("sup",null,"2"));var o=3;a>100?o=0:a>10?o=1:a>1&&(o=2);var u=a.toFixed(o);return 0===o&&(u=(0,i.HT)(u)),{value:r.createElement("span",null,u),unit:n}}};case"distanceInKm":return{renderValue:function(e,t){var n=r.createElement("span",null,"km"),a=e;return t&&(n=r.createElement("span",null,"mi"),a/=1.60934),{value:r.createElement("span",null,a.toFixed(2)),unit:n}}};case"distanceInM":return{renderValue:function(e,t){var n="m",a=e;return t&&(n="ft",a*=3.28084),{value:r.createElement("span",null,(0,i.HT)(a.toFixed(0))),unit:r.createElement("span",null,n)}}};case"democraticMargin":return{renderValue:function(e){return{value:r.createElement(c,{value:e}),unit:r.createElement("span",null,"%")}}};case"temperature":return{renderValue:function(e,t,n){var a=r.createElement("span",null,"\xb0F"),o=e;return"celsius"===n&&(a=r.createElement("span",null,"\xb0C"),o=5/9*(e-32)),{value:r.createElement("span",null,o.toFixed(1)),unit:a}}};case"time":return{renderValue:function(e){var t=Math.floor(e),n=Math.floor((e-t)*60);return{value:r.createElement("span",null,t,":",n.toString().padStart(2,"0")),unit:r.createElement("span",null,"\xa0")}}};case"distancePerYear":return{renderValue:function(e,t){var n=100*e,a="cm";return t&&(a="in",n/=2.54),{value:r.createElement("span",null,n.toFixed(1)),unit:r.createElement("span",null,a,"/yr")}}};case"contaminantLevel":return{renderValue:function(e){return{value:r.createElement("span",null,e.toFixed(2)),unit:r.createElement("span",null,"μg/m",r.createElement("sup",null,"3"))}}};case"number":return{renderValue:function(e){return{value:r.createElement("span",null,e.toFixed(3)),unit:r.createElement("span",null,"\xa0")}}};case"usd":return{renderValue:function(e){return e>1e9?{value:r.createElement("span",null,"$",(e/1e9).toPrecision(3)),unit:r.createElement("span",null,"B")}:e>1e6?{value:r.createElement("span",null,"$",(e/1e6).toPrecision(3)),unit:r.createElement("span",null,"m")}:e>1e3?{value:r.createElement("span",null,"$",(e/1e3).toPrecision(3)),unit:r.createElement("span",null,"k")}:{value:r.createElement("span",null,"$",(0,i.HT)(e.toFixed(0))),unit:r.createElement("span",null,"\xa0")}}};case"minutes":return{renderValue:function(e){var t=Math.floor(e/60),n=Math.floor(e%60);return t>0?{value:r.createElement("span",null,t,":",n.toString().padStart(2,"0")),unit:r.createElement("span",null,"\xa0")}:{value:r.createElement("span",null,n),unit:r.createElement("span",null,"\xa0")}}}}})(null!=(n=e.unit)?n:(t=e.statname).includes("%")||t.includes("Change")||t.includes("(Grade)")?"percentage":t.includes("Total")&&t.includes("Fatalities")?"fatalities":t.includes("Fatalities Per Capita")?"fatalitiesPerCapita":t.includes("Density")?"density":t.includes("Elevation")?"distanceInM":t.startsWith("Population")?"population":"Area"===t?"area":t.includes("Mean distance")?"distanceInKm":t.includes("Election")||t.includes("Swing")?"democraticMargin":t.includes("high temp")||t.includes("low temp")||t.includes("high heat index")||t.includes("dewpt")?"temperature":"Mean sunny hours"===t?"time":"Rainfall"===t||"Snowfall [rain-equivalent]"===t?"distancePerYear":t.includes("Pollution")?"contaminantLevel":t.includes("(USD)")?"usd":t.includes("(min)")?"minutes":"number").renderValue(e.value,a,u),p=s.value,f=s.unit;return r.createElement("span",{style:e.style},e.isUnit?f:p)}function c(e){var t=(0,a.cI)();if(e.value!=e.value)return r.createElement("span",null,"N/A");var n=100*Math.abs(e.value),o=n>10?1:n>1?2:n>.1?3:4,i=n.toFixed(o),u=e.value>0?"D":"R",l=e.value>0?t.hueColors.blue:t.hueColors.red;return r.createElement("span",{style:{color:l,display:"flex",justifyContent:"flex-end"}},u,"+",i)}function p(e){if(e.ordinal>e.total)return r.createElement("span",null);var t=e.percentileByPopulation,n="".concat(t,"th percentile");return e.simpleOrdinals?n="".concat(t.toString(),"%"):t%10==1&&t%100!=11?n="".concat(t,"st percentile"):t%10==2&&t%100!=12?n="".concat(t,"nd percentile"):t%10==3&&t%100!=13&&(n="".concat(t,"rd percentile")),r.createElement("div",{className:"serif",style:{textAlign:"right",marginRight:e.simpleOrdinals?"5px":void 0}},n)}},47779:function(e,t,n){n.r(t),n.d(t,{MapperPanel:()=>ej}),n(71540),n(50457);var r=n(58788),a=n(23509),o=n.n(a),i=n(72668),u=n(4050),l=n(45375),s=n(36405),c=n(41486),p=n(88609),f=n(52594),m=n(88452),d=n(46207),v=n(99448);function y(e,t,n,r,a,o,i){try{var u=e[o](i),l=u.value}catch(e){n(e);return}u.done?t(l):Promise.resolve(l).then(r,a)}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function g(e){var t=e.mapSettings,n=e.setMapSettings;return i.createElement("div",{style:{display:"flex",gap:"0.5em",margin:"0.5em 0"}},i.createElement("button",{onClick:function(){var e;return(e=function(){var e,t;return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(l){var s=[u,l];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:return[4,(0,d.c)(".uss")];case 1:if((e=r.sent())===d.B)return[2];return[4,e.text()];case 2:if(!(t=E.apply(void 0,[r.sent()])).success)return alert(t.error),[2];return n(t.mapSettings),[2]}})},function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function i(e){y(o,r,a,i,u,"next",e)}function u(e){y(o,r,a,i,u,"throw",e)}i(void 0)})})()}},"Import Script"),i.createElement("button",{onClick:function(){var e;(0,c.saveAs)(new Blob([(e=t,'meta(kind="mapper", universe="'.concat(e.universe,'", geographyKind="').concat(e.geographyKind,'")\n').concat((0,m.Z2)(e.script.uss)))]),"urban_stats_mapper.uss")}},"Export Script"))}var b=p.z.object(h({kind:p.z.literal("mapper")},v.mapperMetaFields.shape));function E(e){var t,n,r=(0,m.Qc)(e);if("error"===r.type)return{success:!1,error:"Parse Errors:\n".concat(r.errors.map(function(e){return"• ".concat(e.value," at ").concat((0,f.i7)(e.location))}).join("\n"))};var a=void 0;if("statements"===r.type&&"expression"===r.result[0].type&&"call"===r.result[0].value.type&&"identifier"===r.result[0].value.fn.type&&"meta"===r.result[0].value.fn.name.node){var o=r.result[0].value;r.result.splice(0,1);var i=[],u=!0,l=!1,s=void 0;try{for(var c,p=o.args[Symbol.iterator]();!(u=(c=p.next()).done);u=!0){var d=c.value;if("unnamed"===d.type)return{success:!1,error:'"meta" function call at '.concat((0,f.i7)(o.entireLoc)," must have only named arguments")};if("constant"!==d.value.type)return{success:!1,error:'"meta" function argument "'.concat(d.name.node,'" must have a constant value')};i.push([d.name.node,d.value.value.node.value])}}catch(e){l=!0,s=e}finally{try{u||null==p.return||p.return()}finally{if(l)throw s}}var y=b.safeParse(Object.fromEntries(i));if(!y.success)return{success:!1,error:"Error parsing metadata: ".concat(Object.values(y.error.flatten(function(e){return'• Parameter "'.concat(e.path,'" is ').concat(e.message)}).fieldErrors).join("\n"))};a=y.data}return{success:!0,mapSettings:(0,v.defaultSettings)((t=h({},a),n=n={script:{uss:(0,v.convertToMapUss)(r)}},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t))}}var S=n(83929),w=n(66547),O={fontWeight:500,fontSize:"1.2em",marginBottom:"0.125em",marginTop:"0.25em"},P=n(30444),j=n(78233);function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function C(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function M(e){return function(e){if(Array.isArray(e))return x(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return x(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e){var t=e.mapSettings,n=e.setMapSettings,r=e.errors,a=e.counts,o=e.typeEnvironment,l=t.script.uss,s=(0,i.useCallback)(function(e){return{text:null!=e?e:""}},[]),c=(0,i.useMemo)(function(){return[void 0].concat(M(u.Z))},[]),p=(0,i.useMemo)(function(){return void 0===t.universe?void 0:[void 0].concat(M((0,S.d)(a,t.universe)))},[t.universe,a]);return i.createElement(i.Fragment,null,i.createElement("div",{style:O},"Universe"),i.createElement(P.S,{possibleValues:c,value:t.universe,renderValue:s,onChange:function(e){n(C(k({},t),{universe:e,geographyKind:void 0===e||void 0===t.geographyKind||(0,S.d)(a,e).includes(t.geographyKind)?t.geographyKind:void 0}))}}),p&&i.createElement(i.Fragment,null,i.createElement("div",{style:O},"Geography Kind"),i.createElement(P.S,{possibleValues:p,value:t.geographyKind,renderValue:s,onChange:function(e){n(C(k({},t),{geographyKind:e}))}})),i.createElement(j.ag,{uss:l,setUss:function(e){n(C(k({},t),{script:{uss:e}}))},typeEnvironment:o,errors:r}))}var A=n(65344),R=n(44640),D=n(39517),U=n(77053),T=n(73001);function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}var F=T.Ry({north:T.Rx(),east:T.Rx(),south:T.Rx(),west:T.Rx()}),B=T.n0(T.Rf(T.RE({fn:T.QU("constructInset"),unnamedArgs:[],namedArgs:{mainMap:T.O7(),name:T.Z_(),screenBounds:F,mapBounds:F}})),function(e){var t=e.namedArgs,n=t.screenBounds,r=t.mapBounds,a=t.mainMap,o=t.name;return{bottomLeft:[n.west,n.south],topRight:[n.east,n.north],coordBox:[r.west,r.south,r.east,r.north],mainMap:a,name:o}}),_=T.n0(T.RE({fn:T.QU("constructInsets"),namedArgs:{},unnamedArgs:[T.xr(T.eP(B))]}),function(e){return e.unnamedArgs[0]}),z=T.x2(T.gh([T.ID(),T.s2({condition:T.ID(),rest:[T.th(T.Hw(j.Qc,j.Py,T.RE({fn:T.ID(),unnamedArgs:[],namedArgs:{insets:T.eP(T.jt(T.Rf(_)))}})))]})]),function(e){var t,n,r,a=e[1].rest[0].namedArgs.insets,o=null!=(r=a.currentValue)?r:null;return t=K({},a),n=n={currentValue:o},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t});function G(e,t){if("statements"===e.script.uss.type){var n=z.parse(e.script.uss,t);if(void 0!==n){if(null!==n.currentValue)return n.currentValue.map(function(e){return e.currentValue});if(void 0!==e.universe)return(0,D.z)(e.universe)}}}var N=n(6381),L=n(45437),$=n(79779),q=n(46347),Z=n(23529),H=n(34672),X=n(24714),J=n(69851),W=n(81600),Q=n(27193),Y=n(84635),ee=n(89147),et=n(51647),en=n(13736),er=n(43166),ea=n(36195),eo=n(45988),ei=n(64455),eu=n(72082);function el(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function es(e,t,n,r,a,o,i){try{var u=e[o](i),l=u.value}catch(e){n(e);return}u.done?t(l):Promise.resolve(l).then(r,a)}function ec(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function i(e){es(o,r,a,i,u,"next",e)}function u(e){es(o,r,a,i,u,"throw",e)}i(void 0)})}}function ep(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ef(e){return(ef=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function em(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ep(e,t,n[t])})}return e}function ed(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function ev(e,t){return(ev=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ey(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,u=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(u)throw r}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return el(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return el(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eh(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(eh=function(){return!!e})()}function eg(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(l){var s=[u,l];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}}var eb=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(){var e,t,r;if(!(this instanceof n))throw TypeError("Cannot call a class as a function");return t=n,r=arguments,t=ef(t),ep(e=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,eh()?Reflect.construct(t,r||[],ef(this).constructor):t.apply(this,r)),"shapes",void 0),ep(e,"shapeType",void 0),e}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&ev(n,e),t=[{key:"shouldHaveLoadingSpinner",value:function(){return!0}},{key:"getShapes",value:function(){if(this.shapes&&this.shapes.geographyKind===this.versionProps.geographyKind&&this.shapes.universe===this.versionProps.universe&&this.shapes.shapeType===this.shapeType)return this.shapes;var e=this.shapeType;return(0,U.h)(void 0!==e,"Shape type must be set before loading shapes"),this.shapes={geographyKind:this.versionProps.geographyKind,universe:this.versionProps.universe,shapeType:e,data:ec(function(){return eg(this,function(t){var n,r;return[2,(n=this.versionProps.geographyKind,r=this.versionProps.universe,ec(function(){var t,a;return eg(this,function(o){switch(o.label){case 0:switch(e){case"polygon":return[3,1];case"point":return[3,2]}return[3,5];case 1:return[2,ec(function(){var e,t,a,o,i;return eg(this,function(s){switch(s.label){case 0:return e=u.Z.indexOf(r),[4,(0,l.gi)((0,L.UM)(n),"ConsolidatedShapes")];case 1:for(i=0,t=s.sent(),a=[],o=[];i<t.longnames.length;i++)t.universes[i].universeIdxs.includes(e)&&(a.push(t.longnames[i]),o.push(t.shapes[i]));return[2,{shapes:{type:"polygon",value:o},nameToIndex:new Map(a.map(function(e,t){return[e,t]}))}]}})})()];case 2:return t=(0,L.Tw)(r,n),[4,(0,l.gi)(t,"ArticleOrderingList")];case 3:return a=o.sent(),[4,(0,q.y7)(r,n,a.longnames)];case 4:return[2,{shapes:{type:"point",value:o.sent().map(function(e){return{lon:e.lon,lat:e.lat}})},nameToIndex:new Map(a.longnames.map(function(e,t){return[e,t]}))}];case 5:throw Error("Unknown shape type ".concat(e));case 6:return[2]}})})())]})}).call(this)},this.shapes}},{key:"loadShapes",value:function(e){return ec(function(){var t,n,r,a,o;return eg(this,function(i){switch(i.label){case 0:return[4,(t=this.getShapes()).data];case 1:switch(r=(n=i.sent()).nameToIndex,a=n.shapes,o=r.get(e),(0,U.h)(void 0!==o&&o>=0&&o<a.value.length,"Shape ".concat(e," not found in ").concat(t.geographyKind," for ").concat(t.universe)),a.type){case"polygon":return[2,{type:"polygon",value:a.value[o]}];case"point":return[2,{type:"point",value:a.value[o]}]}return[2]}})}).call(this)}},{key:"loadPolygon",value:function(e){return ec(function(){var t;return eg(this,function(n){switch(n.label){case 0:return[4,this.loadShapes(e)];case 1:return t=n.sent(),(0,U.h)("polygon"===t.type,"Shape ".concat(e," is not a polygon")),[2,t.value]}})}).call(this)}},{key:"loadPoint",value:function(e){return ec(function(){var t;return eg(this,function(n){switch(n.label){case 0:return[4,this.loadShapes(e)];case 1:return t=n.sent(),(0,U.h)("point"===t.type,"Shape ".concat(e," is not a point")),[2,t.value]}})}).call(this)}},{key:"computeShapesToRender",value:function(e){return ec(function(){var t,n,r,a,o,i,u,l,s,c,p,f,m,d,v,y,h,g,b,E,S,w,O,P;return eg(this,function(j){switch(j.label){case 0:if(void 0===(r=this.versionProps.uss))return[2,{shapes:[],zoomIndex:-1}];return[4,(0,Y.W)({descriptor:{kind:"mapper",geographyKind:this.versionProps.geographyKind,universe:this.versionProps.universe},stmts:r})];case 1:if(a=j.sent(),e===this.version&&(null==(o=(i=this.versionProps).setErrors)||o.call(i,a.error)),void 0===a.resultingValue)return[2,{shapes:[],zoomIndex:-1}];return l="pMap"===(u=a.resultingValue.value).opaqueType?"point":"polygon",s=u.value.label,this.shapeType=l,"cMap"===u.opaqueType||"cMapRGB"===u.opaqueType?c=u.value.outline:(f=u.value.maxRadius,p=u.value.relativeArea.map(function(e){return Math.sqrt(e)*f})),m=u.value.geo,this.versionProps.basemapCallback(u.value.basemap),this.versionProps.insetsCallback(u.value.insets),d=(0,eo.lM)(u,a.context),v="".concat(this.versionProps.geographyKind,"-").concat(this.versionProps.universe,"-data.csv"),null==(t=(n=this.versionProps).onCsvDataUpdate)||t.call(n,{csvData:d,csvFilename:v}),"cMapRGB"===u.opaqueType?(y=(h=u.value).dataR.map(function(e,t){return(0,X.XF)({r:255*e,g:255*h.dataG[t],b:255*h.dataB[t],a:255})}),this.versionProps.rampCallback({type:"label",value:s})):(b=(g=u.value).ramp,S=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1].map((E=(0,J._K)(g.scale)).inverse),this.versionProps.rampCallback({type:"ramp",value:{ramp:b,interpolations:S,scale:E,label:s,unit:u.value.unit}}),w=(0,en.oX)(b.map(function(e){return e[1]})),y=g.data.map(function(e){return(0,en.BM)(b,E.forward(e),w)})),O=y.map(function(e,t){switch(l){case"polygon":return{type:"polygon",style:{fillColor:e,fillOpacity:1,color:(0,X.XF)(c.color),weight:c.weight}};case"point":return{type:"point",style:{fillColor:e,fillOpacity:1,radius:p[t]}}}}),P="cMap"===u.opaqueType||"pMap"===u.opaqueType?u.value.data.map(function(e){return{statistic:e}}):u.value.dataR.map(function(e,t){return{statistic:[e,u.value.dataG[t],u.value.dataB[t]]}}),[2,{shapes:m.map(function(e,t){return{name:e,spec:O[t],meta:P[t]}}),zoomIndex:-1}]}})}).call(this)}},{key:"progressivelyLoadShapes",value:function(){return!1}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(eu.J9);function eE(e){switch(e.type){case"osm":return{};case"none":return{backgroundColor:e.backgroundColor,color:e.textColor}}}function eS(e){var t=(0,i.useRef)(null),n=(0,i.useSyncExternalStore)(ea.fl,function(){if(null===t.current)return!1;for(var e=t.current.querySelectorAll(".containerOfXticks"),n=0;n<e.length;n++){var r=e[n],a=r.querySelector(".containedOfXticks");if(null!==a&&a.offsetWidth>.9*r.offsetWidth)return!0}return!1}),r=(0,i.useMemo)(function(){return void 0===e.ramp||"ramp"!==e.ramp.type?void 0:(0,en.oX)(e.ramp.value.ramp.map(function(e){return e[1]}))},[e.ramp]);if(void 0===e.ramp)return i.createElement("div",null);if("label"===e.ramp.type)return i.createElement("div",{className:"centered_text",style:eE(e.basemap)},e.ramp.value);var a=e.ramp.value.ramp,o=e.ramp.value.scale,u=e.ramp.value.label,l=e.ramp.value.interpolations,s=e.ramp.value.unit,c=eE(e.basemap),p="".concat(100/l.length,"%"),f=function(e){return l.map(function(t,n){return i.createElement("div",{key:n,style:{width:p,display:"flex",alignItems:"center",justifyContent:"center"},className:"containerOfXticks"},i.createElement("div",{style:{writingMode:e?"sideways-lr":"horizontal-tb",padding:e?"0.5em":"0"},className:"containedOfXticks"},i.createElement("div",{className:"centered_text",style:c},i.createElement(ei.$k,{statname:u,value:t,isUnit:!1,unit:s}),i.createElement(ei.$k,{statname:u,value:t,isUnit:!0,unit:s}))))})};return i.createElement("div",{style:ed(em({},c),{position:"relative"})},i.createElement("div",{style:{display:"flex",width:"100%"}},l.map(function(e,t){return i.createElement("div",{key:t,style:{width:p,height:"1em",backgroundColor:(0,en.BM)(a,o.forward(e),r),marginLeft:"1px",marginRight:"1px"}})})),i.createElement("div",{ref:t,style:{position:"absolute",top:0,left:0,display:"flex",width:"100%",visibility:"hidden"}},f(!1)),i.createElement("div",{style:{display:"flex",width:"100%"}},f(n)),i.createElement("div",{className:"centered_text"},u))}function ew(e){var t,n=ey((0,i.useState)(void 0),2),r=n[0],a=n[1],u=ey((0,i.useState)({type:"osm"}),2),l=u[0],s=u[1],c=ey((0,i.useState)((0,D.z)(e.universe)),2),p=c[0],f=c[1],m=(0,er.h)(p);return i.createElement("div",{style:{display:"flex",flexDirection:"column"}},i.createElement("div",{style:{height:"90%",width:"100%"}},i.createElement(eb,{geographyKind:e.geographyKind,universe:e.universe,rampCallback:function(e){a(e)},basemapCallback:function(e){s(e)},insetsCallback:function(e){f(e)},ref:e.mapRef,uss:e.uss,height:{type:"aspect-ratio",value:m},attribution:"startVisible",basemap:l,setErrors:e.setErrors,colors:(0,w.cI)(),insets:null!=(t=e.overrideInsets)?t:p,key:o()({currentInsets:p,editInsets:!!e.editInsets}),editInsets:e.editInsets,onCsvDataUpdate:e.onCsvDataUpdate,dropEmptyInsets:void 0===e.editInsets})),i.createElement("div",{style:{height:"8%",width:"100%"},ref:e.colorbarRef},i.createElement(eS,{ramp:r,basemap:l})))}function eO(e,t,n){var r="string"==typeof t?new Blob([t],{type:n}):t,a=URL.createObjectURL(r),o=document.createElement("a");o.href=a,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function eP(e){var t=(0,w.cI)();return i.createElement("div",{style:{display:"flex",gap:"0.5em",margin:"0.5em 0"}},i.createElement("button",{onClick:function(){ec(function(){var n,r;return eg(this,function(a){switch(a.label){case 0:if(null===e.mapRef.current)return[2];return r=null!=(n=e.colorbarRef.current)?n:void 0,[4,e.mapRef.current.exportAsPng(r,t.background,t.mapInsetBorderColor)];case 1:return[4,fetch(a.sent())];case 2:return[4,a.sent().blob()];case 3:return eO("map.png",a.sent(),"image/png"),[2]}})})()}},"Export as PNG"),i.createElement("button",{onClick:function(){ec(function(){return eg(this,function(t){switch(t.label){case 0:if(null===e.mapRef.current)return[2];return[4,e.mapRef.current.exportAsGeoJSON()];case 1:return eO("map.geojson",t.sent(),"application/geo+json"),[2]}})})()}},"Export as GeoJSON"),i.createElement("button",{onClick:function(){var e=new URLSearchParams(window.location.search);e.set("view","true"),window.open("?".concat(e.toString()),"_blank")}},"View as Zoomable Page"))}function ej(e){var t=ey((0,i.useState)(void 0),2),n=t[0],r=t[1],a=(0,i.useCallback)(function(e){r(e)},[]);return e.view?i.createElement(ex,ed(em({},e.mapSettings),{uss:(0,v.computeUSS)(e.mapSettings.script),onCsvDataUpdate:a})):i.createElement(ek,ed(em({},e),{onCsvDataUpdate:a,csvExportData:n}))}function ex(e){return void 0===e.geographyKind||void 0===e.universe?i.createElement(Z.SA,{results:[{kind:"error",type:"error",value:"Select a Universe and Geography Kind",location:Q.tU}],editor:!1}):i.createElement(ew,ed(em({},e),{geographyKind:e.geographyKind,universe:e.universe,onCsvDataUpdate:e.onCsvDataUpdate}))}function ek(e){var t=ey((0,i.useState)(e.mapSettings),2),n=t[0],a=t[1],o=ey((0,i.useState)("uss"),2),u=o[0],l=o[1],c=(0,i.useMemo)(function(){return new ee.Z(void 0)},[]),p=(0,W.C5)(n,c.value,a,function(e){c.value=e},{undoChunking:et.k.shared.isTesting?2e3:1e3,onlyElement:"insets"===u?{current:null}:void 0}),f=p.updateCurrentSelection,d=p.addState,v=(0,i.useCallback)(function(e){a(e),d(e,c.value)},[c,d]),y=(0,i.useRef)(!0);(0,i.useEffect)(function(){y.current?y.current=!1:(v(e.mapSettings),l("uss"))},[e.mapSettings,v]);var h=JSON.stringify(ed(em({},n),{script:{uss:(0,m.Z2)(n.script.uss)}})),g=(0,i.useContext)(N.C.Context);(0,i.useEffect)(function(){if(e.mapSettings!==n){var t=(0,r.gzipSync)(h).toString("base64");g.setMapperSettings(t)}},[h,g]);var b=(0,ea.Kn)(),E=(0,i.useMemo)(function(){return(0,s.A)(n.universe)},[n.universe]);(0,i.useEffect)(function(){var e=function(){f(c.value)};return c.observers.add(e),function(){c.observers.delete(e)}},[c,f]);var S={mapSettings:n,setMapSettings:v,typeEnvironment:E,setMapEditorMode:l,onCsvDataUpdate:e.onCsvDataUpdate};return i.createElement($.P,{csvExportData:e.csvExportData},i.createElement(A.I.Provider,{value:c},i.createElement("div",{className:b},"Urban Stats Mapper (beta)"),"insets"===u?i.createElement(eM,S):i.createElement(eC,ed(em({},S),{counts:e.counts})),"insets"!==u?p.ui:void 0))}function eC(e){var t=e.mapSettings,n=e.setMapSettings,r=e.counts,a=e.typeEnvironment,o=e.setMapEditorMode,u=e.onCsvDataUpdate,l=ey((0,i.useState)([]),2),s=l[0],c=l[1],p=(0,i.useRef)(null),f=(0,i.useRef)(null),m=ey((0,i.useState)(void 0),2),d=m[0],y=m[1];return(0,i.useEffect)(function(){var e=(0,v.computeUSS)(t.script),n=(0,H.ZP)(e);n.length>0&&c(n.map(function(e){return ed(em({},e),{kind:"error"})})),y(n.length>0?void 0:e)},[t]),i.createElement(i.Fragment,null,i.createElement(I,{mapSettings:t,setMapSettings:n,errors:s,counts:r,typeEnvironment:a}),i.createElement("div",{style:{display:"flex",justifyContent:"space-between",gap:"0.5em"}},i.createElement(eP,{mapRef:p,colorbarRef:f}),G(t,a)&&i.createElement("div",{style:{display:"flex",gap:"0.5em",margin:"0.5em 0"}},i.createElement("button",{onClick:function(){o("insets")}},"Edit Insets")),i.createElement(g,{mapSettings:t,setMapSettings:n})),i.createElement(ex,{geographyKind:t.geographyKind,universe:t.universe,uss:d,mapRef:p,setErrors:c,colorbarRef:f,onCsvDataUpdate:u}))}function eM(e){var t=e.mapSettings,n=e.setMapSettings,r=e.typeEnvironment,a=e.setMapEditorMode,o=e.onCsvDataUpdate,u=(0,w.cI)(),l=ey((0,i.useState)(new Map),2),s=l[0],c=l[1],p=(0,W.C5)(s,void 0,c,function(){}),f=p.addState,m=p.ui,d=(0,i.useMemo)(function(){return G(t,r).map(function(e){return new ee.Z(e)})},[t,r]);return(0,i.useEffect)(function(){var e=G(t,r),n=!0,a=!1,o=void 0;try{for(var i,u=d.entries()[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var l=ey(i.value,2),c=l[0];l[1].value=em({},e[c],s.get(c))}}catch(e){a=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}},[s,d,t,r]),i.createElement(i.Fragment,null,i.createElement("div",{style:{backgroundColor:u.slightlyDifferentBackgroundFocused,borderRadius:"5px",padding:"10px",margin:"10px 0",display:"flex",justifyContent:"space-between",gap:"0.5em"}},i.createElement("div",null,i.createElement("b",null,"Editing Insets.")," ","Pans and zooms to maps will be reflected permanently. Drag inset frames to reposition and resize."),i.createElement("div",{style:{display:"flex",gap:"10px"}},i.createElement("button",{onClick:function(){a("uss")}},"Cancel"),i.createElement("button",{onClick:function(){n(ed(em({},t),{script:{uss:function(e,t,n){(0,U.h)("statements"===e.script.uss.type,"Trying to do an inset edit on USS that is not inset editable");var r=z.parse(e.script.uss,n);(0,U.h)(void 0!==r&&(null!==r.currentValue||void 0!==e.universe),"Trying to do an inset edit on USS that is not inset editable"),u=null!==r.currentValue?r.expr:(0,D.U)(e.universe);var a=!0,o=!1,i=void 0;try{for(var u,l,s=t[Symbol.iterator]();!(a=(l=s.next()).done);a=!0){var c,p=(c=l.value,function(e){if(Array.isArray(e))return e}(c)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,u=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),o.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(u)throw r}}return o}}(c,2)||function(e,t){if(e){if("string"==typeof e)return V(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return V(e,t)}}(c,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),f=p[0],m=p[1],d=_.parse(u,n);u=d[f].edit((0,R.Rf)(K({},d[f].currentValue,m)))}}catch(e){o=!0,i=e}finally{try{a||null==s.return||s.return()}finally{if(o)throw i}}return r.edit(u)}(t,s,r)}})),a("uss")},disabled:0===s.size},"Accept"))),i.createElement(ex,{geographyKind:t.geographyKind,universe:t.universe,uss:(0,v.computeUSS)(t.script),editInsets:{doEdit:function(e,t){c(function(n){var r=new Map(n);return r.set(e,em({},r.get(e),t)),f(r,void 0),r})},subscribeChanges:d},onCsvDataUpdate:o}),m)}},46207:function(e,t,n){n.d(t,{B:()=>r,c:()=>a});var r=Symbol();function a(e){var t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept",e),t.style.display="none";var n=new Promise(function(e){t.onchange=function(){e(t.files[0]),t.remove()},t.oncancel=function(){e(r),t.remove()}});return document.body.appendChild(t),t.click(),n}}}]);
//# sourceMappingURL=467.js.map