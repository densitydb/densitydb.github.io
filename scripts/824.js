"use strict";(self.webpackChunkassets=self.webpackChunkassets||[]).push([["824"],{64455:function(e,t,n){n.d(t,{JZ:()=>s,gw:()=>p,$k:()=>c});var r=n(72668),a=n(66547),o=n(27281),i=n(59070);function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,u=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(u)throw r}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e){var t,n,a=l((0,o.yu)("use_imperial"),1)[0],u=l((0,o.yu)("temperature_unit"),1)[0],c=(function(e){switch(e){case"percentage":return{renderValue:function(e){return{value:r.createElement("span",null,(100*e).toFixed(2)),unit:r.createElement("span",null,"%")}}};case"fatalities":return{renderValue:function(e){return{value:r.createElement("span",null,(0,i.HT)(e.toFixed(0))),unit:r.createElement("span",null,"\xa0")}}};case"fatalitiesPerCapita":return{renderValue:function(e){return{value:r.createElement("span",null,(1e5*e).toFixed(2)),unit:r.createElement("span",null,"/100k")}}};case"density":return{renderValue:function(e,t){var n="km",a=e;t&&(n="mi",a*=2.5899752356);var o=2;return a>10?o=0:a>1&&(o=1),{value:r.createElement("span",null,(0,i.HT)(a.toFixed(o))),unit:r.createElement("span",null,"/\xa0",n,r.createElement("sup",null,"2"))}}};case"population":return{renderValue:function(e){return e>1e9?{value:r.createElement("span",null,(e/1e9).toPrecision(3)),unit:r.createElement("span",null,"B")}:e>1e6?{value:r.createElement("span",null,(e/1e6).toPrecision(3)),unit:r.createElement("span",null,"m")}:e>1e4?{value:r.createElement("span",null,(e/1e3).toPrecision(3)),unit:r.createElement("span",null,"k")}:{value:r.createElement("span",null,(0,i.HT)(e.toFixed(0))),unit:r.createElement("span",null,"\xa0")}}};case"area":return{renderValue:function(e,t){var n,a=e;t?(a/=2.5899752356)<1?(n=r.createElement("span",null,"acres"),a*=640):n=r.createElement("span",null,"mi",r.createElement("sup",null,"2")):a<.01?(a*=1e6,n=r.createElement("span",null,"m",r.createElement("sup",null,"2"))):n=r.createElement("span",null,"km",r.createElement("sup",null,"2"));var o=3;a>100?o=0:a>10?o=1:a>1&&(o=2);var u=a.toFixed(o);return 0===o&&(u=(0,i.HT)(u)),{value:r.createElement("span",null,u),unit:n}}};case"distanceInKm":return{renderValue:function(e,t){var n=r.createElement("span",null,"km"),a=e;return t&&(n=r.createElement("span",null,"mi"),a/=1.60934),{value:r.createElement("span",null,a.toFixed(2)),unit:n}}};case"distanceInM":return{renderValue:function(e,t){var n="m",a=e;return t&&(n="ft",a*=3.28084),{value:r.createElement("span",null,(0,i.HT)(a.toFixed(0))),unit:r.createElement("span",null,n)}}};case"democraticMargin":return{renderValue:function(e){return{value:r.createElement(s,{value:e}),unit:r.createElement("span",null,"%")}}};case"temperature":return{renderValue:function(e,t,n){var a=r.createElement("span",null,"\xb0F"),o=e;return"celsius"===n&&(a=r.createElement("span",null,"\xb0C"),o=5/9*(e-32)),{value:r.createElement("span",null,o.toFixed(1)),unit:a}}};case"time":return{renderValue:function(e){var t=Math.floor(e),n=Math.floor((e-t)*60);return{value:r.createElement("span",null,t,":",n.toString().padStart(2,"0")),unit:r.createElement("span",null,"\xa0")}}};case"distancePerYear":return{renderValue:function(e,t){var n=100*e,a="cm";return t&&(a="in",n/=2.54),{value:r.createElement("span",null,n.toFixed(1)),unit:r.createElement("span",null,a,"/yr")}}};case"contaminantLevel":return{renderValue:function(e){return{value:r.createElement("span",null,e.toFixed(2)),unit:r.createElement("span",null,"μg/m",r.createElement("sup",null,"3"))}}};case"number":return{renderValue:function(e){return{value:r.createElement("span",null,e.toFixed(3)),unit:r.createElement("span",null,"\xa0")}}};case"usd":return{renderValue:function(e){return e>1e9?{value:r.createElement("span",null,"$",(e/1e9).toPrecision(3)),unit:r.createElement("span",null,"B")}:e>1e6?{value:r.createElement("span",null,"$",(e/1e6).toPrecision(3)),unit:r.createElement("span",null,"m")}:e>1e3?{value:r.createElement("span",null,"$",(e/1e3).toPrecision(3)),unit:r.createElement("span",null,"k")}:{value:r.createElement("span",null,"$",(0,i.HT)(e.toFixed(0))),unit:r.createElement("span",null,"\xa0")}}};case"minutes":return{renderValue:function(e){var t=Math.floor(e/60),n=Math.floor(e%60);return t>0?{value:r.createElement("span",null,t,":",n.toString().padStart(2,"0")),unit:r.createElement("span",null,"\xa0")}:{value:r.createElement("span",null,n),unit:r.createElement("span",null,"\xa0")}}}}})(null!=(n=e.unit)?n:(t=e.statname).includes("%")||t.includes("Change")||t.includes("(Grade)")?"percentage":t.includes("Total")&&t.includes("Fatalities")?"fatalities":t.includes("Fatalities Per Capita")?"fatalitiesPerCapita":t.includes("Density")?"density":t.includes("Elevation")?"distanceInM":t.startsWith("Population")?"population":"Area"===t?"area":t.includes("Mean distance")?"distanceInKm":t.includes("Election")||t.includes("Swing")?"democraticMargin":t.includes("high temp")||t.includes("low temp")||t.includes("high heat index")||t.includes("dewpt")?"temperature":"Mean sunny hours"===t?"time":"Rainfall"===t||"Snowfall [rain-equivalent]"===t?"distancePerYear":t.includes("Pollution")?"contaminantLevel":t.includes("(USD)")?"usd":t.includes("(min)")?"minutes":"number").renderValue(e.value,a,u),p=c.value,f=c.unit;return r.createElement("span",{style:e.style},e.isUnit?f:p)}function s(e){var t=(0,a.cI)();if(e.value!=e.value)return r.createElement("span",null,"N/A");var n=100*Math.abs(e.value),o=n>10?1:n>1?2:n>.1?3:4,i=n.toFixed(o),u=e.value>0?"D":"R",l=e.value>0?t.hueColors.blue:t.hueColors.red;return r.createElement("span",{style:{color:l,display:"flex",justifyContent:"flex-end"}},u,"+",i)}function p(e){if(e.ordinal>e.total)return r.createElement("span",null);var t=e.percentileByPopulation,n="".concat(t,"th percentile");return e.simpleOrdinals?n="".concat(t.toString(),"%"):t%10==1&&t%100!=11?n="".concat(t,"st percentile"):t%10==2&&t%100!=12?n="".concat(t,"nd percentile"):t%10==3&&t%100!=13&&(n="".concat(t,"rd percentile")),r.createElement("div",{className:"serif",style:{textAlign:"right",marginRight:e.simpleOrdinals?"5px":void 0}},n)}},97349:function(e,t,n){n.r(t),n.d(t,{MapperPanel:()=>e3});var r=n(72668),a=n(45988),o=n(6135),i=n(65547),u=n(50038),l=n.n(u);function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t,n,r,a,o,i){try{var u=e[o](i),l=u.value}catch(e){n(e);return}u.done?t(l):Promise.resolve(l).then(r,a)}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,u=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(u)throw r}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var f=n(4050),m=n(45375),d=n(15638),y=n(45437),v=n(41623),g=n(46347),b=n(34672),h=n(24714),E=n(69851),w=n(27193),O=n(39517),S=n(84635),x=n(13736),j=n(77053);function P(e){return e*Math.PI/180*6378137}function M(e){return 6378137*Math.log(Math.tan(Math.PI/4+e*Math.PI/360))}function k(e){var t=P(e[0]),n=P(e[2]),r=M(e[1]);return Math.abs((n-t)*(M(e[3])-r))}function I(e){(0,j.h)(e.length>0,"No insets with coordBox");var t,n,r,a=e.reduce(function(e,t){return k(t.coordBox)>k(e.coordBox)?t:e}),o=a.coordBox,i=a.topRight[0]-a.bottomLeft[0],u=a.topRight[1]-a.bottomLeft[1];return t=P(o[0]),n=P(o[2]),r=M(o[1]),Math.abs(n-t)/Math.abs(M(o[3])-r)/(i/u)}var A=n(2414),C=n(64455),R=n(36195);function F(e){switch(e.type){case"osm":return{};case"none":return{backgroundColor:e.backgroundColor,color:e.textColor}}}function D(e){var t,n,a=(0,r.useRef)(null),o=(0,r.useSyncExternalStore)(R.fl,function(){if(null===a.current)return!1;for(var e=a.current.querySelectorAll(".containerOfXticks"),t=0;t<e.length;t++){var n=e[t],r=n.querySelector(".containedOfXticks");if(null!==r&&r.offsetWidth>.9*n.offsetWidth)return!0}return!1}),i=(0,r.useMemo)(function(){return void 0===e.ramp||"ramp"!==e.ramp.type?void 0:(0,x.oX)(e.ramp.value.ramp.map(function(e){return e[1]}))},[e.ramp]);if(void 0===e.ramp)return r.createElement("div",null);if("label"===e.ramp.type)return r.createElement("div",{className:"centered_text",style:F(e.basemap)},e.ramp.value);var u=e.ramp.value.ramp,l=e.ramp.value.scale,c=e.ramp.value.label,s=e.ramp.value.interpolations,p=e.ramp.value.unit,f=F(e.basemap),m="".concat(100/s.length,"%"),d=function(e){return s.map(function(t,n){return r.createElement("div",{key:n,style:{width:m,display:"flex",alignItems:"center",justifyContent:"center"},className:"containerOfXticks"},r.createElement("div",{style:{writingMode:e?"sideways-lr":"horizontal-tb",padding:e?"0.5em":"0"},className:"containedOfXticks"},r.createElement("div",{className:"centered_text",style:f},r.createElement(C.$k,{statname:c,value:t,isUnit:!1,unit:p}),r.createElement(C.$k,{statname:c,value:t,isUnit:!0,unit:p}))))})};return r.createElement("div",{style:(t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}({},f),n=n={position:"relative"},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t)},r.createElement("div",{style:{display:"flex",width:"100%"}},s.map(function(e,t){return r.createElement("div",{key:t,style:{width:m,height:"1em",backgroundColor:(0,x.BM)(u,l.forward(e),i),marginLeft:"1px",marginRight:"1px"}})})),r.createElement("div",{ref:a,style:{position:"absolute",top:0,left:0,display:"flex",width:"100%",visibility:"hidden"}},d(!1)),r.createElement("div",{style:{display:"flex",width:"100%"}},d(o)),r.createElement("div",{className:"centered_text"},c))}var B=n(45844),L=n(66547),U=n(51647);function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function z(e){return function(e){if(Array.isArray(e))return V(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||N(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,t){if(e){if("string"==typeof e)return V(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return V(e,t)}}var K=r.forwardRef(function(e,t){var n,a=e.inset,u=e.children,l=e.editInset,c=e.container,s=e.i,p=e.numInsets,f=(0,L.cI)(),m="map-".concat(s);return r.createElement("div",{id:m,style:{position:"absolute",left:"".concat(100*a.bottomLeft[0],"%"),bottom:"".concat(100*a.bottomLeft[1],"%"),width:"".concat((a.topRight[0]-a.bottomLeft[0])*100,"%"),height:"".concat((a.topRight[1]-a.bottomLeft[1])*100,"%")}},r.createElement(o.yq,{ref:t,style:{position:"absolute",inset:0,border:a.mainMap?"".concat(i.C4,"px solid ").concat(f.borderNonShadow):"".concat(o.uE,"px solid ").concat(f.mapInsetBorderColor),borderRadius:a.mainMap?"".concat(i.uq,"px"):"0px",width:void 0,height:void 0},attributionControl:!1},u,r.createElement(G,{inset:a,setCoordBox:function(e){null==l||l.modify({coordBox:e})}}),r.createElement(H,{id:m}),a.mainMap&&r.createElement(o.X3,{startShowingAttribution:!0})),l&&r.createElement(X,{frame:z(a.bottomLeft).concat(z(a.topRight)),setFrame:function(e){l.modify({bottomLeft:[e[0],e[1]],topRight:[e[2],e[3]]})},container:c,delete:a.mainMap?void 0:l.delete,duplicate:a.mainMap?void 0:l.duplicate,add:a.mainMap?l.add:void 0,shouldHaveCenterHandle:!a.mainMap||!(.005>Math.abs((n=a).bottomLeft[0]-0)&&.005>Math.abs(n.bottomLeft[1]-0)&&.005>Math.abs(n.topRight[0]-1)&&.005>Math.abs(n.topRight[1]-1)),moveUp:s+1<p?function(){l.moveUp()}:void 0,moveDown:s>0?function(){l.moveDown()}:void 0}))});function G(e){var t=e.inset,n=e.setCoordBox,a=(0,B.Sx)().current;return(0,r.useEffect)(function(){var e=function(){a.fitBounds(t.coordBox,{animate:!1})};return e(),a.on("resize",e),function(){a.off("resize",e)}},[t,a]),(0,r.useEffect)(function(){var e=function(){var e=a.getBounds(),t=e.getSouthWest(),n=e.getNorthEast();return[t.lng,t.lat,n.lng,n.lat]},t=function(t){void 0!==t.originalEvent&&n(e())};return a.on("moveend",t),function(){a.off("moveend",t)}},[a,n]),null}function H(e){var t=e.id,n=(0,B.Sx)().current.getMap();return U.k.shared.maps.set(t,new WeakRef(n)),null}function X(e){var t=(0,r.useRef)(void 0),n=function(n){return{"data-test":n,onPointerDown:function(r){if(void 0===t.current){var a=r.target;t.current={kind:n,startX:r.clientX,startY:r.clientY,startFrame:e.frame,pointerId:r.pointerId},a.setPointerCapture(r.pointerId)}},onPointerMove:function(n){if((null==(r=t.current)?void 0:r.pointerId)===n.pointerId){var r,a,o=t.current,i=(n.clientX-o.startX)/e.container.current.clientWidth,u=-(n.clientY-o.startY)/e.container.current.clientHeight,l=[Math.max(0,Math.min(o.startFrame[0]+i,o.startFrame[2]-.05)),Math.max(0,Math.min(o.startFrame[1]+u,o.startFrame[3]-.1)),Math.max(o.startFrame[0]+.05,Math.min(o.startFrame[2]+i,1)),Math.max(o.startFrame[1]+.1,Math.min(o.startFrame[3]+u,1))];switch(o.kind){case"move":var c=Math.max(0-o.startFrame[0],Math.min(i,1-o.startFrame[2])),s=Math.max(0-o.startFrame[1],Math.min(u,1-o.startFrame[3]));a=[o.startFrame[0]+c,o.startFrame[1]+s,o.startFrame[2]+c,o.startFrame[3]+s];break;case"topRight":a=[o.startFrame[0],o.startFrame[1],l[2],l[3]];break;case"bottomRight":a=[o.startFrame[0],l[1],l[2],o.startFrame[3]];break;case"bottomLeft":a=[l[0],l[1],o.startFrame[2],o.startFrame[3]];break;case"topLeft":a=[l[0],o.startFrame[1],o.startFrame[2],l[3]]}e.setFrame(a)}},onPointerUp:function(e){var n;(null==(n=t.current)?void 0:n.pointerId)===e.pointerId&&(t.current=void 0)},onPointerCancel:function(e){var n;(null==(n=t.current)?void 0:n.pointerId)===e.pointerId&&(t.current=void 0)}}};return r.createElement(r.Fragment,null,r.createElement($,T({handleSize:15,style:{right:"-".concat(o.uE,"px"),top:"-".concat(o.uE,"px"),cursor:"nesw-resize"}},n("topRight"))),r.createElement($,T({handleSize:15,style:{right:"-".concat(o.uE,"px"),bottom:"-".concat(o.uE,"px"),cursor:"nwse-resize"}},n("bottomRight"))),r.createElement($,T({handleSize:15,style:{left:"-".concat(o.uE,"px"),bottom:"-".concat(o.uE,"px"),cursor:"nesw-resize"}},n("bottomLeft"))),r.createElement($,T({handleSize:15,style:{left:"-".concat(o.uE,"px"),top:"-".concat(o.uE,"px"),cursor:"nwse-resize"}},n("topLeft"))),e.shouldHaveCenterHandle&&r.createElement($,T({handleSize:20,style:{margin:"auto",left:"calc(50% - 10px)",top:"calc(50% - 10px)",cursor:"move"}},n("move"))),e.duplicate&&r.createElement($,{handleSize:25,"data-test":"duplicate",style:{margin:"auto",left:"calc(66% - 12.5px)",textAlign:"center",lineHeight:"25px",top:-o.uE,cursor:"copy"},onClick:e.duplicate,img:{src:"/duplicate.png",alt:"Duplicate"}}),e.delete&&r.createElement($,{handleSize:25,"data-test":"delete",style:{margin:"auto",left:"calc(33% - 12.5px)",textAlign:"center",lineHeight:"25px",top:-o.uE,cursor:"default"},onClick:e.delete,img:{src:"/close-red-small.png",alt:"Delete"}}),e.add&&r.createElement($,{handleSize:25,"data-test":"add",style:{margin:"auto",left:"calc(50% - 12.5px)",textAlign:"center",top:-o.uE,cursor:"default"},onClick:e.add,img:{src:"/add-green-small.png",alt:"Add"}}),e.moveUp&&r.createElement($,{handleSize:25,"data-test":"moveUp",style:{left:"-".concat(o.uE,"px"),textAlign:"center",top:"calc(50% - 25px)",cursor:"default"},onClick:e.moveUp,img:{src:"/sort-up.png",alt:"Move Up"}}),e.moveDown&&r.createElement($,{handleSize:25,"data-test":"moveDown",style:{left:"-".concat(o.uE,"px"),textAlign:"center",top:"calc(50%)",cursor:"default"},onClick:e.moveDown,img:{src:"/sort-down.png",alt:"Move Down"}}))}function $(e){var t,n=e.handleSize,a=e.style,o=e.img,i=function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(e,["handleSize","style","img"]),u=(0,L.cI)(),l=(t=(0,r.useState)(!1),function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,u=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),o.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(u)throw r}}return o}}(t,2)||N(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=l[0],s=l[1],p=(0,r.useRef)(null);return(0,r.useEffect)(function(){var e=function(){s(!0)},t=function(){s(!1)},n=p.current;return n.addEventListener("mouseenter",e),n.addEventListener("mouseleave",t),function(){n.removeEventListener("mouseenter",e),n.removeEventListener("mouseleave",t)}},[]),r.createElement("div",T({ref:p,role:"button",style:T({backgroundColor:c?u.slightlyDifferentBackgroundFocused:u.slightlyDifferentBackground,border:"1px solid ".concat(u.textMain),position:"absolute",width:"".concat(n,"px"),height:"".concat(n,"px"),borderRadius:"2px"},a)},i),o&&r.createElement("img",{src:o.src,alt:o.alt,style:{width:"100%",height:"100%"}}))}var W=n(99448);function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function J(e,t,n,r,a,o,i){try{var u=e[o](i),l=u.value}catch(e){n(e);return}u.done?t(l):Promise.resolve(l).then(r,a)}function Z(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function i(e){J(o,r,a,i,u,"next",e)}function u(e){J(o,r,a,i,u,"throw",e)}i(void 0)})}}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function q(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function Q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,u=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(u)throw r}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ee(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(l){var c=[u,l];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(o=0)),o;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){o=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){o.label=c[1];break}if(6===c[0]&&o.label<a[1]){o.label=a[1],a=c;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(c);break}a[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}function et(e){var t=e.mapSettings,n=(0,r.useRef)({}),a=(0,r.useRef)(Date.now()),o=Q((0,r.useState)(function(){return en({mapSettings:t,cache:n.current,previousGenerator:void 0})}),2),i=o[0],u=o[1];(0,r.useEffect)(function(){var e=Date.now()-a.current;if(e>500){a.current=Date.now(),u(function(e){return en({mapSettings:t,cache:n.current,previousGenerator:e})});return}a.current=Date.now();var r=setTimeout(function(){u(function(e){return en({mapSettings:t,cache:n.current,previousGenerator:e})})},500-e);return function(){clearTimeout(r)}},[t]);var l=(0,A.a)(i),c=l.result,s=l.loading;return void 0!==c?q(Y({},c),{ui:function(e){return c.ui(q(Y({},e),{loading:s}))}}):{ui:function(){return{node:r.createElement(eo,{universe:t.universe,loading:s})}},errors:[]}}function en(e){return Z(function(e){var t,n,u,c,v,O,j,P,M,k,A,C,R,F,B,L,U,V;return ee(this,function(T){switch(T.label){case 0:if(t=e.mapSettings,n=e.cache,u=e.previousGenerator,c=function(e){var n=e.loading;return{node:r.createElement(eo,{universe:t.universe,loading:n})}},void 0===t.geographyKind||void 0===t.universe)return[2,{ui:c,errors:[{kind:"error",type:"error",value:"Select a Universe and Geography Kind",location:w.tU}]}];if(v=(0,W.computeUSS)(t.script),!((O=(0,b.ZP)(v)).length>0))return[3,2];return[4,u];case 1:return[2,q(Y({},j=T.sent()),{ui:null!=(P=null==j?void 0:j.ui)?P:c,errors:O.map(function(e){return q(Y({},e),{kind:"error"})})})];case 2:return[4,(0,S.W)({descriptor:{kind:"mapper",geographyKind:t.geographyKind,universe:t.universe},stmts:v})];case 3:if(void 0!==(M=T.sent()).resultingValue)return[3,5];return[4,u];case 4:return[2,q(Y({},k=T.sent()),{ui:null!=(A=null==k?void 0:k.ui)?A:c,errors:M.error})];case 5:return C=M.resultingValue.value,R=(0,a.lM)(C,M.context),F="".concat(t.geographyKind,"-").concat(t.universe,"-data.csv"),[4,function(e){return Z(function(e){var t,n,a,i,u,l,c,s,p,v,b,w,O,S,j;return ee(this,function(P){var M,k,I,A,C,R,F,D;switch(P.label){case 0:switch(n=(t=e.mapResultMain).opaqueType,a=t.value,i=e.universe,u=e.geographyKind,l=e.cache,n){case"pMap":case"cMap":p=(0,E._K)(a.scale),v=(0,x.oX)(a.ramp.map(function(e){return e[1]})),b=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1].map(p.inverse),c={type:"ramp",value:{ramp:a.ramp,interpolations:b,scale:p,label:a.label,unit:a.unit}},s=a.data.map(function(e){return(0,x.BM)(a.ramp,p.forward(e),v)});break;case"cMapRGB":s=a.dataR.map(function(e,t){return(0,h.XF)({r:255*e,g:255*a.dataG[t],b:255*a.dataB[t],a:255})}),c={type:"label",value:a.label}}switch(n){case"pMap":return[3,1];case"cMap":case"cMapRGB":return[3,3]}return[3,5];case 1:return S=Array.from(a.data.entries()).map(function(e){var t=Q(e,2),n=t[0],r=t[1];return{name:a.geo[n],fillColor:s[n],fillOpacity:1,radius:Math.sqrt(a.relativeArea[n])*a.maxRadius,statistic:r}}),[4,(M=u,k=i,I=S,A=l,Z(function(){var e,t,n,r,a;return ee(this,function(o){switch(o.label){case 0:if((null==(e=A.geo)?void 0:e.type)==="points"&&A.geo.universe===k&&A.geo.geographyKind===M)return[3,3];return t=(0,y.Tw)(k,M),[4,(0,m.gi)(t,"ArticleOrderingList")];case 1:return n=o.sent(),[4,(0,g.y7)(k,M,n.longnames)];case 2:r=o.sent(),A.geo={type:"points",universe:k,geographyKind:M,centroidsByName:new Map(n.longnames.map(function(e,t){return[e,r[t]]}))},o.label=3;case 3:return a=A.geo,[2,I.map(function(e){var t=a.centroidsByName.get(e.name);return{type:"Feature",properties:Y({},e),geometry:{type:"Point",coordinates:[t.lon,t.lat]}}})]}})})())];case 2:return w=P.sent(),O=function(e){return r.createElement(o.Oy,{features:e,clickable:!0})},[3,5];case 3:return j=Array.from(s.entries()).map(function(e){var t,r=Q(e,2),o=r[0],i=r[1];switch(n){case"cMap":t={statistic:a.data[o]};break;case"cMapRGB":t={statistic:[a.dataR[o],a.dataG[o],a.dataB[o]]}}return Y({name:a.geo[o],fillColor:i,fillOpacity:1,color:(0,h.XF)(a.outline.color),weight:a.outline.weight},t)}),[4,(C=u,R=i,F=j,D=l,Z(function(){var e,t,n,r,a,o;return ee(this,function(i){switch(i.label){case 0:if((null==(e=D.geo)?void 0:e.type)==="polygons"&&D.geo.universe===R&&D.geo.geographyKind===C)return[3,2];return t=f.Z.indexOf(R),[4,(0,m.gi)((0,y.UM)(C),"ConsolidatedShapes")];case 1:for(a=0,n=i.sent(),r=new Map;a<n.longnames.length;a++)n.universes[a].universeIdxs.includes(t)&&r.set(n.longnames[a],(0,d.geometry)(n.shapes[a]));D.geo={type:"polygons",universe:R,geographyKind:C,polygonsByName:r},i.label=2;case 2:return o=D.geo,[2,F.map(function(e){return{type:"Feature",properties:Y({},e),geometry:o.polygonsByName.get(e.name)}})]}})})())];case 4:return w=P.sent(),O=function(e){return r.createElement(o.uy,{features:e,clickable:!0})},[3,5];case 5:return[2,{features:w,mapChildren:function(e){return r.createElement(r.Fragment,null,O(e),r.createElement(o.Es,{basemap:a.basemap}))},ramp:c}]}})}).apply(this,arguments)}({mapResultMain:C,universe:t.universe,geographyKind:t.geographyKind,cache:n})];case 6:return L=(B=T.sent()).features,U=B.mapChildren,V=B.ramp,[2,{errors:M.error,exportCSV:{csvData:R,csvFilename:F},exportGeoJSON:function(){return JSON.stringify({type:"FeatureCollection",features:L},null,2)},ui:function(e){var t=[],n=r.createRef(),a=("insets"===e.mode?e.editInsets.editedInsets:C.value.insets).flatMap(function(t){var n,r,a,o=(n=t,r=L,a=n.coordBox,n.mainMap||(r=r.filter(function(e){var t=(0,d.boundingBox)(e.geometry);return t.getWest()<a[2]&&t.getEast()>a[0]&&t.getNorth()>a[1]&&t.getSouth()<a[3]})),r);return 0===o.length&&"insets"!==e.mode?[]:[{inset:t,insetFeatures:o}]}),o=a.map(function(a,o,i){var u=a.inset,l=a.insetFeatures;return r.createElement(K,{i:o,key:o,inset:u,ref:function(e){return t[o]=e},container:n,numInsets:i.length,editInset:"insets"===e.mode?{modify:function(t){e.editInsets.modify(o,t)},delete:function(){e.editInsets.delete(o)},duplicate:function(){e.editInsets.duplicate(o)},add:e.editInsets.add,moveUp:function(){e.editInsets.moveUp(o)},moveDown:function(){e.editInsets.moveDown(o)}}:void 0},U(l))}),u=a.map(function(e){return e.inset}),c=r.createRef();return{node:r.createElement(er,{maps:o,loading:e.loading,colorbar:r.createElement(D,{ramp:V,basemap:C.value.basemap}),aspectRatio:I(u),mapsContainerRef:n,colorbarRef:c}),exportPng:function(e){return function(e){return Z(function(e){var t,n,r,a,o,u,c,f,m,d,y,v,g,b,h,E,w;return ee(this,function(O){switch(O.label){case 0:return t=e.colors,n=e.colorbarElement,r=e.insets,a=e.maps,o=e.basemap,m=(f=function(e,t,n){if(void 0===e)return{width:0,height:0};var r=e.offsetWidth,a=e.offsetHeight,o=n/a;if(a=n,(r*=o)>t){var i=t/r;r=t,a*=i}return{width:r,height:a}}(n,.8*(u=4096),300-(c=40))).height,d=f.width,y=I(r),g=(v=Math.round(u/y))+m+c,b={width:u,height:v,pixelRatio:4,insetBorderColor:t.mapInsetBorderColor},E=(h=document.createElement("canvas")).getContext("2d"),h.width=u,h.height=g,[4,Promise.all(a.map(function(e,t){return Z(function(){var n;return ee(this,function(a){switch(a.label){case 0:var o,i;return n=r[t],[4,(o=E,(i=function(){var t,r,a,i,u,c,s,f,m,d,y,v,g,h,E,w;return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(l){var c=[u,l];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(o=0)),o;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){o=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){o.label=c[1];break}if(6===c[0]&&o.label<a[1]){o.label=a[1],a=c;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(c);break}a[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(O){switch(O.label){case 0:var S,x,j,P,M,k;return r={width:(t=e.getContainer()).style.width||"",height:t.style.height||""},a=e.getBounds(),i=e.getPixelRatio(),x=(S=p(n.bottomLeft,2))[0],j=S[1],M=(P=p(n.topRight,2))[0],k=P[1],c=(u={insetWidth:(M-x)*b.width,insetHeight:(k-j)*b.height,insetX:x*b.width,insetY:(1-k)*b.height}).insetWidth,s=u.insetHeight,f=u.insetX,m=u.insetY,t.style.width="".concat(c/b.pixelRatio,"px"),t.style.height="".concat(s/b.pixelRatio,"px"),e.setPixelRatio(b.pixelRatio),e.resize(),y=(d=p(n.coordBox,4))[0],v=d[1],g=d[2],h=d[3],E=new(l()).LngLatBounds(new(l()).LngLat(y,v),new(l()).LngLat(g,h)),e.fitBounds(E,{animate:!1,padding:0}),[4,new Promise(function(e){return setTimeout(e,1e3)})];case 1:return O.sent(),w=e.getCanvas(),o.drawImage(w,f,m,c,s),n.mainMap||(o.strokeStyle=b.insetBorderColor,o.lineWidth=4,o.strokeRect(f,m,c,s)),t.style.width=r.width,t.style.height=r.height,e.setPixelRatio(i),e.resize(),e.fitBounds(a,{animate:!1}),[2]}})},function(){var e=this,t=arguments;return new Promise(function(n,r){var a=i.apply(e,t);function o(e){s(a,n,r,o,u,"next",e)}function u(e){s(a,n,r,o,u,"throw",e)}o(void 0)})})())];case 1:return a.sent(),[2]}})})()}))];case 1:if(O.sent(),E.fillStyle="none"===o.type?o.backgroundColor:t.background,E.fillRect(0,v,u,m+c),!n)return[3,3];return[4,(0,i.d_)(n,d,1)];case 2:w=O.sent(),E.drawImage(w,(u-d)/2,v+c/2),O.label=3;case 3:return[2,h.toDataURL("image/png",1)]}})}).apply(this,arguments)}({colors:e,colorbarElement:c.current,insets:u,maps:t.map(function(e){return e.getMap()}),basemap:C.value.basemap})}}}}]}})}).apply(this,arguments)}function er(e){var t=e.maps,n=e.colorbar,a=e.loading,o=e.mapsContainerRef,i=e.colorbarRef,u=e.aspectRatio;return r.createElement("div",{style:{display:"flex",flexDirection:"column",position:"relative"}},r.createElement(ea,{loading:a}),r.createElement("div",{style:{height:"90%",width:"100%"}},r.createElement("div",{ref:o,style:{width:"100%",minHeight:"300px",aspectRatio:u,position:"relative"}},t)),r.createElement("div",{style:{height:"8%",width:"100%"},ref:i},n))}function ea(e){var t=e.loading;return r.createElement(v.WU,{containerStyleOverride:{position:"absolute",transition:"opacity 0.25s",opacity:+!!t,pointerEvents:"none"}})}function eo(e){var t=e.universe,n=e.loading,a=(0,O.v)(null!=t?t:"world");return r.createElement(er,{maps:a.map(function(e,t){return r.createElement(K,{i:t,key:t,inset:e,container:r.createRef(),numInsets:a.length},null)}),loading:n,colorbar:null,aspectRatio:I(a)})}var ei=n(58788),eu=n(6381),el=n(79779),ec=n(81600),es=n(88452),ep=n(89147),ef=n(36405),em=n(41486),ed=n(88609),ey=n(52594),ev=n(46207);function eg(e,t,n,r,a,o,i){try{var u=e[o](i),l=u.value}catch(e){n(e);return}u.done?t(l):Promise.resolve(l).then(r,a)}function eb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function eh(e){var t=e.mapSettings,n=e.setMapSettings;return r.createElement("div",{style:{display:"flex",gap:"0.5em",margin:"0.5em 0"}},r.createElement("button",{onClick:function(){var e;return(e=function(){var e,t;return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(l){var c=[u,l];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(o=0)),o;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){o=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){o.label=c[1];break}if(6===c[0]&&o.label<a[1]){o.label=a[1],a=c;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(c);break}a[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(r){switch(r.label){case 0:return[4,(0,ev.c)(".uss")];case 1:if((e=r.sent())===ev.B)return[2];return[4,e.text()];case 2:if(!(t=ew.apply(void 0,[r.sent()])).success)return alert(t.error),[2];return n(t.mapSettings),[2]}})},function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function i(e){eg(o,r,a,i,u,"next",e)}function u(e){eg(o,r,a,i,u,"throw",e)}i(void 0)})})()}},"Import Script"),r.createElement("button",{onClick:function(){var e;(0,em.saveAs)(new Blob([(e=t,'meta(kind="mapper", universe="'.concat(e.universe,'", geographyKind="').concat(e.geographyKind,'")\n').concat((0,es.Z2)(e.script.uss)))]),"urban_stats_mapper.uss")}},"Export Script"))}var eE=ed.z.object(eb({kind:ed.z.literal("mapper")},W.mapperMetaFields.shape));function ew(e){var t,n,r=(0,es.Qc)(e);if("error"===r.type)return{success:!1,error:"Parse Errors:\n".concat(r.errors.map(function(e){return"• ".concat(e.value," at ").concat((0,ey.i7)(e.location))}).join("\n"))};var a=void 0;if("statements"===r.type&&"expression"===r.result[0].type&&"call"===r.result[0].value.type&&"identifier"===r.result[0].value.fn.type&&"meta"===r.result[0].value.fn.name.node){var o=r.result[0].value;r.result.splice(0,1);var i=[],u=!0,l=!1,c=void 0;try{for(var s,p=o.args[Symbol.iterator]();!(u=(s=p.next()).done);u=!0){var f=s.value;if("unnamed"===f.type)return{success:!1,error:'"meta" function call at '.concat((0,ey.i7)(o.entireLoc)," must have only named arguments")};if("constant"!==f.value.type)return{success:!1,error:'"meta" function argument "'.concat(f.name.node,'" must have a constant value')};i.push([f.name.node,f.value.value.node.value])}}catch(e){l=!0,c=e}finally{try{u||null==p.return||p.return()}finally{if(l)throw c}}var m=eE.safeParse(Object.fromEntries(i));if(!m.success)return{success:!1,error:"Error parsing metadata: ".concat(Object.values(m.error.flatten(function(e){return'• Parameter "'.concat(e.path,'" is ').concat(e.message)}).fieldErrors).join("\n"))};a=m.data}return{success:!0,mapSettings:(0,W.defaultSettings)((t=eb({},a),n=n={script:{uss:(0,W.convertToMapUss)(r)}},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t))}}var eO=n(83929),eS={fontWeight:500,fontSize:"1.2em",marginBottom:"0.125em",marginTop:"0.25em"},ex=n(30444),ej=n(78233);function eP(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function eM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function ek(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function eI(e){return function(e){if(Array.isArray(e))return eP(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return eP(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eP(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eA(e){var t=e.mapSettings,n=e.setMapSettings,a=e.errors,o=e.counts,i=e.typeEnvironment,u=t.script.uss,l=(0,r.useCallback)(function(e){return{text:null!=e?e:""}},[]),c=(0,r.useMemo)(function(){return[void 0].concat(eI(f.Z))},[]),s=(0,r.useMemo)(function(){return void 0===t.universe?void 0:[void 0].concat(eI((0,eO.d)(o,t.universe)))},[t.universe,o]);return r.createElement(r.Fragment,null,r.createElement("div",{style:eS},"Universe"),r.createElement(ex.S,{possibleValues:c,value:t.universe,renderValue:l,onChange:function(e){n(ek(eM({},t),{universe:e,geographyKind:void 0===e||void 0===t.geographyKind||(0,eO.d)(o,e).includes(t.geographyKind)?t.geographyKind:void 0}))}}),s&&r.createElement(r.Fragment,null,r.createElement("div",{style:eS},"Geography Kind"),r.createElement(ex.S,{possibleValues:s,value:t.geographyKind,renderValue:l,onChange:function(e){n(ek(eM({},t),{geographyKind:e}))}})),r.createElement(ej.ag,{uss:u,setUss:function(e){n(ek(eM({},t),{script:{uss:e}}))},typeEnvironment:i,errors:a}))}var eC=n(65344),eR=n(44640);function eF(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function eD(e){return function(e){if(Array.isArray(e))return eF(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||eB(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eB(e,t){if(e){if("string"==typeof e)return eF(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eF(e,t)}}function eL(e,t,n){var r=function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,u=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),o.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(u)throw r}}return o}}(t,2)||eB(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),a=r[0],o=r[1];return function(t){var r=e(t);return eD(r.slice(0,a)).concat(eD(n),eD(r.slice(o)))}}function eU(e,t,n){return function(r){var a=e(r),o=a[t],i=a[n],u=Array.from(a);return u[n]=o,u[t]=i,u}}var eV=n(73001);function eT(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var ez=eV.Ry({north:eV.Rx(),east:eV.Rx(),south:eV.Rx(),west:eV.Rx()}),eN=eV.n0(eV.Rf(eV.RE({fn:eV.QU("constructInset"),unnamedArgs:[],namedArgs:{mainMap:eV.O7(),name:eV.Z_(),screenBounds:ez,mapBounds:ez}})),function(e){var t=e.namedArgs,n=t.screenBounds,r=t.mapBounds,a=t.mainMap,o=t.name;return{bottomLeft:[n.west,n.south],topRight:[n.east,n.north],coordBox:[r.west,r.south,r.east,r.north],mainMap:a,name:o}}),eK=eV.n0(eV.RE({fn:eV.QU("constructInsets"),namedArgs:{},unnamedArgs:[eV.sS(eN)]}),function(e){return e.unnamedArgs[0]}),eG=eV.x2(eV.gh([eV.ID(),eV.s2({condition:eV.ID(),rest:[eV.th(eV.Hw(ej.Qc,ej.Py,eV.RE({fn:eV.ID(),unnamedArgs:[],namedArgs:{insets:eV.eP(eV.jt(eV.Rf(eK)))}})))]})]),function(e){var t,n,r,a=e[1].rest[0].namedArgs.insets,o=null!=(r=a.currentValue)?r:null;return t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}({},a),n=n={currentValue:o},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}),t});function eH(e,t){if("statements"===e.script.uss.type){var n=eG.parse(e.script.uss,t);if(void 0!==n){if(null!==n.currentValue)return n.currentValue.currentValue;if(void 0!==e.universe)return(0,O.v)(e.universe)}}}function eX(e,t,n){var r=function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,u=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),o.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(u)throw r}}return o}}(t,2)||function(e,t){if(e){if("string"==typeof e)return eT(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eT(e,t)}}(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),a=r[0],o=r[1];return{insets:eL(e.insets,[a,o],n),ast:eL(e.ast,[a,o],n.map(eR.Rf))}}function e$(e,t,n){return{insets:eU(e.insets,t,n),ast:eU(e.ast,t,n)}}function eW(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function e_(e,t,n,r,a,o,i){try{var u=e[o](i),l=u.value}catch(e){n(e);return}u.done?t(l):Promise.resolve(l).then(r,a)}function eJ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function eZ(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function eY(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,u=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(u)throw r}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return eW(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eW(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eq(e){var t=eY((0,r.useState)(e.mapSettings),2),n=t[0],a=t[1],o=eY((0,r.useState)("uss"),2),i=o[0],u=o[1],l=(0,r.useMemo)(function(){return new ep.Z(void 0)},[]),c=(0,ec.C5)(n,l.value,a,function(e){l.value=e},{undoChunking:U.k.shared.isTesting?2e3:1e3,onlyElement:"insets"===i?{current:null}:void 0}),s=c.updateCurrentSelection,p=c.addState,f=(0,r.useCallback)(function(e){a(e),p(e,l.value)},[l,p]),m=(0,r.useRef)(!0);(0,r.useEffect)(function(){m.current?m.current=!1:(f(e.mapSettings),u("uss"))},[e.mapSettings,f]);var d=JSON.stringify(eZ(eJ({},n),{script:{uss:(0,es.Z2)(n.script.uss)}})),y=(0,r.useContext)(eu.C.Context);(0,r.useEffect)(function(){if(e.mapSettings!==n){var t=(0,ei.gzipSync)(d).toString("base64");y.setMapperSettings(t)}},[d,y]);var v=(0,R.Kn)(),g=(0,r.useMemo)(function(){return(0,ef.A)(n.universe)},[n.universe]);(0,r.useEffect)(function(){var e=function(){s(l.value)};return l.observers.add(e),function(){l.observers.delete(e)}},[l,s]);var b=et({mapSettings:n}),h={mapSettings:n,setMapSettings:f,typeEnvironment:g,setMapEditorMode:u,mapGenerator:b};return r.createElement(el.P,{csvExportData:b.exportCSV},r.createElement(eC.I.Provider,{value:l},r.createElement("div",{className:v},"Urban Stats Mapper (beta)"),"insets"===i?r.createElement(e0,h):r.createElement(eQ,eZ(eJ({},h),{counts:e.counts})),"insets"!==i?c.ui:void 0))}function eQ(e){var t=e.mapSettings,n=e.setMapSettings,a=e.counts,o=e.typeEnvironment,i=e.setMapEditorMode,u=e.mapGenerator,l=u.ui({mode:"uss"});return r.createElement(r.Fragment,null,r.createElement(eA,{mapSettings:t,setMapSettings:n,errors:u.errors,counts:a,typeEnvironment:o}),r.createElement("div",{style:{display:"flex",justifyContent:"space-between",gap:"0.5em"}},r.createElement(e5,{pngExport:l.exportPng,geoJSONExport:u.exportGeoJSON}),eH(t,o)&&r.createElement("div",{style:{display:"flex",gap:"0.5em",margin:"0.5em 0"}},r.createElement("button",{onClick:function(){i("insets")}},"Edit Insets")),r.createElement(eh,{mapSettings:t,setMapSettings:n})),l.node)}function e0(e){var t=e.mapSettings,n=e.setMapSettings,a=e.typeEnvironment,o=e.setMapEditorMode,i=e.mapGenerator,u=(0,L.cI)(),l=eY((0,r.useState)({ast:function(e){return e},insets:function(e){return e}}),2),c=l[0],s=l[1],p=(0,ec.C5)(c,void 0,s,function(){}),f=p.addState,m=p.ui,d=p.canUndo,y=c.insets(eH(t,a)),v=function(e){s(e),f(e,void 0)},g=i.ui({mode:"insets",editInsets:{add:function(){var e,n=eZ(eJ({},(0,O.v)(null!=(e=t.universe)?e:"world")[0]),{bottomLeft:[.25,.25],topRight:[.75,.75],mainMap:!1});v(eX(c,[y.length,y.length],[e1(n,y)]))},modify:function(e,t){v(eX(c,[e,e+1],[eJ({},y[e],t)]))},delete:function(e){v(eX(c,[e,e+1],[]))},duplicate:function(e){v(eX(c,[e+1,e+1],[e1(y[e],y)]))},moveUp:function(e){(0,j.h)(e+1<y.length,"Cannot move inset ".concat(e," up, already top")),v(e$(c,e,e+1))},moveDown:function(e){(0,j.h)(e>0,"Cannot move inset ".concat(e," down, already bottom")),v(e$(c,e,e-1))},editedInsets:y}});return r.createElement(r.Fragment,null,r.createElement("div",{style:{backgroundColor:u.slightlyDifferentBackgroundFocused,borderRadius:"5px",padding:"10px",margin:"10px 0",display:"flex",justifyContent:"space-between",gap:"0.5em"}},r.createElement("div",null,r.createElement("b",null,"Editing Insets.")," ","Pans and zooms to maps will be reflected permanently. Drag inset frames to reposition and resize."),r.createElement("div",{style:{display:"flex",gap:"10px"}},r.createElement("button",{onClick:function(){o("uss")}},"Cancel"),r.createElement("button",{onClick:function(){var e,r,i;n(eZ(eJ({},t),{script:{uss:((0,j.h)("statements"===t.script.uss.type,"Trying to do an inset edit on USS that is not inset editable"),r=eG.parse(t.script.uss,a),(0,j.h)(void 0!==r&&(null!==r.currentValue||void 0!==t.universe),"Trying to do an inset edit on USS that is not inset editable"),e=null!==r.currentValue?r.expr:(0,O.U)(t.universe),i=eK.parse(e,a).edit(c.ast),r.edit(i))}})),o("uss")},disabled:!d},"Accept"))),g.node,m)}function e1(e,t){for(var n=0;n<1;n+=.05)for(var r=0,a=[[n,n],[-n,-n],[-n,n],[n,-n]];r<a.length;r++){var o=function(n,r){var a=eY(r[n],2),o=a[0],i=a[1],u=eZ(eJ({},e),{bottomLeft:[e.bottomLeft[0]+o,e.bottomLeft[1]+i],topRight:[e.topRight[0]+o,e.topRight[1]+i]});if(u.bottomLeft.concat(u.topRight).every(function(e){return e>=0&&e<=1})&&!t.some(function(e){return u.bottomLeft[0]===e.bottomLeft[0]&&u.bottomLeft[1]===e.bottomLeft[1]&&u.topRight[0]===e.topRight[0]&&u.topRight[1]===e.topRight[1]}))return{v:u}}(r,a);if("object"==(o&&"undefined"!=typeof Symbol&&o.constructor===Symbol?"symbol":typeof o))return o.v}return e}function e2(e,t,n){var r="string"==typeof t?new Blob([t],{type:n}):t,a=URL.createObjectURL(r),o=document.createElement("a");o.href=a,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function e5(e){var t=(0,L.cI)(),n=function(){var n;return(n=function(){return function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(l){var c=[u,l];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(o=0)),o;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){o=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){o.label=c[1];break}if(6===c[0]&&o.label<a[1]){o.label=a[1],a=c;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(c);break}a[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(n){switch(n.label){case 0:if(void 0===e.pngExport)return[2];return[4,e.pngExport(t)];case 1:return[4,fetch(n.sent())];case 2:return[4,n.sent().blob()];case 3:return e2("map.png",n.sent(),"image/png"),[2]}})},function(){var e=this,t=arguments;return new Promise(function(r,a){var o=n.apply(e,t);function i(e){e_(o,r,a,i,u,"next",e)}function u(e){e_(o,r,a,i,u,"throw",e)}i(void 0)})})()},a=function(){void 0!==e.geoJSONExport&&e2("map.geojson",e.geoJSONExport(),"application/geo+json")};return r.createElement("div",{style:{display:"flex",gap:"0.5em",margin:"0.5em 0"}},r.createElement("button",{disabled:void 0===e.pngExport,onClick:function(){n()}},"Export as PNG"),r.createElement("button",{disabled:void 0===e.geoJSONExport,onClick:function(){a()}},"Export as GeoJSON"),r.createElement("button",{onClick:function(){var e=new URLSearchParams(window.location.search);e.set("view","true"),window.open("?".concat(e.toString()),"_blank")}},"View as Zoomable Page"))}function e3(e){return e.view?r.createElement(e4,{mapSettings:e.mapSettings}):r.createElement(eq,e)}function e4(e){var t=et({mapSettings:e.mapSettings});return r.createElement(r.Fragment,null,t.ui({mode:"view"}).node)}},46207:function(e,t,n){n.d(t,{B:()=>r,c:()=>a});var r=Symbol();function a(e){var t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept",e),t.style.display="none";var n=new Promise(function(e){t.onchange=function(){e(t.files[0]),t.remove()},t.oncancel=function(){e(r),t.remove()}});return document.body.appendChild(t),t.click(),n}}}]);
//# sourceMappingURL=824.js.map