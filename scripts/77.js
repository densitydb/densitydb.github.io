"use strict";(self.webpackChunkassets=self.webpackChunkassets||[]).push([["77"],{98380:function(e,t,n){n.r(t),n.d(t,{mapSettingsFromURLParam:()=>eQ,MapperPanel:()=>eY}),n(71540),n(50457);var r=n(58788),a=n(72668),o=n(88609),i=n(21791),u=n(4050),l=n(45375),s=n(83929),c=n(10966),p=n(89147),f=n(51647),d=n(36405),y=n(44852),m={fontWeight:500,fontSize:"1.2em",marginBottom:"0.125em",marginTop:"0.25em"},v=n(23509),h=n.n(v),b=n(77053);function g(e,t,n,r){for(var a=0;a<=n;a++)r[a].fill(0),r[a][0]=(1<<a)-1;var o=1<<t.length-1;e:for(var i=1;i<=t.length+e.length;i++){var u=void 0;u=i-1<e.length?t.alphabet[e.charCodeAt(i-1)]:0;for(var l=0;l<=n;l++)if(0===l?r[0][i]=(r[0][i-1]<<1|1)&u:r[l][i]=(r[l][i-1]<<1|1)&u|((r[l-1][i-1]|r[l-1][i])<<1|1)|r[l-1][i-1],(r[l][i]&o)!=0&&(n=l-1,0===l))break e}return n+1}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,u=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(u)throw r}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e){var t=e.value,n=e.onChange,r=e.possibleValues,o=e.renderValue,i=(0,y.cI)(),u=o(t),l=E((0,a.useState)(u),2),s=l[0],c=l[1],p=E((0,a.useState)(!1),2),f=p[0],d=p[1],m=E((0,a.useState)(0),2),v=m[0],S=m[1],w=(0,a.useRef)(null),A=(0,a.useRef)(null);(0,a.useEffect)(function(){c(u)},[u]);var k=(0,a.useMemo)(function(){var e=r.map(function(e,t){return{renderedChoice:o(e),index:t}}),t=e.reduce(function(e,t){return Math.max(e,t.renderedChoice.toLowerCase().length)},0);return{options:e,bitapBuffers:Array.from({length:32},function(){return new Uint32Array(31+t+1)})}},[r,o]),x=k.bitapBuffers,U=k.options,C=(0,a.useMemo)(function(){var e,t={alphabet:function(e){(0,b.h)(e.length<=31,"Max bitap token length is 31");for(var t=new Uint32Array(65535).fill(0),n=0;n<e.length;n++){var r=e.charCodeAt(n);t[r]=t[r]|1<<n}return t}(e=s.toLowerCase().slice(0,31)),length:e.length,signature:function(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r>=97&&r<=122){var a=1<<(r-97)*2;(t&a)!=0?t|=a<<1:t|=a}}return t}(e)};return U.sort(function(e,n){var r=g(e.renderedChoice.toLowerCase(),t,31,x),a=g(n.renderedChoice.toLowerCase(),t,31,x);return r===a?e.renderedChoice.length-n.renderedChoice.length:r-a})},[x,s,U]),O=function(e){var a=r[e.index];h()(a)!==h()(t)&&n(a),c(e.renderedChoice),d(!1),S(0)};return a.createElement("div",{style:{position:"relative",flex:1}},a.createElement("input",{ref:w,type:"text",value:s,onChange:function(e){c(e.target.value),d(!0),S(0),A.current&&(A.current.scrollTop=0)},onKeyDown:function(e){if(f&&0!==C.length)switch(e.key){case"ArrowDown":e.preventDefault(),S(function(e){return e<C.length-1?e+1:0});break;case"ArrowUp":e.preventDefault(),S(function(e){return e>0?e-1:C.length-1});break;case"Enter":e.preventDefault(),v>=0&&v<C.length&&O(C[v]);break;case"Escape":e.preventDefault(),d(!1),S(0)}},onClick:function(e){e.target.select()},onFocus:function(){d(!0),S(0)},onBlur:function(){setTimeout(function(){d(!1),S(0)},150)},placeholder:"Search options...",style:{width:"100%",padding:"".concat("4px"," 8px"),border:"1px solid ".concat(i.ordinalTextColor),borderRadius:"4px",fontSize:"14px"}}),f&&C.length>0&&a.createElement("div",{style:{position:"absolute",top:"100%",left:0,right:0,backgroundColor:i.background,border:"1px solid #ccc",borderRadius:"4px",maxHeight:"200px",overflowY:"auto",zIndex:1e3,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},ref:A},C.map(function(e,t){return a.createElement("div",{key:t,onMouseDown:function(){O(e)},onMouseUp:function(){var t;O(e),null==(t=w.current)||t.blur()},style:{padding:"8px 12px",cursor:"pointer",borderBottom:t<C.length-1?"1px solid #eee":"none",backgroundColor:t===v?i.slightlyDifferentBackgroundFocused:i.slightlyDifferentBackground,color:""===e.renderedChoice?i.ordinalTextColor:i.textMain},onMouseEnter:function(){S(t)}},""===e.renderedChoice?"No Selection":e.renderedChoice)})))}var A=(0,a.createContext)(new p.Z(void 0)),k=n(39343),x=n.n(k),U=n(98234),C=n(23529),O=n(34672),I=n(5855),j=n(88452),P=n(24714),M=n(27193),T=n(89080),L=n(79074),N=n(36195);function B(e){var t=e.uss,n=e.setUss,r=e.typeEnvironment,o=e.errors,i=e.blockIdent,u=e.placeholder,l=(0,a.useMemo)(function(){return o.filter(function(e){return"single"===e.location.start.block.type&&e.location.start.block.ident===i})},[o,i]),s=(0,a.useContext)(A),c=s.use();return a.createElement(C.ML,{uss:t.originalCode,setUss:function(e){n((0,j.Fc)(e,i,t.expectedType))},typeEnvironment:r,results:l,placeholder:u,selection:(null==c?void 0:c.blockIdent)===i?c.range:null,setSelection:function(e){var t;null!==e?s.value={blockIdent:i,range:e}:(null==(t=s.value)?void 0:t.blockIdent)===i&&(s.value=void 0)}})}var R=n(54509);function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function K(e){return function(e){if(Array.isArray(e))return D(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||F(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){if(e){if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}}function z(e){return"number"===e.type||"string"===e.type}function V(e,t){var n=[];if(e.some(function(e){return"vector"===e.type})&&n.push({type:"vector"}),e.some(function(e){return"object"===e.type})&&n.push({type:"object"}),e.some(function(e){return"opaque"!==e.type||!1!==e.allowCustomExpression})&&n.push({type:"custom"}),e.some(z))n.push({type:"constant"});else{var r=e.map(T.wB),a=[],o=[],i=!0,u=!1,l=void 0;try{for(var s,c=t[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var p,f=(p=s.value,function(e){if(Array.isArray(e))return e}(p)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,u=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),o.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(u)throw r}}return o}}(p,2)||F(p,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),d=f[0],y=f[1].type;r.includes((0,T.wB)(y))?a.push({type:"variable",name:d}):"function"===y.type&&"concrete"===y.returnType.type&&r.includes((0,T.wB)(y.returnType.value))&&o.push({type:"function",name:d})}}catch(e){u=!0,l=e}finally{try{i||null==c.return||c.return()}finally{if(u)throw l}}a.sort(function(e,n){var r,a,o,i,u,l;return("variable"===e.type&&null!=(u=null==(a=t.get(e.name))||null==(r=a.documentation)?void 0:r.priority)?u:1)-("variable"===n.type&&null!=(l=null==(i=t.get(n.name))||null==(o=i.documentation)?void 0:o.priority)?l:1)}),o.sort(function(e,n){var r,a,o,i,u,l;return("function"===e.type&&null!=(u=null==(a=t.get(e.name))||null==(r=a.documentation)?void 0:r.priority)?u:0)-("function"===n.type&&null!=(l=null==(i=t.get(n.name))||null==(o=i.documentation)?void 0:o.priority)?l:0)}),n.push.apply(n,K(o)),n.push.apply(n,K(a))}return n}function G(e){var t=Z(e.uss),n=(0,a.useMemo)(function(){var t=new Set;return e.type.forEach(function(n){V([n],e.typeEnvironment).forEach(function(e){return t.add(e)})}),Array.from(t)},[e.type,e.typeEnvironment]),r=(0,a.useCallback)(function(t){return function(e,t){if("custom"===t.type)return"Custom Expression";if("constant"===t.type)return"Constant";if("vector"===t.type)return"Manual List";if("object"===t.type)return"Properties";var n,r,a=null==(r=e.get(t.name))||null==(n=r.documentation)?void 0:n.humanReadableName;return null!=a?a:t.name}(e.typeEnvironment,t)},[e.typeEnvironment]);if(!(n.length<2)){var o=e.type.some(function(e){return"number"===e.type}),i=e.type.some(function(e){return"string"===e.type}),u="constant"===t.type&&(o||i),l="constant"===e.uss.type?e.uss.value.node.value.toString():"",s=e.errors.filter(function(t){return"single"===t.location.start.block.type&&t.location.start.block.ident===e.blockIdent}),c=a.createElement(C.SA,{results:s,editor:!1}),p=e.type.some(function(e){return"opaque"===e.type&&"color"===e.name})?_(e.uss,e.typeEnvironment):void 0,f=a.createElement("div",{style:{position:"relative",display:"flex",alignItems:"center",gap:"0.5em"}},a.createElement(w,{value:t,possibleValues:n,renderValue:r,onChange:e.setSelection}),u&&a.createElement("input",{type:"text",value:l,onChange:function(t){var n,r,a=t.target.value,i={type:"constant",value:{node:o&&void 0!==(r=(0,I.p3)(a))?{type:"number",value:r}:{type:"string",value:a},location:(0,I.PS)(e.blockIdent)}};e.setUss(i)},style:{width:"200px",fontSize:"14px",padding:"4px 8px"},placeholder:o?"Enter number":"Enter string"}),void 0!==p&&a.createElement("input",{type:"color",value:(0,P.XF)(p.color,!0),style:{width:"200px",height:"30.5px"},onChange:function(t){var n,r=(0,R.u)(t.target.value),a="hsv"===p.kind?(0,P.v1)(r,{forceAlpha:p.color.a}):(0,P.io)(r,{forceAlpha:p.color.a});switch(e.uss.type){case"customNode":n=(0,j.Fc)(a,e.blockIdent,e.type);break;case"identifier":case"call":n=(0,j.hc)(a,e.blockIdent)}void 0!==n&&(n=eo(n,e.blockIdent,e.type,e.typeEnvironment,function(){throw Error("Should not happen")},!0),e.setUss(n))}}));return a.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5em"}},f,c)}}function Z(e){if("customNode"===e.type)return{type:"custom"};if("constant"===e.type)return{type:"constant"};if("identifier"===e.type)return{type:"variable",name:e.name.node};if("call"===e.type){var t=Z(e.fn);return(0,b.h)("variable"===t.type,"Function must be a variable or another function"),{type:"function",name:t.name}}if("vectorLiteral"===e.type)return{type:"vector"};if("objectLiteral"===e.type)return{type:"object"};throw Error("Unsupported USS expression type: ".concat(e.type))}function _(e,t){switch(e.type){case"customNode":if("expression"===e.expr.type)return _(e.expr.value,t);break;case"identifier":var n=t.get(e.name.node);if(void 0===n||!("value"in n))break;if("opaque"===n.type.type&&"color"===n.type.name)return{color:n.value.value,kind:"rgb"};break;case"call":var r=e.args.flatMap(function(e){return"unnamed"===e.type&&"constant"===e.value.type&&"number"===e.value.value.node.type?[e.value.value.node.value]:[]}),a=e.args.flatMap(function(e){return"named"===e.type&&"a"===e.name.node&&"constant"===e.value.type&&"number"===e.value.value.node.type?[e.value.value.node.value]:[]});(0,b.h)(a.length<=1,'There should be at most one "a" named argument');var o=1===a.length?a[0]:1;if("identifier"===e.fn.type&&(3===r.length||4===r.length))switch(e.fn.name.node){case"rgb":var i=(0,P._l)(r[0],r[1],r[2],o,!0);if(void 0===i)return;return{color:i,kind:"rgb"};case"hsv":var u=(0,P.De)(r[0],r[1],r[2],o,!0);if(void 0===u)return;return{color:u,kind:"hsv"};default:return}}}var q=n(20110);function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function $(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function H(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,u=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(u)throw r}}return o}}(e,t)||Q(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(e){return function(e){if(Array.isArray(e))return W(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Q(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(e,t){if(e){if("string"==typeof e)return W(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return W(e,t)}}function X(e,t,n){if("number"===e.type)return{type:"constant",value:{node:{type:"number",value:0},location:(0,I.PS)(t)}};if("string"===e.type)return{type:"constant",value:{node:{type:"string",value:""},location:(0,I.PS)(t)}};var r=!0,a=!1,o=void 0;try{for(var i,u=n[Symbol.iterator]();!(r=(i=u.next()).done);r=!0){var l,s=H(i.value,2),c=s[0],p=s[1];if(null==(l=p.documentation)?void 0:l.isDefault){if((0,T.wB)(p.type)===(0,T.wB)(e))return en({type:"variable",name:c},n,t);if("function"===p.type.type&&"inferFromPrimitive"!==p.type.returnType.type&&(0,T.wB)(p.type.returnType.value)===(0,T.wB)(e))return er({type:"function",name:c},n,t)}}}catch(e){a=!0,o=e}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}return"vector"===e.type?{type:"vectorLiteral",entireLoc:(0,I.PS)(t),elements:[]}:(0,j.Fc)("",t,[e])}function ee(e){var t,n,r,o=e.argWDefault.type;(0,b.h)("concrete"===o.type,"Named argument ".concat(e.name," must be concrete"));var i=e.uss,u=i.args.find(function(t){return"named"===t.type&&t.name.node===e.name}),l=void 0!==e.argWDefault.defaultValue,s=void 0!==u,c=(0,M.EU)(e.blockIdent,e.name),p=e.typeEnvironment.get(i.fn.name.node),f=null!=(r=null==p||null==(n=p.documentation)||null==(t=n.namedArgs)?void 0:t[e.name])?r:e.name;return a.createElement("div",{style:{display:"flex",alignItems:"flex-start",gap:"0.25em",width:"100%",margin:"0.25em 0"}},a.createElement("div",{style:{flex:1}},a.createElement("div",null,l?a.createElement(U.Ov,{name:f,checked:s,onChange:function(t){if(t){var n=e.argWDefault.defaultValue,r=void 0===n||"identifier"===n.type&&"null"===n.name.node?X(o.value,c,e.typeEnvironment):n;r=eo(r,c,[o.value],e.typeEnvironment,function(){throw Error("Should not happen")},!0);var a={type:"named",name:{node:e.name,location:(0,I.PS)(c)},value:r},u=Y(i.args).concat([a]);e.setUss($(J({},i),{args:u}))}else{var l=i.args.filter(function(t){return"named"!==t.type||t.name.node!==e.name});e.setUss($(J({},i),{args:l}))}}}):a.createElement("span",null,f)),s&&a.createElement(et,{uss:u.value,setUss:function(t){var n=i.args.map(function(n){return"named"===n.type&&n.name.node===e.name?$(J({},n),{value:t}):n});e.setUss($(J({},i),{args:n}))},typeEnvironment:e.typeEnvironment,errors:e.errors,blockIdent:c,type:[o.value]})))}function et(e){var t,n,r,o,i,u,l=(0,O.x9)(e.uss).start;("single"!==l.block.type||l.block.ident!==e.blockIdent)&&(q.warn("USS: ",e.uss),q.warn("USS Location: ",l),q.warn("Editor blockIdent: ",e.blockIdent),q.error("USS expression location does not match block identifier",e.uss,"single"===l.block.type?l.block.ident:"(multi)",e.blockIdent));var s=null!=(i=e.labelWidth)?i:"5%",c=H((n=(t=H(function(){if("constant"===e.uss.type)return[void 0,"does-not-consume-errors"];var t=e.uss;if("customNode"===t.type)return[a.createElement(B,{key:"custom",uss:t,setUss:e.setUss,typeEnvironment:e.typeEnvironment,errors:e.errors,blockIdent:e.blockIdent}),"consumes-errors"];if("identifier"===t.type)return[void 0,"does-not-consume-errors"];if("call"===t.type){(0,b.h)("identifier"===t.fn.type,"Function must be an identifier");var n=e.typeEnvironment.get(t.fn.name.node);(0,b.h)(void 0!==n,"Function ".concat(t.fn.name.node," not found in type environment"));var r=n.type;(0,b.h)("function"===r.type,"Function ".concat(t.fn.name.node," must be a function type"));var o=[];return r.posArgs.forEach(function(n,r){(0,b.h)("concrete"===n.type,"Positional argument must be concrete"),o.push(a.createElement(et,{key:"pos-".concat(r),uss:t.args[r].value,setUss:function(n){var a=Y(t.args);a[r]=$(J({},a[r]),{value:n}),e.setUss($(J({},t),{args:a}))},typeEnvironment:e.typeEnvironment,errors:e.errors,blockIdent:(0,M.ZM)(e.blockIdent,r),type:[n.value]}))}),Object.entries(r.namedArgs).forEach(function(n){var r,i=H(n,2),u=i[0],l=i[1];(null==(r=l.documentation)?void 0:r.hide)!==!0&&o.push(a.createElement(ee,{key:"named-".concat(u),name:u,argWDefault:l,uss:t,setUss:e.setUss,typeEnvironment:e.typeEnvironment,errors:e.errors,blockIdent:e.blockIdent}))}),[a.createElement.apply(a,["div",{key:"subselectors"}].concat(Y(o))),"does-not-consume-errors"]}if("vectorLiteral"===t.type){var i={type:"number"};return"vector"===e.type[0].type&&(i=e.type[0].elementType),[a.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5em",width:"100%"}},t.elements.map(function(n,r){return a.createElement("div",{key:r,style:{display:"flex",alignItems:"center",gap:"0.5em",width:"100%"}},a.createElement(et,{uss:n,setUss:function(n){var a=Y(t.elements);a[r]=n,e.setUss($(J({},t),{elements:a}))},typeEnvironment:e.typeEnvironment,errors:e.errors,blockIdent:(0,M.AY)(e.blockIdent,r),type:[i],label:"".concat(r+1)}),a.createElement("button",{style:{marginLeft:8,flexShrink:0},onClick:function(){var n=t.elements.filter(function(e,t){return t!==r});e.setUss($(J({},t),{elements:n}))},title:"Remove element"},"–"))}),a.createElement("button",{style:{alignSelf:"flex-start",marginTop:4},onClick:function(){var n=Y(t.elements).concat([t.elements.length>0?t.elements[t.elements.length-1]:X(i,(0,M.AY)(e.blockIdent,t.elements.length),e.typeEnvironment)]);e.setUss($(J({},t),{elements:n}))}},"+ Add element")),"does-not-consume-errors"]}if("objectLiteral"===t.type){var u=new L.G(function(){return{type:"number"}});return"object"===e.type[0].type&&(u=e.type[0].properties),[a.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"0.5em",width:"100%"}},Array.from(u.keys()).sort().map(function(n){var r,o,i=u.get(n);return a.createElement(et,{key:n,uss:null!=(o=null==(r=t.properties.find(function(e){return H(e,1)[0]===n}))?void 0:r[1])?o:X(i,(0,M.zt)(e.blockIdent,n),e.typeEnvironment),setUss:function(r){e.setUss($(J({},t),{properties:t.properties.map(function(e){var t=H(e,2),a=t[0],o=t[1];return[a,a===n?r:o]})}))},typeEnvironment:e.typeEnvironment,errors:e.errors,blockIdent:(0,M.zt)(e.blockIdent,n),type:[i],label:n})})),"does-not-consume-errors"]}throw Error("Unsupported USS expression type: ".concat(e.uss.type))}(),2))[0],r=t[1],void 0===n?[void 0,r]:[a.createElement("div",{style:{width:"100%",flex:1}},a.createElement("div",{style:{display:"flex",gap:"1em",marginLeft:s}},e.label&&a.createElement("span",{style:{minWidth:"fit-content"}}),a.createElement("div",{style:{flex:1}},n))),r]),2),p=c[0],f=c[1],d=void 0===e.label?void 0:a.createElement("div",{style:{padding:"".concat("4px"," 0px")}},a.createElement("span",{style:{minWidth:"fit-content"}},e.label)),y=V(e.type,e.typeEnvironment).length<2?void 0:a.createElement("div",{style:{width:"calc(100% - ".concat(s,")")}},a.createElement(G,{uss:e.uss,setSelection:function(t){e.setUss(function(e,t,n,r,a){var o=function e(t,n,r,a,o){switch(t.type){case"identifier":var i=n.get(t.name.node);if(void 0===i||(null==(c=i.documentation)?void 0:c.equivalentExpressions)===void 0)return;var u=!0,l=!1,s=void 0;try{for(var c,p,f=i.documentation.equivalentExpressions[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var d=p.value,y=ea(d,r,a,n);if(void 0!==y&&h()(Z(y))===h()(o))return y}}catch(e){l=!0,s=e}finally{try{u||null==f.return||f.return()}finally{if(l)throw s}}return;case"customNode":if("expression"===t.expr.type)return e(t.expr.value,n,r,a,o);return;case"call":if("opaque"===a.type&&"color"===a.name&&"function"===o.type){var m=_(t,n);switch(!0){case(null==m?void 0:m.kind)==="rgb"&&"hsv"===o.name:return(0,j.hc)((0,P.v1)(m.color),r);case(null==m?void 0:m.kind)==="hsv"&&"rgb"===o.name:return(0,j.hc)((0,P.io)(m.color),r)}}return;default:return}}(t,n,r,a,e);if(void 0!==o)return o;var i=ea(t,r,a,n);if(void 0!==i&&h()(Z(i))===h()(e))return i;switch(e.type){case"custom":return(0,j.Fc)((0,j.Z2)(t),r,[a]);case"constant":return X(a,r,n);case"variable":return en(e,n,r);case"function":return er(e,n,r);case"vector":return{type:"vectorLiteral",entireLoc:(0,I.PS)(r),elements:[]};case"object":return{type:"objectLiteral",entireLoc:(0,I.PS)(r),properties:[]}}}(t,e.uss,e.typeEnvironment,e.blockIdent,e.type[0]))},setUss:e.setUss,typeEnvironment:e.typeEnvironment,type:e.type,blockIdent:e.blockIdent,errors:"consumes-errors"===f?[]:e.errors})),m=(0,N.wd)()||(null!=(u=null==(o=e.label)?void 0:o.length)?u:0)>5;return a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%",flex:1,margin:"0.25em 0",gap:"0.25em"},id:"auto-ux-editor-".concat(e.blockIdent)},void 0!==d||void 0!==y?a.createElement("div",{style:{width:"100%",flex:1}},m?a.createElement(a.Fragment,null,a.createElement("div",{style:{display:"flex",alignItems:"top"}},d),a.createElement("div",{style:{display:"flex",alignItems:"top"}},a.createElement("div",{style:{width:s}}),y)):a.createElement("div",{style:{display:"flex",alignItems:"top"}},a.createElement("div",{style:{width:s}},d),y)):void 0,p)}function en(e,t,n){var r,a=null==(r=t.get(e.name))?void 0:r.type;return(0,b.h)(void 0!==a,"Variable ".concat(e.name," not found in type environment")),{type:"identifier",name:{node:e.name,location:(0,I.PS)(n)}}}function er(e,t,n){var r=t.get(e.name);(0,b.h)(void 0!==r&&"function"===r.type.type,"Function ".concat(e.name," not found or not a function"));for(var a=[],o=0;o<r.type.posArgs.length;o++){var i=r.type.posArgs[o];(0,b.h)("concrete"===i.type,"Positional argument must be concrete"),a.push({type:"unnamed",value:X(i.value,(0,M.ZM)(n,o),t)})}var u=Object.entries(r.type.namedArgs).filter(function(e){return void 0===H(e,2)[1].defaultValue}),l=!0,s=!1,c=void 0;try{for(var p,f=u[Symbol.iterator]();!(l=(p=f.next()).done);l=!0){var d=H(p.value,2),y=d[0],m=d[1].type;(0,b.h)("concrete"===m.type,"Named argument ".concat(y," must be concrete")),a.push({type:"named",name:{node:y,location:(0,I.PS)(n)},value:X(m.value,(0,M.EU)(n,y),t)})}}catch(e){s=!0,c=e}finally{try{l||null==f.return||f.return()}finally{if(s)throw c}}return{type:"call",fn:{type:"identifier",name:{node:e.name,location:(0,I.PS)(n)}},args:a,entireLoc:(0,I.PS)(n)}}function ea(e,t,n,r){try{return eo(e,t,[n],r,function(){throw Error("parsing failed")},!1)}catch(e){}}function eo(e,t,n,r,a,o){var i=function e(t,n,r,a,o,i){switch(t.type){case"condition":case"binaryOperator":case"if":case"assignment":case"parseError":case"attribute":return;case"vectorLiteral":var u=r.filter(function(e){return"vector"===e.type}).map(function(e){return e.elementType}).filter(function(e){return"elementOfEmptyVector"!==e.type});if(0===u.length)return;return{type:"vectorLiteral",entireLoc:(0,I.PS)(n),elements:t.elements.map(function(e,t){return eo(e,(0,M.AY)(n,t),u,a,o,i)})};case"objectLiteral":var l=new Set(t.properties.map(function(e){return H(e,1)[0]})),s=r.filter(function(e){return!("object"!==e.type||e.properties.size!==t.properties.length||Array.from(e.properties.keys()).some(function(e){return!l.has(e)}))});if(0===s.length)return;return{type:"objectLiteral",entireLoc:(0,I.PS)(n),properties:t.properties.map(function(e){var t=H(e,2),r=t[0];return[r,eo(t[1],(0,M.zt)(n,r),s.map(function(e){return e.properties.get(r)}),a,o,i)]})};case"do":var c,p={type:"statements",result:t.statements,entireLoc:t.entireLoc};return null!=(c=e(p,n,r,a,o,i))?c:o((0,j.Z2)(p),n,r);case"customNode":if(i)return(0,j.Fc)((0,j.Z2)(t,{simplify:!0}),n,r);return eo(t.expr,n,r,a,o,i);case"statements":if(1===t.result.length)return eo(t.result[0],n,r,a,o,i);return;case"expression":return eo(t.value,n,r,a,o,i);case"identifier":if(V(r,a).filter(function(e){return"variable"===e.type}).some(function(e){return e.name===t.name.node}))return{type:"identifier",name:{node:t.name.node,location:(0,I.PS)(n)}};return;case"constant":if(r.some(function(e){return e.type===t.value.node.type}))return{type:"constant",value:{node:t.value.node,location:(0,I.PS)(n)}};return;case"unaryOperator":if("-"===t.operator.node&&"constant"===t.expr.type&&"number"===t.expr.value.node.type&&r.some(function(e){return"number"===e.type}))return{type:"constant",value:{location:(0,I.PS)(n),node:{type:"number",value:-t.expr.value.node.value}}};return;case"call":var f=t.fn;if("identifier"!==f.type||!V(r,a).filter(function(e){return"function"===e.type}).some(function(e){return e.name===f.name.node}))return;var d=a.get(f.name.node);if(!d||"function"!==d.type.type)return;var y=d.type,m=t.args.filter(function(e){return"unnamed"===e.type});if(m.length!==y.posArgs.length)return;var v=t.args.filter(function(e){return"named"===e.type}),h=new Set(v.map(function(e){return e.name.node}));if(Object.entries(y.namedArgs).filter(function(e){return void 0===H(e,2)[1].defaultValue}).some(function(e){var t=H(e,1)[0];return!h.has(t)})||y.posArgs.some(function(e){return"concrete"!==e.type})||(m=m.map(function(e,t){return{type:"unnamed",value:eo(e.value,(0,M.ZM)(n,t),[y.posArgs[t].value],a,o,i)}}),Object.values(y.namedArgs).some(function(e){return"concrete"!==e.type.type})))return;return v=v.map(function(e){return{type:"named",name:e.name,value:eo(e.value,(0,M.EU)(n,e.name.node),[y.namedArgs[e.name.node].type.value],a,o,i)}}),{type:"call",fn:{type:"identifier",name:{node:f.name.node,location:(0,I.PS)(n)}},args:Y(m).concat(Y(v)),entireLoc:(0,I.PS)(n)}}}(e,t,n,r,a,o);return null!=i?i:a((0,j.Z2)(e),t,n)}function ei(e){var t=e.condition,n=e.setCondition,r=e.typeEnvironment,o=e.errors,i=e.blockIdent,u="customNode"===t.type;return a.createElement("div",{style:{margin:"0.5em 0"}},a.createElement(U.Ov,{name:"Filter?",checked:u,onChange:function(e){if(e){var r=(0,j.Z2)(t)||"true";n((0,j.Fc)(r,i,[{type:"vector",elementType:{type:"boolean"}}]))}else n({type:"identifier",name:{node:"true",location:(0,I.PS)(i)}})}}),u&&a.createElement(B,{uss:t,setUss:n,typeEnvironment:r,errors:o,blockIdent:i}))}function eu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function el(e){var t,n=e.preamble,r=e.setPreamble,o=e.typeEnvironment,i=e.errors,u=e.blockIdent,l=(t=(0,a.useState)(""!==n.originalCode.trim()),function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,u=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),o.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(u)throw r}}return o}}(t,2)||function(e,t){if(e){if("string"==typeof e)return eu(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eu(e,t)}}(t,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=l[0],c=l[1];return a.createElement("div",{style:{margin:"0.5em 0"}},a.createElement(U.Ov,{name:"Preamble",checked:s,onChange:function(e){r((0,j.Fc)("",u)),c(e)}}),s&&a.createElement(B,{uss:n,setUss:r,typeEnvironment:o,errors:i,blockIdent:u,placeholder:"Variables here can be used by all custom expressions."}))}function es(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ec(e){return function(e){if(Array.isArray(e))return es(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return es(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return es(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ep(e,t){var n=ec(e.map(O.x9));return void 0!==t&&n.push((0,I.PS)(t)),{type:"statements",result:e,entireLoc:O.LU.apply(void 0,ec(n))}}var ef=[{type:"opaque",name:"cMap",allowCustomExpression:!1},{type:"opaque",name:"pMap",allowCustomExpression:!1}],ed="".concat("r","p"),ey="".concat("r","c"),em="".concat("r","o");function ev(e){var t=e.uss,n=e.setUss,r=e.typeEnvironment,o=e.errors;return a.createElement("div",null,a.createElement(U.Ov,{name:"Enable custom script",checked:"customNode"===t.type,onChange:function(e){e?(x()("statements"===t.type,"USS should be statements when enabling custom script"),n((0,j.Fc)((0,j.Z2)(t,{simplify:!0}),"r"))):(x()("customNode"===t.type,"USS should not be a custom node when disabled"),n(eh(t.expr,r,!1)))},style:{margin:"0.5em 0"}}),"customNode"===t.type?a.createElement(B,{uss:t,setUss:n,typeEnvironment:r,errors:o,blockIdent:"r"}):a.createElement("div",null,a.createElement(el,{preamble:t.result[0].value,setPreamble:function(e){n(ep([{type:"expression",value:e},t.result[1]]))},typeEnvironment:r,errors:o,blockIdent:ed}),a.createElement(ei,{condition:t.result[1].condition,setCondition:function(e){var r={type:"condition",entireLoc:(0,O.x9)(e),condition:e,rest:t.result[1].rest};n(ep([t.result[0],r]))},typeEnvironment:r,errors:o,blockIdent:ey}),a.createElement(et,{uss:t.result[1].rest[0].value,setUss:function(e){var r={type:"condition",entireLoc:t.result[1].entireLoc,condition:t.result[1].condition,rest:[{type:"expression",value:e}]};n(ep([t.result[0],r]))},typeEnvironment:r,errors:o,blockIdent:em,type:ef,labelWidth:"0px"})),a.createElement(C.SA,{editor:!1,results:o.filter(function(e){return"multi"===e.location.start.block.type})}))}function eh(e,t,n){if("customNode"===e.type)return e;var r="statements"===e.type?e.result:[e],a={type:"statements",result:r.slice(0,-1),entireLoc:(0,O.x9)(e)},o=function(e){var t=void 0!==e?[e]:[];if((null==e?void 0:e.type)==="condition"){var n=(0,j.Z2)(e.condition,{simplify:!0});if("true"!==n.trim())return{conditionExpr:(0,j.Fc)(n,ey,[{type:"vector",elementType:{type:"boolean"}}]),conditionRest:e.rest};t=e.rest}return{conditionExpr:{type:"identifier",name:{node:"true",location:(0,I.PS)(ey)}},conditionRest:t}}(r.length>0?r[r.length-1]:void 0),i=o.conditionRest,u=o.conditionExpr,l=eo(ep(i,em),em,ef,t,j.Fc,n),s={type:"condition",entireLoc:(0,O.x9)(u),condition:u,rest:[{type:"expression",value:l}]};return{type:"statements",result:[{type:"expression",value:(0,j.Fc)((0,j.Z2)(a,{simplify:!0}),ed)},s],entireLoc:(0,O.x9)(e)}}function eb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function eg(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){var r;r=n[t],t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})}return e}function eS(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function eE(e){return function(e){if(Array.isArray(e))return eb(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return eb(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eb(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ew(e){var t=e.mapSettings,n=e.setMapSettings,r=e.errors,o=e.counts,i=t.script.uss,l=(0,a.useMemo)(function(){return new p.Z(void 0)},[]),y=(0,c.C5)(t,l.value,n,function(e){l.value=e},{undoChunking:f.k.shared.isTesting?2e3:1e3}),v=y.addState,h=y.updateCurrentSelection;(0,a.useEffect)(function(){var e=function(){h(l.value)};return l.observers.add(e),function(){l.observers.delete(e)}},[l,h]);var b=(0,a.useMemo)(function(){return(0,d.A)(t.universe)},[t.universe]),g=(0,a.useCallback)(function(e){return null!=e?e:""},[]),S=(0,a.useMemo)(function(){return[void 0].concat(eE(u.Z))},[]),E=(0,a.useMemo)(function(){return void 0===t.universe?void 0:[void 0].concat(eE((0,s.d)(o,t.universe)))},[t.universe,o]),k=function(e){n(e),v(e,l.value)};return a.createElement(A.Provider,{value:l},a.createElement("div",{style:m},"Universe"),a.createElement(w,{possibleValues:S,value:t.universe,renderValue:g,onChange:function(e){k(eS(eg({},t),{universe:e,geographyKind:void 0===e||void 0===t.geographyKind||(0,s.d)(o,e).includes(t.geographyKind)?t.geographyKind:void 0}))}}),E&&a.createElement(a.Fragment,null,a.createElement("div",{style:m},"Geography Kind"),a.createElement(w,{possibleValues:E,value:t.geographyKind,renderValue:g,onChange:function(e){k(eS(eg({},t),{geographyKind:e}))}})),a.createElement(ev,{uss:i,setUss:function(e){k(eS(eg({},t),{script:{uss:e}}))},typeEnvironment:b,errors:r}))}var eA=n(6381),ek=n(45437),ex=n(79779),eU=n(46347),eC=n(69851),eO=n(39517),eI=n(84635),ej=n(13736),eP=n(43166),eM=n(72082),eT=n(15198),eL=n(52904).Buffer;function eN(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function eB(e,t,n,r,a,o,i){try{var u=e[o](i),l=u.value}catch(e){n(e);return}u.done?t(l):Promise.resolve(l).then(r,a)}function eR(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function i(e){eB(o,r,a,i,u,"next",e)}function u(e){eB(o,r,a,i,u,"throw",e)}i(void 0)})}}function eD(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function eK(e){return(eK=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function eF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){eD(e,t,n[t])})}return e}function ez(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n})(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}function eV(e,t){return(eV=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function eG(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,u=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),!t||o.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(u)throw r}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return eN(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eN(e,t)}}(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(eZ=function(){return!!e})()}function e_(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(l){var s=[u,l];if(n)throw TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}}var eq=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(){var e,t,r;if(!(this instanceof n))throw TypeError("Cannot call a class as a function");return t=n,r=arguments,t=eK(t),eD(e=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,eZ()?Reflect.construct(t,r||[],eK(this).constructor):t.apply(this,r)),"shapes",void 0),eD(e,"shapeType",void 0),e}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&eV(n,e),t=[{key:"shouldHaveLoadingSpinner",value:function(){return!0}},{key:"getShapes",value:function(){if(this.shapes&&this.shapes.geographyKind===this.props.geographyKind&&this.shapes.universe===this.props.universe&&this.shapes.shapeType===this.shapeType)return this.shapes;var e=this.shapeType;return(0,b.h)(void 0!==e,"Shape type must be set before loading shapes"),this.shapes={geographyKind:this.props.geographyKind,universe:this.props.universe,shapeType:e,data:eR(function(){return e_(this,function(t){var n,r;return[2,(n=this.props.geographyKind,r=this.props.universe,eR(function(){var t,a;return e_(this,function(o){switch(o.label){case 0:switch(e){case"polygon":return[3,1];case"point":return[3,2]}return[3,5];case 1:return[2,eR(function(){var e,t,a,o,i;return e_(this,function(s){switch(s.label){case 0:return e=u.Z.indexOf(r),[4,(0,l.gi)((0,ek.UM)(n),"ConsolidatedShapes")];case 1:for(i=0,t=s.sent(),a=[],o=[];i<t.longnames.length;i++)t.universes[i].universeIdxs.includes(e)&&(a.push(t.longnames[i]),o.push(t.shapes[i]));return[2,{shapes:{type:"polygon",value:o},nameToIndex:new Map(a.map(function(e,t){return[e,t]}))}]}})})()];case 2:return t=(0,ek.Tw)(r,n),[4,(0,l.gi)(t,"ArticleOrderingList")];case 3:return a=o.sent(),[4,(0,eU.y7)(r,n,a.longnames)];case 4:return[2,{shapes:{type:"point",value:o.sent().map(function(e){return{lon:e.lon,lat:e.lat}})},nameToIndex:new Map(a.longnames.map(function(e,t){return[e,t]}))}];case 5:throw Error("Unknown shape type ".concat(e));case 6:return[2]}})})())]})}).call(this)},this.shapes}},{key:"loadShapes",value:function(e){return eR(function(){var t,n,r,a,o;return e_(this,function(i){switch(i.label){case 0:return[4,(t=this.getShapes()).data];case 1:switch(r=(n=i.sent()).nameToIndex,a=n.shapes,o=r.get(e),(0,b.h)(void 0!==o&&o>=0&&o<a.value.length,"Shape ".concat(e," not found in ").concat(t.geographyKind," for ").concat(t.universe)),a.type){case"polygon":return[2,{type:"polygon",value:a.value[o]}];case"point":return[2,{type:"point",value:a.value[o]}]}return[2]}})}).call(this)}},{key:"loadPolygon",value:function(e){return eR(function(){var t;return e_(this,function(n){switch(n.label){case 0:return[4,this.loadShapes(e)];case 1:return t=n.sent(),(0,b.h)("polygon"===t.type,"Shape ".concat(e," is not a polygon")),[2,t.value]}})}).call(this)}},{key:"loadPoint",value:function(e){return eR(function(){var t;return e_(this,function(n){switch(n.label){case 0:return[4,this.loadShapes(e)];case 1:return t=n.sent(),(0,b.h)("point"===t.type,"Shape ".concat(e," is not a point")),[2,t.value]}})}).call(this)}},{key:"computeShapesToRender",value:function(e){return eR(function(){var t,n,r,a,o,i,u,l,s,c,p,f,d,y,m;return e_(this,function(v){switch(v.label){case 0:if(t=this,void 0===(n=this.props.uss))return[2,{shapes:[],zoomIndex:-1}];return[4,(0,eI.W)({descriptor:{kind:"mapper",geographyKind:this.props.geographyKind,universe:this.props.universe},stmts:n})];case 1:if(r=v.sent(),e===this.version&&this.props.setErrors(r.error),void 0===r.resultingValue)return[2,{shapes:[],zoomIndex:-1}];return o=(a=r.resultingValue.value).value,i="pMap"===a.opaqueType?"point":"polygon",this.shapeType=i,"cMap"===a.opaqueType?u=a.value.outline:(s=a.value.maxRadius,l=a.value.relativeArea.map(function(e){return Math.sqrt(e)*s})),c=o.geo,p=o.ramp,d=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1].map((f=(0,eC._K)(o.scale)).inverse),this.props.rampCallback({ramp:p,interpolations:d,scale:f,label:o.label,unit:o.unit}),this.props.basemapCallback(o.basemap),this.props.insetsCallback(o.insets),y=o.data.map(function(e){return(0,ej.BM)(p,f.forward(e),t.props.colors.mapInvalidFillColor)}).map(function(e,t){switch(i){case"polygon":return{type:"polygon",style:{fillColor:e,fillOpacity:1,color:(0,P.XF)(u.color),weight:u.weight}};case"point":return{type:"point",style:{fillColor:e,fillOpacity:1,radius:l[t]}}}}),m=o.data.map(function(e){return{statistic:e}}),[2,{shapes:c.map(function(e,t){return{name:e,spec:y[t],meta:m[t]}}),zoomIndex:-1}]}})}).call(this)}},{key:"progressivelyLoadShapes",value:function(){return!1}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(n.prototype,t),n}(eM.J9);function eW(e){var t=(0,y.cI)();if(void 0===e.ramp)return a.createElement("div",null);var n=e.ramp.label,r=e.ramp.interpolations,o=e.ramp.unit,i="".concat(100/r.length,"%");return a.createElement("div",null,a.createElement("table",{style:{width:"100%",height:"100%"}},a.createElement("tbody",null,a.createElement("tr",null,r.map(function(n,r){return a.createElement("td",{key:r,style:{width:i,height:"1em",backgroundColor:(0,ej.BM)(e.ramp.ramp,e.ramp.scale.forward(n),t.mapInvalidFillColor)}})})),a.createElement("tr",null,r.map(function(e,t){return a.createElement("td",{key:t,style:{width:i,height:"1em"}},a.createElement("div",{className:"centered_text"},a.createElement(eT.$k,{statname:n,value:e,isUnit:!1,unit:o}),a.createElement(eT.$k,{statname:n,value:e,isUnit:!0,unit:o})))})))),a.createElement("div",{className:"centered_text"},n))}function eJ(e){var t=eG((0,a.useState)(void 0),2),n=t[0],r=t[1],o=eG((0,a.useState)({type:"osm"}),2),i=o[0],u=o[1],l=eG((0,a.useState)((0,eO.z)(e.universe)),2),s=l[0],c=l[1],p=(0,eP.h)(s);return a.createElement("div",{style:{display:"flex",flexDirection:"column"}},a.createElement("div",{style:{height:"90%",width:"100%"}},a.createElement(eq,{geographyKind:e.geographyKind,universe:e.universe,rampCallback:function(e){r(e)},basemapCallback:function(e){u(e)},insetsCallback:function(e){c(e)},ref:e.mapRef,uss:e.uss,height:{type:"aspect-ratio",value:p},attribution:"startVisible",basemap:i,setErrors:e.setErrors,colors:(0,y.cI)(),insets:s,key:JSON.stringify(s)})),a.createElement("div",{style:{height:"8%",width:"100%"},ref:e.colorbarRef},a.createElement(eW,{ramp:n})))}function e$(e,t,n){var r="string"==typeof t?new Blob([t],{type:n}):t,a=URL.createObjectURL(r),o=document.createElement("a");o.href=a,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function eH(e){var t=(0,y.cI)();return a.createElement("div",{style:{display:"flex",gap:"0.5em",margin:"0.5em 0"}},a.createElement("button",{onClick:function(){eR(function(){var n,r;return e_(this,function(a){switch(a.label){case 0:if(null===e.mapRef.current)return[2];return r=null!=(n=e.colorbarRef.current)?n:void 0,[4,e.mapRef.current.exportAsPng(r,t.background,t.mapInsetBorderColor)];case 1:return[4,fetch(a.sent())];case 2:return[4,a.sent().blob()];case 3:return e$("map.png",a.sent(),"image/png"),[2]}})})()}},"Export as PNG"),a.createElement("button",{onClick:function(){eR(function(){return e_(this,function(t){switch(t.label){case 0:if(null===e.mapRef.current)return[2];return[4,e.mapRef.current.exportAsGeoJSON()];case 1:return e$("map.geojson",t.sent(),"application/geo+json"),[2]}})})()}},"Export as GeoJSON"),a.createElement("button",{onClick:function(){var e=new URLSearchParams(window.location.search);e.set("view","true"),window.open("?".concat(e.toString()),"_blank")}},"View as Zoomable Page"))}function eY(e){var t=eG((0,a.useState)(e.mapSettings),2),n=t[0],o=t[1],i=eG((0,a.useState)(void 0),2),u=i[0],l=i[1],s=function(e){o(e);var t,n=(t=e.script,(0,O.qT)(t.uss)),r=(0,O.ZP)(n);r.length>0&&v(r.map(function(e){return ez(eF({},e),{kind:"error"})})),l(r.length>0?void 0:n)};(0,a.useEffect)(function(){s(e.mapSettings)},[e.mapSettings]);var c=(0,a.useRef)(null),p=(0,a.useRef)(null),f=JSON.stringify(ez(eF({},n),{script:{uss:(0,j.Z2)(n.script.uss)}})),d=(0,a.useContext)(eA.C.Context);(0,a.useEffect)(function(){if(e.mapSettings!==n){var t=(0,r.gzipSync)(f).toString("base64");d.setMapperSettings(t)}},[f,d]);var y=eG((0,a.useState)([]),2),m=y[0],v=y[1],h=function(){return void 0===n.geographyKind||void 0===n.universe?a.createElement(C.SA,{results:[{kind:"error",type:"error",value:"Select a Universe and Geography Kind",location:M.tU}],editor:!1}):a.createElement(eJ,{geographyKind:n.geographyKind,universe:n.universe,uss:u,mapRef:c,setErrors:v,colorbarRef:p})},b=(0,N.Kn)();return e.view?h():a.createElement(ex.P,null,a.createElement("div",null,a.createElement("div",{className:b},"Urban Stats Mapper (beta)"),a.createElement(ew,{mapSettings:n,setMapSettings:s,errors:m,counts:e.counts}),a.createElement(eH,{mapRef:c,colorbarRef:p}),h()))}function eQ(e){var t,n,a,l,s,p,f,y={};if(void 0!==e){var m,v=(0,r.gunzipSync)(eL.from(e,"base64")).toString(),h=o.z.object({geographyKind:o.z.optional(o.z.enum(i.Z)).catch(void 0),universe:o.z.optional(o.z.enum(u.Z)).catch(void 0),script:o.z.object({uss:o.z.string()})}).parse(JSON.parse(v)),b=(0,j.Qc)(h.script.uss);if("error"===b.type)throw Error(b.errors.map(function(e){return(0,c.l9)(eF({kind:"error"},e),!0)}).join(", "));y=ez(eF({},h),{script:{uss:"expression"===(m=b).type&&"customNode"===m.value.type?m.value:"statements"===m.type&&2===m.result.length&&"expression"===m.result[0].type&&"customNode"===m.result[0].value.type&&"condition"===m.result[1].type&&1===m.result[1].rest.length&&"expression"===m.result[1].rest[0].type?ez(eF({},m),{result:[ez(eF({},m.result[0]),{value:m.result[0].value}),ez(eF({},m.result[1]),{rest:[m.result[1].rest[0]]})]}):(0,j.Fc)((0,j.Z2)(m),"r")}})}return f=eh(null!=(a=null==(n=(t=y).script)?void 0:n.uss)?a:(0,j.Fc)("cMap(data=density_pw_1km, scale=linearScale(), ramp=rampUridis)","r",ef).expr,(0,d.A)(null!=(l=t.universe)?l:"USA"),!0),{geographyKind:null!=(s=t.geographyKind)?s:"Subnational Region",universe:null!=(p=t.universe)?p:"USA",script:{uss:f}}}},4050:function(e,t,n){n.d(t,{Z:()=>r});let r=["world","Africa","Asia","Europe","North America","Oceania","South America","Andorra","United Arab Emirates","Afghanistan","Antigua and Barbuda","Anguilla","Albania","Armenia","Angola","Argentina","Austria","Australia","Aruba","Azerbaijan","Bosnia and Herzegovina","Barbados","Bangladesh","Belgium","Burkina Faso","Bulgaria","Bahrain","Burundi","Benin","Bermuda","Brunei","Bolivia","Brazil","The Bahamas","Bhutan","Botswana","Belarus","Belize","Canada","Cocos (Keeling) Islands","Democratic Republic of the Congo","Central African Republic","Congo","Switzerland","Ivory Coast","Cook Islands","Chile","Cameroon","China","Colombia","Costa Rica","Cuba","Cape Verde","Christmas Island","Cyprus","Czech Republic","Germany","Djibouti","Denmark","Dominica","Dominican Republic","Algeria","Ecuador","Estonia","Egypt","Eritrea","Spain","Ethiopia","Finland","Fiji","Falkland Islands","Micronesia","Faroe Islands","France","Gabon","United Kingdom","Grenada","Georgia","Guernsey","Ghana","Gibraltar","Greenland","The Gambia","Guinea","Equatorial Guinea","Greece","Guatemala","Guinea-Bissau","Guyana","Honduras","Croatia","Haiti","Hungary","Indonesia","Ireland","Israel","Isle of Man","India","Iraq","Iran","Iceland","Italy","Jersey","Jamaica","Jordan","Japan","Kenya","Kyrgyzstan","Cambodia","Kiribati","Comoros","Saint Kitts and Nevis","North Korea","South Korea","Kuwait","Cayman Islands","Kazakhstan","Laos","Lebanon","Saint Lucia","Liechtenstein","Sri Lanka","Liberia","Lesotho","Lithuania","Luxembourg","Latvia","Libya","Morocco","Monaco","Moldova","Montenegro","Madagascar","Marshall Islands","North Macedonia","Mali","Myanmar","Mongolia","Mauritania","Montserrat","Malta","Mauritius","Maldives","Malawi","Mexico","Malaysia","Mozambique","Namibia","Niger","Norfolk Island","Nigeria","Nicaragua","Netherlands","Norway","Nepal","Nauru","Niue","New Zealand","Oman","Panama","Peru","Papua New Guinea","Philippines","Pakistan","Poland","Pitcairn Islands","State of Palestine","Portugal","Palau","Paraguay","Qatar","Romania","Serbia","Russia","Rwanda","Saudi Arabia","Solomon Islands","Seychelles","Sudan","Sweden","Singapore","Saint Helena, Ascension and Tristan da Cunha","Slovenia","Slovakia","Sierra Leone","San Marino","Senegal","Somalia","Suriname","South Sudan","S\xe3o Tom\xe9 and Pr\xedncipe","El Salvador","Syria","Eswatini","Turks and Caicos Islands","Chad","Togo","Thailand","Tajikistan","Tokelau","East Timor","Turkmenistan","Tunisia","Tonga","Turkey","Trinidad and Tobago","Tuvalu","Tanzania","Ukraine","Uganda","USA","Uruguay","Uzbekistan","Vatican City","Saint Vincent and the Grenadines","Venezuela","British Virgin Islands","Vietnam","Vanuatu","Samoa","Yemen","South Africa","Zambia","Zimbabwe","Alabama, USA","Alaska, USA","Arizona, USA","Arkansas, USA","California, USA","Colorado, USA","Connecticut, USA","Delaware, USA","Florida, USA","Georgia, USA","Hawaii, USA","Idaho, USA","Illinois, USA","Indiana, USA","Iowa, USA","Kansas, USA","Kentucky, USA","Louisiana, USA","Maine, USA","Maryland, USA","Massachusetts, USA","Michigan, USA","Minnesota, USA","Mississippi, USA","Missouri, USA","Montana, USA","Nebraska, USA","Nevada, USA","New Hampshire, USA","New Jersey, USA","New Mexico, USA","New York, USA","North Carolina, USA","North Dakota, USA","Ohio, USA","Oklahoma, USA","Oregon, USA","Pennsylvania, USA","Rhode Island, USA","South Carolina, USA","South Dakota, USA","Tennessee, USA","Texas, USA","Utah, USA","Vermont, USA","Virginia, USA","Washington, USA","West Virginia, USA","Wisconsin, USA","Wyoming, USA","American Samoa, USA","Guam, USA","Northern Mariana Islands, USA","Puerto Rico, USA","US Virgin Islands, USA","District of Columbia, USA","Alberta, Canada","British Columbia, Canada","Manitoba, Canada","New Brunswick, Canada","Newfoundland and Labrador, Canada","Northwest Territories, Canada","Nova Scotia, Canada","Nunavut, Canada","Ontario, Canada","Prince Edward Island, Canada","Quebec, Canada","Saskatchewan, Canada","Yukon, Canada"]},89147:function(e,t,n){n.d(t,{Z:()=>i});var r=n(72668);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");o(this,"_value",void 0),o(this,"observers",new Set),this._value=e}return e=[{key:"value",get:function(){return this._value},set:function(e){this._value=e,this.observers.forEach(function(e){e()})}},{key:"use",value:function(){var e,t=this,n=(e=(0,r.useState)(0),function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var o=[],i=!0,u=!1;try{for(a=a.call(e);!(i=(n=a.next()).done)&&(o.push(n.value),o.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(u)throw r}}return o}}(e,2)||function(e,t){if(e){if("string"==typeof e)return a(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}}(e,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[1];return(0,r.useEffect)(function(){var e=function(){n(function(e){return e+1})};return t.observers.add(e),function(){t.observers.delete(e)}},[]),this.value}}],function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,e),t}()}}]);
//# sourceMappingURL=77.js.map