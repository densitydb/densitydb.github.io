"use strict";(self.webpackChunkassets=self.webpackChunkassets||[]).push([["948"],{75842:function(e,t,r){r.d(t,{Uj:()=>j,lv:()=>P});var n=r(20110);function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t,r,n,o,i,s){try{var c=e[i](s),a=c.value}catch(e){r(e);return}c.done?t(a):Promise.resolve(a).then(n,o)}function s(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var s=e.apply(t,r);function c(e){i(s,n,o,c,a,"next",e)}function a(e){i(s,n,o,c,a,"throw",e)}c(void 0)})}}function c(e,t,r){return t=h(t),function(e,t){if(t&&("object"===b(t)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e,k()?Reflect.construct(t,r||[],h(e).constructor):t.apply(e,r))}function a(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function u(e,t,r){return(u=k()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&y(o,r.prototype),o}).apply(null,arguments)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),e}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){var n;n=r[t],t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n})}return e}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],s=!0,c=!1;try{for(o=o.call(e);!(s=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);s=!0);}catch(e){c=!0,n=e}finally{try{s||null==o.return||o.return()}finally{if(c)throw n}}return i}}(e,t)||g(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function g(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}}function w(e){var t="function"==typeof Map?new Map:void 0;return(w=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return u(e,arguments,h(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),y(r,e)})(e)}function k(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(k=function(){return!!e})()}function _(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=c(0),s.throw=c(1),s.return=c(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(c){return function(a){var u=[c,a];if(r)throw TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&u[0]?n.return:u[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,u[1])).done)return o;switch(n=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,n=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(6===u[0]&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(e,i)}catch(e){u=[6,e],n=0}finally{r=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}}var m=function(e){function t(e,r){var n;return a(this,t),(n=c(this,t,[e])).oauth2Code=r,n}return p(t,e),t}(w(Error)),O=function(e){function t(e,r,n,o){var i;return a(this,t),(i=c(this,t,[e,r])).httpCode=n.status,i.response=n,i.parsedBody=o,i}return p(t,e),t}(m),S=function(){function e(t){a(this,e),this.client=t}return f(e,[{key:"getAuthorizeUri",value:function(e){return s(function(){var t,r,n,o,i,c,a,u,l,f,h,p,d,y,b,g,w,k;return _(this,function(m){switch(m.label){case 0:var O;return[4,Promise.all([e.codeVerifier?(O=e.codeVerifier,s(function(){var e,t;return _(this,function(r){switch(r.label){case 0:return[4,T()];case 1:return e=r.sent(),t=["S256"],[4,e.subtle.digest("SHA-256",function(e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t}(O))];case 2:return[2,t.concat([E.apply(void 0,[r.sent()])])]}})})()):void 0,this.client.getEndpoint("authorizationEndpoint")])];case 1:if(r=(t=v.apply(void 0,[m.sent(),2]))[0],n=t[1],o=new URLSearchParams({client_id:this.client.settings.clientId,response_type:"code",redirect_uri:e.redirectUri}),i=!0,c=!1,a=void 0,r&&(o.set("code_challenge_method",r[0]),o.set("code_challenge",r[1])),e.state&&o.set("state",e.state),e.scope&&o.set("scope",e.scope.join(" ")),e.resource)try{for(u=[].concat(e.resource)[Symbol.iterator]();!(i=(l=u.next()).done);i=!0)f=l.value,o.append("resource",f)}catch(e){c=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(c)throw a}}if(h=!0,p=!1,d=void 0,e.responseMode&&"query"!==e.responseMode&&o.append("response_mode",e.responseMode),e.extraParams)try{for(y=Object.entries(e.extraParams)[Symbol.iterator]();!(h=(b=y.next()).done);h=!0){if(w=(g=v(b.value,2))[0],k=g[1],o.has(w))throw Error("Property in extraParams would overwrite standard property: ".concat(w));o.set(w,k)}}catch(e){p=!0,d=e}finally{try{h||null==y.return||y.return()}finally{if(p)throw d}}return[2,n+"?"+o.toString()]}})}).call(this)}},{key:"getTokenFromCodeRedirect",value:function(e,t){return s(function(){var r;return _(this,function(n){return r=this.validateResponse(e,{state:t.state}).code,[2,this.getToken({code:r,redirectUri:t.redirectUri,codeVerifier:t.codeVerifier})]})}).call(this)}},{key:"validateResponse",value:function(e,t){var r,n=(e=new URL(e)).searchParams;if(n.has("code")||n.has("error")||!(e.hash.length>0)||(n=new URLSearchParams(e.hash.slice(1))),n.has("error"))throw new m(null!=(r=n.get("error_description"))?r:"OAuth2 error",n.get("error"));if(!n.has("code"))throw Error("The url did not contain a code parameter ".concat(e));if(t.state&&t.state!==n.get("state"))throw Error('The "state" parameter in the url did not match the expected value of '.concat(t.state));return{code:n.get("code"),scope:n.has("scope")?n.get("scope").split(" "):void 0}}},{key:"getToken",value:function(e){return s(function(){var t;return _(this,function(r){return t={grant_type:"authorization_code",code:e.code,redirect_uri:e.redirectUri,code_verifier:e.codeVerifier,resource:e.resource},[2,this.client.tokenResponseToOAuth2Token(this.client.request("tokenEndpoint",t))]})}).call(this)}}]),e}();function j(){return s(function(){var e,t;return _(this,function(r){switch(r.label){case 0:return[4,T()];case 1:return e=r.sent(),t=new Uint8Array(32),[2,(e.getRandomValues(t),E(t))]}})})()}function T(){return s(function(){var e,t;return _(this,function(r){switch(r.label){case 0:if(("undefined"==typeof window?"undefined":b(window))<"u"&&window.crypto){if(!(null!=(e=window.crypto.subtle)&&e.digest))throw Error("The context/environment is not secure, and does not support the 'crypto.subtle' module. See: https://developer.mozilla.org/en-US/docs/Web/API/Crypto/subtle for details");return[2,window.crypto]}if(!(("undefined"==typeof self?"undefined":b(self))<"u"&&self.crypto))return[3,1];return t=self.crypto,[3,3];case 1:return[4,Promise.resolve().then(function(){return C})];case 2:t=r.sent().webcrypto,r.label=3;case 3:return[2,t]}})})()}function E(e){var t,r;return btoa((t=String).fromCharCode.apply(t,function(e){if(Array.isArray(e))return o(e)}(r=new Uint8Array(e))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||g(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}var P=function(){function e(t){a(this,e),this.serverMetadata=null,null!=t&&t.fetch||(t.fetch=fetch.bind(globalThis)),this.settings=t}return f(e,[{key:"refreshToken",value:function(e,t){return s(function(){var r,n;return _(this,function(o){switch(o.label){case 0:if(!e.refreshToken)throw Error("This token didn't have a refreshToken. It's not possible to refresh this");return r={grant_type:"refresh_token",refresh_token:e.refreshToken},this.settings.clientSecret||(r.client_id=this.settings.clientId),null!=t&&t.scope&&(r.scope=t.scope.join(" ")),null!=t&&t.resource&&(r.resource=t.resource),[4,this.tokenResponseToOAuth2Token(this.request("tokenEndpoint",r))];case 1:return[2,(!(n=o.sent()).refreshToken&&e.refreshToken&&(n.refreshToken=e.refreshToken),n)]}})}).call(this)}},{key:"clientCredentials",value:function(e){return s(function(){var t,r,n;return _(this,function(o){if(r=["client_id","client_secret","grant_type","scope"],null!=e&&e.extraParams&&Object.keys(e.extraParams).filter(function(e){return r.includes(e)}).length>0)throw Error("The following extraParams are disallowed: '".concat(r.join("', '"),"'"));if(n=d({grant_type:"client_credentials",scope:null==(t=null==e?void 0:e.scope)?void 0:t.join(" "),resource:null==e?void 0:e.resource},null==e?void 0:e.extraParams),!this.settings.clientSecret)throw Error("A clientSecret must be provided to use client_credentials");return[2,this.tokenResponseToOAuth2Token(this.request("tokenEndpoint",n))]})}).call(this)}},{key:"password",value:function(e){return s(function(){var t,r;return _(this,function(n){var o,i;return o=d({grant_type:"password"},e),i=i={scope:null==(t=e.scope)?void 0:t.join(" ")},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(i)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(i,e))}),r=o,[2,this.tokenResponseToOAuth2Token(this.request("tokenEndpoint",r))]})}).call(this)}},{key:"authorizationCode",get:function(){return new S(this)}},{key:"introspect",value:function(e){return s(function(){var t;return _(this,function(r){return t={token:e.accessToken,token_type_hint:"access_token"},[2,this.request("introspectionEndpoint",t)]})}).call(this)}},{key:"revoke",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"access_token";return s(function(){var r,n;return _(this,function(o){return r=e.accessToken,"refresh_token"===t&&(r=e.refreshToken),n={token:r,token_type_hint:t},[2,this.request("revocationEndpoint",n)]})}).call(this)}},{key:"getEndpoint",value:function(e){return s(function(){var t;return _(this,function(r){switch(r.label){case 0:if(void 0!==this.settings[e])return[2,A(this.settings[e],this.settings.server)];if(!(t="discoveryEndpoint"!==e))return[3,2];return[4,this.discover()];case 1:r.sent(),t=void 0!==this.settings[e],r.label=2;case 2:if(t)return[2,A(this.settings[e],this.settings.server)];if(!this.settings.server)throw Error("Could not determine the location of ".concat(e,". Either specify ").concat(e,' in the settings, or the "server" endpoint to let the client discover it.'));switch(e){case"authorizationEndpoint":return[2,A("/authorize",this.settings.server)];case"tokenEndpoint":return[2,A("/token",this.settings.server)];case"discoveryEndpoint":return[2,A("/.well-known/oauth-authorization-server",this.settings.server)];case"introspectionEndpoint":return[2,A("/introspect",this.settings.server)];case"revocationEndpoint":return[2,A("/revoke",this.settings.server)]}return[2]}})}).call(this)}},{key:"discover",value:function(){return void 0===this.discoveryPromise&&(this.discoveryPromise=this.doDiscover()),this.discoveryPromise}},{key:"doDiscover",value:function(){return s(function(){var e,t,r,o,i,s,c,a,u,l,f,h,p,d,y,b,g,w,k;return _(this,function(_){switch(_.label){case 0:return _.trys.push([0,2,,3]),[4,this.getEndpoint("discoveryEndpoint")];case 1:return t=_.sent(),[3,3];case 2:return _.sent(),n.warn('[oauth2] OAuth2 discovery endpoint could not be determined. Either specify the "server" or "discoveryEndpoint'),[2];case 3:return[4,this.settings.fetch(t,{headers:{Accept:"application/json"}})];case 4:if(!(r=_.sent()).ok)return[2];if(!(null!=(e=r.headers.get("Content-Type"))&&e.startsWith("application/json")))return n.warn("[oauth2] OAuth2 discovery endpoint was not a JSON response. Response is ignored"),[2];return o=this,[4,r.json()];case 5:if(o.serverMetadata=_.sent(),i=[["authorization_endpoint","authorizationEndpoint"],["token_endpoint","tokenEndpoint"],["introspection_endpoint","introspectionEndpoint"],["revocation_endpoint","revocationEndpoint"]],null!==this.serverMetadata){s=!0,c=!1,a=void 0;try{for(u=i[Symbol.iterator]();!(s=(l=u.next()).done);s=!0)h=(f=v(l.value,2))[0],p=f[1],this.serverMetadata[h]&&(this.settings[p]=A(this.serverMetadata[h],t))}catch(e){c=!0,a=e}finally{try{s||null==u.return||u.return()}finally{if(c)throw a}}if(this.serverMetadata.token_endpoint_auth_methods_supported&&!this.settings.authenticationMethod){d=!0,y=!1,b=void 0;try{for(g=this.serverMetadata.token_endpoint_auth_methods_supported[Symbol.iterator]();!(d=(w=g.next()).done);d=!0)if(k=w.value,"client_secret_basic"===k||"client_secret_post"===k){this.settings.authenticationMethod=k;break}}catch(e){y=!0,b=e}finally{try{d||null==g.return||g.return()}finally{if(y)throw b}}}}return[2]}})}).call(this)}},{key:"request",value:function(e,t){return s(function(){var r,n,o,i,s,c,a,u;return _(this,function(c){switch(c.label){case 0:return[4,this.getEndpoint(e)];case 1:switch(r=c.sent(),n={"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},o=this.settings.authenticationMethod,this.settings.clientSecret||(o="client_secret_post"),o||(o="client_secret_basic_interop"),o){case"client_secret_basic":n.Authorization="Basic "+btoa(x(this.settings.clientId)+":"+x(this.settings.clientSecret));break;case"client_secret_basic_interop":n.Authorization="Basic "+btoa(this.settings.clientId.replace(/:/g,"%3A")+":"+this.settings.clientSecret.replace(/:/g,"%3A"));break;case"client_secret_post":t.client_id=this.settings.clientId,this.settings.clientSecret&&(t.client_secret=this.settings.clientSecret);break;default:throw Error("Authentication method not yet supported:"+o+". Open a feature request if you want this!")}return[4,this.settings.fetch(r,{method:"POST",body:function(e){var t=new URLSearchParams,r=!0,n=!1,o=void 0,i=!0,s=!1,c=void 0;try{for(var a,u=Object.entries(e)[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var l=v(a.value,2),f=l[0],h=l[1];if(Array.isArray(h))try{for(var p,d=h[Symbol.iterator]();!(r=(p=d.next()).done);r=!0){var y=p.value;t.append(f,y)}}catch(e){n=!0,o=e}finally{try{r||null==d.return||d.return()}finally{if(n)throw o}}else void 0!==h&&t.set(f,h.toString())}}catch(e){s=!0,c=e}finally{try{i||null==u.return||u.return()}finally{if(s)throw c}}return t.toString()}(t),headers:n})];case 2:if(!(204!==(i=c.sent()).status&&i.headers.has("Content-Type")&&i.headers.get("Content-Type").match(/^application\/(.*\+)?json/)))return[3,4];return[4,i.json()];case 3:s=c.sent(),c.label=4;case 4:if(i.ok)return[2,s];throw null!=s&&s.error?(a="OAuth2 error "+s.error+".",s.error_description&&(a+=" "+s.error_description),u=s.error):(a="HTTP Error "+i.status+" "+i.statusText,401===i.status&&this.settings.clientSecret&&(a+=". It's likely that the clientId and/or clientSecret was incorrect"),u=null),new O(a,u,i,s)}})}).call(this)}},{key:"tokenResponseToOAuth2Token",value:function(e){return s(function(){var t,r,o,i,s,c,a,u;return _(this,function(l){switch(l.label){case 0:return[4,e];case 1:if(!(null!=(t=l.sent())&&t.access_token))throw n.warn("Invalid OAuth2 Token Response: ",t),TypeError("We received an invalid token response from an OAuth2 server.");return r=t.access_token,o=t.refresh_token,i=t.expires_in,s=t.id_token,c=t.scope,t.token_type,a=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(t,["access_token","refresh_token","expires_in","id_token","scope","token_type"]),u={accessToken:r,expiresAt:i?Date.now()+1e3*i:null,refreshToken:null!=o?o:null},[2,(s&&(u.idToken=s),c&&(u.scope=c.split(" ")),Object.keys(a).length>0&&(u.extraParams=a),u)]}})})()}}]),e}();function A(e,t){return new URL(e,t).toString()}function x(e){return encodeURIComponent(e).replace(/%20/g,"+").replace(/[-_.!~*'()]/g,function(e){return"%".concat(e.charCodeAt(0).toString(16).toUpperCase())})}var C=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}))}}]);
//# sourceMappingURL=948.js.map