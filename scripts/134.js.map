{"version":3,"file":"134.js","sources":["webpack://assets/./src/components/display-stats.tsx","webpack://assets/./src/components/unit-display.tsx","webpack://assets/./src/utils/coordinates.ts","webpack://assets/./src/mapper/components/Colorbar.tsx","webpack://assets/./src/mapper/components/InsetMap.tsx","webpack://assets/./src/mapper/map-generator.tsx","webpack://assets/./src/mapper/settings/ImportExportCode.tsx","webpack://assets/./src/mapper/style.ts","webpack://assets/./src/mapper/settings/MapperSettings.tsx","webpack://assets/./src/utils/array-edits.ts","webpack://assets/./src/mapper/settings/insets.ts","webpack://assets/./src/mapper/settings/EditMapperPanel.tsx","webpack://assets/./src/mapper/components/MapperPanel.tsx","webpack://assets/./src/utils/upload.ts"],"sourcesContent":["import React, { CSSProperties, ReactNode } from 'react'\n\nimport { useColors } from '../page_template/colors'\nimport { useSetting } from '../page_template/settings'\nimport { UnitType } from '../utils/unit'\n\nimport { classifyStatistic, getUnitDisplay } from './unit-display'\n\nexport function Statistic(props: { style?: React.CSSProperties, statname: string, value: number, isUnit: boolean, unit?: UnitType }): ReactNode {\n    const [useImperial] = useSetting('use_imperial')\n    const [temperatureUnit] = useSetting('temperature_unit')\n\n    const statisticType = props.unit ?? classifyStatistic(props.statname)\n    const unitDisplay = getUnitDisplay(statisticType)\n    const { value, unit } = unitDisplay.renderValue(props.value, useImperial, temperatureUnit)\n\n    return (\n        <span style={props.style}>\n            {props.isUnit ? unit : value}\n        </span>\n    )\n}\n\nexport function ElectionResult(props: { value: number }): ReactNode {\n    const colors = useColors()\n    // check if value is NaN\n    if (props.value !== props.value) {\n        return <span>N/A</span>\n    }\n    const value = Math.abs(props.value) * 100\n    const places = value > 10 ? 1 : value > 1 ? 2 : value > 0.1 ? 3 : 4\n    const text = value.toFixed(places)\n    const party = props.value > 0 ? 'D' : 'R'\n    const partyColor = props.value > 0 ? colors.hueColors.blue : colors.hueColors.red\n    const spanStyle: CSSProperties = {\n        color: partyColor,\n        // So that on 4 digits, we overflow left\n        display: 'flex',\n        justifyContent: 'flex-end',\n    }\n    return (\n        <span style={spanStyle}>\n            {party}\n            +\n            {text}\n        </span>\n    )\n}\n\nexport function Percentile(props: {\n    ordinal: number\n    total: number\n    percentileByPopulation: number\n    simpleOrdinals: boolean\n}): ReactNode {\n    const ordinal = props.ordinal\n    const total = props.total\n    if (ordinal > total) {\n        return <span></span>\n    }\n    // percentile as an integer\n    // used to be keyed by a setting, but now we always use percentile_by_population\n    const percentile = props.percentileByPopulation\n    // something like Xth percentile\n    let text = `${percentile}th percentile`\n    if (props.simpleOrdinals) {\n        text = `${percentile.toString()}%`\n    }\n    else if (percentile % 10 === 1 && percentile % 100 !== 11) {\n        text = `${percentile}st percentile`\n    }\n    else if (percentile % 10 === 2 && percentile % 100 !== 12) {\n        text = `${percentile}nd percentile`\n    }\n    else if (percentile % 10 === 3 && percentile % 100 !== 13) {\n        text = `${percentile}rd percentile`\n    }\n    return <div className=\"serif\" style={{ textAlign: 'right', marginRight: props.simpleOrdinals ? '5px' : undefined }}>{text}</div>\n}\n","import React, { ReactNode } from 'react'\n\nimport { separateNumber } from '../utils/text'\nimport { UnitType } from '../utils/unit'\n\nimport { ElectionResult } from './display-stats'\n\nexport interface UnitDisplay {\n    renderValue: (value: number, useImperial?: boolean, temperatureUnit?: string) => {\n        value: ReactNode\n        unit: ReactNode\n    }\n}\n\nexport function getUnitDisplay(unitType: UnitType): UnitDisplay {\n    switch (unitType) {\n        case 'percentage':\n            return {\n                renderValue: (value: number) => {\n                    return {\n                        value: <span>{(value * 100).toFixed(2)}</span>,\n                        unit: <span>%</span>,\n                    }\n                },\n            }\n        case 'fatalities':\n            return {\n                renderValue: (value: number) => {\n                    return {\n                        value: <span>{separateNumber(value.toFixed(0))}</span>,\n                        unit: <span>&nbsp;</span>,\n                    }\n                },\n            }\n        case 'fatalitiesPerCapita':\n            return {\n                renderValue: (value: number) => {\n                    return {\n                        value: <span>{(100_000 * value).toFixed(2)}</span>,\n                        unit: <span>/100k</span>,\n                    }\n                },\n            }\n        case 'density':\n            return {\n                renderValue: (value: number, useImperial?: boolean) => {\n                    let unitName = 'km'\n                    let adjustedValue = value\n                    if (useImperial) {\n                        unitName = 'mi'\n                        adjustedValue *= 1.60934 * 1.60934\n                    }\n                    let places = 2\n                    if (adjustedValue > 10) {\n                        places = 0\n                    }\n                    else if (adjustedValue > 1) {\n                        places = 1\n                    }\n                    return {\n                        value: <span>{separateNumber(adjustedValue.toFixed(places))}</span>,\n                        unit: (\n                            <span>\n                                /&nbsp;\n                                {unitName}\n                                <sup>2</sup>\n                            </span>\n                        ),\n                    }\n                },\n            }\n        case 'population':\n            return {\n                renderValue: (value: number) => {\n                    if (value > 1e9) {\n                        return {\n                            value: <span>{(value / 1e9).toPrecision(3)}</span>,\n                            unit: <span>B</span>,\n                        }\n                    }\n                    if (value > 1e6) {\n                        return {\n                            value: <span>{(value / 1e6).toPrecision(3)}</span>,\n                            unit: <span>m</span>,\n                        }\n                    }\n                    else if (value > 1e4) {\n                        return {\n                            value: <span>{(value / 1e3).toPrecision(3)}</span>,\n                            unit: <span>k</span>,\n                        }\n                    }\n                    else {\n                        return {\n                            value: <span>{separateNumber(value.toFixed(0))}</span>,\n                            unit: <span>&nbsp;</span>,\n                        }\n                    }\n                },\n            }\n        case 'area':\n            return {\n                renderValue: (value: number, useImperial?: boolean) => {\n                    let adjustedValue = value\n                    let unit: React.ReactElement\n                    if (useImperial) {\n                        adjustedValue /= 1.60934 * 1.60934\n                        if (adjustedValue < 1) {\n                            unit = <span>acres</span>\n                            adjustedValue *= 640\n                        }\n                        else {\n                            unit = (\n                                <span>\n                                    mi\n                                    <sup>2</sup>\n                                </span>\n                            )\n                        }\n                    }\n                    else {\n                        if (adjustedValue < 0.01) {\n                            adjustedValue *= 1000 * 1000\n                            unit = (\n                                <span>\n                                    m\n                                    <sup>2</sup>\n                                </span>\n                            )\n                        }\n                        else {\n                            unit = (\n                                <span>\n                                    km\n                                    <sup>2</sup>\n                                </span>\n                            )\n                        }\n                    }\n                    let places = 3\n                    if (adjustedValue > 100) {\n                        places = 0\n                    }\n                    else if (adjustedValue > 10) {\n                        places = 1\n                    }\n                    else if (adjustedValue > 1) {\n                        places = 2\n                    }\n                    let rendered = adjustedValue.toFixed(places)\n                    if (places === 0) {\n                        rendered = separateNumber(rendered)\n                    }\n                    return {\n                        value: <span>{rendered}</span>,\n                        unit,\n                    }\n                },\n            }\n        case 'distanceInKm':\n            return {\n                renderValue: (value: number, useImperial?: boolean) => {\n                    let unit = <span>km</span>\n                    let adjustedValue = value\n                    if (useImperial) {\n                        unit = <span>mi</span>\n                        adjustedValue /= 1.60934\n                    }\n                    return {\n                        value: <span>{adjustedValue.toFixed(2)}</span>,\n                        unit,\n                    }\n                },\n            }\n        case 'distanceInM':\n            return {\n                renderValue: (value: number, useImperial?: boolean) => {\n                    let unitName = 'm'\n                    let adjustedValue = value\n                    if (useImperial) {\n                        unitName = 'ft'\n                        adjustedValue *= 3.28084\n                    }\n                    return {\n                        value: <span>{separateNumber(adjustedValue.toFixed(0))}</span>,\n                        unit: <span>{unitName}</span>,\n                    }\n                },\n            }\n        case 'democraticMargin':\n            return {\n                renderValue: (value: number) => {\n                    return {\n                        value: <ElectionResult value={value} />,\n                        unit: <span>%</span>,\n                    }\n                },\n            }\n        case 'temperature':\n            return {\n                renderValue: (value: number, useImperial?: boolean, temperatureUnit?: string) => {\n                    let unit = <span>&deg;F</span>\n                    let adjustedValue = value\n                    if (temperatureUnit === 'celsius') {\n                        unit = <span>&deg;C</span>\n                        adjustedValue = (value - 32) * (5 / 9)\n                    }\n                    return {\n                        value: <span>{adjustedValue.toFixed(1)}</span>,\n                        unit,\n                    }\n                },\n            }\n        case 'time':\n            return {\n                renderValue: (value: number) => {\n                    const hours = Math.floor(value)\n                    const minutes = Math.floor((value - hours) * 60)\n                    return {\n                        value: (\n                            <span>\n                                {hours}\n                                :\n                                {minutes.toString().padStart(2, '0')}\n                            </span>\n                        ),\n                        unit: <span>&nbsp;</span>,\n                    }\n                },\n            }\n        case 'distancePerYear':\n            return {\n                renderValue: (value: number, useImperial?: boolean) => {\n                    let adjustedValue = value * 100\n                    let unit = 'cm'\n                    if (useImperial) {\n                        unit = 'in'\n                        adjustedValue /= 2.54\n                    }\n                    return {\n                        value: <span>{adjustedValue.toFixed(1)}</span>,\n                        unit: (\n                            <span>\n                                {unit}\n                                /yr\n                            </span>\n                        ),\n                    }\n                },\n            }\n        case 'contaminantLevel':\n            return {\n                renderValue: (value: number) => {\n                    return {\n                        value: <span>{value.toFixed(2)}</span>,\n                        unit: (\n                            <span>\n                                &mu;g/m\n                                <sup>3</sup>\n                            </span>\n                        ),\n                    }\n                },\n            }\n        case 'number':\n            return {\n                renderValue: (value: number) => {\n                    return {\n                        value: <span>{value.toFixed(3)}</span>,\n                        unit: <span>&nbsp;</span>,\n                    }\n                },\n            }\n        case 'usd':\n            return {\n                renderValue: (value: number) => {\n                    if (value > 1e9) {\n                        return {\n                            value: (\n                                <span>\n                                    $\n                                    {(value / 1e9).toPrecision(3)}\n                                </span>\n                            ),\n                            unit: <span>B</span>,\n                        }\n                    }\n                    if (value > 1e6) {\n                        return {\n                            value: (\n                                <span>\n                                    $\n                                    {(value / 1e6).toPrecision(3)}\n                                </span>\n                            ),\n                            unit: <span>m</span>,\n                        }\n                    }\n                    else if (value > 1e3) {\n                        return {\n                            value: (\n                                <span>\n                                    $\n                                    {(value / 1e3).toPrecision(3)}\n                                </span>\n                            ),\n                            unit: <span>k</span>,\n                        }\n                    }\n                    else {\n                        return {\n                            value: (\n                                <span>\n                                    $\n                                    {separateNumber(value.toFixed(0))}\n                                </span>\n                            ),\n                            unit: <span>&nbsp;</span>,\n                        }\n                    }\n                },\n            }\n        case 'minutes':\n            return {\n                renderValue: (value: number) => {\n                    const hours = Math.floor(value / 60)\n                    const minutes = Math.floor(value % 60)\n\n                    if (hours > 0) {\n                        return {\n                            value: (\n                                <span>\n                                    {hours}\n                                    :\n                                    {minutes.toString().padStart(2, '0')}\n                                </span>\n                            ),\n                            unit: <span>&nbsp;</span>,\n                        }\n                    }\n                    else {\n                        return {\n                            value: <span>{minutes}</span>,\n                            unit: <span>&nbsp;</span>,\n                        }\n                    }\n                },\n            }\n    }\n}\n\nexport function classifyStatistic(statname: string): UnitType {\n    if (statname.includes('%') || statname.includes('Change') || statname.includes('(Grade)')) {\n        return 'percentage'\n    }\n    if (statname.includes('Total') && statname.includes('Fatalities')) {\n        return 'fatalities'\n    }\n    if (statname.includes('Fatalities Per Capita')) {\n        return 'fatalitiesPerCapita'\n    }\n    if (statname.includes('Density')) {\n        return 'density'\n    }\n    if (statname.includes('Elevation')) {\n        return 'distanceInM'\n    }\n    if (statname.startsWith('Population')) {\n        return 'population'\n    }\n    if (statname === 'Area') {\n        return 'area'\n    }\n    if (statname.includes('Mean distance')) {\n        return 'distanceInKm'\n    }\n    if (statname.includes('Election') || statname.includes('Swing')) {\n        return 'democraticMargin'\n    }\n    if (statname.includes('high temp') || statname.includes('low temp') || statname.includes('high heat index') || statname.includes('dewpt')) {\n        return 'temperature'\n    }\n    if (statname === 'Mean sunny hours') {\n        return 'time'\n    }\n    if (statname === 'Rainfall' || statname === 'Snowfall [rain-equivalent]') {\n        return 'distancePerYear'\n    }\n    if (statname.includes('Pollution')) {\n        return 'contaminantLevel'\n    }\n    if (statname.includes('(USD)')) {\n        return 'usd'\n    }\n    if (statname.includes('(min)')) {\n        return 'minutes'\n    }\n    return 'number'\n}\n","import { Inset } from '../urban-stats-script/constants/insets'\n\nimport { assert } from './defensive'\n\n// Web Mercator projection functions\nfunction lngToWebMercatorX(lng: number): number {\n    return lng * Math.PI / 180 * 6378137\n}\n\nfunction latToWebMercatorY(lat: number): number {\n    return 6378137 * Math.log(Math.tan(Math.PI / 4 + lat * Math.PI / 360))\n}\n\nexport function computeAspectRatio(coordBox: [number, number, number, number]): number {\n    // coordBox is [west, south, east, north]\n    const x1 = lngToWebMercatorX(coordBox[0])\n    const x2 = lngToWebMercatorX(coordBox[2])\n    const y1 = latToWebMercatorY(coordBox[1])\n    const y2 = latToWebMercatorY(coordBox[3])\n\n    const width = Math.abs(x2 - x1)\n    const height = Math.abs(y2 - y1)\n\n    return width / height\n}\n\nfunction area(coordBox: [number, number, number, number]): number {\n    // coordBox is [west, south, east, north]\n    const x1 = lngToWebMercatorX(coordBox[0])\n    const x2 = lngToWebMercatorX(coordBox[2])\n    const y1 = latToWebMercatorY(coordBox[1])\n    const y2 = latToWebMercatorY(coordBox[3])\n\n    return Math.abs((x2 - x1) * (y2 - y1))\n}\n\nexport function computeAspectRatioForInsets(mapsWithCoordBox: Inset[]): number {\n    assert(mapsWithCoordBox.length > 0, 'No insets with coordBox')\n\n    const biggestMap = mapsWithCoordBox.reduce((prev, curr) => {\n        return area(curr.coordBox) > area(prev.coordBox) ? curr : prev\n    })\n    const coordBox = biggestMap.coordBox\n    const onScreenWidth = biggestMap.topRight[0] - biggestMap.bottomLeft[0]\n    const onScreenHeight = biggestMap.topRight[1] - biggestMap.bottomLeft[1]\n    const onScreenAspectRatio = onScreenWidth / onScreenHeight\n    return computeAspectRatio(coordBox) / onScreenAspectRatio\n}\n","import React, { ReactNode, useLayoutEffect, useMemo, useRef, useState } from 'react'\n\nimport { Statistic } from '../../components/display-stats'\nimport { useColors } from '../../page_template/colors'\nimport { ScaleInstance } from '../../urban-stats-script/constants/scale'\nimport { furthestColor, interpolateColor } from '../../utils/color'\nimport { UnitType } from '../../utils/unit'\nimport { Keypoints } from '../ramps'\nimport { Basemap } from '../settings/utils'\n\ninterface EmpiricalRamp {\n    ramp: Keypoints\n    scale: ScaleInstance\n    interpolations: number[]\n    label: string\n    unit?: UnitType\n}\n\nexport type RampToDisplay = { type: 'ramp', value: EmpiricalRamp } | { type: 'label', value: string }\n\nexport function Colorbar(props: { ramp: RampToDisplay | undefined, basemap: Basemap }): ReactNode {\n    const colors = useColors()\n\n    return (\n        <div style={{\n            width: '100%',\n            ...(props.basemap.type === 'none'\n                ? { backgroundColor: props.basemap.backgroundColor, color: props.basemap.textColor }\n                : { backgroundColor: colors.background }),\n            padding: '10px',\n        }}\n        >\n            {props.ramp && props.ramp.type === 'label' && (\n                <div className=\"centered_text user_input\">\n                    {props.ramp.value}\n                </div>\n            )}\n            {props.ramp && props.ramp.type === 'ramp' && (\n                <RampColorbar ramp={props.ramp.value} />\n            )}\n        </div>\n    )\n}\n\nfunction RampColorbar({ ramp }: { ramp: EmpiricalRamp }): ReactNode {\n    // do this as a table with 10 columns, each 10% wide and\n    // 2 rows. Top one is the colorbar, bottom one is the\n    // labels.\n    const valuesRef = useRef<HTMLDivElement>(null)\n\n    const [shouldRotate, setShouldRotate] = useState(false)\n\n    useLayoutEffect(() => {\n        const values = valuesRef.current\n        if (values === null) {\n            return\n        }\n        const updateShouldRotate = (): void => {\n            setShouldRotate(\n                Array.from(values.querySelectorAll('.containerOfXticks')).some((container) => {\n                    const contained: HTMLDivElement | null = container.querySelector('.containedOfXticks')\n                    return contained !== null && contained.offsetWidth > (container as HTMLDivElement).offsetWidth * 0.9\n                }),\n            )\n        }\n        updateShouldRotate()\n        const resizeObserver = new ResizeObserver(updateShouldRotate)\n        resizeObserver.observe(values)\n        return () => {\n            resizeObserver.unobserve(values)\n        }\n    }, [ramp])\n\n    const furthest = useMemo(() => furthestColor(ramp.ramp.map(x => x[1])), [ramp])\n\n    const createValue = (stat: number): ReactNode => {\n        return (\n            <div className=\"centered_text\">\n                <Statistic\n                    statname={ramp.label}\n                    value={stat}\n                    isUnit={false}\n                    unit={ramp.unit}\n                />\n                <Statistic\n                    statname={ramp.label}\n                    value={stat}\n                    isUnit={true}\n                    unit={ramp.unit}\n                />\n            </div>\n        )\n    }\n\n    const width = `${100 / ramp.interpolations.length}%`\n\n    const valuesDivs = (rotate: boolean): ReactNode[] => ramp.interpolations.map((x, i) => (\n        <div\n            key={i}\n            style={{\n                width,\n                // height: rotate ? '2em' : '1em',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n            }}\n            className=\"containerOfXticks\"\n        >\n            <div\n                style={{\n                    // transform: rotate ? 'rotate(-45deg)' : 'none',\n                    writingMode: rotate ? 'sideways-lr' : 'horizontal-tb',\n                    padding: rotate ? '0.5em' : '0',\n                    // transformOrigin: 'center',\n                    // whiteSpace: 'nowrap',\n                    // fontSize: rotate ? '0.8em' : '1em',\n                }}\n                className=\"containedOfXticks\"\n            >\n                {createValue(x)}\n            </div>\n        </div>\n    ))\n\n    return (\n        <div style={{ position: 'relative' }}>\n            <div style={{ display: 'flex', width: '100%' }}>\n                {\n                    ramp.interpolations.map((x, i) => (\n                        <div\n                            key={i}\n                            style={{\n                                width, height: '1em',\n                                backgroundColor: interpolateColor(ramp.ramp, ramp.scale.forward(x), furthest),\n                                marginLeft: '1px',\n                                marginRight: '1px',\n                            }}\n                        >\n                        </div>\n                    ))\n                }\n            </div>\n            <div ref={valuesRef} style={{ position: 'absolute', top: 0, left: 0, display: 'flex', width: '100%', visibility: 'hidden' }}>{valuesDivs(false)}</div>\n            <div style={{ display: 'flex', width: '100%' }}>{valuesDivs(shouldRotate)}</div>\n            <div className=\"centered_text user_input\">\n                {ramp.label}\n            </div>\n        </div>\n    )\n}\n","import React, { HTMLAttributes, ReactNode, RefObject, useEffect, useRef, useState } from 'react'\nimport { MapRef, useMap } from 'react-map-gl/maplibre'\n\nimport { CommonMaplibreMap, CustomAttributionControlComponent, insetBorderWidth } from '../../components/map-common'\nimport { defaultMapBorderRadius, mapBorderWidth, useScreenshotMode } from '../../components/screenshot'\nimport { useColors } from '../../page_template/colors'\nimport { Inset } from '../../urban-stats-script/constants/insets'\nimport { TestUtils } from '../../utils/TestUtils'\n\n// eslint-disable-next-line no-restricted-syntax -- Forward Ref\nfunction _InsetMap({ inset, children, editInset, container, i, numInsets }: {\n    inset: Inset\n    children: ReactNode\n    container: RefObject<HTMLDivElement>\n    editInset?: {\n        modify: (newInset: Partial<Inset>) => void\n        duplicate: () => void\n        delete: () => void\n        add: () => void\n        moveUp: () => void\n        moveDown: () => void\n    }\n    i: number\n    numInsets: number\n}, ref: React.Ref<MapRef>): ReactNode {\n    const colors = useColors()\n\n    const id = `map-${i}`\n\n    const screenshotMode = useScreenshotMode()\n\n    return (\n        <div\n            id={id}\n            style={{ position: 'absolute',\n                left: `${inset.bottomLeft[0] * 100}%`,\n                bottom: `${inset.bottomLeft[1] * 100}%`,\n                width: `${(inset.topRight[0] - inset.bottomLeft[0]) * 100}%`,\n                height: `${(inset.topRight[1] - inset.bottomLeft[1]) * 100}%` }}\n        >\n            <CommonMaplibreMap\n                ref={ref}\n                style={{\n                    position: 'absolute',\n                    inset: 0,\n                    border: !inset.mainMap ? `${insetBorderWidth}px solid ${colors.mapInsetBorderColor}` : `${mapBorderWidth}px solid ${colors.borderNonShadow}`,\n                    borderRadius: !inset.mainMap || screenshotMode ? '0px' : `${defaultMapBorderRadius}px`,\n                    width: undefined,\n                    height: undefined,\n                }}\n                attributionControl={false}\n            >\n                {children}\n                <HandleInsets\n                    inset={inset}\n                    setCoordBox={(newBox) => {\n                        editInset?.modify({ coordBox: newBox })\n                    }}\n                />\n                <ExposeMapForTesting id={id} />\n                { inset.mainMap && <CustomAttributionControlComponent startShowingAttribution={true} />}\n            </CommonMaplibreMap>\n            { editInset && (\n                <EditInsetsHandles\n                    frame={[...inset.bottomLeft, ...inset.topRight]}\n                    setFrame={(newFrame) => {\n                        editInset.modify({ bottomLeft: [newFrame[0], newFrame[1]], topRight: [newFrame[2], newFrame[3]] })\n                    }}\n                    container={container}\n                    delete={inset.mainMap ? undefined : editInset.delete}\n                    duplicate={inset.mainMap ? undefined : editInset.duplicate}\n                    add={inset.mainMap ? editInset.add : undefined}\n                    shouldHaveCenterHandle={!inset.mainMap || !isFullScreenInset(inset)}\n                    /*\n                    Allowing reordering on the main map in case you want to put its corner in front of an inset or something\n                    it also eliminates the weird edge case where the main map is not the 0th inset\n                    */\n                    moveUp={i + 1 < numInsets ? () => { editInset.moveUp() } : undefined}\n                    moveDown={i > 0 ? () => { editInset.moveDown() } : undefined}\n                />\n            )}\n        </div>\n    )\n}\n\n// eslint-disable-next-line no-restricted-syntax -- Forward Ref\nexport const InsetMap = React.forwardRef(_InsetMap)\n\nfunction HandleInsets({ inset, setCoordBox }: { inset: Inset, setCoordBox: (newBox: Frame) => void }): ReactNode {\n    const map = useMap().current!\n\n    useEffect(() => {\n        const fit = (): void => {\n            map.fitBounds(inset.coordBox, { animate: false })\n        }\n        fit()\n        map.on('resize', fit)\n        return () => {\n            map.off('resize', fit)\n        }\n    }, [inset, map])\n\n    useEffect(() => {\n        const getCoordBox = (): [number, number, number, number] => {\n            const mapBounds = map.getBounds()\n            const sw = mapBounds.getSouthWest()\n            const ne = mapBounds.getNorthEast()\n            return [sw.lng, sw.lat, ne.lng, ne.lat]\n        }\n\n        const moveHandler = (e: maplibregl.MapLibreEvent): void => {\n            if (e.originalEvent === undefined) {\n                // Not a user event\n                return\n            }\n            setCoordBox(getCoordBox())\n        }\n\n        map.on('moveend', moveHandler)\n\n        return () => {\n            map.off('moveend', moveHandler)\n        }\n    }, [map, setCoordBox])\n\n    return null\n}\n\nfunction ExposeMapForTesting({ id }: { id: string }): ReactNode {\n    const map = useMap().current!.getMap()\n    TestUtils.shared.maps.set(id, new WeakRef(map))\n    return null\n}\n\ntype DragKind = 'move' | `${'top' | 'bottom'}${'Right' | 'Left'}`\n\ntype Frame = [number, number, number, number]\n\nfunction isFullScreenInset(inset: Inset): boolean {\n    const tolerance = 0.005\n    return Math.abs(inset.bottomLeft[0] - 0) < tolerance\n        && Math.abs(inset.bottomLeft[1] - 0) < tolerance\n        && Math.abs(inset.topRight[0] - 1) < tolerance\n        && Math.abs(inset.topRight[1] - 1) < tolerance\n}\n\nfunction EditInsetsHandles(props: {\n    frame: Frame\n    setFrame: (newFrame: Frame) => void\n    container: RefObject<HTMLDivElement>\n    delete?: () => void\n    duplicate?: () => void\n    add?: () => void\n    moveUp?: () => void\n    moveDown?: () => void\n    shouldHaveCenterHandle: boolean\n}): ReactNode {\n    const activeDrag = useRef<{ kind: DragKind, startX: number, startY: number, startFrame: Frame, pointerId: number } | undefined>(undefined)\n\n    const pointerHandlers = (kind: DragKind): {\n        'onPointerDown': (e: React.PointerEvent) => void\n        'onPointerMove': (e: React.PointerEvent) => void\n        'onPointerUp': (e: React.PointerEvent) => void\n        'onPointerCancel': (e: React.PointerEvent) => void\n        'data-test': string\n    } => ({\n        'data-test': kind,\n        'onPointerDown': (e: React.PointerEvent) => {\n            if (activeDrag.current !== undefined) {\n                return\n            }\n            const thisElem = e.target as HTMLDivElement\n            activeDrag.current = {\n                kind,\n                startX: e.clientX,\n                startY: e.clientY,\n                startFrame: props.frame,\n                pointerId: e.pointerId,\n            }\n            thisElem.setPointerCapture(e.pointerId)\n        },\n        'onPointerMove': (e: React.PointerEvent) => {\n            if (activeDrag.current?.pointerId !== e.pointerId) {\n                return\n            }\n            const drag = activeDrag.current\n            const containerBounds = props.container.current!.getBoundingClientRect()\n            const rawMovementX = (e.clientX - drag.startX) / containerBounds.width\n            const rawMovementY = -(e.clientY - drag.startY) / containerBounds.height\n            const resizedFrame: Frame = [\n                Math.max(0, Math.min(drag.startFrame[0] + rawMovementX, drag.startFrame[2] - 0.05)),\n                Math.max(0, Math.min(drag.startFrame[1] + rawMovementY, drag.startFrame[3] - 0.1)),\n                Math.max(drag.startFrame[0] + 0.05, Math.min(drag.startFrame[2] + rawMovementX, 1)),\n                Math.max(drag.startFrame[1] + 0.1, Math.min(drag.startFrame[3] + rawMovementY, 1)),\n            ]\n            let newFrame: Frame\n            switch (drag.kind) {\n                case 'move':\n                    const movementX = Math.max(0 - drag.startFrame[0], Math.min(rawMovementX, 1 - drag.startFrame[2]))\n                    const movementY = Math.max(0 - drag.startFrame[1], Math.min(rawMovementY, 1 - drag.startFrame[3]))\n                    newFrame = [drag.startFrame[0] + movementX, drag.startFrame[1] + movementY, drag.startFrame[2] + movementX, drag.startFrame[3] + movementY]\n                    break\n                case 'topRight':\n                    newFrame = [drag.startFrame[0], drag.startFrame[1], resizedFrame[2], resizedFrame[3]]\n                    break\n                case 'bottomRight':\n                    newFrame = [drag.startFrame[0], resizedFrame[1], resizedFrame[2], drag.startFrame[3]]\n                    break\n                case 'bottomLeft':\n                    newFrame = [resizedFrame[0], resizedFrame[1], drag.startFrame[2], drag.startFrame[3]]\n                    break\n                case 'topLeft':\n                    newFrame = [resizedFrame[0], drag.startFrame[1], drag.startFrame[2], resizedFrame[3]]\n                    break\n            }\n            props.setFrame(newFrame)\n        },\n        'onPointerUp': (e: React.PointerEvent) => {\n            if (activeDrag.current?.pointerId !== e.pointerId) {\n                return\n            }\n            activeDrag.current = undefined\n        },\n        'onPointerCancel': (e: React.PointerEvent) => {\n            if (activeDrag.current?.pointerId !== e.pointerId) {\n                return\n            }\n            activeDrag.current = undefined\n        },\n    })\n\n    return (\n        <>\n            <Handle handleSize={15} style={{ right: `-${insetBorderWidth}px`, top: `-${insetBorderWidth}px`, cursor: 'nesw-resize' }} {...pointerHandlers('topRight')} />\n            <Handle handleSize={15} style={{ right: `-${insetBorderWidth}px`, bottom: `-${insetBorderWidth}px`, cursor: 'nwse-resize' }} {...pointerHandlers('bottomRight')} />\n            <Handle handleSize={15} style={{ left: `-${insetBorderWidth}px`, bottom: `-${insetBorderWidth}px`, cursor: 'nesw-resize' }} {...pointerHandlers('bottomLeft')} />\n            <Handle handleSize={15} style={{ left: `-${insetBorderWidth}px`, top: `-${insetBorderWidth}px`, cursor: 'nwse-resize' }} {...pointerHandlers('topLeft')} />\n            {props.shouldHaveCenterHandle && (\n                <Handle handleSize={20} style={{ margin: 'auto', left: `calc(50% - 10px)`, top: `calc(50% - 10px)`, cursor: 'move' }} {...pointerHandlers('move')} />\n            )}\n            {props.duplicate && (\n                <Handle handleSize={25} data-test=\"duplicate\" style={{ margin: 'auto', left: `calc(66% - 12.5px)`, textAlign: 'center', lineHeight: '25px', top: -insetBorderWidth, cursor: 'copy' }} onClick={props.duplicate} img={{ src: '/duplicate.png', alt: 'Duplicate' }} />\n            )}\n            {props.delete && (\n                <Handle handleSize={25} data-test=\"delete\" style={{ margin: 'auto', left: `calc(33% - 12.5px)`, textAlign: 'center', lineHeight: '25px', top: -insetBorderWidth, cursor: 'default' }} onClick={props.delete} img={{ src: '/close-red-small.png', alt: 'Delete' }} />\n            )}\n            {props.add && (\n                <Handle handleSize={25} data-test=\"add\" style={{ margin: 'auto', left: `calc(50% - 12.5px)`, textAlign: 'center', top: -insetBorderWidth, cursor: 'default' }} onClick={props.add} img={{ src: '/add-green-small.png', alt: 'Add' }} />\n            )}\n            {props.moveUp && (\n                <Handle handleSize={25} data-test=\"moveUp\" style={{ left: `-${insetBorderWidth}px`, textAlign: 'center', top: `calc(50% - 25px)`, cursor: 'default' }} onClick={props.moveUp} img={{ src: '/sort-up.png', alt: 'Move Up' }} />\n            )}\n            {props.moveDown && (\n                <Handle handleSize={25} data-test=\"moveDown\" style={{ left: `-${insetBorderWidth}px`, textAlign: 'center', top: `calc(50%)`, cursor: 'default' }} onClick={props.moveDown} img={{ src: '/sort-down.png', alt: 'Move Down' }} />\n            )}\n        </>\n    )\n}\n\nfunction Handle({ handleSize, style, img, ...rest }: { handleSize: number, img?: { src: string, alt: string } } & HTMLAttributes<HTMLDivElement>): ReactNode {\n    const colors = useColors()\n    const [hover, setHover] = useState(false)\n\n    const divRef = useRef<HTMLDivElement>(null)\n\n    useEffect(() => {\n        const handleMouseEnter = (): void => {\n            setHover(true)\n        }\n\n        const handleMouseLeave = (): void => {\n            setHover(false)\n        }\n\n        const div = divRef.current!\n        div.addEventListener('mouseenter', handleMouseEnter)\n        div.addEventListener('mouseleave', handleMouseLeave)\n\n        return () => {\n            div.removeEventListener('mouseenter', handleMouseEnter)\n            div.removeEventListener('mouseleave', handleMouseLeave)\n        }\n    }, [])\n\n    return (\n        <div\n            ref={divRef}\n            role=\"button\"\n            style={{\n                backgroundColor: hover ? colors.slightlyDifferentBackgroundFocused : colors.slightlyDifferentBackground,\n                border: `1px solid ${colors.textMain}`,\n                position: 'absolute',\n                width: `${handleSize}px`,\n                height: `${handleSize}px`,\n                borderRadius: '2px',\n                ...style,\n            }}\n            {...rest}\n        >\n            {img && <img src={img.src} alt={img.alt} style={{ width: '100%', height: '100%' }} />}\n        </div>\n    )\n}\n","import React, { ReactNode, useEffect, useRef, useState } from 'react'\nimport { MapRef } from 'react-map-gl/maplibre'\n\nimport { CSVExportData, generateMapperCSVData } from '../components/csv-export'\nimport { Basemap as BasemapComponent, PointFeatureCollection, Polygon, PolygonFeatureCollection } from '../components/map-common'\nimport { screencapElement, ScreenshotContext } from '../components/screenshot'\nimport valid_geographies from '../data/mapper/used_geographies'\nimport universes_ordered from '../data/universes_ordered'\nimport { loadProtobuf } from '../load_json'\nimport { boundingBox, geometry } from '../map-partition'\nimport { consolidatedShapeLink, indexLink } from '../navigation/links'\nimport { LongLoad } from '../navigation/loading'\nimport { loadCentroids } from '../syau/load'\nimport { Universe } from '../universe'\nimport { getAllParseErrors } from '../urban-stats-script/ast'\nimport { doRender } from '../urban-stats-script/constants/color-utils'\nimport { Inset } from '../urban-stats-script/constants/insets'\nimport { instantiate } from '../urban-stats-script/constants/scale'\nimport { EditorError } from '../urban-stats-script/editor-utils'\nimport { noLocation } from '../urban-stats-script/location'\nimport { USSOpaqueValue } from '../urban-stats-script/types-values'\nimport { loadInsets } from '../urban-stats-script/worker'\nimport { executeAsync } from '../urban-stats-script/workerManager'\nimport { furthestColor, interpolateColor } from '../utils/color'\nimport { computeAspectRatioForInsets } from '../utils/coordinates'\nimport { ConsolidatedShapes, Feature, ICoordinate } from '../utils/protos'\nimport { NormalizeProto } from '../utils/types'\nimport { useOrderedResolve } from '../utils/useOrderedResolve'\n\nimport { Colorbar, RampToDisplay } from './components/Colorbar'\nimport { InsetMap } from './components/InsetMap'\nimport { computeUSS, MapSettings } from './settings/utils'\n\ntype EditMultipleInsets = (index: number, newInset: Partial<Inset>) => void\ninterface EditInsets {\n    modify: EditMultipleInsets\n    editedInsets: Inset[]\n    add: () => void\n    delete: (i: number) => void\n    duplicate: (i: number) => void\n    moveUp: (i: number) => void\n    moveDown: (i: number) => void\n}\n\nconst mapUpdateInterval = 500\n\nexport function useMapGenerator({ mapSettings }: { mapSettings: MapSettings }): MapGenerator {\n    const cache = useRef<MapCache>({})\n    const updateTime = useRef(Date.now())\n\n    const [currentGenerator, setCurrentGenerator] = useState<Promise<MapGenerator<{ loading: boolean }>>>(() => makeMapGenerator({ mapSettings, cache: cache.current, previousGenerator: undefined }))\n\n    useEffect(() => {\n        const timeSinceMapUpdate = Date.now() - updateTime.current\n        if (timeSinceMapUpdate > mapUpdateInterval) {\n            updateTime.current = Date.now()\n            setCurrentGenerator(previousGenerator => makeMapGenerator({ mapSettings, cache: cache.current, previousGenerator }))\n            return\n        }\n        else {\n            updateTime.current = Date.now()\n            const timeout = setTimeout(() => {\n                setCurrentGenerator(previousGenerator => makeMapGenerator({ mapSettings, cache: cache.current, previousGenerator }))\n            }, mapUpdateInterval - timeSinceMapUpdate)\n            return () => {\n                clearTimeout(timeout)\n            }\n        }\n    }, [mapSettings]) // Do not change this effect list!!\n\n    const { result, loading } = useOrderedResolve(currentGenerator)\n\n    return result !== undefined\n        ? {\n                ...result,\n                ui: props => result.ui({ ...props, loading }),\n            }\n        : {\n                ui: () => ({ node: <EmptyMapLayout universe={mapSettings.universe} loading={loading} /> }),\n                errors: [],\n            }\n}\n\ntype MapUIProps<T> = T & ({ mode: 'view' } | { mode: 'uss' } | { mode: 'insets', editInsets: EditInsets })\n\nexport interface MapGenerator<T = unknown> {\n    ui: (props: MapUIProps<T>) => { node: ReactNode, exportPng?: () => Promise<string> }\n    exportGeoJSON?: () => string\n    exportCSV?: CSVExportData\n    errors: EditorError[]\n}\n\nasync function makeMapGenerator({ mapSettings, cache, previousGenerator }: { mapSettings: MapSettings, cache: MapCache, previousGenerator: Promise<MapGenerator<{ loading: boolean }>> | undefined }): Promise<MapGenerator<{ loading: boolean }>> {\n    const emptyMap = ({ loading }: { loading: boolean }): { node: ReactNode } => ({ node: <EmptyMapLayout universe={mapSettings.universe} loading={loading} /> })\n\n    if (mapSettings.geographyKind === undefined || mapSettings.universe === undefined) {\n        return {\n            ui: emptyMap,\n            errors: [{ kind: 'error', type: 'error', value: 'Select a Universe and Geography Kind', location: noLocation }],\n        }\n    }\n\n    const stmts = computeUSS(mapSettings.script)\n\n    const parseErrors = getAllParseErrors(stmts)\n    if (parseErrors.length > 0) {\n        const prev = await previousGenerator\n        return {\n            ...prev,\n            ui: prev?.ui ?? emptyMap,\n            errors: parseErrors.map(e => ({ ...e, kind: 'error' })),\n        }\n    }\n\n    const execResult = await executeAsync({ descriptor: { kind: 'mapper', geographyKind: mapSettings.geographyKind, universe: mapSettings.universe }, stmts })\n\n    if (execResult.resultingValue === undefined) {\n        const prev = await previousGenerator\n        return {\n            ...prev,\n            ui: prev?.ui ?? emptyMap,\n            errors: execResult.error,\n        }\n    }\n\n    const mapResultMain = execResult.resultingValue.value\n\n    const csvData = generateMapperCSVData(mapResultMain, execResult.context)\n    const csvFilename = `${mapSettings.geographyKind}-${mapSettings.universe}-data.csv`\n\n    const { features, mapChildren, ramp } = await loadMapResult({ mapResultMain, universe: mapSettings.universe, geographyKind: mapSettings.geographyKind, cache })\n\n    function MapComponent({ props, exportPngRef }: { props: MapUIProps<{ loading: boolean }>, exportPngRef: (fn: () => Promise<string>) => void }): ReactNode {\n        const mapsRef: (MapRef | null)[] = []\n\n        const mapsContainerRef = useRef<HTMLDivElement>(null)\n        const wholeRenderRef = useRef<HTMLDivElement>(null)\n\n        const insetsFeatures = (props.mode === 'insets' ? props.editInsets.editedInsets : mapResultMain.value.insets).flatMap((inset) => {\n            const insetFeatures = filterOverlaps(inset, features)\n            if (insetFeatures.length === 0 && props.mode !== 'insets') {\n                return []\n            }\n            return [{\n                inset,\n                insetFeatures,\n            }]\n        })\n\n        const insetMaps = insetsFeatures.map(({ inset, insetFeatures }, i, insets) => {\n            return (\n                <InsetMap\n                    i={i}\n                    key={i}\n                    inset={inset}\n                    ref={e => mapsRef[i] = e}\n                    container={mapsContainerRef}\n                    numInsets={insets.length}\n                    editInset={props.mode === 'insets'\n                        ? {\n                                modify: (newInset: Partial<Inset>) => { props.editInsets.modify(i, newInset) },\n                                delete: () => { props.editInsets.delete(i) },\n                                duplicate: () => { props.editInsets.duplicate(i) },\n                                add: props.editInsets.add,\n                                moveUp: () => { props.editInsets.moveUp(i) },\n                                moveDown: () => { props.editInsets.moveDown(i) },\n                            }\n                        : undefined}\n                >\n                    {mapChildren(insetFeatures, ['uss', 'view'].includes(props.mode))}\n                </InsetMap>\n            )\n        })\n\n        const visibleInsets = insetsFeatures.map(({ inset }) => inset)\n\n        const colorbar = (\n            <Colorbar\n                ramp={ramp}\n                basemap={mapResultMain.value.basemap}\n            />\n        )\n\n        const [screenshotMode, setScreenshotMode] = useState(false)\n\n        exportPngRef(async () => {\n            const exportPixelRatio = 4\n            setScreenshotMode(true)\n            const restoreMaps = mapsRef.map(r => r!.getMap()).map((map) => {\n                const originalPixelRatio = map.getPixelRatio()\n                map.setPixelRatio(exportPixelRatio)\n\n                const attrib: HTMLElement | null = map.getContainer().querySelector('.maplibregl-ctrl-attrib')\n                let resetAttrib: undefined | (() => void)\n                if (attrib !== null) {\n                    const prevDisplay = attrib.style.display\n                    attrib.style.display = 'none'\n                    resetAttrib = () => attrib.style.display = prevDisplay\n                }\n\n                return () => {\n                    map.setPixelRatio(originalPixelRatio)\n                    resetAttrib?.()\n                }\n            })\n            return new Promise((resolve) => {\n                setTimeout(async () => {\n                    const elementCanvas = await screencapElement(wholeRenderRef.current!, canonicalWidth * exportPixelRatio, 1, { mapBorderRadius: 0, testing: false })\n                    resolve(elementCanvas.toDataURL('image/png'))\n                    setScreenshotMode(false)\n                    restoreMaps.forEach((restore) => { restore() })\n                })\n            })\n        })\n\n        return (\n            <ScreenshotContext.Provider value={screenshotMode}>\n                <MapLayout\n                    maps={insetMaps}\n                    loading={props.loading}\n                    colorbar={colorbar}\n                    aspectRatio={computeAspectRatioForInsets(visibleInsets)}\n                    mapsContainerRef={mapsContainerRef}\n                    wholeRenderRef={wholeRenderRef}\n                />\n            </ScreenshotContext.Provider>\n        )\n    }\n\n    return {\n        errors: execResult.error,\n        exportCSV: {\n            csvData,\n            csvFilename,\n        },\n        exportGeoJSON: () => exportAsGeoJSON(features),\n        ui: (props) => {\n            let exportPng: () => Promise<string>\n\n            return {\n                node: (\n                    <MapComponent props={props} exportPngRef={fn => exportPng = fn} />\n                ),\n                exportPng: () => exportPng(),\n            }\n        },\n    }\n}\n\nfunction MapLayout({ maps, colorbar, loading, mapsContainerRef, aspectRatio, wholeRenderRef }: {\n    maps: ReactNode\n    colorbar: ReactNode\n    loading: boolean\n    mapsContainerRef?: React.Ref<HTMLDivElement>\n    aspectRatio: number\n    wholeRenderRef?: React.Ref<HTMLDivElement>\n}): ReactNode {\n    return (\n        <TransformConstantWidth>\n            <div\n                ref={wholeRenderRef}\n                style={{\n                    display: 'flex',\n                    flexDirection: 'column',\n                    position: 'relative',\n                    minHeight: 0, // https://stackoverflow.com/questions/36230944/prevent-flex-items-from-overflowing-a-container/66689926#66689926\n                }}\n            >\n                <RelativeLoader loading={loading} />\n                <div\n                    style={{ width: '100%', aspectRatio }}\n                >\n                    <div\n                        ref={mapsContainerRef}\n                        style={{\n                            aspectRatio,\n                            position: 'relative',\n                            maxHeight: '100%',\n                            margin: 'auto',\n                        }}\n                    >\n                        {maps}\n                    </div>\n                </div>\n                {colorbar}\n            </div>\n        </TransformConstantWidth>\n    )\n}\n\nfunction RelativeLoader({ loading }: { loading: boolean }): ReactNode {\n    return (\n        <LongLoad containerStyleOverride={{\n            position: 'absolute',\n            transition: 'opacity 0.25s',\n            opacity: loading ? 1 : 0,\n            pointerEvents: 'none',\n        }}\n        />\n    )\n}\n\nfunction EmptyMapLayout({ universe, loading }: { universe?: Universe, loading: boolean }): ReactNode {\n    const insets = loadInsets(universe ?? 'world')\n\n    return (\n        <MapLayout\n            maps={insets.map((inset, i) => (\n                <InsetMap\n                    i={i}\n                    key={i}\n                    inset={inset}\n                    container={React.createRef()}\n                    numInsets={insets.length}\n                >\n                    {null}\n                </InsetMap>\n            ))}\n            loading={loading}\n            colorbar={null}\n            aspectRatio={computeAspectRatioForInsets(insets)}\n        />\n    )\n}\n\nasync function loadMapResult({ mapResultMain: { opaqueType, value }, universe, geographyKind, cache }:\n{\n    mapResultMain: USSOpaqueValue & { opaqueType: 'cMap' | 'cMapRGB' | 'pMap' }\n    universe: Universe\n    geographyKind: typeof valid_geographies[number]\n    cache: MapCache\n}): Promise<{ features: GeoJSON.Feature[], mapChildren: (fs: GeoJSON.Feature[], clickable: boolean) => ReactNode, ramp: RampToDisplay }> {\n    let ramp: RampToDisplay\n    let colors: string[]\n    switch (opaqueType) {\n        case 'pMap':\n        case 'cMap':\n            const scale = instantiate(value.scale)\n            const furthest = furthestColor(value.ramp.map(x => x[1]))\n            const interpolations = [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1].map(scale.inverse)\n            ramp = { type: 'ramp', value: { ramp: value.ramp, interpolations, scale, label: value.label, unit: value.unit } }\n            colors = value.data.map(val => interpolateColor(value.ramp, scale.forward(val), furthest))\n            break\n        case 'cMapRGB':\n            colors = value.dataR.map((r, i) => doRender({\n                r,\n                g: value.dataG[i],\n                b: value.dataB[i],\n                a: 1,\n            }))\n            ramp = { type: 'label', value: value.label }\n            break\n    }\n\n    let features: GeoJSON.Feature[]\n    let mapChildren: (fs: GeoJSON.Feature[], clickable: boolean) => ReactNode\n    switch (opaqueType) {\n        case 'pMap':\n            const points: Point[] = Array.from(value.data.entries()).map(([i, dataValue]) => {\n                return {\n                    name: value.geo[i],\n                    fillColor: colors[i],\n                    fillOpacity: 1,\n                    radius: Math.sqrt(value.relativeArea[i]) * value.maxRadius,\n                    statistic: dataValue,\n                }\n            })\n\n            features = await pointsGeojson(geographyKind, universe, points, cache)\n\n            mapChildren = (fs, clickable) => <PointFeatureCollection features={fs} clickable={clickable} />\n\n            break\n        case 'cMap':\n        case 'cMapRGB':\n            const polys: Polygon[] = Array.from(colors.entries()).map(([i, color]) => {\n                let meta\n                switch (opaqueType) {\n                    case 'cMap':\n                        meta = { statistic: value.data[i] }\n                        break\n                    case 'cMapRGB':\n                        meta = { statistic: [value.dataR[i], value.dataG[i], value.dataB[i]] }\n                        break\n                }\n\n                return {\n                    name: value.geo[i],\n                    fillColor: color,\n                    fillOpacity: 1,\n                    color: doRender(value.outline.color),\n                    weight: value.outline.weight,\n                    ...meta,\n                }\n            })\n\n            features = await polygonsGeojson(geographyKind, universe, polys, cache)\n\n            mapChildren = (fs, clickable) => <PolygonFeatureCollection features={fs} clickable={clickable} />\n\n            break\n    }\n\n    return {\n        features,\n        mapChildren: (fs, clickable) => (\n            <>\n                {mapChildren(fs, clickable)}\n                <BasemapComponent basemap={value.basemap} />\n            </>\n        ),\n        ramp,\n    }\n}\n\nconst canonicalWidth = 1200\n\nfunction TransformConstantWidth({ children }: { children: ReactNode }): ReactNode {\n    const [layout, setLayout] = useState({ scale: 1, top: 0, left: 0 })\n    const ref = useRef<HTMLDivElement>(null)\n    const childRef = useRef<HTMLDivElement>(null)\n\n    useEffect(() => {\n        const updateScale = (): void => {\n            if (ref.current === null || childRef.current === null) {\n                return\n            }\n            const scale = Math.min(...[\n                ref.current.offsetWidth / canonicalWidth,\n                ...(ref.current.offsetHeight > 0 ? [ref.current.offsetHeight / childRef.current.offsetHeight] : []),\n            ])\n            setLayout({\n                scale,\n                top: Math.max(0, (ref.current.offsetHeight - childRef.current.offsetHeight * scale) / 2),\n                left: Math.max(0, (ref.current.offsetWidth - childRef.current.offsetWidth * scale) / 2),\n            })\n        }\n        updateScale()\n\n        const observer = new ResizeObserver(updateScale)\n        observer.observe(ref.current!)\n        observer.observe(childRef.current!)\n        return () => {\n            observer.disconnect()\n        }\n    }, [])\n\n    return (\n        <div ref={ref} style={{ position: 'absolute', inset: 0 }}>\n            <div\n                ref={childRef}\n                style={{\n                    transform: `scale(${layout.scale})`,\n                    transformOrigin: 'top left',\n                    width: `${canonicalWidth}px`,\n                    position: 'relative',\n                    top: `${layout.top}px`,\n                    left: `${layout.left}px`,\n                }}\n            >\n                {children}\n            </div>\n        </div>\n    )\n}\n\nfunction filterOverlaps(inset: Inset, features: GeoJSON.Feature[]): GeoJSON.Feature[] {\n    const bbox = inset.coordBox\n    if (!inset.mainMap) {\n        features = features.filter((poly) => {\n            const bounds = boundingBox(poly.geometry)\n            // Check if the polygon overlaps the inset bounds\n            return bounds.getWest() < bbox[2] && bounds.getEast() > bbox[0]\n                && bounds.getNorth() > bbox[1] && bounds.getSouth() < bbox[3]\n        })\n    }\n    return features\n}\n\ninterface MapCache {\n    geo?: { universe: Universe, geographyKind: typeof valid_geographies[number] } & (\n        { type: 'points', centroidsByName: Map<string, ICoordinate> }\n        | { type: 'polygons', polygonsByName: Map<string, GeoJSON.Geometry> }\n    )\n}\n\ninterface Point {\n    name: string\n\n    fillColor: string\n    fillOpacity: number\n    radius: number\n\n    [meta: string]: unknown\n\n}\n\nasync function pointsGeojson(geographyKind: typeof valid_geographies[number], universe: Universe, points: Point[], cache: MapCache): Promise<GeoJSON.Feature[]> {\n    if (cache.geo?.type !== 'points' || cache.geo.universe !== universe || cache.geo.geographyKind !== geographyKind) {\n        const idxLink = indexLink(universe, geographyKind)\n        const articles = await loadProtobuf(idxLink, 'ArticleOrderingList')\n        const centroids = await loadCentroids(universe, geographyKind, articles.longnames)\n\n        const centroidsByName = new Map(articles.longnames.map((r, i) => [r, centroids[i]]))\n        cache.geo = {\n            type: 'points',\n            universe,\n            geographyKind,\n            centroidsByName,\n        }\n    }\n\n    const geo = cache.geo\n\n    return points.map((point) => {\n        const centroid = geo.centroidsByName.get(point.name)!\n\n        return {\n            type: 'Feature' as const,\n            properties: { ...point },\n            geometry: {\n                type: 'Point',\n                coordinates: [centroid.lon!, centroid.lat!],\n            },\n        }\n    })\n}\n\nasync function polygonsGeojson(geographyKind: typeof valid_geographies[number], universe: Universe, polygons: Polygon[], cache: MapCache): Promise<GeoJSON.Feature[]> {\n    if (cache.geo?.type !== 'polygons' || cache.geo.universe !== universe || cache.geo.geographyKind !== geographyKind) {\n        const universeIdx = universes_ordered.indexOf(universe)\n        const shapes = (await loadProtobuf(consolidatedShapeLink(geographyKind), 'ConsolidatedShapes')) as NormalizeProto<ConsolidatedShapes>\n        const polygonsByName = new Map<string, GeoJSON.Geometry>()\n        for (let i = 0; i < shapes.longnames.length; i++) {\n            if (shapes.universes[i].universeIdxs.includes(universeIdx)) {\n                polygonsByName.set(shapes.longnames[i], geometry(shapes.shapes[i] as NormalizeProto<Feature>))\n            }\n        }\n        cache.geo = {\n            type: 'polygons',\n            universe,\n            geographyKind,\n            polygonsByName,\n        }\n    }\n\n    const geo = cache.geo\n\n    return polygons.map((polygon) => {\n        return {\n            type: 'Feature' as const,\n            properties: { ...polygon },\n            geometry: geo.polygonsByName.get(polygon.name)!,\n        }\n    })\n}\n\nfunction exportAsGeoJSON(features: GeoJSON.Feature[]): string {\n    return JSON.stringify(\n        {\n            type: 'FeatureCollection',\n            features,\n        },\n        null,\n        2,\n    )\n}\n","import { saveAs } from 'file-saver'\nimport React, { ReactNode } from 'react'\nimport { z } from 'zod'\n\nimport { renderLocInfo } from '../../urban-stats-script/interpreter'\nimport { parse, unparse } from '../../urban-stats-script/parser'\nimport { cancelled, uploadFile } from '../../utils/upload'\n\nimport { convertToMapUss, defaultSettings, mapperMetaFields, MapSettings } from './utils'\n\nexport function ImportExportCode({ mapSettings, setMapSettings }: { mapSettings: MapSettings, setMapSettings: (v: MapSettings) => void }): ReactNode {\n    return (\n        <div style={{\n            display: 'flex',\n            gap: '0.5em',\n            margin: '0.5em 0',\n        }}\n        >\n            <button onClick={async () => {\n                const file = await uploadFile('.uss')\n\n                if (file === cancelled) {\n                    return\n                }\n\n                const importResult = importMapSettings(await file.text())\n\n                if (!importResult.success) {\n                    alert(importResult.error)\n                    return\n                }\n\n                setMapSettings(importResult.mapSettings)\n            }}\n            >\n                Import Script\n            </button>\n            <button onClick={() => {\n                saveAs(new Blob([exportMapSettings(mapSettings)]), 'urban_stats_mapper.uss')\n            }}\n            >\n                Export Script\n            </button>\n        </div>\n    )\n}\n\nconst metadataSchema = z.object({\n    kind: z.literal('mapper'),\n    ...mapperMetaFields.shape,\n})\n\nfunction importMapSettings(fileContent: string): { success: true, mapSettings: MapSettings } | { success: false, error: string } {\n    const parsed = parse(fileContent)\n    if (parsed.type === 'error') {\n        return {\n            success: false,\n            error: `Parse Errors:\\n${parsed.errors.map(error => ` ${error.value} at ${renderLocInfo(error.location)}`).join('\\n')}`,\n        }\n    }\n\n    let metadata = undefined\n    if (parsed.type === 'statements'\n        && parsed.result[0].type === 'expression'\n        && parsed.result[0].value.type === 'call'\n        && parsed.result[0].value.fn.type === 'identifier'\n        && parsed.result[0].value.fn.name.node === 'meta'\n    ) {\n        const meta = parsed.result[0].value\n\n        // Remove meta from the parsed result\n        parsed.result.splice(0, 1)\n\n        const args = []\n\n        for (const arg of meta.args) {\n            if (arg.type === 'unnamed') {\n                return { success: false, error: `\"meta\" function call at ${renderLocInfo(meta.entireLoc)} must have only named arguments` }\n            }\n            if (arg.value.type !== 'constant') {\n                return { success: false, error: `\"meta\" function argument \"${arg.name.node}\" must have a constant value` }\n            }\n            args.push([arg.name.node, arg.value.value.node.value])\n        }\n\n        const metadataResult = metadataSchema.safeParse(Object.fromEntries(args))\n\n        if (!metadataResult.success) {\n            return {\n                success: false,\n                error: `Error parsing metadata: ${Object.values(metadataResult.error.flatten(issue => ` Parameter \"${issue.path}\" is ${issue.message}`).fieldErrors).join('\\n')}`,\n            }\n        }\n        metadata = metadataResult.data\n    }\n\n    const newSettings = defaultSettings({\n        ...metadata,\n        script: {\n            uss: convertToMapUss(parsed),\n        },\n    })\n\n    return { success: true, mapSettings: newSettings }\n}\n\nfunction exportMapSettings(mapSettings: MapSettings): string {\n    return `meta(kind=\"mapper\", universe=\"${mapSettings.universe}\", geographyKind=\"${mapSettings.geographyKind}\")\\n${unparse(mapSettings.script.uss)}`\n}\n","import { useColors } from '../page_template/colors'\n\nexport const settingNameStyle = {\n    fontWeight: 500,\n    fontSize: '1.2em',\n    marginBottom: '0.125em',\n    marginTop: '0.25em',\n}\n\nexport const useSettingSubNameStyle = (): React.CSSProperties => ({\n    fontWeight: 500,\n    fontSize: '1em',\n    marginBottom: '0.125em',\n    color: useColors().ordinalTextColor,\n})\n","import React, { ReactNode, useCallback, useMemo } from 'react'\n\nimport { articleTypes, CountsByUT } from '../../components/countsByArticleType'\nimport universes_ordered from '../../data/universes_ordered'\nimport { EditorError } from '../../urban-stats-script/editor-utils'\nimport { TypeEnvironment } from '../../urban-stats-script/types-values'\nimport { settingNameStyle } from '../style'\n\nimport { BetterSelector } from './BetterSelector'\nimport { TopLevelEditor } from './TopLevelEditor'\nimport { MapSettings } from './utils'\n\nexport function MapperSettings({ mapSettings, setMapSettings, errors, counts, typeEnvironment }: {\n    mapSettings: MapSettings\n    setMapSettings: (s: MapSettings) => void\n    errors: EditorError[]\n    counts: CountsByUT\n    typeEnvironment: TypeEnvironment\n}): ReactNode {\n    const uss = mapSettings.script.uss\n\n    const renderString = useCallback((universe: string | undefined) => ({ text: universe ?? '' }), [])\n\n    const universes = useMemo(() => [undefined, ...universes_ordered], [])\n\n    const geographyKinds = useMemo(() =>\n        mapSettings.universe === undefined ? undefined : [undefined, ...articleTypes(counts, mapSettings.universe)] as Exclude<MapSettings['geographyKind'], undefined>[],\n    [mapSettings.universe, counts])\n\n    return (\n        <>\n            <div style={settingNameStyle}>\n                Universe\n            </div>\n            <BetterSelector\n                possibleValues={universes}\n                value={mapSettings.universe}\n                renderValue={renderString}\n                onChange={\n                    (newUniverse) => {\n                        setMapSettings({\n                            ...mapSettings,\n                            universe: newUniverse,\n                            geographyKind: newUniverse === undefined || mapSettings.geographyKind === undefined\n                                ? mapSettings.geographyKind\n                                : articleTypes(counts, newUniverse).includes(mapSettings.geographyKind)\n                                    ? mapSettings.geographyKind\n                                    : undefined,\n                        })\n                    }\n                }\n            />\n            {geographyKinds && (\n                <>\n                    <div style={settingNameStyle}>\n                        Geography Kind\n                    </div>\n                    <BetterSelector\n                        possibleValues={geographyKinds}\n                        value={mapSettings.geographyKind}\n                        renderValue={renderString}\n                        onChange={\n                            (newGeographyKind) => {\n                                setMapSettings({\n                                    ...mapSettings,\n                                    geographyKind: newGeographyKind,\n                                })\n                            }\n                        }\n                    />\n                </>\n            )}\n            <TopLevelEditor\n                uss={uss}\n                setUss={(newUss) => {\n                    setMapSettings({\n                        ...mapSettings,\n                        script: { uss: newUss },\n                    })\n                }}\n                typeEnvironment={typeEnvironment}\n                errors={errors}\n            />\n        </>\n    )\n}\n","export type ArrayEdits<T> = (a: T[]) => T[]\n\nexport function replace<T>(edits: ArrayEdits<T>, [from, to]: [number, number], withArray: T[]): ArrayEdits<T> {\n    return (a) => {\n        const applied = edits(a)\n        return [...applied.slice(0, from), ...withArray, ...applied.slice(to)]\n    }\n}\n\nexport function swap<T>(edits: ArrayEdits<T>, indexA: number, indexB: number): ArrayEdits<T> {\n    return (a) => {\n        const array = edits(a)\n        const itemA = array[indexA]\n        const itemB = array[indexB]\n        const result = Array.from(array)\n        result[indexB] = itemA\n        result[indexA] = itemB\n        return result\n    }\n}\n","import { UrbanStatsASTExpression } from '../../urban-stats-script/ast'\nimport { deconstruct, Inset } from '../../urban-stats-script/constants/insets'\nimport { TypeEnvironment } from '../../urban-stats-script/types-values'\nimport { loadInsets, loadInsetExpression } from '../../urban-stats-script/worker'\nimport { ArrayEdits, replace, swap } from '../../utils/array-edits'\nimport { assert } from '../../utils/defensive'\n\nimport * as l from './../../urban-stats-script/literal-parser'\nimport { idOutput, MapUSS, validMapperOutputs } from './TopLevelEditor'\nimport { MapSettings } from './utils'\n\nconst neswSchema = l.object({\n    north: l.number(),\n    east: l.number(),\n    south: l.number(),\n    west: l.number(),\n})\n\nconst insetSchema = l.transformExpr(l.deconstruct(l.call({ fn: l.identifier('constructInset'), unnamedArgs: [], namedArgs: {\n    mainMap: l.boolean(),\n    name: l.string(),\n    screenBounds: neswSchema,\n    mapBounds: neswSchema,\n} })),\n({ namedArgs: { screenBounds, mapBounds, mainMap, name } }) => ({\n    bottomLeft: [screenBounds.west, screenBounds.south],\n    topRight: [screenBounds.east, screenBounds.north],\n    coordBox: [mapBounds.west, mapBounds.south, mapBounds.east, mapBounds.north],\n    mainMap,\n    name,\n} satisfies Inset))\n\nconst constructInsetsSchema = l.transformExpr(l.call({ fn: l.identifier('constructInsets'), namedArgs: {}, unnamedArgs: [l.editableVector(insetSchema)] }), call => call.unnamedArgs[0])\n\nconst mapSchema = l.transformStmt(l.statements([\n    l.ignore(),\n    l.condition({\n        condition: l.ignore(),\n        rest: [\n            l.expression(l.reparse(idOutput, validMapperOutputs,\n                l.call({\n                    fn: l.ignore(),\n                    unnamedArgs: [],\n                    namedArgs: {\n                        insets: l.edit(l.optional(l.deconstruct(constructInsetsSchema))),\n                    },\n                }))),\n        ],\n    }),\n]), uss => uss[1].rest[0].namedArgs.insets)\n\nexport function getInsets(settings: MapSettings, typeEnvironment: TypeEnvironment): Inset[] | undefined {\n    if (settings.script.uss.type === 'statements') {\n        try {\n            const parseResult = mapSchema.parse(settings.script.uss, typeEnvironment)\n            if (parseResult.currentValue === undefined && settings.universe !== undefined) {\n                return loadInsets(settings.universe)\n            }\n            return parseResult.currentValue?.currentValue\n        }\n        catch {\n            return undefined\n        }\n    }\n    return undefined\n}\n\nexport interface InsetEdits {\n    insets: ArrayEdits<Inset>\n    ast: ArrayEdits<UrbanStatsASTExpression>\n}\n\nexport function replaceInsets(edits: InsetEdits, [from, to]: [number, number], withArray: Inset[]): InsetEdits {\n    return {\n        insets: replace(edits.insets, [from, to], withArray),\n        ast: replace(edits.ast, [from, to], withArray.map(deconstruct)),\n    }\n}\n\nexport function swapInsets(edits: InsetEdits, indexA: number, indexB: number): InsetEdits {\n    return {\n        insets: swap(edits.insets, indexA, indexB),\n        ast: swap(edits.ast, indexA, indexB),\n    }\n}\n\nexport function doEditInsets(settings: MapSettings, edits: InsetEdits, typeEnvironment: TypeEnvironment): MapUSS {\n    assert(settings.script.uss.type === 'statements', 'Trying to do an inset edit on USS that is not inset editable')\n    const mapInsets = mapSchema.parse(settings.script.uss, typeEnvironment)\n    assert(settings.universe !== undefined, 'Trying to do an inset edit on USS that is not inset editable')\n\n    let currentInsetsAst: UrbanStatsASTExpression\n    if (mapInsets.currentValue !== undefined) {\n        currentInsetsAst = mapInsets.expr!\n    }\n    else {\n        currentInsetsAst = loadInsetExpression(settings.universe)\n    }\n\n    const newConstructInsets = constructInsetsSchema.parse(currentInsetsAst, typeEnvironment).edit(edits.ast) as UrbanStatsASTExpression\n\n    const result = mapInsets.edit(newConstructInsets)\n    return result as MapUSS\n}\n","import { gzipSync } from 'zlib'\n\nimport React, { ReactNode, useCallback, useContext, useEffect, useLayoutEffect, useMemo, useRef, useState } from 'react'\n\nimport { CountsByUT } from '../../components/countsByArticleType'\nimport { Navigator } from '../../navigation/Navigator'\nimport { useColors } from '../../page_template/colors'\nimport { useSetting } from '../../page_template/settings'\nimport { PageTemplate } from '../../page_template/template'\nimport { Inset } from '../../urban-stats-script/constants/insets'\nimport { useUndoRedo } from '../../urban-stats-script/editor-utils'\nimport { unparse } from '../../urban-stats-script/parser'\nimport { TypeEnvironment } from '../../urban-stats-script/types-values'\nimport { loadInsets } from '../../urban-stats-script/worker'\nimport { Property } from '../../utils/Property'\nimport { TestUtils } from '../../utils/TestUtils'\nimport { mixWithBackground } from '../../utils/color'\nimport { assert } from '../../utils/defensive'\nimport { useMobileLayout } from '../../utils/responsive'\nimport { defaultTypeEnvironment } from '../context'\nimport { MapGenerator, useMapGenerator } from '../map-generator'\n\nimport { ImportExportCode } from './ImportExportCode'\nimport { MapperSettings } from './MapperSettings'\nimport { Selection, SelectionContext } from './SelectionContext'\nimport { doEditInsets, getInsets, InsetEdits, replaceInsets, swapInsets } from './insets'\nimport { MapSettings } from './utils'\n\ntype MapEditorMode = 'uss' | 'insets'\n\nexport function EditMapperPanel(props: { mapSettings: MapSettings, counts: CountsByUT }): ReactNode {\n    const [mapSettings, setMapSettings] = useState(props.mapSettings)\n\n    const [mapEditorMode, setMapEditorMode] = useState<MapEditorMode>('uss')\n\n    const selectionContext = useMemo(() => new Property<Selection | undefined>(undefined), [])\n\n    const undoRedo = useUndoRedo(\n        mapSettings,\n        selectionContext.value,\n        setMapSettings,\n        (selection) => {\n            selectionContext.value = selection\n        },\n        {\n            undoChunking: TestUtils.shared.isTesting ? 2000 : 1000,\n            // Prevent keyboard shortcusts when in insets editing mode, since insets has its own undo stack\n            onlyElement: mapEditorMode === 'insets' ? { current: null } : undefined,\n        },\n    )\n\n    const { updateCurrentSelection, addState } = undoRedo\n\n    const setMapSettingsWrapper = useCallback((newSettings: MapSettings): void => {\n        setMapSettings(newSettings)\n        addState(newSettings, selectionContext.value)\n    }, [selectionContext, addState])\n\n    const firstEffect = useRef(true)\n\n    useEffect(() => {\n        if (firstEffect.current) {\n            // Otherwise we add an undo state immediately\n            firstEffect.current = false\n        }\n        else {\n            // So that map settings are updated when the prop changes\n            setMapSettingsWrapper(props.mapSettings)\n            setMapEditorMode('uss')\n        }\n    }, [props.mapSettings, setMapSettingsWrapper])\n\n    const jsonedSettings = JSON.stringify({\n        ...mapSettings,\n        script: {\n            uss: unparse(mapSettings.script.uss),\n        },\n    })\n\n    const navContext = useContext(Navigator.Context)\n\n    useEffect(() => {\n        if (props.mapSettings !== mapSettings) {\n            // gzip then base64 encode\n            const encodedSettings = gzipSync(jsonedSettings).toString('base64')\n            navContext.setMapperSettings(encodedSettings)\n        }\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- props.view won't be set except from the navigator\n    }, [jsonedSettings, navContext])\n\n    const typeEnvironment = useMemo(() => defaultTypeEnvironment(mapSettings.universe), [mapSettings.universe])\n\n    // Update current selection when it changes\n    useEffect(() => {\n        const observer = (): void => {\n            updateCurrentSelection(selectionContext.value)\n        }\n\n        selectionContext.observers.add(observer)\n        return () => { selectionContext.observers.delete(observer) }\n    }, [selectionContext, updateCurrentSelection])\n\n    const mapGenerator = useMapGenerator({ mapSettings })\n\n    const commonProps: CommonEditorProps = {\n        mapSettings,\n        setMapSettings: setMapSettingsWrapper,\n        typeEnvironment,\n        setMapEditorMode,\n        mapGenerator,\n    }\n\n    return (\n        <PageTemplate csvExportData={mapGenerator.exportCSV} showFooter={false}>\n            <SelectionContext.Provider value={selectionContext}>\n                {mapEditorMode === 'insets' ? <InsetsMapEditor {...commonProps} /> : <USSMapEditor {...commonProps} counts={props.counts} />}\n                {mapEditorMode !== 'insets' ? undoRedo.ui : undefined /* Insets editor has its own undo stack */}\n            </SelectionContext.Provider>\n        </PageTemplate>\n    )\n}\n\ninterface CommonEditorProps {\n    mapSettings: MapSettings\n    setMapSettings: (s: MapSettings) => void\n    typeEnvironment: TypeEnvironment\n    setMapEditorMode: (m: MapEditorMode) => void\n    mapGenerator: MapGenerator\n}\n\nfunction USSMapEditor({ mapSettings, setMapSettings, counts, typeEnvironment, setMapEditorMode, mapGenerator }: CommonEditorProps & { counts: CountsByUT }): ReactNode {\n    const ui = mapGenerator.ui({ mode: 'uss' })\n\n    return (\n        <MaybeSplitLayout\n            error={mapGenerator.errors.some(e => e.kind === 'error')}\n            left={(\n                <MapperSettings\n                    mapSettings={mapSettings}\n                    setMapSettings={setMapSettings}\n                    errors={mapGenerator.errors}\n                    counts={counts}\n                    typeEnvironment={typeEnvironment}\n                />\n            )}\n            right={(\n                <>\n                    <div style={{ display: 'flex', justifyContent: 'space-between', gap: '0.5em' }}>\n                        <Export pngExport={ui.exportPng} geoJSONExport={mapGenerator.exportGeoJSON} />\n                        {\n                            getInsets(mapSettings, typeEnvironment) && (\n                                <div style={{\n                                    display: 'flex',\n                                    gap: '0.5em',\n                                    margin: '0.5em 0',\n                                }}\n                                >\n                                    <button onClick={() => { setMapEditorMode('insets') }}>\n                                        Edit Insets\n                                    </button>\n                                </div>\n                            )\n                        }\n                        <ImportExportCode\n                            mapSettings={mapSettings}\n                            setMapSettings={setMapSettings}\n                        />\n                    </div>\n                    <div style={{ position: 'relative', flex: 1 }}>\n                        {ui.node}\n                    </div>\n                </>\n            )}\n        />\n    )\n}\n\nfunction MaybeSplitLayout({ left, right, error }: { left: ReactNode, right: ReactNode, error: boolean }): ReactNode {\n    const mobileLayout = useMobileLayout()\n\n    return mobileLayout\n        ? (\n                <>\n                    {left}\n                    {right}\n                </>\n            )\n        : <SplitLayout error={error} left={left} right={right} />\n}\n\nfunction SplitLayout({ left, right, error }: { left: ReactNode, right: ReactNode, error: boolean }): ReactNode {\n    const [height, setHeight] = useState(0)\n    const splitRef = useRef<HTMLDivElement>(null)\n    const colors = useColors()\n\n    const updateHeight = useCallback(() => {\n        if (splitRef.current) {\n            const bounds = splitRef.current.getBoundingClientRect()\n            setHeight(window.innerHeight - bounds.top - 8)\n        }\n    }, [])\n\n    // This is ultimately the simplest way to set the height\n    useLayoutEffect(() => {\n        updateHeight()\n        window.addEventListener('resize', updateHeight)\n        return () => {\n            window.removeEventListener('resize', updateHeight)\n        }\n    }, [updateHeight])\n\n    const [leftColProp, setLeftColProp] = useSetting('mapperSettingsColumnProp')\n\n    const [drag, setDrag] = useState<{ startOffsetX: number, pointerId: number, startProp: number } | undefined>(undefined)\n\n    const dividerRef = useRef<HTMLDivElement>(null)\n\n    const minLeftColProp = (): number =>\n        minLeftWidth / splitRef.current!.offsetWidth\n\n    useEffect(() => {\n        if (dividerRef.current !== null) {\n            dividerRef.current.style.cursor = leftColProp === minLeftColProp() ? 'e-resize' : (leftColProp === maxLeftColProp ? 'w-resize' : 'col-resize')\n        }\n    })\n\n    const minLeftWidth = left ? 540 : 0\n    const leftPct = left ? `${leftColProp * 100}%` : '0%'\n\n    const maxLeftColProp = 0.5\n\n    const dividerWidth = '1em'\n\n    return (\n        <div style={{ display: 'flex', height, position: 'relative' }} ref={splitRef}>\n            {left && (\n                <>\n                    <div style={{ width: leftPct, minWidth: minLeftWidth, overflowY: 'scroll', backgroundColor: mixWithBackground(colors.hueColors.red, error ? 0.8 : 1, colors.slightlyDifferentBackground), padding: '1em', borderRadius: '5px' }}>\n                        {left}\n                    </div>\n                    <div\n                        ref={dividerRef}\n                        style={{ width: dividerWidth, position: 'relative' }}\n                        onPointerDown={(e) => {\n                            if (drag === undefined) {\n                                const div = e.target as HTMLDivElement\n                                setDrag({\n                                    pointerId: e.pointerId,\n                                    startOffsetX: e.nativeEvent.offsetX + div.offsetLeft,\n                                    startProp: Math.max(minLeftColProp(), leftColProp),\n                                })\n                                div.setPointerCapture(e.pointerId)\n                            }\n                        }}\n                        onPointerMove={(e) => {\n                            if (e.pointerId === drag?.pointerId) {\n                                const div = e.target as HTMLDivElement\n                                const propChange = (div.offsetLeft + e.nativeEvent.offsetX - drag.startOffsetX) / splitRef.current!.offsetWidth\n                                setLeftColProp(Math.max(minLeftColProp(), Math.min(drag.startProp + propChange, maxLeftColProp)))\n                            }\n                        }}\n                        onPointerCancel={(e) => {\n                            if (drag?.pointerId === e.pointerId) {\n                                setDrag(undefined)\n                            }\n                        }}\n                        onPointerUp={(e) => {\n                            if (drag?.pointerId === e.pointerId) {\n                                setDrag(undefined)\n                            }\n                        }}\n                    >\n                        <div style={{\n                            backgroundColor: colors.borderNonShadow,\n                            borderRadius: '5px',\n                            position: 'absolute',\n                            width: '5px',\n                            left: 'calc(50% - 2px)',\n                            height: '50%',\n                            top: '25%',\n                            pointerEvents: 'none',\n                        }}\n                        />\n                    </div>\n                </>\n            )}\n            <div style={{ width: `calc(100% - max(${minLeftWidth}px, ${leftPct}) - ${dividerWidth})`, display: 'flex', flexDirection: 'column', justifyContent: 'center' }}>\n                {right}\n            </div>\n        </div>\n    )\n}\n\nfunction InsetsMapEditor({ mapSettings, setMapSettings, typeEnvironment, setMapEditorMode, mapGenerator }: CommonEditorProps): ReactNode {\n    const colors = useColors()\n\n    const [insetEdits, setInsetEdits] = useState<InsetEdits>({\n        ast: a => a,\n        insets: i => i,\n    })\n\n    const { addState, ui: undoRedoUi, canUndo } = useUndoRedo(insetEdits, undefined, setInsetEdits, () => undefined)\n\n    const editedInsets = insetEdits.insets(getInsets(mapSettings, typeEnvironment)!)\n\n    const addInsetEdit = (edits: InsetEdits): void => {\n        setInsetEdits(edits)\n        addState(edits, undefined)\n    }\n\n    const ui = mapGenerator.ui({\n        mode: 'insets',\n        editInsets: {\n            add: () => {\n                const newInset: Inset = {\n                    ...loadInsets(mapSettings.universe ?? 'world')[0],\n                    bottomLeft: [0.25, 0.25],\n                    topRight: [0.75, 0.75],\n                    mainMap: false,\n                }\n                addInsetEdit(replaceInsets(insetEdits, [editedInsets.length, editedInsets.length], [offsetInsetInBounds(newInset, editedInsets)]))\n            },\n            modify: (i, e) => {\n                addInsetEdit(replaceInsets(insetEdits, [i, i + 1], [{ ...editedInsets[i], ...e }]))\n            },\n            delete: (i) => {\n                addInsetEdit(replaceInsets(insetEdits, [i, i + 1], []))\n            },\n            duplicate: (i) => {\n                addInsetEdit(replaceInsets(insetEdits, [i + 1, i + 1], [offsetInsetInBounds(editedInsets[i], editedInsets)]))\n            },\n            moveUp: (i) => {\n                assert(i + 1 < editedInsets.length, `Cannot move inset ${i} up, already top`)\n                addInsetEdit(swapInsets(insetEdits, i, i + 1))\n            },\n            moveDown: (i) => {\n                assert(i > 0, `Cannot move inset ${i} down, already bottom`)\n                addInsetEdit(swapInsets(insetEdits, i, i - 1))\n            },\n            editedInsets,\n        },\n    })\n\n    return (\n        <>\n            <MaybeSplitLayout\n                left={undefined}\n                error={false}\n                right={(\n                    <>\n                        <div style={{\n                            backgroundColor: colors.slightlyDifferentBackgroundFocused,\n                            borderRadius: '5px',\n                            padding: '10px',\n                            margin: '10px 0',\n                            display: 'flex',\n                            justifyContent: 'space-between',\n                            gap: '0.5em',\n                        }}\n                        >\n                            <div>\n                                <b>Editing Insets.</b>\n                                {' '}\n                                Pans and zooms to maps will be reflected permanently. Drag inset frames to reposition and resize.\n                            </div>\n                            <div style={{ display: 'flex', gap: '10px' }}>\n\n                                <button onClick={() => { setMapEditorMode('uss') }}>\n                                    Cancel\n                                </button>\n                                <button\n                                    onClick={() => {\n                                        setMapSettings({ ...mapSettings, script: { uss: doEditInsets(mapSettings, insetEdits, typeEnvironment) } })\n                                        setMapEditorMode('uss')\n                                    }}\n                                    disabled={!canUndo}\n                                >\n                                    Accept\n                                </button>\n                            </div>\n                        </div>\n                        <div style={{ flex: 1, position: 'relative' }}>\n                            {ui.node}\n                        </div>\n                    </>\n                )}\n            />\n            {undoRedoUi}\n        </>\n    )\n}\n\nfunction moveInset(inset: Inset, x: number, y: number): Inset {\n    return {\n        ...inset,\n        bottomLeft: [inset.bottomLeft[0] + x, inset.bottomLeft[1] + y],\n        topRight: [inset.topRight[0] + x, inset.topRight[1] + y],\n    }\n}\n\nfunction inBounds(inset: Inset): boolean {\n    return inset.bottomLeft.concat(inset.topRight).every(c => c >= 0 && c <= 1)\n}\n\nfunction samePosition(a: Inset, b: Inset): boolean {\n    return a.bottomLeft[0] === b.bottomLeft[0] && a.bottomLeft[1] === b.bottomLeft[1] && a.topRight[0] === b.topRight[0] && a.topRight[1] === b.topRight[1]\n}\n\nfunction offsetInsetInBounds(inset: Inset, exclude: Inset[]): Inset {\n    for (let delta = 0; delta < 1; delta += 0.05) {\n        for (const [x, y] of [[delta, delta], [-delta, -delta], [-delta, delta], [delta, -delta]]) {\n            const newInset = moveInset(inset, x, y)\n            if (inBounds(newInset) && !exclude.some(i => samePosition(newInset, i))) {\n                return newInset\n            }\n        }\n    }\n    return inset\n}\n\nfunction saveAsFile(filename: string, data: string | Blob, type: string): void {\n    const blob = typeof data === 'string' ? new Blob([data], { type }) : data\n    const url = URL.createObjectURL(blob)\n    const link = document.createElement('a')\n    link.href = url\n    link.download = filename\n    document.body.appendChild(link)\n    link.click()\n    document.body.removeChild(link)\n}\n\nfunction Export(props: { pngExport?: () => Promise<string>, geoJSONExport?: () => string }): ReactNode {\n    const doPngExport = async (): Promise<void> => {\n        if (props.pngExport === undefined) {\n            return\n        }\n        const pngDataUrl = await props.pngExport()\n        const data = await fetch(pngDataUrl)\n        const pngData = await data.blob()\n        saveAsFile('map.png', pngData, 'image/png')\n    }\n\n    const doGeoJSONExport = (): void => {\n        if (props.geoJSONExport === undefined) {\n            return\n        }\n        saveAsFile('map.geojson', props.geoJSONExport(), 'application/geo+json')\n    }\n\n    return (\n        <div style={{\n            display: 'flex',\n            gap: '0.5em',\n            margin: '0.5em 0',\n        }}\n        >\n            <button\n                disabled={props.pngExport === undefined}\n                onClick={() => {\n                    void doPngExport()\n                }}\n            >\n                Export as PNG\n            </button>\n            <button\n                disabled={props.geoJSONExport === undefined}\n                onClick={() => {\n                    doGeoJSONExport()\n                }}\n            >\n                Export as GeoJSON\n            </button>\n            <button onClick={() => {\n                // eslint-disable-next-line no-restricted-syntax -- We're opening a new window here\n                const params = new URLSearchParams(window.location.search)\n                params.set('view', 'true')\n                // navigate to the page in a new tab\n                window.open(`?${params.toString()}`, '_blank')\n            }}\n            >\n                View as Zoomable Page\n            </button>\n        </div>\n    )\n}\n","import React, { ReactNode } from 'react'\n\nimport { CountsByUT } from '../../components/countsByArticleType'\nimport { useMapGenerator } from '../map-generator'\nimport { EditMapperPanel } from '../settings/EditMapperPanel'\nimport { MapSettings } from '../settings/utils'\n\nexport function MapperPanel(props: { mapSettings: MapSettings, view: boolean, counts: CountsByUT }): ReactNode {\n    if (props.view) {\n        return <DisplayMap mapSettings={props.mapSettings} />\n    }\n\n    return <EditMapperPanel {...props} />\n}\n\nfunction DisplayMap({ mapSettings }: { mapSettings: MapSettings }): ReactNode {\n    const mapGenerator = useMapGenerator({ mapSettings })\n    return (\n        <>\n            {mapGenerator.ui({ mode: 'view' }).node}\n        </>\n    )\n}\n","export const cancelled = Symbol()\n\nexport function uploadFile(accept: string): Promise<File | typeof cancelled> {\n    const inputElement = document.createElement('input')\n    inputElement.setAttribute('type', 'file')\n    inputElement.setAttribute('accept', accept)\n    inputElement.style.display = 'none'\n    const result = new Promise<File | typeof cancelled>((resolve) => {\n        inputElement.onchange = () => {\n            resolve(inputElement.files![0])\n            inputElement.remove()\n        }\n        inputElement.oncancel = () => {\n            resolve(cancelled)\n            inputElement.remove()\n        }\n    })\n\n    document.body.appendChild(inputElement)\n    inputElement.click()\n\n    return result\n}\n"],"names":["Statistic","props","statname","_props_unit","useImperial","_useSetting","temperatureUnit","_useSetting1","_unitDisplay_renderValue","getUnitDisplay","unitType","value","separateNumber","unitName","adjustedValue","places","unit","rendered","ElectionResult","hours","Math","minutes","colors","useColors","text","party","partyColor","Percentile","ordinal","percentile","undefined","lngToWebMercatorX","lng","latToWebMercatorY","lat","area","coordBox","x1","x2","y1","y2","computeAspectRatioForInsets","mapsWithCoordBox","assert","biggestMap","prev","curr","onScreenWidth","onScreenHeight","computeAspectRatio","Colorbar","RampColorbar","param","ramp","valuesRef","useRef","_useState","shouldRotate","setShouldRotate","useLayoutEffect","values","updateShouldRotate","Array","container","contained","resizeObserver","ResizeObserver","furthest","useMemo","furthestColor","x","width","valuesDivs","rotate","i","interpolateColor","InsetMap","React","ref","inset","children","editInset","numInsets","id","screenshotMode","useScreenshotMode","CommonMaplibreMap","mapBorderWidth","insetBorderWidth","defaultMapBorderRadius","HandleInsets","newBox","ExposeMapForTesting","CustomAttributionControlComponent","EditInsetsHandles","newFrame","setCoordBox","map","useMap","useEffect","fit","getCoordBox","mapBounds","sw","ne","moveHandler","e","TestUtils","WeakRef","activeDrag","pointerHandlers","kind","thisElem","_activeDrag_current","drag","containerBounds","rawMovementX","rawMovementY","resizedFrame","movementX","movementY","Handle","_param","handleSize","style","img","rest","hover","setHover","divRef","handleMouseEnter","handleMouseLeave","div","useMapGenerator","mapSettings","cache","updateTime","Date","makeMapGenerator","currentGenerator","setCurrentGenerator","timeSinceMapUpdate","previousGenerator","timeout","setTimeout","mapUpdateInterval","clearTimeout","_useOrderedResolve","result","loading","EmptyMapLayout","emptyMap","stmts","parseErrors","_prev_ui","execResult","prev1","_prev_ui1","mapResultMain","csvData","csvFilename","_ref","features","mapChildren","MapComponent","exportPngRef","mapsRef","mapsContainerRef","wholeRenderRef","insetsFeatures","bbox","insetFeatures","poly","bounds","boundingBox","insetMaps","insets","newInset","visibleInsets","colorbar","setScreenshotMode","restoreMaps","r","resetAttrib","originalPixelRatio","attrib","prevDisplay","Promise","resolve","screencapElement","canonicalWidth","elementCanvas","restore","ScreenshotContext","MapLayout","noLocation","computeUSS","getAllParseErrors","executeAsync","generateMapperCSVData","loadMapResult","opaqueType","universe","geographyKind","scale","interpolations","points","polys","polygons","instantiate","val","doRender","dataValue","_cache_geo","idxLink","articles","centroids","geo","indexLink","loadProtobuf","loadCentroids","centroidsByName","Map","point","centroid","fs","clickable","PointFeatureCollection","meta","color","universeIdx","shapes","polygonsByName","universes_ordered","consolidatedShapeLink","geometry","polygon","PolygonFeatureCollection","BasemapComponent","JSON","exportPng","fn","maps","aspectRatio","TransformConstantWidth","RelativeLoader","LongLoad","loadInsets","layout","setLayout","childRef","updateScale","_Math","observer","ImportExportCode","setMapSettings","file","importResult","uploadFile","cancelled","importMapSettings","alert","saveAs","Blob","unparse","metadataSchema","z","mapperMetaFields","fileContent","parsed","parse","error","renderLocInfo","metadata","args","_iteratorError","arg","metadataResult","Object","issue","defaultSettings","convertToMapUss","settingNameStyle","MapperSettings","errors","counts","typeEnvironment","uss","renderString","useCallback","universes","geographyKinds","articleTypes","BetterSelector","newUniverse","newGeographyKind","TopLevelEditor","newUss","replace","edits","withArray","from","to","a","applied","swap","indexA","indexB","array","itemA","itemB","neswSchema","l","insetSchema","screenBounds","mainMap","name","constructInsetsSchema","call","mapSchema","idOutput","validMapperOutputs","getInsets","settings","_parseResult_currentValue","parseResult","replaceInsets","deconstruct","swapInsets","EditMapperPanel","_useState1","mapEditorMode","setMapEditorMode","selectionContext","Property","undoRedo","useUndoRedo","selection","updateCurrentSelection","addState","setMapSettingsWrapper","newSettings","firstEffect","jsonedSettings","navContext","useContext","Navigator","encodedSettings","gzipSync","defaultTypeEnvironment","mapGenerator","commonProps","PageTemplate","SelectionContext","InsetsMapEditor","USSMapEditor","ui","MaybeSplitLayout","Export","left","right","mobileLayout","useMobileLayout","SplitLayout","height","setHeight","splitRef","updateHeight","window","leftColProp","setLeftColProp","setDrag","dividerRef","minLeftColProp","minLeftWidth","maxLeftColProp","leftPct","mixWithBackground","propChange","dividerWidth","insetEdits","setInsetEdits","_useUndoRedo","undoRedoUi","canUndo","editedInsets","addInsetEdit","_mapSettings_universe","offsetInsetInBounds","currentInsetsAst","mapInsets","newConstructInsets","loadInsetExpression","exclude","delta","_iter","y","inBounds","c","b","saveAsFile","filename","data","type","blob","url","URL","link","document","doPngExport","fetch","doGeoJSONExport","params","URLSearchParams","MapperPanel","DisplayMap","Symbol","accept","inputElement"],"mappings":"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"}