{"version":3,"file":"loading.js","sources":["webpack://assets/./src/loading.ts","webpack://assets/webpack/runtime/rspack_version","webpack://assets/webpack/runtime/rspack_unique_id","webpack://assets/./src/page_template/color-themes.ts","webpack://assets/./src/data/hueColors.ts","webpack://assets/./src/utils/TestUtils.ts"],"sourcesContent":["import { colorThemes } from './page_template/color-themes'\n// eslint-disable-next-line import/no-unassigned-import -- Only care about side effects\nimport './utils/TestUtils'\n\nconst savedSettings = localStorage.getItem('settings')\n// eslint-disable-next-line no-restricted-syntax -- Represents persisted data\nconst loadedSettings = JSON.parse(savedSettings ?? '{}') as { theme?: string, clean_background?: boolean }\n\nlet theme: 'Dark Mode' | 'Light Mode'\n\nswitch (loadedSettings.theme) {\n    case 'Dark Mode':\n    case 'Light Mode':\n        theme = loadedSettings.theme\n        break\n    default:\n        theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'Dark Mode' : 'Light Mode'\n}\n\nconst themeDict = { ...colorThemes[theme] }\nif (loadedSettings.clean_background) {\n    themeDict.background = themeDict.cleanBackground\n    themeDict.slightlyDifferentBackground = themeDict.cleanSlightlyDifferentBackground\n}\n\ndocument.documentElement.style.setProperty('--loading-main', themeDict.textMain)\ndocument.documentElement.style.setProperty('--loading-background', themeDict.background)\n","__webpack_require__.rv = () => (\"1.3.15\")","__webpack_require__.ruid = \"bundler=rspack@1.3.15\";\n","import hueColors from '../data/hueColors'\n\nexport interface HueColors {\n    blue: string\n    orange: string\n    brown: string\n    purple: string\n    red: string\n    grey: string\n    darkGrey: string\n    pink: string\n    yellow: string\n    green: string\n    cyan: string\n}\n\nexport interface Colors {\n    background: string\n    cleanBackground: string\n    slightlyDifferentBackground: string\n    cleanSlightlyDifferentBackground: string\n    slightlyDifferentBackgroundFocused: string\n    highlight: string\n    textMain: string\n    textMainOpposite: string\n    textPointer: string\n    borderShadow: string\n    borderNonShadow: string\n    ordinalTextColor: string\n    unselectedButton: string\n    selectedButton: string\n    selectedButtonText: string\n    blueLink: string\n    mapInsetBorderColor: string\n    buttonTextWhite: string\n    bannerURL: string\n    mixPct: number\n    hueColors: HueColors\n    screenshotFooterUrl: string\n    pencilIcon: string\n    wikidataURL: string\n}\n\nexport interface JuxtastatColors {\n    correct: string\n    incorrect: string\n    correctEmoji: string\n    incorrectEmoji: string\n    lifeEmoji: string\n    lifeLostEmoji: string\n}\n\nconst defaultHueColors: HueColors = hueColors\n\nexport type Theme = 'Light Mode' | 'Dark Mode'\n\n/* eslint-disable no-restricted-syntax -- Allowing hex colors for themes */\nexport const colorThemes: Record<Theme, Colors> = {\n    'Light Mode': {\n        background: '#fff8f0',\n        cleanBackground: '#ffffff',\n        slightlyDifferentBackground: '#f7f1e8',\n        cleanSlightlyDifferentBackground: '#faf7f2',\n        slightlyDifferentBackgroundFocused: '#ffe0e0',\n        highlight: '#d4b5e2',\n        textMain: '#000000',\n        textMainOpposite: '#ffffff',\n        textPointer: '#222222',\n        borderShadow: '#333333',\n        borderNonShadow: '#cccccc',\n        ordinalTextColor: '#444444',\n        unselectedButton: '#e6e9ef',\n        selectedButton: '#4e525a',\n        selectedButtonText: '#ffffff',\n        blueLink: '#22f',\n        mapInsetBorderColor: '#000000',\n        buttonTextWhite: '#ffffff',\n        bannerURL: '/banner.png',\n        mixPct: 70,\n        hueColors: defaultHueColors,\n        screenshotFooterUrl: 'screenshot_footer.svg',\n        pencilIcon: '/pencil-light.png',\n        wikidataURL: '/wikidata-light.svg',\n    },\n    'Dark Mode': {\n        background: '#00060f',\n        cleanBackground: '#000000',\n        slightlyDifferentBackground: '#080e17',\n        cleanSlightlyDifferentBackground: '#080e17',\n        slightlyDifferentBackgroundFocused: '#3d2900',\n        highlight: '#3b1d49',\n        textMain: '#dddddd',\n        textMainOpposite: '#000000',\n        textPointer: '#dddddd',\n        borderShadow: '#cccccc',\n        borderNonShadow: '#333333',\n        ordinalTextColor: '#bbbbbb',\n        unselectedButton: '#303030',\n        selectedButton: '#a2a6ae',\n        selectedButtonText: '#000000',\n        blueLink: '#aaaaff',\n        mapInsetBorderColor: '#000000',\n        buttonTextWhite: '#ffffff',\n        bannerURL: '/banner-dark.png',\n        mixPct: 50,\n        hueColors: defaultHueColors,\n        screenshotFooterUrl: 'screenshot_footer_dark.svg',\n        pencilIcon: '/pencil-dark.png',\n        wikidataURL: '/wikidata-dark.svg',\n    },\n}\n/* eslint-enable no-restricted-syntax -- Allowing hex colors for themes */\n","export default {\n    \"blue\": \"#5a7dc3\",\n    \"orange\": \"#f7aa41\",\n    \"brown\": \"#af6707\",\n    \"purple\": \"#975ac3\",\n    \"red\": \"#f96d6d\",\n    \"grey\": \"#8e8e8e\",\n    \"darkGrey\": \"#4e525a\",\n    \"pink\": \"#c767b0\",\n    \"yellow\": \"#b8a32f\",\n    \"green\": \"#8ac35a\",\n    \"cyan\": \"#07a5af\"\n} as const","import type maplibregl from 'maplibre-gl'\n\n/**\n * Indicates whether we're e2e testing.\n *\n * Use sparingly! Functionality under testing should diverge minimally.\n *\n * Tests should be careful not to clear keys used by this\n */\nexport class TestUtils {\n    readonly isTesting = (window as unknown as TestWindow)['%hammerhead%'] !== undefined\n    readonly testIterationId: string | undefined\n    testSyncing = false\n\n    private constructor() {\n        let iterId = localStorage.getItem('testIterationId')\n        if (iterId === null && this.isTesting) {\n            iterId = crypto.randomUUID()\n            localStorage.setItem('testIterationId', iterId)\n        }\n        if (iterId !== null && !this.isTesting) {\n            iterId = null\n            localStorage.removeItem('testIterationId')\n        }\n        this.testIterationId = iterId ?? undefined\n    }\n\n    static shared = new TestUtils()\n\n    safeClearLocalStorage(): void {\n        const quizAuthEnabled = localStorage.getItem('enable_auth_features')\n        // eslint-disable-next-line no-restricted-syntax -- This is the safe function\n        localStorage.clear()\n        if (this.testIterationId !== undefined) {\n            localStorage.setItem('testIterationId', this.testIterationId)\n        }\n        if (quizAuthEnabled !== null) {\n            localStorage.setItem('enable_auth_features', quizAuthEnabled)\n        }\n    }\n\n    readonly maps = new Map<string, WeakRef<maplibregl.Map>>()\n\n    readonly clickableMaps = new Map<string, {\n        clickFeature: (name: string) => void\n        features: string[]\n    }>()\n\n    private loadingCounter = 0\n    private loadingCallbacks: (() => void)[] = []\n\n    startLoading(): void {\n        this.loadingCounter++\n    }\n\n    private async eventLoopIters(iters: number): Promise<void> {\n        for (;iters > 0; iters--) {\n            await new Promise(resolve => setTimeout(resolve, 0))\n        }\n    }\n\n    async finishLoading(): Promise<void> {\n        await this.eventLoopIters(10)\n        this.loadingCounter--\n        if (this.loadingCounter === 0) {\n            this.loadingCallbacks.forEach((callback) => { callback() })\n            this.loadingCallbacks = []\n        }\n    }\n\n    async waitForLoading(): Promise<void> {\n        await this.eventLoopIters(10)\n        if (this.loadingCounter === 0) {\n            return Promise.resolve()\n        }\n        else {\n            return new Promise((resolve) => {\n                this.loadingCallbacks.push(resolve)\n            })\n        }\n    }\n}\n\nexport interface TestWindow {\n    'testUtils': TestUtils\n    '%hammerhead%': unknown\n}\n\n(window as unknown as TestWindow).testUtils = TestUtils.shared\n"],"names":["theme","defaultHueColors","TestUtils","window","undefined","Map","iterId","localStorage","crypto","safeClearLocalStorage","quizAuthEnabled","startLoading","eventLoopIters","iters","Promise","resolve","setTimeout","finishLoading","callback","waitForLoading","savedSettings","loadedSettings","JSON","themeDict","colorThemes","document"],"mappings":"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"}