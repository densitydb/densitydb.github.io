{"version":3,"file":"655.js","sources":["webpack://assets/./src/components/map.css","webpack://assets/./src/components/map.css?b72c","webpack://assets/./src/components/map-common.tsx","webpack://assets/./src/utils/partition.ts","webpack://assets/./src/map-partition.ts","webpack://assets/./src/utils/promiseStream.ts","webpack://assets/./src/utils/useOrderedResolve.ts"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nimport ___CSS_LOADER_GET_URL_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/getUrl.js\";\nvar ___CSS_LOADER_URL_IMPORT_0___ = new URL(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2729%27 height=%2729%27 fill=%27%23333%27 viewBox=%270 0 29 29%27%3E%3Cpath d=%27M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z%27/%3E%3C/svg%3E\", import.meta.url);\nvar ___CSS_LOADER_URL_IMPORT_1___ = new URL(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%2729%27 height=%2729%27 viewBox=%270 0 29 29%27%3E%3Cpath d=%27M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z%27/%3E%3C/svg%3E\", import.meta.url);\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\nvar ___CSS_LOADER_URL_REPLACEMENT_0___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_0___);\nvar ___CSS_LOADER_URL_REPLACEMENT_1___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_1___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `/* Style fullscreen/shrink controls to match \"Zoom to\" controls */\n.maplibregl-ctrl-top-left .maplibregl-ctrl.maplibregl-ctrl-group:has(.maplibregl-ctrl-fullscreen, .maplibregl-ctrl-shrink) {\n    margin: 1em;\n    padding: calc((3em - 29px) / 2); /* (height of zoom button + 2*padding of flex container - height of icon)/2 */\n    background-color: var(--background);\n    box-shadow: none;\n\n    > button:hover:not(:disabled) {\n        background-color: var(--slightly-different-background-focused);\n    }\n\n    > button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon {\n        mask-image: url(${___CSS_LOADER_URL_REPLACEMENT_0___});\n        background-color: var(--text-main);\n        background-image: none;\n    }\n\n    > button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon {\n        mask-image: url(${___CSS_LOADER_URL_REPLACEMENT_1___});\n        background-color: var(--text-main);\n        background-image: none;\n    }\n}\n\n.maplibregl-ctrl-attrib {\n    transform: scale(0.85);\n    transform-origin: bottom right;\n}`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/components/map.css\"],\"names\":[],\"mappings\":\"AAAA,iEAAiE;AACjE;IACI,WAAW;IACX,+BAA+B,EAAE,6EAA6E;IAC9G,mCAAmC;IACnC,gBAAgB;;IAEhB;QACI,8DAA8D;IAClE;;IAEA;QACI,mDAAyb;QACzb,kCAAkC;QAClC,sBAAsB;IAC1B;;IAEA;QACI,mDAA2a;QAC3a,kCAAkC;QAClC,sBAAsB;IAC1B;AACJ;;AAEA;IACI,sBAAsB;IACtB,8BAA8B;AAClC\",\"sourcesContent\":[\"/* Style fullscreen/shrink controls to match \\\"Zoom to\\\" controls */\\n.maplibregl-ctrl-top-left .maplibregl-ctrl.maplibregl-ctrl-group:has(.maplibregl-ctrl-fullscreen, .maplibregl-ctrl-shrink) {\\n    margin: 1em;\\n    padding: calc((3em - 29px) / 2); /* (height of zoom button + 2*padding of flex container - height of icon)/2 */\\n    background-color: var(--background);\\n    box-shadow: none;\\n\\n    > button:hover:not(:disabled) {\\n        background-color: var(--slightly-different-background-focused);\\n    }\\n\\n    > button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon {\\n        mask-image: url(\\\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E\\\");\\n        background-color: var(--text-main);\\n        background-image: none;\\n    }\\n\\n    > button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon {\\n        mask-image: url(\\\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E\\\");\\n        background-color: var(--text-main);\\n        background-image: none;\\n    }\\n}\\n\\n.maplibregl-ctrl-attrib {\\n    transform: scale(0.85);\\n    transform-origin: bottom right;\\n}\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!./map.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!./map.css\";\n       export default content && content.locals ? content.locals : undefined;\n","import maplibregl from 'maplibre-gl'\nimport 'maplibre-gl/dist/maplibre-gl.css'\nimport React, { ReactNode, useContext, useEffect, useId, useMemo } from 'react'\nimport { Layer, Map, MapProps, MapRef, Source, useControl, useMap } from 'react-map-gl/maplibre'\n\nimport { boundingBox, extendBoxes, geometry } from '../map-partition'\nimport { Basemap } from '../mapper/settings/utils'\nimport { Navigator } from '../navigation/Navigator'\nimport { useColors } from '../page_template/colors'\nimport { TestUtils } from '../utils/TestUtils'\nimport { assert } from '../utils/defensive'\nimport { promiseStream, waiting } from '../utils/promiseStream'\nimport { Feature } from '../utils/protos'\nimport { loadFeatureFromPossibleSymlink } from '../utils/symlinks'\nimport { NormalizeProto } from '../utils/types'\nimport { useOrderedResolve } from '../utils/useOrderedResolve'\n\nimport { defaultMapBorderRadius, mapBorderWidth, useScreenshotMode } from './screenshot'\n\nimport './map.css'\n\nexport const defaultMapPadding = 20\nexport const insetBorderWidth = 2\n\nvoid maplibregl.setRTLTextPlugin('https://unpkg.com/@mapbox/mapbox-gl-rtl-text@0.3.0/dist/mapbox-gl-rtl-text.js', true)\n\n// eslint-disable-next-line no-restricted-syntax -- Forwarded ref\nfunction _CommonMaplibreMap(props: MapProps, ref: React.Ref<MapRef>): ReactNode {\n    const colors = useColors()\n    const isScreenshotMode = useScreenshotMode()\n\n    return (\n        <Map\n            ref={ref}\n            mapStyle=\"https://tiles.openfreemap.org/styles/bright\"\n            canvasContextAttributes={{\n                preserveDrawingBuffer: true, // Allows screenshots\n            }}\n            {...props}\n            style={{\n                width: '100%',\n                height: 400,\n                borderRadius: defaultMapBorderRadius,\n                border: `${mapBorderWidth}px solid ${colors.borderNonShadow}`,\n                // Background color is used for e2e tests\n                backgroundColor: isScreenshotMode ? 'transparent' : colors.slightlyDifferentBackground,\n                ...props.style,\n            }}\n        />\n    )\n}\n\n// eslint-disable-next-line no-restricted-syntax -- Is a function component\nexport const CommonMaplibreMap = React.forwardRef(_CommonMaplibreMap)\n\n// We don't use refs on these to avoid races, as the mapRef may be assigned after the feature has loaded\nexport function useZoomFirstFeature(mapRef: MapRef | null, features: (GeoJSON.Feature | typeof waiting)[]): void {\n    const firstFeature = features.length > 0 ? features[0] : undefined\n\n    useEffect(() => {\n        if (firstFeature === undefined || firstFeature === waiting) {\n            return\n        }\n        mapRef?.fitBounds(boundingBox(firstFeature.geometry), { animate: false, padding: defaultMapPadding })\n    }, [mapRef, firstFeature]) // Don't depend on all features or we keep zooming as they load\n}\n\nexport function useZoomAllFeatures(mapRef: MapRef | null, features: (GeoJSON.Feature | typeof waiting)[], readyFeatures: GeoJSON.Feature[]): void {\n    useEffect(() => {\n        if (readyFeatures.length < features.length) {\n            return\n        }\n        // Only zoom once all features are ready\n        mapRef?.fitBounds(extendBoxes(readyFeatures.map(f => boundingBox(f.geometry))), { animate: false, padding: defaultMapPadding })\n    }, [mapRef, features, readyFeatures])\n}\n\nexport interface Polygon {\n    name: string\n    clickable?: boolean\n\n    // Style\n    fillColor: string\n    fillOpacity: number\n    color: string\n    weight?: number\n\n    [meta: string]: unknown\n}\n\nconst urbanStatsLayerPrefix = 'urban-stats'\n\nfunction polygonsId(id: string, kind: 'source' | 'fill' | 'outline'): string {\n    return `${urbanStatsLayerPrefix}-polygons-${kind}-${id}`\n}\n\nexport function PolygonFeatureCollection({ features, clickable }: { features: GeoJSON.Feature[], clickable: boolean }): ReactNode {\n    const { current: map } = useMap()\n\n    const labelId = useOrderedResolve(useMemo(() => map !== undefined ? firstLabelId(map) : Promise.resolve(undefined), [map])).result\n\n    const collection: GeoJSON.FeatureCollection = useMemo(() => ({\n        type: 'FeatureCollection',\n        features,\n    }), [features])\n\n    const id = useId()\n\n    useClickable({ id: polygonsId(id, 'fill'), features, clickable })\n\n    return (\n        <>\n            <Source id={polygonsId(id, 'source')} type=\"geojson\" data={collection} />\n            <Layer\n                id={polygonsId(id, 'fill')}\n                type=\"fill\"\n                source={polygonsId(id, 'source')}\n                paint={{\n                    'fill-color': ['get', 'fillColor'],\n                    'fill-opacity': ['get', 'fillOpacity'],\n                }}\n                beforeId={labelId}\n            />\n            <Layer\n                id={polygonsId(id, 'outline')}\n                type=\"line\"\n                source={polygonsId(id, 'source')}\n                paint={{\n                    'line-color': ['get', 'color'],\n                    'line-width': ['get', 'weight'],\n                }}\n                beforeId={labelId}\n            />\n        </>\n    )\n}\n\nasync function polygonGeojson(polygon: Polygon): Promise<GeoJSON.Feature> {\n    const feature = await loadFeatureFromPossibleSymlink(polygon.name) as NormalizeProto<Feature>\n    return {\n        type: 'Feature' as const,\n        properties: polygon,\n        geometry: geometry(feature),\n    }\n}\n\nexport function polygonFeatureCollection(polygons: Polygon[]): { use: () => (GeoJSON.Feature | typeof waiting)[] } {\n    return promiseStream(polygons.map(polygonGeojson))\n}\n\nasync function waitForMapLoadedOrRemoved(map: MapRef): Promise<void> {\n    if (!map.loaded()) {\n        await Promise.any([\n            map.once('load'),\n            map.once('remove'), // Map might be removed while it's loading\n        ])\n    }\n}\n\nasync function firstLabelId(map: MapRef): Promise<string | undefined> {\n    await waitForMapLoadedOrRemoved(map)\n    for (const layerId of map.getLayersOrder()) {\n        const layer = map.getLayer(layerId)!\n        if (layer.type === 'symbol' && layer.id.startsWith('label')) {\n            return layer.id\n        }\n    }\n    return undefined\n}\n\nclass CustomAttributionControl extends maplibregl.AttributionControl {\n    constructor(startShowingAttribution: boolean) {\n        super()\n\n        // Copied from implementation https://github.com/maplibre/maplibre-gl-js/blob/34b95c06259014661cf72a418fd81917313088bf/src/ui/control/attribution_control.ts#L190\n        // But reduced since always compact\n        this._updateCompact = () => {\n            if (!this._container.classList.contains('maplibregl-compact') && !this._container.classList.contains('maplibregl-attrib-empty')) {\n                this._container.classList.add('maplibregl-compact')\n                if (startShowingAttribution) {\n                    this._container.setAttribute('open', '')\n                    this._container.classList.add('maplibregl-compact-show')\n                }\n            }\n        }\n    }\n}\n\nexport function CustomAttributionControlComponent({ startShowingAttribution }: { startShowingAttribution: boolean }): ReactNode {\n    useControl(() => new CustomAttributionControl(startShowingAttribution))\n    return null\n}\n\nfunction pointsId(id: string, kind: 'source' | 'fill' | 'outline'): string {\n    return `${urbanStatsLayerPrefix}-points-${kind}-${id}`\n}\n\nexport function PointFeatureCollection({ features, clickable }: { features: GeoJSON.Feature[], clickable: boolean }): ReactNode {\n    const { current: map } = useMap()\n    const id = useId()\n\n    const labelId = useOrderedResolve(useMemo(() => map !== undefined ? firstLabelId(map) : Promise.resolve(undefined), [map])).result\n\n    const collection: GeoJSON.FeatureCollection = useMemo(() => ({\n        type: 'FeatureCollection',\n        features,\n    }), [features])\n\n    useClickable({ id: pointsId(id, 'fill'), features, clickable })\n\n    return (\n        <>\n            <Source id={pointsId(id, 'source')} type=\"geojson\" data={collection} />\n            <Layer\n                id={pointsId(id, 'fill')}\n                type=\"circle\"\n                source={pointsId(id, 'source')}\n                paint={{\n                    'circle-color': ['get', 'fillColor'],\n                    'circle-opacity': ['get', 'fillOpacity'],\n                    'circle-radius': ['get', 'radius'],\n                }}\n                beforeId={labelId}\n            />\n        </>\n    )\n}\n\nfunction useClickable({ id, clickable, features }: { id: string, clickable: boolean, features: GeoJSON.Feature[] }): void {\n    const navigator = useContext(Navigator.Context)\n\n    const { current: map } = useMap()\n\n    useEffect(() => {\n        if (clickable) {\n            assert(map !== undefined, 'map is undefined')\n\n            const clickFeature = (name: string): void => {\n                void navigator.navigate({\n                    kind: 'article',\n                    universe: navigator.universe,\n                    longname: name,\n                }, { history: 'push', scroll: { kind: 'element', element: map.getContainer() } })\n            }\n\n            const overCallback = (): void => {\n                map.getCanvas().style.cursor = 'pointer'\n            }\n            const leaveCallback = (): void => {\n                map.getCanvas().style.cursor = ''\n            }\n            const clickCallback = (e: maplibregl.MapMouseEvent & {\n                features?: maplibregl.MapGeoJSONFeature[]\n            }): void => {\n                const feature = e.features?.find(f => f.properties.clickable !== false)\n                if (feature !== undefined) {\n                    clickFeature(feature.properties.name as string)\n                }\n            }\n            map.on('mouseover', id, overCallback)\n            map.on('mouseleave', id, leaveCallback)\n            map.on('click', id, clickCallback)\n\n            TestUtils.shared.clickableMaps.set(id, { clickFeature, features: features.map(f => f.properties!.name as string) })\n\n            return () => {\n                map.off('mouseover', id, overCallback)\n                map.off('mouseleave', id, leaveCallback)\n                map.off('click', id, clickCallback)\n\n                TestUtils.shared.clickableMaps.delete(id)\n            }\n        }\n\n        return () => undefined\n    }, [id, map, clickable, navigator, features])\n}\n\n// eslint-disable-next-line no-restricted-syntax -- This is the default maplibre background color\nconst defaultBackgroundColor = '#f8f4f0'\n\nexport function Basemap({ basemap }: { basemap: Basemap }): ReactNode {\n    const map = useMap().current!\n\n    const mapLoaded = useOrderedResolve(useMemo(async () => {\n        await waitForMapLoadedOrRemoved(map)\n        return true\n    }, [map])).result ?? false\n\n    useEffect(() => {\n        if (mapLoaded) {\n            for (const layerId of map.getLayersOrder()) {\n                if (layerId === 'background' || layerId.startsWith(urbanStatsLayerPrefix)) {\n                    continue\n                }\n                const layer = map.getLayer(layerId)!\n                map.getMap().setLayoutProperty(layerId, 'visibility', isVisible(basemap, layer) ? 'visible' : 'none')\n            }\n            map.getMap().setPaintProperty('background', 'background-color', basemap.type === 'none' ? basemap.backgroundColor : defaultBackgroundColor)\n            map.getMap().setPaintProperty('background', 'background-color-transition', { duration: 0, delay: 0 })\n        }\n    }, [map, basemap, mapLoaded])\n\n    const labelId = useOrderedResolve(useMemo(() => firstLabelId(map), [map])).result\n\n    if (basemap.type === 'osm' && basemap.subnationalOutlines !== undefined) {\n        return (\n            <Layer\n                id=\"boundary_subn_overlayed\"\n                type=\"line\"\n                source=\"openmaptiles\"\n                source-layer=\"boundary\"\n                filter={[\n                    'all',\n                    ['<=', ['get', 'admin_level'], 4],\n                    ['!=', ['get', 'maritime'], 1],\n                    ['!=', ['get', 'disputed'], 1],\n                    ['!', ['has', 'claimed_by']],\n                ]}\n                paint={{\n                    'line-color': basemap.subnationalOutlines.color,\n                    'line-width': basemap.subnationalOutlines.weight,\n                }}\n                beforeId={labelId}\n            />\n        )\n    }\n\n    return null\n}\n\nfunction isVisible(basemap: Basemap, layer: { type: string }): boolean {\n    switch (basemap.type) {\n        case 'none':\n            return false\n        case 'osm':\n            if (basemap.noLabels && layer.type === 'symbol') {\n                return false\n            }\n            return true\n    }\n}\n","/**\n * Efficiently finds the best partition in some search space, given a hueristic\n * The hueristic must not increase when an element is added to any partition in the partition set that is ordred greater than all the elements already in the partition\n *\n * Example: (match numbers to partition group index parity)\n * bestPartition(3, 2, ps => ps.reduce((a, p, i) => a + p.reduce((b, n) => b + n % 2 !== i % 2 ? 1 : 0, 0), 0), (a, b) => b - a) -> [[0, 2], [1]]\n *\n * This function has a built-in time limit, and will stop generating if it starts taking too long\n */\nexport function bestPartition<Score>(upperBound: number, maxPartitions: number, score: (partition: number[][]) => Score, compareScores: (a: Score, b: Score) => number): number[][] {\n    const timeLimit = Date.now() + 500\n    let bestScore: Score | undefined\n    let best: number[][] | undefined\n\n    function helper(index: number, current: number[][], currentScore?: Score): void {\n        if (Date.now() > timeLimit) {\n            throw new Error('out of time')\n        }\n\n        if (index === upperBound) {\n            currentScore = currentScore ?? score(current)\n            if (bestScore === undefined || compareScores(currentScore, bestScore) > 0) {\n                bestScore = currentScore\n                best = current\n            }\n            return\n        }\n\n        if (current.length === 0) {\n            helper(index + 1, [[index]])\n            return\n        }\n\n        for (let i = 0; i < current.length; i++) {\n            const newPartition = current.map((subset, j) =>\n                i === j ? [...subset, index] : subset,\n            )\n            const newPartitionScore = score(newPartition)\n            if (bestScore === undefined || compareScores(newPartitionScore, bestScore) >= 0) {\n                helper(index + 1, newPartition, newPartitionScore)\n            }\n        }\n\n        if (current.length < maxPartitions) {\n            const newPartition = [...current, [index]]\n            helper(index + 1, newPartition)\n        }\n    }\n\n    helper(0, [])\n    return best!\n}\n","import geojsonExtent from '@mapbox/geojson-extent'\nimport maplibregl from 'maplibre-gl'\nimport { min } from 'mathjs'\n\nimport { bestPartition } from './utils/partition'\nimport { Feature } from './utils/protos'\nimport { loadFeatureFromPossibleSymlink } from './utils/symlinks'\nimport { NormalizeProto } from './utils/types'\n\nexport function geometry(poly: NormalizeProto<Feature>): GeoJSON.Geometry {\n    if (poly.geometry === 'multipolygon') {\n        const polys = poly.multipolygon.polygons\n        const coords = polys.map(\n            multiPoly => multiPoly.rings.map(\n                ring => ring.coords.map(\n                    coordinate => [coordinate.lon, coordinate.lat],\n                ),\n            ),\n        )\n        return {\n            type: 'MultiPolygon',\n            coordinates: coords,\n        }\n    }\n    else {\n        const coords = poly.polygon.rings.map(\n            ring => ring.coords.map(\n                coordinate => [coordinate.lon, coordinate.lat],\n            ),\n        )\n        return {\n            type: 'Polygon',\n            coordinates: coords,\n        }\n    }\n}\n\nconst boundingBoxCache = new WeakMap<GeoJSON.Geometry, maplibregl.LngLatBounds>()\n\nexport function boundingBox(geo: GeoJSON.Geometry): maplibregl.LngLatBounds {\n    let result: maplibregl.LngLatBounds | undefined\n    if ((result = boundingBoxCache.get(geo)) !== undefined) {\n        return result\n    }\n\n    const bbox = geojsonExtent(geo)\n    result = new maplibregl.LngLatBounds(\n        new maplibregl.LngLat(bbox[0], bbox[1]),\n        new maplibregl.LngLat(bbox[2], bbox[3]),\n    )\n    boundingBoxCache.set(geo, result)\n\n    return result\n}\n\nexport function extendBoxes(boxes: maplibregl.LngLatBounds[]): maplibregl.LngLatBounds {\n    return boxes.reduce((result, box) => result.extend(box), new maplibregl.LngLatBounds())\n}\n\n// Area of bounds in EPSG:3857 projection\nfunction area(bounds: maplibregl.LngLatBounds): number {\n    const sw = maplibregl.MercatorCoordinate.fromLngLat(bounds.getSouthWest())\n    const ne = maplibregl.MercatorCoordinate.fromLngLat(bounds.getNorthEast())\n    // Handle wrapping by normalizing x difference\n    let dx = ne.x - sw.x\n    if (dx < 0) {\n        dx += 1 // Web Mercator x wraps at 1\n    }\n    return Math.abs(dx * (ne.y - sw.y))\n}\n\nfunction proportionFilled(boxes: maplibregl.LngLatBounds[]): number {\n    return boxes.reduce((a, box) => a + area(box), 0) / area(extendBoxes(boxes))\n}\n\n/**\n * Given many regions to be compared, determine how best to split them into multiple maps\n *\n * If the bounds of the regions fill a map above some threshold, put all the regions in the same map\n *\n * Otherwise, weigh multiple groupings to determine the best one\n */\nexport async function partitionLongnames(longnames: string[]): Promise<number[][]> {\n    const fillThreshold = 0.1\n    const maxMaps = 6\n\n    const boundingBoxes = await Promise.all(longnames.map(async longname => boundingBox(geometry(await loadFeatureFromPossibleSymlink(longname) as NormalizeProto<Feature>))))\n\n    // We need to sort the bounding boxes otherwise there could be an edge case when partitioning where a region gets added in the middle of a partition two other regions\n    // The partition of those two far partitions would not have been explored in `bestPartition`, since the hueristic would have eliminated that search space.\n    // Therefore, we need to sort the bounding boxes\n    const sortedBoundingBoxes = Array.from(boundingBoxes.entries())\n        .sort(([, a], [, b]) => a.getCenter().lat - b.getCenter().lat)\n        .sort(([, a], [, b]) => a.getCenter().lng - b.getCenter().lng)\n\n    try {\n        const partitions = bestPartition(sortedBoundingBoxes.length, maxMaps,\n            ps => ps.map((partition) => {\n                const filled = proportionFilled(partition.map(index => sortedBoundingBoxes[index][1]))\n                if (filled >= fillThreshold) {\n                    return partition.length\n                }\n                return filled\n            }).sort((a, b) => a - b),\n            (a, b) => {\n                for (let i = 0; i < Math.min(a.length, b.length); i++) {\n                    if (a[i] !== b[i]) {\n                        return a[i] - b[i]\n                    }\n                }\n                return a.length - b.length\n            },\n        )\n\n        // Un-sort the indices\n        // Also re-sort the partitions by the unsorted indices\n        const unsortedPartitions = partitions.map(partition => partition.map(index => sortedBoundingBoxes[index][0])\n            .sort((a, b) => a - b)).sort((a, b) => min(a) - min(b))\n\n        return unsortedPartitions\n    }\n    catch (e) {\n        console.warn('Error partitioning maps', e)\n    }\n\n    // Give up\n    return [longnames.map((_, i) => i)]\n}\n","import { Property } from './Property'\nimport { TestUtils } from './TestUtils'\n\nexport const waiting = Symbol('waiting')\n\nexport function notWaiting<T>(x: T | typeof waiting): x is T {\n    return x !== waiting\n}\n\n// Turns an array of promies into a property that updates with their ordered results\nexport function promiseStream<T>(promises: Promise<T>[]): Property<(T | typeof waiting)[]> {\n    const values = Array.from<T | typeof waiting>({ length: promises.length }).fill(waiting)\n    const result = new Property<(T | typeof waiting)[]>(Array.from(values))\n\n    TestUtils.shared.startLoading()\n    void Promise.allSettled(promises).finally(() => TestUtils.shared.finishLoading())\n\n    for (const [i, promise] of promises.entries()) {\n        void promise.then((value) => {\n            values[i] = value\n            result.value = Array.from(values)\n        })\n    }\n    return result\n}\n","import { useEffect, useState } from 'react'\n\nimport { TestUtils } from './TestUtils'\n\nexport interface ResolveState<T> {\n    promise: Promise<T>\n    result: T | undefined\n    loading: boolean\n}\n\nexport function useOrderedResolve<T>(promise: Promise<T>): ResolveState<T> {\n    const [state, setState] = useState<ResolveState<T>>({ promise, result: undefined, loading: true })\n\n    useEffect(() => {\n        setState(prevState => ({ promise, result: prevState.result, loading: true }))\n        TestUtils.shared.startLoading()\n        void promise.then(\n            (result) => {\n                setState(prevState => prevState.promise === promise ? ({ promise, result, loading: false }) : prevState)\n            },\n            () => {\n                setState(prevState => prevState.promise === promise ? ({ promise, result: undefined, loading: false }) : prevState)\n            },\n        ).finally(() => { void TestUtils.shared.finishLoading() })\n    }, [promise])\n\n    return state\n}\n"],"names":["URL","defaultMapPadding","insetBorderWidth","maplibregl","CommonMaplibreMap","React","props","ref","colors","useColors","isScreenshotMode","useScreenshotMode","Map","defaultMapBorderRadius","mapBorderWidth","useZoomFirstFeature","mapRef","features","firstFeature","undefined","useEffect","waiting","boundingBox","useZoomAllFeatures","readyFeatures","extendBoxes","f","urbanStatsLayerPrefix","polygonsId","id","kind","PolygonFeatureCollection","param","clickable","map","_useMap","labelId","useOrderedResolve","useMemo","firstLabelId","Promise","collection","useId","useClickable","Source","Layer","polygonGeojson","polygon","feature","loadFeatureFromPossibleSymlink","geometry","polygonFeatureCollection","polygons","promiseStream","waitForMapLoadedOrRemoved","_iteratorError","layerId","layer","CustomAttributionControl","startShowingAttribution","CustomAttributionControlComponent","useControl","pointsId","PointFeatureCollection","navigator","useContext","Navigator","assert","clickFeature","name","overCallback","leaveCallback","clickCallback","e","_e_features","TestUtils","Basemap","_useOrderedResolve_result","basemap","useMap","mapLoaded","isVisible","poly","polys","multiPoly","ring","coordinate","boundingBoxCache","WeakMap","geo","result","bbox","geojsonExtent","boxes","box","area","bounds","sw","ne","dx","Math","partitionLongnames","longnames","fillThreshold","maxMaps","sortedBoundingBoxes","unsortedPartitions","longname","Array","boundingBoxes","a","b","upperBound","maxPartitions","score","compareScores","bestScore","best","timeLimit","ps","partition","filled","index","i","Date","helper","current","currentScore","newPartition","subset","j","newPartitionScore","Error","partitions","min","console","_","Symbol","notWaiting","x","promises","values","Property","promise","value","_useState","state","setState","prevState"],"mappings":"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"}