{"version":3,"file":"650.js","sources":["webpack://assets/./src/utils/array-edits.ts","webpack://assets/./src/utils/coordinates.ts","webpack://assets/./src/mapper/components/Colorbar.tsx","webpack://assets/./src/utils/saveAsFile.ts","webpack://assets/./src/mapper/settings/ImportExportCode.tsx","webpack://assets/./src/mapper/style.ts","webpack://assets/./src/mapper/settings/MapperSettings.tsx","webpack://assets/./src/mapper/settings/edit-insets.ts","webpack://assets/./src/mapper/settings/edit-text-boxes.ts","webpack://assets/./src/mapper/settings/EditMapperPanel.tsx","webpack://assets/./src/mapper/map-generator.tsx","webpack://assets/./src/mapper/components/MapperPanel.tsx","webpack://assets/./src/utils/upload.ts"],"sourcesContent":["export type ArrayEdits<T> = (a: T[]) => T[]\n\nexport function replace<T>(edits: ArrayEdits<T>, [from, to]: [number, number], withArray: T[]): ArrayEdits<T> {\n    return (a) => {\n        const applied = edits(a)\n        return [...applied.slice(0, from), ...withArray, ...applied.slice(to)]\n    }\n}\n\nexport function swap<T>(edits: ArrayEdits<T>, indexA: number, indexB: number): ArrayEdits<T> {\n    return (a) => {\n        const array = edits(a)\n        const itemA = array[indexA]\n        const itemB = array[indexB]\n        const result = Array.from(array)\n        result[indexB] = itemA\n        result[indexA] = itemB\n        return result\n    }\n}\n\nexport interface EditSeq<T> {\n    modify: (index: number, v: Partial<T>) => void\n    edited: T[]\n    add: () => void\n    delete: (i: number) => void\n    duplicate: (i: number) => void\n    moveUp: (i: number) => void\n    moveDown: (i: number) => void\n}\n\nexport interface Edit<T> {\n    modify: (v: Partial<T>) => void\n    duplicate: () => void\n    delete: () => void\n    add: () => void\n    moveUp: () => void\n    moveDown: () => void\n}\n\nexport function editIndex<T>(seq: EditSeq<T>, i: number): Edit<T> {\n    return {\n        modify: (v: Partial<T>) => { seq.modify(i, v) },\n        delete: () => { seq.delete(i) },\n        duplicate: () => { seq.duplicate(i) },\n        add: seq.add,\n        moveUp: () => { seq.moveUp(i) },\n        moveDown: () => { seq.moveDown(i) },\n    }\n}\n","import { Inset } from '../urban-stats-script/constants/insets'\n\nimport { assert } from './defensive'\n\n// Web Mercator projection functions\nfunction lngToWebMercatorX(lng: number): number {\n    return lng * Math.PI / 180 * 6378137\n}\n\nfunction latToWebMercatorY(lat: number): number {\n    return 6378137 * Math.log(Math.tan(Math.PI / 4 + lat * Math.PI / 360))\n}\n\nexport function computeAspectRatio(coordBox: [number, number, number, number]): number {\n    // coordBox is [west, south, east, north]\n    const x1 = lngToWebMercatorX(coordBox[0])\n    const x2 = lngToWebMercatorX(coordBox[2])\n    const y1 = latToWebMercatorY(coordBox[1])\n    const y2 = latToWebMercatorY(coordBox[3])\n\n    const width = Math.abs(x2 - x1)\n    const height = Math.abs(y2 - y1)\n\n    return width / height\n}\n\nfunction area(coordBox: [number, number, number, number]): number {\n    // coordBox is [west, south, east, north]\n    const x1 = lngToWebMercatorX(coordBox[0])\n    const x2 = lngToWebMercatorX(coordBox[2])\n    const y1 = latToWebMercatorY(coordBox[1])\n    const y2 = latToWebMercatorY(coordBox[3])\n\n    return Math.abs((x2 - x1) * (y2 - y1))\n}\n\nexport function computeAspectRatioForInsets(mapsWithCoordBox: Inset[]): number {\n    assert(mapsWithCoordBox.length > 0, 'No insets with coordBox')\n\n    const biggestMap = mapsWithCoordBox.reduce((prev, curr) => {\n        return area(curr.coordBox) > area(prev.coordBox) ? curr : prev\n    })\n    const coordBox = biggestMap.coordBox\n    const onScreenWidth = biggestMap.topRight[0] - biggestMap.bottomLeft[0]\n    const onScreenHeight = biggestMap.topRight[1] - biggestMap.bottomLeft[1]\n    const onScreenAspectRatio = onScreenWidth / onScreenHeight\n    return computeAspectRatio(coordBox) / onScreenAspectRatio\n}\n","import React, { ReactNode, useLayoutEffect, useMemo, useRef, useState } from 'react'\n\nimport { Statistic } from '../../components/display-stats'\nimport { Colors } from '../../page_template/color-themes'\nimport { useColors } from '../../page_template/colors'\nimport { ScaleInstance } from '../../urban-stats-script/constants/scale'\nimport { furthestColor, interpolateColor } from '../../utils/color'\nimport { UnitType } from '../../utils/unit'\nimport { Keypoints } from '../ramps'\nimport { Basemap } from '../settings/utils'\n\ninterface EmpiricalRamp {\n    ramp: Keypoints\n    scale: ScaleInstance\n    interpolations: number[]\n    label: string\n    unit?: UnitType\n}\n\nexport type RampToDisplay = { type: 'ramp', value: EmpiricalRamp } | { type: 'label', value: string }\n\nexport function styleFromBasemap(basemap: Basemap, colors: Colors): { backgroundColor: string, color?: string } {\n    return basemap.type === 'none'\n        ? { backgroundColor: basemap.backgroundColor, color: basemap.textColor }\n        : { backgroundColor: colors.background }\n}\n\nexport function Colorbar(props: { ramp: RampToDisplay | undefined, basemap: Basemap }): ReactNode {\n    const colors = useColors()\n\n    return (\n        <div style={{\n            width: '100%',\n            ...styleFromBasemap(props.basemap, colors),\n            padding: '10px',\n        }}\n        >\n            {props.ramp && props.ramp.type === 'label' && (\n                <div className=\"centered_text user_input\">\n                    {props.ramp.value}\n                </div>\n            )}\n            {props.ramp && props.ramp.type === 'ramp' && (\n                <RampColorbar ramp={props.ramp.value} />\n            )}\n        </div>\n    )\n}\n\nfunction RampColorbar({ ramp }: { ramp: EmpiricalRamp }): ReactNode {\n    // do this as a table with 10 columns, each 10% wide and\n    // 2 rows. Top one is the colorbar, bottom one is the\n    // labels.\n    const valuesRef = useRef<HTMLDivElement>(null)\n\n    const [shouldRotate, setShouldRotate] = useState(false)\n\n    useLayoutEffect(() => {\n        const values = valuesRef.current\n        if (values === null) {\n            return\n        }\n        const updateShouldRotate = (): void => {\n            setShouldRotate(\n                Array.from(values.querySelectorAll('.containerOfXticks')).some((container) => {\n                    const contained: HTMLDivElement | null = container.querySelector('.containedOfXticks')\n                    return contained !== null && contained.offsetWidth > (container as HTMLDivElement).offsetWidth * 0.9\n                }),\n            )\n        }\n        updateShouldRotate()\n        const resizeObserver = new ResizeObserver(updateShouldRotate)\n        resizeObserver.observe(values)\n        return () => {\n            resizeObserver.unobserve(values)\n        }\n    }, [ramp])\n\n    const furthest = useMemo(() => furthestColor(ramp.ramp.map(x => x[1])), [ramp])\n\n    const createValue = (stat: number): ReactNode => {\n        return (\n            <div className=\"centered_text\">\n                <Statistic\n                    statname={ramp.label}\n                    value={stat}\n                    isUnit={false}\n                    unit={ramp.unit}\n                />\n                <Statistic\n                    statname={ramp.label}\n                    value={stat}\n                    isUnit={true}\n                    unit={ramp.unit}\n                />\n            </div>\n        )\n    }\n\n    const width = `${100 / ramp.interpolations.length}%`\n\n    const valuesDivs = (rotate: boolean): ReactNode[] => ramp.interpolations.map((x, i) => (\n        <div\n            key={i}\n            style={{\n                width,\n                // height: rotate ? '2em' : '1em',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n            }}\n            className=\"containerOfXticks\"\n        >\n            <div\n                style={{\n                    // transform: rotate ? 'rotate(-45deg)' : 'none',\n                    writingMode: rotate ? 'sideways-lr' : 'horizontal-tb',\n                    padding: rotate ? '0.5em' : '0',\n                    // transformOrigin: 'center',\n                    // whiteSpace: 'nowrap',\n                    // fontSize: rotate ? '0.8em' : '1em',\n                }}\n                className=\"containedOfXticks\"\n            >\n                {createValue(x)}\n            </div>\n        </div>\n    ))\n\n    return (\n        <div style={{ position: 'relative' }}>\n            <div style={{ display: 'flex', width: '100%' }}>\n                {\n                    ramp.interpolations.map((x, i) => (\n                        <div\n                            key={i}\n                            style={{\n                                width, height: '1em',\n                                backgroundColor: interpolateColor(ramp.ramp, ramp.scale.forward(x), furthest),\n                                marginLeft: '1px',\n                                marginRight: '1px',\n                            }}\n                        >\n                        </div>\n                    ))\n                }\n            </div>\n            <div ref={valuesRef} style={{ position: 'absolute', top: 0, left: 0, display: 'flex', width: '100%', visibility: 'hidden' }}>{valuesDivs(false)}</div>\n            <div style={{ display: 'flex', width: '100%' }}>{valuesDivs(shouldRotate)}</div>\n            <div className=\"centered_text user_input\">\n                {ramp.label}\n            </div>\n        </div>\n    )\n}\n","export function saveAsFile(filename: string, data: string | Blob, type: string): void {\n    const blob = typeof data === 'string' ? new Blob([data], { type }) : data\n    const url = URL.createObjectURL(blob)\n    const link = document.createElement('a')\n    link.href = url\n    link.download = filename\n    document.body.appendChild(link)\n    link.click()\n    document.body.removeChild(link)\n}\n","import { saveAs } from 'file-saver'\nimport React, { ReactNode } from 'react'\nimport { z } from 'zod'\n\nimport { renderLocInfo } from '../../urban-stats-script/interpreter'\nimport { parse, unparse } from '../../urban-stats-script/parser'\nimport { cancelled, uploadFile } from '../../utils/upload'\n\nimport { ActionOptions } from './EditMapperPanel'\nimport { convertToMapUss, defaultSettings, mapperMetaFields, MapSettings } from './utils'\n\nexport function ImportExportCode({ mapSettings, setMapSettings }: { mapSettings: MapSettings, setMapSettings: (v: MapSettings, o: ActionOptions) => void }): ReactNode {\n    return (\n        <div style={{\n            display: 'flex',\n            gap: '0.5em',\n            margin: '0.5em 0',\n        }}\n        >\n            <button onClick={async () => {\n                const file = await uploadFile('.uss')\n\n                if (file === cancelled) {\n                    return\n                }\n\n                const importResult = importMapSettings(await file.text())\n\n                if (!importResult.success) {\n                    alert(importResult.error)\n                    return\n                }\n\n                setMapSettings(importResult.mapSettings, {})\n            }}\n            >\n                Import Script\n            </button>\n            <button onClick={() => {\n                saveAs(new Blob([exportMapSettings(mapSettings)]), 'urban_stats_mapper.uss')\n            }}\n            >\n                Export Script\n            </button>\n        </div>\n    )\n}\n\nconst metadataSchema = z.object({\n    kind: z.literal('mapper'),\n    ...mapperMetaFields.shape,\n})\n\nfunction importMapSettings(fileContent: string): { success: true, mapSettings: MapSettings } | { success: false, error: string } {\n    const parsed = parse(fileContent)\n    if (parsed.type === 'error') {\n        return {\n            success: false,\n            error: `Parse Errors:\\n${parsed.errors.map(error => `• ${error.value} at ${renderLocInfo(error.location)}`).join('\\n')}`,\n        }\n    }\n\n    let metadata = undefined\n    if (parsed.type === 'statements'\n        && parsed.result[0].type === 'expression'\n        && parsed.result[0].value.type === 'call'\n        && parsed.result[0].value.fn.type === 'identifier'\n        && parsed.result[0].value.fn.name.node === 'meta'\n    ) {\n        const meta = parsed.result[0].value\n\n        // Remove meta from the parsed result\n        parsed.result.splice(0, 1)\n\n        const args = []\n\n        for (const arg of meta.args) {\n            if (arg.type === 'unnamed') {\n                return { success: false, error: `\"meta\" function call at ${renderLocInfo(meta.entireLoc)} must have only named arguments` }\n            }\n            if (arg.value.type !== 'constant') {\n                return { success: false, error: `\"meta\" function argument \"${arg.name.node}\" must have a constant value` }\n            }\n            args.push([arg.name.node, arg.value.value.node.value])\n        }\n\n        const metadataResult = metadataSchema.safeParse(Object.fromEntries(args))\n\n        if (!metadataResult.success) {\n            return {\n                success: false,\n                error: `Error parsing metadata: ${Object.values(metadataResult.error.flatten(issue => `• Parameter \"${issue.path}\" is ${issue.message}`).fieldErrors).join('\\n')}`,\n            }\n        }\n        metadata = metadataResult.data\n    }\n\n    const newSettings = defaultSettings({\n        ...metadata,\n        script: {\n            uss: convertToMapUss(parsed),\n        },\n    })\n\n    return { success: true, mapSettings: newSettings }\n}\n\nfunction exportMapSettings(mapSettings: MapSettings): string {\n    return `meta(kind=\"mapper\", universe=\"${mapSettings.universe}\", geographyKind=\"${mapSettings.geographyKind}\")\\n${unparse(mapSettings.script.uss)}`\n}\n","import { useColors } from '../page_template/colors'\n\nexport const settingNameStyle = {\n    fontWeight: 500,\n    fontSize: '1.2em',\n    marginBottom: '0.125em',\n    marginTop: '0.25em',\n}\n\nexport const useSettingSubNameStyle = (): React.CSSProperties => ({\n    fontWeight: 500,\n    fontSize: '1em',\n    marginBottom: '0.125em',\n    color: useColors().ordinalTextColor,\n})\n","import React, { ReactNode, useCallback, useMemo } from 'react'\n\nimport { articleTypes, CountsByUT } from '../../components/countsByArticleType'\nimport universes_ordered from '../../data/universes_ordered'\nimport { EditorError } from '../../urban-stats-script/editor-utils'\nimport { TypeEnvironment, USSType } from '../../urban-stats-script/types-values'\nimport { settingNameStyle } from '../style'\n\nimport { BetterSelector } from './BetterSelector'\nimport { ActionOptions } from './EditMapperPanel'\nimport { TopLevelEditor } from './TopLevelEditor'\nimport { MapSettings } from './utils'\n\nexport function MapperSettings({\n    mapSettings,\n    setMapSettings,\n    errors,\n    counts,\n    typeEnvironment,\n    targetOutputTypes,\n}: {\n    mapSettings: MapSettings\n    setMapSettings: (s: MapSettings, o: ActionOptions) => void\n    errors: EditorError[]\n    counts: CountsByUT\n    typeEnvironment: TypeEnvironment\n    targetOutputTypes: USSType[]\n}): ReactNode {\n    const uss = mapSettings.script.uss\n\n    const renderString = useCallback((universe: string | undefined) => ({ text: universe ?? '' }), [])\n\n    const universes = useMemo(() => [undefined, ...universes_ordered], [])\n\n    const geographyKinds = useMemo(() =>\n        mapSettings.universe === undefined ? undefined : [undefined, ...articleTypes(counts, mapSettings.universe)] as Exclude<MapSettings['geographyKind'], undefined>[],\n    [mapSettings.universe, counts])\n\n    return (\n        <>\n            <div style={settingNameStyle}>\n                Universe\n            </div>\n            <BetterSelector\n                possibleValues={universes}\n                value={mapSettings.universe}\n                renderValue={renderString}\n                onChange={\n                    (newUniverse) => {\n                        setMapSettings({\n                            ...mapSettings,\n                            universe: newUniverse,\n                            geographyKind: newUniverse === undefined || mapSettings.geographyKind === undefined\n                                ? mapSettings.geographyKind\n                                : articleTypes(counts, newUniverse).includes(mapSettings.geographyKind)\n                                    ? mapSettings.geographyKind\n                                    : undefined,\n                        }, {})\n                    }\n                }\n            />\n            {geographyKinds && (\n                <>\n                    <div style={settingNameStyle}>\n                        Geography Kind\n                    </div>\n                    <BetterSelector\n                        possibleValues={geographyKinds}\n                        value={mapSettings.geographyKind}\n                        renderValue={renderString}\n                        onChange={\n                            (newGeographyKind) => {\n                                setMapSettings({\n                                    ...mapSettings,\n                                    geographyKind: newGeographyKind,\n                                }, {})\n                            }\n                        }\n                    />\n                </>\n            )}\n            <TopLevelEditor\n                uss={uss}\n                setUss={(newUss, options) => {\n                    setMapSettings({\n                        ...mapSettings,\n                        script: { uss: newUss },\n                    }, options)\n                }}\n                typeEnvironment={typeEnvironment}\n                errors={errors}\n                targetOutputTypes={targetOutputTypes}\n            />\n        </>\n    )\n}\n","import { UrbanStatsASTExpression } from '../../urban-stats-script/ast'\nimport { deconstruct as deconstructInset, Inset } from '../../urban-stats-script/constants/insets'\nimport * as l from '../../urban-stats-script/literal-parser'\nimport { TypeEnvironment } from '../../urban-stats-script/types-values'\nimport { ArrayEdits, replace, swap } from '../../utils/array-edits'\nimport { assert } from '../../utils/defensive'\nimport { loadInsetExpression, loadInsets } from '../context'\n\nimport { idOutput, MapUSS, validMapperOutputs } from './TopLevelEditor'\nimport { MapSettings } from './utils'\n\nexport const neswSchema = l.object({\n    north: l.number(),\n    east: l.number(),\n    south: l.number(),\n    west: l.number(),\n})\n\nconst insetSchema = l.transformExpr(l.deconstruct(l.call({ fn: l.identifier('constructInset'), unnamedArgs: [], namedArgs: {\n    mainMap: l.boolean(),\n    name: l.string(),\n    screenBounds: neswSchema,\n    mapBounds: neswSchema,\n} })),\n({ namedArgs: { screenBounds, mapBounds, mainMap, name } }) => ({\n    bottomLeft: [screenBounds.west, screenBounds.south],\n    topRight: [screenBounds.east, screenBounds.north],\n    coordBox: [mapBounds.west, mapBounds.south, mapBounds.east, mapBounds.north],\n    mainMap,\n    name,\n} satisfies Inset))\n\nconst constructInsetsSchema = l.transformExpr(l.call({ fn: l.identifier('constructInsets'), namedArgs: {}, unnamedArgs: [l.editableVector(insetSchema)] }), call => call.unnamedArgs[0])\n\nconst mapSchema = l.transformStmt(l.statements([\n    l.ignore(),\n    l.condition({\n        condition: l.ignore(),\n        rest: [\n            l.expression(l.reparse(idOutput, validMapperOutputs,\n                l.call({\n                    fn: l.ignore(),\n                    unnamedArgs: [],\n                    namedArgs: {\n                        insets: l.edit(l.optional(l.deconstruct(constructInsetsSchema))),\n                    },\n                }))),\n        ],\n    }),\n]), uss => uss[1].rest[0].namedArgs.insets)\n\nexport function getInsets(settings: MapSettings, typeEnvironment: TypeEnvironment): Inset[] | undefined {\n    if (settings.script.uss.type === 'statements') {\n        try {\n            const parseResult = mapSchema.parse(settings.script.uss, typeEnvironment)\n            if (parseResult.currentValue === undefined && settings.universe !== undefined) {\n                return loadInsets(settings.universe)\n            }\n            return parseResult.currentValue?.currentValue\n        }\n        catch {\n            return undefined\n        }\n    }\n    return undefined\n}\n\nexport interface InsetEdits {\n    insets: ArrayEdits<Inset>\n    ast: ArrayEdits<UrbanStatsASTExpression>\n}\n\nexport function replaceInsets(edits: InsetEdits, [from, to]: [number, number], withArray: Inset[]): InsetEdits {\n    return {\n        insets: replace(edits.insets, [from, to], withArray),\n        ast: replace(edits.ast, [from, to], withArray.map(deconstructInset)),\n    }\n}\n\nexport function swapInsets(edits: InsetEdits, indexA: number, indexB: number): InsetEdits {\n    return {\n        insets: swap(edits.insets, indexA, indexB),\n        ast: swap(edits.ast, indexA, indexB),\n    }\n}\n\nexport function doEditInsets(settings: MapSettings, edits: InsetEdits, typeEnvironment: TypeEnvironment): MapUSS {\n    assert(settings.script.uss.type === 'statements', 'Trying to do an inset edit on USS that is not inset editable')\n    const mapInsets = mapSchema.parse(settings.script.uss, typeEnvironment)\n    assert(settings.universe !== undefined, 'Trying to do an inset edit on USS that is not inset editable')\n\n    let currentInsetsAst: UrbanStatsASTExpression\n    if (mapInsets.currentValue !== undefined) {\n        currentInsetsAst = mapInsets.expr!\n    }\n    else {\n        currentInsetsAst = loadInsetExpression(settings.universe)\n    }\n\n    const newConstructInsets = constructInsetsSchema.parse(currentInsetsAst, typeEnvironment).edit(edits.ast) as UrbanStatsASTExpression\n\n    const result = mapInsets.edit(newConstructInsets)\n    return result as MapUSS\n}\n","import { alignIdentifierToValue, listIdentifierToValue, RichTextDocument, RichTextSegment } from '../../urban-stats-script/constants/rich-text'\nimport { deconstruct, defaults, TextBox } from '../../urban-stats-script/constants/text-box'\nimport * as l from '../../urban-stats-script/literal-parser'\nimport { noLocation } from '../../urban-stats-script/location'\nimport { TypeEnvironment } from '../../urban-stats-script/types-values'\nimport { assert } from '../../utils/defensive'\n\nimport { colorSchema } from './Selector'\nimport { idOutput, MapUSS, validMapperOutputs } from './TopLevelEditor'\nimport { neswSchema } from './edit-insets'\nimport { MapSettings } from './utils'\n\nconst attributesArgs = {\n    size: l.optional(l.number()),\n    font: l.optional(l.string()),\n    color: l.optional(l.transformExpr(colorSchema, color => color?.color)),\n    bold: l.optional(l.boolean()),\n    italic: l.optional(l.boolean()),\n    underline: l.optional(l.boolean()),\n    list: l.optional(l.transformExpr(l.union(Object.keys(listIdentifierToValue).map(l.identifier)), align => listIdentifierToValue[align])),\n    indent: l.optional(l.number()),\n    align: l.optional(l.transformExpr(l.union(Object.keys(alignIdentifierToValue).map(l.identifier)), align => alignIdentifierToValue[align])),\n}\n\n/*\n[\n    l.transformExpr(l.call({ fn: l.identifier('rtfString'), unnamedArgs: [l.string()], namedArgs: attributesArgs }), call => ({\n        insert: call.unnamedArgs[0],\n        attributes: call.namedArgs,\n    } satisfies RichTextSegment)),\n]\n */\n\nconst segmentTypes: [string, (insert: string) => RichTextSegment['insert']][] = [['rtfString', i => i], ['rtfFormula', formula => ({ formula })], ['rtfImage', image => ({ image })]]\n\nconst richTextSegmentSchema = l.union(segmentTypes.map(([fnId, insert]) =>\n    l.transformExpr(l.call({ fn: l.identifier(fnId), unnamedArgs: [l.string()], namedArgs: attributesArgs }), call => ({\n        insert: insert(call.unnamedArgs[0]),\n        attributes: call.namedArgs,\n    } satisfies RichTextSegment)),\n))\n\nconst richTextDocumentSchema = l.transformExpr(l.call({ fn: l.identifier('rtfDocument'), unnamedArgs: [l.vector(richTextSegmentSchema)], namedArgs: {} }),\n    ({ unnamedArgs }) => (unnamedArgs[0] satisfies RichTextDocument))\n\nconst textBoxSchema = l.transformExpr(l.call({ fn: l.identifier('textBox'), unnamedArgs: [], namedArgs: {\n    screenBounds: neswSchema,\n    text: richTextDocumentSchema,\n    backgroundColor: l.transformExpr(l.optional(colorSchema), color => color?.color ?? defaults.backgroundColor),\n    borderColor: l.transformExpr(l.optional(colorSchema), color => color?.color ?? defaults.borderColor),\n    borderWidth: l.transformExpr(l.optional(l.number()), borderWidth => borderWidth ?? defaults.borderWidth),\n} }),\n({ namedArgs: { screenBounds, ...rest } }) => ({\n    bottomLeft: [screenBounds.west, screenBounds.south],\n    topRight: [screenBounds.east, screenBounds.north],\n    ...rest,\n} satisfies TextBox))\n\nconst mapSchema = l.transformStmt(l.statements([\n    l.ignore(),\n    l.condition({\n        condition: l.ignore(),\n        rest: [\n            l.expression(l.reparse(idOutput, validMapperOutputs,\n                l.call({\n                    fn: l.ignore(),\n                    unnamedArgs: [],\n                    namedArgs: {\n                        textBoxes: l.edit(l.optional(l.vector(textBoxSchema))),\n                    },\n                }))),\n        ],\n    }),\n]), uss => uss[1].rest[0].namedArgs.textBoxes)\n\nexport function getTextBoxes(settings: MapSettings, typeEnvironment: TypeEnvironment): TextBox[] | undefined {\n    if (settings.script.uss.type === 'statements') {\n        try {\n            return mapSchema.parse(settings.script.uss, typeEnvironment).currentValue ?? []\n        }\n        catch {\n            return undefined\n        }\n    }\n    return undefined\n}\n\nexport function scriptWithNewTextBoxes(settings: MapSettings, textBoxes: TextBox[], typeEnvironment: TypeEnvironment): MapUSS {\n    assert(settings.script.uss.type === 'statements', 'Trying to do an text boxes edit on USS that is not text boxes editable')\n    const result = mapSchema.parse(settings.script.uss, typeEnvironment).edit(textBoxes.length === 0\n        ? undefined\n        : {\n                type: 'vectorLiteral',\n                elements: textBoxes.map(deconstruct),\n                entireLoc: noLocation,\n            })\n    return result as MapUSS\n}\n","import { gzipSync } from 'zlib'\n\nimport React, { ReactNode, useCallback, useContext, useEffect, useLayoutEffect, useMemo, useRef, useState } from 'react'\n\nimport { CountsByUT } from '../../components/countsByArticleType'\nimport { Navigator } from '../../navigation/Navigator'\nimport { useColors } from '../../page_template/colors'\nimport { useSetting } from '../../page_template/settings'\nimport { PageTemplate } from '../../page_template/template'\nimport { Inset } from '../../urban-stats-script/constants/insets'\nimport { documentLength } from '../../urban-stats-script/constants/rich-text'\nimport { defaults, TextBox } from '../../urban-stats-script/constants/text-box'\nimport { useUndoRedo } from '../../urban-stats-script/editor-utils'\nimport { unparse } from '../../urban-stats-script/parser'\nimport { TypeEnvironment } from '../../urban-stats-script/types-values'\nimport { Property } from '../../utils/Property'\nimport { TestUtils } from '../../utils/TestUtils'\nimport { mixWithBackground } from '../../utils/color'\nimport { assert } from '../../utils/defensive'\nimport { useMobileLayout } from '../../utils/responsive'\nimport { saveAsFile } from '../../utils/saveAsFile'\nimport { Selection as TextBoxesSelection, SelectionContext as TextBoxesSelectionContext } from '../components/MapTextBox'\nimport { defaultTypeEnvironment, loadInsets } from '../context'\nimport { MapGenerator, useMapGenerator } from '../map-generator'\n\nimport { ImportExportCode } from './ImportExportCode'\nimport { MapperSettings } from './MapperSettings'\nimport { Selection, SelectionContext } from './SelectionContext'\nimport { validMapperOutputs } from './TopLevelEditor'\nimport { doEditInsets, getInsets, InsetEdits, replaceInsets, swapInsets } from './edit-insets'\nimport { getTextBoxes, scriptWithNewTextBoxes } from './edit-text-boxes'\nimport { MapSettings } from './utils'\n\ntype MapEditorMode = 'uss' | 'insets' | 'textBoxes'\n\nexport interface ActionOptions { undoable?: boolean, updateMap?: boolean }\n\nexport function EditMapperPanel(props: { mapSettings: MapSettings, counts: CountsByUT }): ReactNode {\n    const [mapSettings, setMapSettings] = useState(props.mapSettings)\n    const [generatorMapSettings, setGeneratorMapSettings] = useState(props.mapSettings)\n\n    const setAllMapSettings = useCallback((newSettings: MapSettings) => {\n        setMapSettings(newSettings)\n        setGeneratorMapSettings(newSettings)\n    }, [])\n\n    const [mapEditorMode, setMapEditorMode] = useState<MapEditorMode>('uss')\n\n    const selectionContext = useMemo(() => new Property<Selection | undefined>(undefined), [])\n\n    const undoRedo = useUndoRedo(\n        mapSettings,\n        selectionContext.value,\n        setAllMapSettings,\n        (selection) => {\n            selectionContext.value = selection\n        },\n        {\n            undoChunking: TestUtils.shared.isTesting ? 2000 : 1000,\n            // Prevent keyboard shortcusts when in insets editing mode, since insets has its own undo stack\n            onlyElement: mapEditorMode !== 'uss' ? { current: null } : undefined,\n        },\n    )\n\n    const { updateCurrentSelection, addState, updateCurrentState } = undoRedo\n\n    const setMapSettingsWrapper = useCallback((newSettings: MapSettings, actionOptions: ActionOptions): void => {\n        if (actionOptions.updateMap === false) {\n            setMapSettings(newSettings)\n        }\n        else {\n            setAllMapSettings(newSettings)\n        }\n        if (actionOptions.undoable === false) {\n            updateCurrentState(newSettings)\n        }\n        else {\n            addState(newSettings, selectionContext.value)\n        }\n    }, [selectionContext, addState, updateCurrentState, setAllMapSettings])\n\n    const firstEffect = useRef(true)\n\n    useEffect(() => {\n        if (firstEffect.current) {\n            // Otherwise we add an undo state immediately\n            firstEffect.current = false\n        }\n        else {\n            // So that map settings are updated when the prop changes\n            setMapSettingsWrapper(props.mapSettings, {})\n            setMapEditorMode('uss')\n        }\n    }, [props.mapSettings, setMapSettingsWrapper])\n\n    const jsonedSettings = JSON.stringify({\n        ...mapSettings,\n        script: {\n            uss: unparse(mapSettings.script.uss),\n        },\n    })\n\n    const navContext = useContext(Navigator.Context)\n\n    useEffect(() => {\n        if (props.mapSettings !== mapSettings) {\n            // gzip then base64 encode\n            const encodedSettings = gzipSync(jsonedSettings).toString('base64')\n            navContext.setMapperSettings(encodedSettings)\n        }\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- props.view won't be set except from the navigator\n    }, [jsonedSettings, navContext])\n\n    const typeEnvironment = useMemo(() => defaultTypeEnvironment(mapSettings.universe), [mapSettings.universe])\n\n    // Update current selection when it changes\n    useEffect(() => {\n        const observer = (): void => {\n            updateCurrentSelection(selectionContext.value)\n        }\n\n        selectionContext.observers.add(observer)\n        return () => { selectionContext.observers.delete(observer) }\n    }, [selectionContext, updateCurrentSelection])\n\n    const mapGenerator = useMapGenerator({ mapSettings: generatorMapSettings })\n\n    const commonProps: CommonEditorProps = {\n        mapSettings,\n        setMapSettings: setMapSettingsWrapper,\n        typeEnvironment,\n        setMapEditorMode,\n        mapGenerator,\n    }\n\n    return (\n        <SelectionContext.Provider value={selectionContext}>\n            {mapEditorMode === 'textBoxes' && <TextBoxesMapEditor {...commonProps} /> }\n            {mapEditorMode === 'insets' && <InsetsMapEditor {...commonProps} />}\n            {mapEditorMode === 'uss' && (\n                <>\n                    <USSMapEditor {...commonProps} counts={props.counts} />\n                    {undoRedo.ui}\n                </>\n            )}\n        </SelectionContext.Provider>\n    )\n}\n\ninterface CommonEditorProps {\n    mapSettings: MapSettings\n    setMapSettings: (s: MapSettings, o: ActionOptions) => void\n    typeEnvironment: TypeEnvironment\n    setMapEditorMode: (m: MapEditorMode) => void\n    mapGenerator: MapGenerator\n}\n\nfunction USSMapEditor({ mapSettings, setMapSettings, counts, typeEnvironment, setMapEditorMode, mapGenerator }: CommonEditorProps & { counts: CountsByUT }): ReactNode {\n    const ui = mapGenerator.ui({ mode: 'uss' })\n\n    const exportImage = ui.exportImage\n\n    const exportPng = exportImage\n        ? async () => {\n            const canvas = await exportImage()\n            const pngDataUrl = canvas.toDataURL('image/png')\n            const data = await fetch(pngDataUrl)\n            const pngData = await data.blob()\n            saveAsFile('map.png', pngData, 'image/png')\n        }\n        : undefined\n\n    return (\n        <PageTemplate csvExportData={mapGenerator.exportCSV} screencap={exportPng} showFooter={false}>\n            <MaybeSplitLayout\n                error={mapGenerator.errors.some(e => e.kind === 'error')}\n                left={(\n                    <MapperSettings\n                        mapSettings={mapSettings}\n                        setMapSettings={setMapSettings}\n                        errors={mapGenerator.errors}\n                        counts={counts}\n                        typeEnvironment={typeEnvironment}\n                        targetOutputTypes={validMapperOutputs}\n                    />\n                )}\n                right={(\n                    <>\n                        <div style={{ display: 'flex', justifyContent: 'space-between', gap: '0.5em' }}>\n                            <Export pngExport={exportPng} geoJSONExport={mapGenerator.exportGeoJSON} />\n                            {\n                                getInsets(mapSettings, typeEnvironment) && (\n                                    <div style={{\n                                        display: 'flex',\n                                        gap: '0.5em',\n                                        margin: '0.5em 0',\n                                    }}\n                                    >\n                                        <button onClick={() => { setMapEditorMode('insets') }}>\n                                            Edit Insets\n                                        </button>\n                                    </div>\n                                )\n                            }\n                            {\n                                getTextBoxes(mapSettings, typeEnvironment) && (\n                                    <div style={{\n                                        display: 'flex',\n                                        gap: '0.5em',\n                                        margin: '0.5em 0',\n                                    }}\n                                    >\n                                        <button onClick={() => { setMapEditorMode('textBoxes') }}>\n                                            Edit Text Boxes\n                                        </button>\n                                    </div>\n                                )\n                            }\n                            <ImportExportCode\n                                mapSettings={mapSettings}\n                                setMapSettings={setMapSettings}\n                            />\n                        </div>\n                        <div style={{ position: 'relative', flex: 1 }}>\n                            {ui.node}\n                        </div>\n                    </>\n                )}\n            />\n        </PageTemplate>\n    )\n}\n\nexport const splitLayoutContext = React.createContext(false)\n\nfunction MaybeSplitLayout({ left, right, error }: { left: ReactNode, right: ReactNode, error: boolean }): ReactNode {\n    const mobileLayout = useMobileLayout()\n\n    return mobileLayout\n        ? (\n                <>\n                    {left}\n                    {right}\n                </>\n            )\n        : <SplitLayout error={error} left={left} right={right} />\n}\n\nfunction SplitLayout({ left, right, error }: { left: ReactNode, right: ReactNode, error: boolean }): ReactNode {\n    const [height, setHeight] = useState(0)\n    const splitRef = useRef<HTMLDivElement>(null)\n    const colors = useColors()\n\n    const updateHeight = useCallback(() => {\n        if (splitRef.current) {\n            const bounds = splitRef.current.getBoundingClientRect()\n            setHeight(window.innerHeight - bounds.top - 8)\n        }\n    }, [])\n\n    // This is ultimately the simplest way to set the height\n    useLayoutEffect(() => {\n        updateHeight()\n        window.addEventListener('resize', updateHeight)\n        return () => {\n            window.removeEventListener('resize', updateHeight)\n        }\n    }, [updateHeight])\n\n    const [leftColProp, setLeftColProp] = useSetting('mapperSettingsColumnProp')\n\n    const [drag, setDrag] = useState<{ startOffsetX: number, pointerId: number, startProp: number } | undefined>(undefined)\n\n    const dividerRef = useRef<HTMLDivElement>(null)\n\n    const minLeftColProp = (): number =>\n        minLeftWidth / splitRef.current!.offsetWidth\n\n    useEffect(() => {\n        if (dividerRef.current !== null) {\n            dividerRef.current.style.cursor = leftColProp === minLeftColProp() ? 'e-resize' : (leftColProp === maxLeftColProp ? 'w-resize' : 'col-resize')\n        }\n    })\n\n    const minLeftWidth = left ? 540 : 0\n    const leftPct = left ? `${leftColProp * 100}%` : '0%'\n\n    const maxLeftColProp = 0.5\n\n    const dividerWidth = '1em'\n\n    return (\n        <splitLayoutContext.Provider value={true}>\n            <div style={{ display: 'flex', height, position: 'relative' }} ref={splitRef}>\n                {left && (\n                    <>\n                        <div data-test=\"split-left\" style={{ width: leftPct, minWidth: minLeftWidth, overflowY: 'scroll', backgroundColor: mixWithBackground(colors.hueColors.red, error ? 0.8 : 1, colors.slightlyDifferentBackground), padding: '1em', borderRadius: '5px' }}>\n                            {left}\n                        </div>\n                        <div\n                            ref={dividerRef}\n                            style={{ width: dividerWidth, position: 'relative' }}\n                            onPointerDown={(e) => {\n                                if (drag === undefined) {\n                                    const div = e.target as HTMLDivElement\n                                    setDrag({\n                                        pointerId: e.pointerId,\n                                        startOffsetX: e.nativeEvent.offsetX + div.offsetLeft,\n                                        startProp: Math.max(minLeftColProp(), leftColProp),\n                                    })\n                                    div.setPointerCapture(e.pointerId)\n                                }\n                            }}\n                            onPointerMove={(e) => {\n                                if (e.pointerId === drag?.pointerId) {\n                                    const div = e.target as HTMLDivElement\n                                    const propChange = (div.offsetLeft + e.nativeEvent.offsetX - drag.startOffsetX) / splitRef.current!.offsetWidth\n                                    setLeftColProp(Math.max(minLeftColProp(), Math.min(drag.startProp + propChange, maxLeftColProp)))\n                                }\n                            }}\n                            onPointerCancel={(e) => {\n                                if (drag?.pointerId === e.pointerId) {\n                                    setDrag(undefined)\n                                }\n                            }}\n                            onPointerUp={(e) => {\n                                if (drag?.pointerId === e.pointerId) {\n                                    setDrag(undefined)\n                                }\n                            }}\n                        >\n                            <div style={{\n                                backgroundColor: colors.borderNonShadow,\n                                borderRadius: '5px',\n                                position: 'absolute',\n                                width: '5px',\n                                left: 'calc(50% - 2px)',\n                                height: '50%',\n                                top: '25%',\n                                pointerEvents: 'none',\n                            }}\n                            />\n                        </div>\n                    </>\n                )}\n                <div style={{ width: `calc(100% - max(${minLeftWidth}px, ${leftPct}) - ${dividerWidth})`, display: 'flex', flexDirection: 'column', justifyContent: 'center' }}>\n                    {right}\n                </div>\n            </div>\n        </splitLayoutContext.Provider>\n    )\n}\n\nfunction InsetsMapEditor({ mapSettings, setMapSettings, typeEnvironment, setMapEditorMode, mapGenerator }: CommonEditorProps): ReactNode {\n    const colors = useColors()\n\n    const [insetEdits, setInsetEdits] = useState<InsetEdits>({\n        ast: a => a,\n        insets: i => i,\n    })\n\n    const { addState, ui: undoRedoUi, canUndo } = useUndoRedo(insetEdits, undefined, setInsetEdits, () => undefined)\n\n    const editedInsets = insetEdits.insets(getInsets(mapSettings, typeEnvironment)!)\n\n    const addInsetEdit = (edits: InsetEdits): void => {\n        setInsetEdits(edits)\n        addState(edits, undefined)\n    }\n\n    const ui = mapGenerator.ui({\n        mode: 'insets',\n        editInsets: {\n            add: () => {\n                const newInset: Inset = {\n                    ...loadInsets(mapSettings.universe ?? 'world')[0],\n                    bottomLeft: [0.25, 0.25],\n                    topRight: [0.75, 0.75],\n                    mainMap: false,\n                }\n                addInsetEdit(replaceInsets(insetEdits, [editedInsets.length, editedInsets.length], [offsetInsetInBounds(newInset, editedInsets)]))\n            },\n            modify: (i, e) => {\n                addInsetEdit(replaceInsets(insetEdits, [i, i + 1], [{ ...editedInsets[i], ...e }]))\n            },\n            delete: (i) => {\n                addInsetEdit(replaceInsets(insetEdits, [i, i + 1], []))\n            },\n            duplicate: (i) => {\n                addInsetEdit(replaceInsets(insetEdits, [i + 1, i + 1], [offsetInsetInBounds(editedInsets[i], editedInsets)]))\n            },\n            moveUp: (i) => {\n                assert(i + 1 < editedInsets.length, `Cannot move inset ${i} up, already top`)\n                addInsetEdit(swapInsets(insetEdits, i, i + 1))\n            },\n            moveDown: (i) => {\n                assert(i > 0, `Cannot move inset ${i} down, already bottom`)\n                addInsetEdit(swapInsets(insetEdits, i, i - 1))\n            },\n            edited: editedInsets,\n        },\n    })\n\n    return (\n        <PageTemplate csvExportData={mapGenerator.exportCSV} showFooter={false}>\n            <MaybeSplitLayout\n                left={undefined}\n                error={false}\n                right={(\n                    <>\n                        <div style={{\n                            backgroundColor: colors.slightlyDifferentBackgroundFocused,\n                            borderRadius: '5px',\n                            padding: '10px',\n                            margin: '10px 0',\n                            display: 'flex',\n                            justifyContent: 'space-between',\n                            gap: '0.5em',\n                        }}\n                        >\n                            <div>\n                                <b>Editing Insets.</b>\n                                {' '}\n                                Pans and zooms to maps will be reflected permanently. Drag inset frames to reposition and resize.\n                            </div>\n                            <div style={{ display: 'flex', gap: '10px' }}>\n\n                                <button onClick={() => { setMapEditorMode('uss') }}>\n                                    Cancel\n                                </button>\n                                <button\n                                    onClick={() => {\n                                        setMapSettings({ ...mapSettings, script: { uss: doEditInsets(mapSettings, insetEdits, typeEnvironment) } }, {})\n                                        setMapEditorMode('uss')\n                                    }}\n                                    disabled={!canUndo}\n                                >\n                                    Accept\n                                </button>\n                            </div>\n                        </div>\n                        <div style={{ flex: 1, position: 'relative' }}>\n                            {ui.node}\n                        </div>\n                    </>\n                )}\n            />\n            {undoRedoUi}\n        </PageTemplate>\n    )\n}\n\nfunction moveInset<T extends Inset | TextBox>(inset: T, x: number, y: number): T {\n    return {\n        ...inset,\n        bottomLeft: [inset.bottomLeft[0] + x, inset.bottomLeft[1] + y],\n        topRight: [inset.topRight[0] + x, inset.topRight[1] + y],\n    }\n}\n\nfunction inBounds(inset: Inset | TextBox): boolean {\n    return inset.bottomLeft.concat(inset.topRight).every(c => c >= 0 && c <= 1)\n}\n\nfunction samePosition(a: Inset | TextBox, b: Inset | TextBox): boolean {\n    return a.bottomLeft[0] === b.bottomLeft[0] && a.bottomLeft[1] === b.bottomLeft[1] && a.topRight[0] === b.topRight[0] && a.topRight[1] === b.topRight[1]\n}\n\nfunction offsetInsetInBounds<T extends Inset | TextBox>(inset: T, exclude: T[]): T {\n    for (let delta = 0; delta < 1; delta += 0.05) {\n        for (const [x, y] of [[delta, delta], [-delta, -delta], [-delta, delta], [delta, -delta]]) {\n            const newInset = moveInset(inset, x, y)\n            if (inBounds(newInset) && !exclude.some(i => samePosition(newInset, i))) {\n                return newInset\n            }\n        }\n    }\n    return inset\n}\n\nfunction Export(props: { pngExport?: () => Promise<void>, geoJSONExport?: () => string }): ReactNode {\n    const doPngExport = (): void => {\n        if (props.pngExport === undefined) {\n            return\n        }\n        void props.pngExport()\n    }\n\n    const doGeoJSONExport = (): void => {\n        if (props.geoJSONExport === undefined) {\n            return\n        }\n        saveAsFile('map.geojson', props.geoJSONExport(), 'application/geo+json')\n    }\n\n    return (\n        <div style={{\n            display: 'flex',\n            gap: '0.5em',\n            margin: '0.5em 0',\n        }}\n        >\n            <button\n                disabled={props.pngExport === undefined}\n                onClick={() => {\n                    doPngExport()\n                }}\n            >\n                Export as PNG\n            </button>\n            <button\n                disabled={props.geoJSONExport === undefined}\n                onClick={() => {\n                    doGeoJSONExport()\n                }}\n            >\n                Export as GeoJSON\n            </button>\n            <button onClick={() => {\n                // eslint-disable-next-line no-restricted-syntax -- We're opening a new window here\n                const params = new URLSearchParams(window.location.search)\n                params.set('view', 'true')\n                // navigate to the page in a new tab\n                window.open(`?${params.toString()}`, '_blank')\n            }}\n            >\n                View as Zoomable Page\n            </button>\n        </div>\n    )\n}\n\nfunction TextBoxesMapEditor({ mapSettings, setMapSettings, typeEnvironment, setMapEditorMode, mapGenerator }: CommonEditorProps): ReactNode {\n    const colors = useColors()\n\n    const [textBoxes, setTextBoxes] = useState<TextBox[]>(() => getTextBoxes(mapSettings, typeEnvironment)!)\n\n    const selectionProperty = useMemo(() => new Property<TextBoxesSelection | undefined>(undefined), [])\n\n    const { addState, ui: undoRedoUi, canUndo, updateCurrentSelection } = useUndoRedo<TextBox[], TextBoxesSelection | undefined>(textBoxes, undefined, setTextBoxes, (newSelection) => {\n        selectionProperty.value = newSelection\n    })\n\n    // Update current selection when it changes\n    useEffect(() => {\n        const observer = (): void => {\n            updateCurrentSelection(selectionProperty.value)\n        }\n\n        selectionProperty.observers.add(observer)\n        return () => { selectionProperty.observers.delete(observer) }\n    }, [selectionProperty, updateCurrentSelection])\n\n    const setTextBoxesWithUndo = (boxes: TextBox[]): void => {\n        setTextBoxes(boxes)\n        addState(boxes, selectionProperty.value)\n    }\n\n    const ui = mapGenerator.ui({\n        mode: 'textBoxes',\n        editTextBoxes: {\n            add: () => {\n                const newTextBox: TextBox = {\n                    bottomLeft: [0.25, 0.25],\n                    topRight: [0.75, 0.75],\n                    text: [{ insert: '\\n' }], // bugs on applying attributes to empty text without this\n                    ...defaults,\n                }\n                setTextBoxesWithUndo([...textBoxes, offsetInsetInBounds(newTextBox, textBoxes)])\n                selectionProperty.value = { index: textBoxes.length, range: { index: 0, length: 0 } }\n            },\n            modify: (i, e) => {\n                setTextBoxesWithUndo(textBoxes.map((textBox, j) => i === j ? { ...textBox, ...e } : textBox))\n            },\n            delete: (i) => {\n                setTextBoxesWithUndo(textBoxes.filter((_, j) => j !== i))\n                if (selectionProperty.value?.index === i) {\n                    selectionProperty.value = undefined\n                }\n            },\n            duplicate: (i) => {\n                setTextBoxesWithUndo([...textBoxes, offsetInsetInBounds(textBoxes[i], textBoxes)])\n                selectionProperty.value = { index: textBoxes.length, range: { index: 0, length: documentLength(textBoxes[i].text) } }\n            },\n            moveUp: (i) => {\n                assert(i + 1 < textBoxes.length, `Cannot move text box ${i} up, already top`)\n                setTextBoxesWithUndo(textBoxes.map((textBox, j) => {\n                    switch (j) {\n                        case i:\n                            return textBoxes[i + 1]\n                        case i + 1:\n                            return textBoxes[i]\n                        default:\n                            return textBox\n                    }\n                }))\n                if (selectionProperty.value?.index === i) {\n                    selectionProperty.value = { ...selectionProperty.value, index: i + 1 }\n                }\n            },\n            moveDown: (i) => {\n                assert(i > 0, `Cannot move inset ${i} down, already bottom`)\n                setTextBoxesWithUndo(textBoxes.map((textBox, j) => {\n                    switch (j) {\n                        case i:\n                            return textBoxes[i - 1]\n                        case i - 1:\n                            return textBoxes[i]\n                        default:\n                            return textBox\n                    }\n                }))\n                if (selectionProperty.value?.index === i) {\n                    selectionProperty.value = { ...selectionProperty.value, index: i - 1 }\n                }\n            },\n            edited: textBoxes,\n        },\n    })\n\n    return (\n        <PageTemplate csvExportData={mapGenerator.exportCSV} showFooter={false}>\n\n            <TextBoxesSelectionContext.Provider value={selectionProperty}>\n                <MaybeSplitLayout\n                    left={undefined}\n                    error={false}\n                    right={(\n                        <>\n                            <div style={{\n                                backgroundColor: colors.slightlyDifferentBackgroundFocused,\n                                borderRadius: '5px',\n                                padding: '10px',\n                                margin: '10px 0',\n                                display: 'flex',\n                                justifyContent: 'space-between',\n                                gap: '0.5em',\n                            }}\n                            >\n                                <div>\n                                    <b>Editing Text Boxes.</b>\n                                </div>\n                                <div style={{ display: 'flex', gap: '10px' }}>\n\n                                    <button onClick={() => { setMapEditorMode('uss') }}>\n                                        Cancel\n                                    </button>\n                                    <button\n                                        onClick={() => {\n                                            setMapSettings({ ...mapSettings, script: { uss: scriptWithNewTextBoxes(mapSettings, textBoxes, typeEnvironment) } }, {})\n                                            setMapEditorMode('uss')\n                                        }}\n                                        disabled={!canUndo}\n                                    >\n                                        Accept\n                                    </button>\n                                </div>\n                            </div>\n                            <div style={{ flex: 1, position: 'relative' }}>\n                                {ui.node}\n                            </div>\n                        </>\n                    )}\n                />\n                {undoRedoUi}\n            </TextBoxesSelectionContext.Provider>\n        </PageTemplate>\n    )\n}\n","import Color from 'color'\nimport React, { ReactNode, useContext, useEffect, useRef, useState } from 'react'\nimport { MapInstance, MapRef } from 'react-map-gl/maplibre'\n\nimport { CSVExportData, generateMapperCSVData } from '../components/csv-export'\nimport { Basemap as BasemapComponent, PointFeatureCollection, Polygon, PolygonFeatureCollection } from '../components/map-common'\nimport { screencapElement, ScreenshotContext } from '../components/screenshot'\nimport valid_geographies from '../data/mapper/used_geographies'\nimport universes_ordered from '../data/universes_ordered'\nimport { loadProtobuf } from '../load_json'\nimport { boundingBox, geometry } from '../map-partition'\nimport { consolidatedShapeLink, indexLink } from '../navigation/links'\nimport { RelativeLoader } from '../navigation/loading'\nimport { Colors, colorThemes } from '../page_template/color-themes'\nimport { OverrideTheme, useColors } from '../page_template/colors'\nimport { loadCentroids } from '../syau/load'\nimport { Universe } from '../universe'\nimport { getAllParseErrors } from '../urban-stats-script/ast'\nimport { doRender } from '../urban-stats-script/constants/color-utils'\nimport { Inset } from '../urban-stats-script/constants/insets'\nimport { instantiate } from '../urban-stats-script/constants/scale'\nimport { TextBox } from '../urban-stats-script/constants/text-box'\nimport { EditorError } from '../urban-stats-script/editor-utils'\nimport { noLocation } from '../urban-stats-script/location'\nimport { USSOpaqueValue } from '../urban-stats-script/types-values'\nimport { executeAsync } from '../urban-stats-script/workerManager'\nimport { loadImage } from '../utils/Image'\nimport { editIndex, EditSeq } from '../utils/array-edits'\nimport { furthestColor, interpolateColor } from '../utils/color'\nimport { computeAspectRatioForInsets } from '../utils/coordinates'\nimport { ConsolidatedShapes, Feature, ICoordinate } from '../utils/protos'\nimport { NormalizeProto } from '../utils/types'\nimport { useOrderedResolve } from '../utils/useOrderedResolve'\n\nimport { Colorbar, RampToDisplay, styleFromBasemap } from './components/Colorbar'\nimport { InsetMap } from './components/InsetMap'\nimport { AddTextBox, MapTextBoxComponent } from './components/MapTextBox'\nimport { loadInsets } from './context'\nimport { splitLayoutContext } from './settings/EditMapperPanel'\nimport { Basemap, computeUSS, MapSettings } from './settings/utils'\n\nconst mapUpdateInterval = 500\n\nexport function useMapGenerator({ mapSettings }: { mapSettings: MapSettings }): MapGenerator {\n    const cache = useRef<MapCache>({})\n    const updateTime = useRef(Date.now())\n\n    const [currentGenerator, setCurrentGenerator] = useState<Promise<MapGenerator<{ loading: boolean }>>>(() => makeMapGenerator({ mapSettings, cache: cache.current, previousGenerator: undefined }))\n\n    useEffect(() => {\n        const timeSinceMapUpdate = Date.now() - updateTime.current\n        if (timeSinceMapUpdate > mapUpdateInterval) {\n            updateTime.current = Date.now()\n            setCurrentGenerator(previousGenerator => makeMapGenerator({ mapSettings, cache: cache.current, previousGenerator }))\n            return\n        }\n        else {\n            updateTime.current = Date.now()\n            const timeout = setTimeout(() => {\n                setCurrentGenerator(previousGenerator => makeMapGenerator({ mapSettings, cache: cache.current, previousGenerator }))\n            }, mapUpdateInterval - timeSinceMapUpdate)\n            return () => {\n                clearTimeout(timeout)\n            }\n        }\n    }, [mapSettings]) // Do not change this effect list!!\n\n    const { result, loading } = useOrderedResolve(currentGenerator)\n\n    return result !== undefined\n        ? {\n                ...result,\n                ui: props => result.ui({ ...props, loading }),\n            }\n        : {\n                ui: () => ({ node: <EmptyMapLayout universe={mapSettings.universe} loading={loading} /> }),\n                errors: [],\n            }\n}\n\ntype MapUIProps<T> = T & ({ mode: 'view' } | { mode: 'uss' } | { mode: 'insets', editInsets: EditSeq<Inset> } | { mode: 'textBoxes', editTextBoxes: EditSeq<TextBox> })\n\nexport interface MapGenerator<T = unknown> {\n    ui: (props: MapUIProps<T>) => { node: ReactNode, exportImage?: () => Promise<HTMLCanvasElement> }\n    exportGeoJSON?: () => string\n    exportCSV?: CSVExportData\n    errors: EditorError[]\n}\n\nasync function makeMapGenerator({ mapSettings, cache, previousGenerator }: { mapSettings: MapSettings, cache: MapCache, previousGenerator: Promise<MapGenerator<{ loading: boolean }>> | undefined }): Promise<MapGenerator<{ loading: boolean }>> {\n    const emptyMap = ({ loading }: { loading: boolean }): { node: ReactNode } => ({ node: <EmptyMapLayout universe={mapSettings.universe} loading={loading} /> })\n\n    if (mapSettings.geographyKind === undefined || mapSettings.universe === undefined) {\n        return {\n            ui: emptyMap,\n            errors: [{ kind: 'error', type: 'error', value: 'Select a Universe and Geography Kind', location: noLocation }],\n        }\n    }\n\n    const stmts = computeUSS(mapSettings.script)\n\n    const parseErrors = getAllParseErrors(stmts)\n    if (parseErrors.length > 0) {\n        const prev = await previousGenerator\n        return {\n            ...prev,\n            ui: prev?.ui ?? emptyMap,\n            errors: parseErrors.map(e => ({ ...e, kind: 'error' })),\n        }\n    }\n\n    const execResult = await executeAsync({ descriptor: { kind: 'mapper', geographyKind: mapSettings.geographyKind, universe: mapSettings.universe }, stmts })\n\n    if (execResult.resultingValue === undefined) {\n        const prev = await previousGenerator\n        return {\n            ...prev,\n            ui: prev?.ui ?? emptyMap,\n            errors: execResult.error,\n        }\n    }\n\n    const mapResultMain = execResult.resultingValue.value\n\n    const csvData = generateMapperCSVData(mapResultMain, execResult.context)\n    const csvFilename = `${mapSettings.geographyKind}-${mapSettings.universe}-data.csv`\n\n    const { features, mapChildren, ramp } = await loadMapResult({ mapResultMain, universe: mapSettings.universe, geographyKind: mapSettings.geographyKind, cache })\n\n    function MapComponent({ props, exportImageRef }: { props: MapUIProps<{ loading: boolean }>, exportImageRef: (fn: () => Promise<HTMLCanvasElement>) => void }): ReactNode {\n        const mapsRef: (MapRef | null)[] = []\n\n        const mapsContainerRef = useRef<HTMLDivElement>(null)\n        const wholeRenderRef = useRef<HTMLDivElement>(null)\n\n        const insetsFeatures = (props.mode === 'insets' ? props.editInsets.edited : mapResultMain.value.insets).flatMap((inset) => {\n            const insetFeatures = filterOverlaps(inset, features)\n            if (insetFeatures.length === 0 && props.mode !== 'insets') {\n                return []\n            }\n            return [{\n                inset,\n                insetFeatures,\n            }]\n        })\n\n        const insetMaps = insetsFeatures.map(({ inset, insetFeatures }, i, insets) => {\n            return (\n                <InsetMap\n                    i={i}\n                    key={i}\n                    inset={inset}\n                    ref={e => mapsRef[i] = e}\n                    container={mapsContainerRef}\n                    numInsets={insets.length}\n                    editInset={props.mode === 'insets'\n                        ? editIndex(props.editInsets, i)\n                        : undefined}\n                    interactive={props.mode !== 'textBoxes'}\n                >\n                    {mapChildren(insetFeatures, ['uss', 'view'].includes(props.mode))}\n                </InsetMap>\n            )\n        })\n\n        const visibleInsets = insetsFeatures.map(({ inset }) => inset)\n\n        const colorbar = (\n            <Colorbar\n                ramp={ramp}\n                basemap={mapResultMain.value.basemap}\n            />\n        )\n\n        const [screenshotMode, setScreenshotMode] = useState(false)\n\n        const colors = useColors()\n\n        exportImageRef(async () => {\n            setScreenshotMode(true)\n            const restoreMaps = mapsRef.map(r => r!.getMap()).map(prepareMapForImageExport)\n            return new Promise((resolve) => {\n                setTimeout(async () => {\n                    const elementCanvas = await screencapElement(wholeRenderRef.current!, canonicalWidth * exportPixelRatio, 1, { mapBorderRadius: 0, testing: false })\n\n                    const image = await mapImageExport(elementCanvas, mapResultMain.value.basemap, colors)\n\n                    resolve(image)\n                    setScreenshotMode(false)\n                    restoreMaps.forEach((restore) => { restore() })\n                })\n            })\n        })\n\n        const textBoxes = props.mode === 'insets'\n            ? undefined\n            : (\n                    <OverrideTheme theme=\"Light Mode\">\n                        {(props.mode === 'textBoxes' ? props.editTextBoxes.edited : mapResultMain.value.textBoxes).map((textBox, i, boxes) => (\n                            <MapTextBoxComponent\n                                container={mapsContainerRef}\n                                key={i}\n                                textBox={textBox}\n                                i={i}\n                                count={boxes.length}\n                                edit={props.mode === 'textBoxes' ? editIndex(props.editTextBoxes, i) : undefined}\n                            />\n                        )).concat(props.mode === 'textBoxes' ? [<AddTextBox key=\"add\" container={mapsContainerRef} add={props.editTextBoxes.add} />] : [])}\n                    </OverrideTheme>\n                )\n\n        return (\n            <ScreenshotContext.Provider value={screenshotMode}>\n                <MapLayout\n                    maps={insetMaps}\n                    loading={props.loading}\n                    colorbar={colorbar}\n                    aspectRatio={computeAspectRatioForInsets(visibleInsets)}\n                    mapsContainerRef={mapsContainerRef}\n                    wholeRenderRef={wholeRenderRef}\n                    textBoxes={textBoxes}\n                />\n            </ScreenshotContext.Provider>\n        )\n    }\n\n    return {\n        errors: execResult.error,\n        exportCSV: {\n            csvData,\n            csvFilename,\n        },\n        exportGeoJSON: () => exportAsGeoJSON(features),\n        ui: (props) => {\n            let exportImage: () => Promise<HTMLCanvasElement>\n\n            return {\n                node: (\n                    <MapComponent props={props} exportImageRef={fn => exportImage = fn} />\n                ),\n                exportImage: () => exportImage(),\n            }\n        },\n    }\n}\n\nconst exportPixelRatio = 4\n\nfunction prepareMapForImageExport(map: MapInstance): () => void {\n    const originalPixelRatio = map.getPixelRatio()\n    map.setPixelRatio(exportPixelRatio)\n\n    const attrib: HTMLElement | null = map.getContainer().querySelector('.maplibregl-ctrl-attrib')\n    let resetAttrib: undefined | (() => void)\n    if (attrib !== null) {\n        const prevDisplay = attrib.style.display\n        attrib.style.display = 'none'\n        resetAttrib = () => attrib.style.display = prevDisplay\n    }\n\n    return () => {\n        map.setPixelRatio(originalPixelRatio)\n        resetAttrib?.()\n    }\n}\n\nasync function mapImageExport(elementCanvas: HTMLCanvasElement, basemap: Basemap, colors: Colors): Promise<HTMLCanvasElement> {\n    const { backgroundColor, color } = styleFromBasemap(basemap, colors)\n    const bannerUrl = color === undefined ? colors.screenshotFooterUrl : colorThemes[Color(color).l() < 50 ? 'Light Mode' : 'Dark Mode'].screenshotFooterUrl\n    const bannerImage = await loadImage(bannerUrl)\n    const bannerHeight = 50 * exportPixelRatio\n    const bannerWidth = bannerImage.width * (bannerHeight / bannerImage.height)\n    const bannerSquish = 10 * exportPixelRatio\n\n    const resultCanvas = document.createElement('canvas')\n    const ctx = resultCanvas.getContext('2d')!\n    resultCanvas.width = elementCanvas.width\n    resultCanvas.height = elementCanvas.height + bannerHeight - bannerSquish\n\n    ctx.drawImage(elementCanvas, 0, 0)\n\n    ctx.fillStyle = backgroundColor\n    ctx.fillRect(0, elementCanvas.height, elementCanvas.width, bannerHeight)\n\n    ctx.drawImage(\n        bannerImage,\n        resultCanvas.width - bannerWidth,\n        resultCanvas.height - bannerHeight,\n        bannerWidth,\n        bannerHeight,\n    )\n\n    return resultCanvas\n}\n\nfunction MapLayout({ maps, colorbar, loading, mapsContainerRef, aspectRatio, wholeRenderRef, textBoxes }: {\n    maps: ReactNode\n    textBoxes: ReactNode\n    colorbar: ReactNode\n    loading: boolean\n    mapsContainerRef?: React.Ref<HTMLDivElement>\n    aspectRatio: number\n    wholeRenderRef?: React.Ref<HTMLDivElement>\n}): ReactNode {\n    return (\n        <TransformConstantWidth>\n            <div\n                ref={wholeRenderRef}\n                style={{\n                    display: 'flex',\n                    flexDirection: 'column',\n                    position: 'relative',\n                    minHeight: 0, // https://stackoverflow.com/questions/36230944/prevent-flex-items-from-overflowing-a-container/66689926#66689926\n                }}\n            >\n                <RelativeLoader loading={loading} />\n                <div\n                    style={{ width: '100%', aspectRatio }}\n                >\n                    <div\n                        ref={mapsContainerRef}\n                        style={{\n                            aspectRatio,\n                            position: 'relative',\n                            maxHeight: '100%',\n                            margin: 'auto',\n                        }}\n                    >\n                        {maps}\n                        {textBoxes}\n                    </div>\n                </div>\n                {colorbar}\n            </div>\n        </TransformConstantWidth>\n    )\n}\n\nfunction EmptyMapLayout({ universe, loading }: { universe?: Universe, loading: boolean }): ReactNode {\n    const insets = loadInsets(universe ?? 'world')\n\n    return (\n        <MapLayout\n            maps={insets.map((inset, i) => (\n                <InsetMap\n                    i={i}\n                    key={i}\n                    inset={inset}\n                    container={React.createRef()}\n                    numInsets={insets.length}\n                    interactive={false}\n                >\n                    {null}\n                </InsetMap>\n            ))}\n            textBoxes={null}\n            loading={loading}\n            colorbar={null}\n            aspectRatio={computeAspectRatioForInsets(insets)}\n        />\n    )\n}\n\nasync function loadMapResult({ mapResultMain: { opaqueType, value }, universe, geographyKind, cache }:\n{\n    mapResultMain: USSOpaqueValue & { opaqueType: 'cMap' | 'cMapRGB' | 'pMap' }\n    universe: Universe\n    geographyKind: typeof valid_geographies[number]\n    cache: MapCache\n}): Promise<{ features: GeoJSON.Feature[], mapChildren: (fs: GeoJSON.Feature[], clickable: boolean) => ReactNode, ramp: RampToDisplay }> {\n    let ramp: RampToDisplay\n    let colors: string[]\n    switch (opaqueType) {\n        case 'pMap':\n        case 'cMap':\n            const scale = instantiate(value.scale)\n            const furthest = furthestColor(value.ramp.map(x => x[1]))\n            const interpolations = [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1].map(scale.inverse)\n            ramp = { type: 'ramp', value: { ramp: value.ramp, interpolations, scale, label: value.label, unit: value.unit } }\n            colors = value.data.map(val => interpolateColor(value.ramp, scale.forward(val), furthest))\n            break\n        case 'cMapRGB':\n            colors = value.dataR.map((r, i) => doRender({\n                r,\n                g: value.dataG[i],\n                b: value.dataB[i],\n                a: 1,\n            }))\n            ramp = { type: 'label', value: value.label }\n            break\n    }\n\n    let features: GeoJSON.Feature[]\n    let mapChildren: (fs: GeoJSON.Feature[], clickable: boolean) => ReactNode\n    switch (opaqueType) {\n        case 'pMap':\n            const points: Point[] = Array.from(value.data.entries()).map(([i, dataValue]) => {\n                return {\n                    name: value.geo[i],\n                    fillColor: colors[i],\n                    fillOpacity: 1,\n                    radius: Math.sqrt(value.relativeArea[i]) * value.maxRadius,\n                    statistic: dataValue,\n                }\n            })\n\n            features = await pointsGeojson(geographyKind, universe, points, cache)\n\n            mapChildren = (fs, clickable) => <PointFeatureCollection features={fs} clickable={clickable} />\n\n            break\n        case 'cMap':\n        case 'cMapRGB':\n            const polys: Polygon[] = Array.from(colors.entries()).map(([i, color]) => {\n                let meta\n                switch (opaqueType) {\n                    case 'cMap':\n                        meta = { statistic: value.data[i] }\n                        break\n                    case 'cMapRGB':\n                        meta = { statistic: [value.dataR[i], value.dataG[i], value.dataB[i]] }\n                        break\n                }\n\n                return {\n                    name: value.geo[i],\n                    fillColor: color,\n                    fillOpacity: 1,\n                    color: doRender(value.outline.color),\n                    weight: value.outline.weight,\n                    ...meta,\n                }\n            })\n\n            features = await polygonsGeojson(geographyKind, universe, polys, cache)\n\n            mapChildren = (fs, clickable) => <PolygonFeatureCollection features={fs} clickable={clickable} />\n\n            break\n    }\n\n    return {\n        features,\n        mapChildren: (fs, clickable) => (\n            <>\n                {mapChildren(fs, clickable)}\n                <BasemapComponent basemap={value.basemap} />\n            </>\n        ),\n        ramp,\n    }\n}\n\nconst canonicalWidth = 1200\n\nfunction TransformConstantWidth({ children }: { children: ReactNode }): ReactNode {\n    const [layout, setLayout] = useState({ scale: 1, top: 0, left: 0, selfDeterminedHeight: 0 })\n    const ref = useRef<HTMLDivElement>(null)\n    const childRef = useRef<HTMLDivElement>(null)\n\n    useEffect(() => {\n        const updateScale = (): void => {\n            if (ref.current === null || childRef.current === null) {\n                return\n            }\n            const scale = Math.min(...[\n                ref.current.offsetWidth / canonicalWidth,\n                ...(ref.current.offsetHeight > 0 ? [ref.current.offsetHeight / childRef.current.offsetHeight] : []),\n            ])\n            setLayout({\n                scale,\n                top: Math.max(0, (ref.current.offsetHeight - childRef.current.offsetHeight * scale) / 2),\n                left: Math.max(0, (ref.current.offsetWidth - childRef.current.offsetWidth * scale) / 2),\n                selfDeterminedHeight: childRef.current.offsetHeight * scale,\n            })\n        }\n        updateScale()\n\n        const observer = new ResizeObserver(updateScale)\n        observer.observe(ref.current!)\n        observer.observe(childRef.current!)\n        return () => {\n            observer.disconnect()\n        }\n    }, [])\n\n    return (\n        <div ref={ref} style={{ ...(useContext(splitLayoutContext) ? { position: 'absolute' } : { height: layout.selfDeterminedHeight }), inset: 0 }}>\n            <div\n                ref={childRef}\n                style={{\n                    transform: `scale(${layout.scale})`,\n                    transformOrigin: 'top left',\n                    width: `${canonicalWidth}px`,\n                    position: 'relative',\n                    top: `${layout.top}px`,\n                    left: `${layout.left}px`,\n                }}\n            >\n                {children}\n            </div>\n        </div>\n    )\n}\n\nfunction filterOverlaps(inset: Inset, features: GeoJSON.Feature[]): GeoJSON.Feature[] {\n    const bbox = inset.coordBox\n    if (!inset.mainMap) {\n        features = features.filter((poly) => {\n            const bounds = boundingBox(poly.geometry)\n            // Check if the polygon overlaps the inset bounds\n            return bounds.getWest() < bbox[2] && bounds.getEast() > bbox[0]\n                && bounds.getNorth() > bbox[1] && bounds.getSouth() < bbox[3]\n        })\n    }\n    return features\n}\n\ninterface MapCache {\n    geo?: { universe: Universe, geographyKind: typeof valid_geographies[number] } & (\n        { type: 'points', centroidsByName: Map<string, ICoordinate> }\n        | { type: 'polygons', polygonsByName: Map<string, GeoJSON.Geometry> }\n    )\n}\n\ninterface Point {\n    name: string\n\n    fillColor: string\n    fillOpacity: number\n    radius: number\n\n    [meta: string]: unknown\n\n}\n\nasync function pointsGeojson(geographyKind: typeof valid_geographies[number], universe: Universe, points: Point[], cache: MapCache): Promise<GeoJSON.Feature[]> {\n    if (cache.geo?.type !== 'points' || cache.geo.universe !== universe || cache.geo.geographyKind !== geographyKind) {\n        const idxLink = indexLink(universe, geographyKind)\n        const articles = await loadProtobuf(idxLink, 'ArticleOrderingList')\n        const centroids = await loadCentroids(universe, geographyKind, articles.longnames)\n\n        const centroidsByName = new Map(articles.longnames.map((r, i) => [r, centroids[i]]))\n        cache.geo = {\n            type: 'points',\n            universe,\n            geographyKind,\n            centroidsByName,\n        }\n    }\n\n    const geo = cache.geo\n\n    return points.map((point) => {\n        const centroid = geo.centroidsByName.get(point.name)!\n\n        return {\n            type: 'Feature' as const,\n            properties: { ...point },\n            geometry: {\n                type: 'Point',\n                coordinates: [centroid.lon!, centroid.lat!],\n            },\n        }\n    })\n}\n\nasync function polygonsGeojson(geographyKind: typeof valid_geographies[number], universe: Universe, polygons: Polygon[], cache: MapCache): Promise<GeoJSON.Feature[]> {\n    if (cache.geo?.type !== 'polygons' || cache.geo.universe !== universe || cache.geo.geographyKind !== geographyKind) {\n        const universeIdx = universes_ordered.indexOf(universe)\n        const shapes = (await loadProtobuf(consolidatedShapeLink(geographyKind), 'ConsolidatedShapes')) as NormalizeProto<ConsolidatedShapes>\n        const polygonsByName = new Map<string, GeoJSON.Geometry>()\n        for (let i = 0; i < shapes.longnames.length; i++) {\n            if (shapes.universes[i].universeIdxs.includes(universeIdx)) {\n                polygonsByName.set(shapes.longnames[i], geometry(shapes.shapes[i] as NormalizeProto<Feature>))\n            }\n        }\n        cache.geo = {\n            type: 'polygons',\n            universe,\n            geographyKind,\n            polygonsByName,\n        }\n    }\n\n    const geo = cache.geo\n\n    return polygons.map((polygon) => {\n        return {\n            type: 'Feature' as const,\n            properties: { ...polygon },\n            geometry: geo.polygonsByName.get(polygon.name)!,\n        }\n    })\n}\n\nfunction exportAsGeoJSON(features: GeoJSON.Feature[]): string {\n    return JSON.stringify(\n        {\n            type: 'FeatureCollection',\n            features,\n        },\n        null,\n        2,\n    )\n}\n","import React, { ReactNode } from 'react'\n\nimport { CountsByUT } from '../../components/countsByArticleType'\nimport { useMapGenerator } from '../map-generator'\nimport { EditMapperPanel } from '../settings/EditMapperPanel'\nimport { MapSettings } from '../settings/utils'\n\nexport function MapperPanel(props: { mapSettings: MapSettings, view: boolean, counts: CountsByUT }): ReactNode {\n    if (props.view) {\n        return <DisplayMap mapSettings={props.mapSettings} />\n    }\n\n    return <EditMapperPanel {...props} />\n}\n\nfunction DisplayMap({ mapSettings }: { mapSettings: MapSettings }): ReactNode {\n    const mapGenerator = useMapGenerator({ mapSettings })\n    return (\n        <>\n            {mapGenerator.ui({ mode: 'view' }).node}\n        </>\n    )\n}\n","export const cancelled = Symbol()\n\nexport function uploadFile(accept: string): Promise<File | typeof cancelled> {\n    const inputElement = document.createElement('input')\n    inputElement.setAttribute('type', 'file')\n    inputElement.setAttribute('accept', accept)\n    inputElement.style.display = 'none'\n    const result = new Promise<File | typeof cancelled>((resolve) => {\n        inputElement.onchange = () => {\n            resolve(inputElement.files![0])\n            inputElement.remove()\n        }\n        inputElement.oncancel = () => {\n            resolve(cancelled)\n            inputElement.remove()\n        }\n    })\n\n    document.body.appendChild(inputElement)\n    inputElement.click()\n\n    return result\n}\n"],"names":["replace","edits","_param","withArray","from","to","a","applied","swap","indexA","indexB","array","itemA","itemB","result","Array","editIndex","seq","i","v","lngToWebMercatorX","lng","Math","latToWebMercatorY","lat","area","coordBox","x1","x2","y1","y2","computeAspectRatioForInsets","mapsWithCoordBox","assert","biggestMap","prev","curr","onScreenWidth","onScreenHeight","computeAspectRatio","styleFromBasemap","basemap","colors","Colorbar","props","useColors","RampColorbar","param","ramp","valuesRef","useRef","_useState","shouldRotate","setShouldRotate","useLayoutEffect","values","updateShouldRotate","container","contained","resizeObserver","ResizeObserver","furthest","useMemo","furthestColor","x","width","valuesDivs","rotate","Statistic","interpolateColor","saveAsFile","filename","data","type","blob","Blob","url","URL","link","document","ImportExportCode","mapSettings","setMapSettings","file","importResult","uploadFile","cancelled","importMapSettings","alert","saveAs","unparse","metadataSchema","z","mapperMetaFields","fileContent","parsed","parse","error","renderLocInfo","metadata","undefined","meta","args","_iteratorError","arg","metadataResult","Object","issue","defaultSettings","convertToMapUss","settingNameStyle","MapperSettings","errors","counts","typeEnvironment","targetOutputTypes","uss","renderString","useCallback","universe","universes","universes_ordered","geographyKinds","articleTypes","BetterSelector","newUniverse","newGeographyKind","TopLevelEditor","newUss","options","neswSchema","l","insetSchema","screenBounds","mapBounds","mainMap","name","constructInsetsSchema","call","mapSchema","idOutput","validMapperOutputs","getInsets","settings","_parseResult_currentValue","parseResult","loadInsets","replaceInsets","deconstructInset","swapInsets","attributesArgs","colorSchema","color","listIdentifierToValue","align","alignIdentifierToValue","richTextSegmentSchema","segmentTypes","formula","image","fnId","insert","richTextDocumentSchema","unnamedArgs","textBoxSchema","_color_color","defaults","borderWidth","rest","getTextBoxes","_mapSchema_parse_currentValue","EditMapperPanel","_useState1","generatorMapSettings","setGeneratorMapSettings","setAllMapSettings","newSettings","_useState2","mapEditorMode","setMapEditorMode","selectionContext","Property","undoRedo","useUndoRedo","selection","TestUtils","updateCurrentSelection","addState","updateCurrentState","setMapSettingsWrapper","actionOptions","firstEffect","useEffect","jsonedSettings","JSON","navContext","useContext","Navigator","encodedSettings","gzipSync","defaultTypeEnvironment","observer","commonProps","mapGenerator","useMapGenerator","SelectionContext","TextBoxesMapEditor","InsetsMapEditor","USSMapEditor","ui","exportImage","exportPng","fetch","canvas","PageTemplate","MaybeSplitLayout","e","Export","splitLayoutContext","React","left","right","mobileLayout","useMobileLayout","SplitLayout","height","setHeight","splitRef","updateHeight","bounds","window","_useSetting","leftColProp","setLeftColProp","drag","setDrag","dividerRef","minLeftColProp","minLeftWidth","maxLeftColProp","leftPct","mixWithBackground","div","propChange","dividerWidth","insetEdits","setInsetEdits","_useUndoRedo","undoRedoUi","canUndo","editedInsets","addInsetEdit","_mapSettings_universe","newInset","offsetInsetInBounds","currentInsetsAst","mapInsets","newConstructInsets","loadInsetExpression","inset","exclude","delta","_iter","y","inBounds","c","b","doPngExport","doGeoJSONExport","params","URLSearchParams","textBoxes","setTextBoxes","selectionProperty","newSelection","setTextBoxesWithUndo","boxes","newTextBox","textBox","j","_selectionProperty_value","_","documentLength","TextBoxesSelectionContext","deconstruct","noLocation","cache","updateTime","Date","makeMapGenerator","currentGenerator","setCurrentGenerator","timeSinceMapUpdate","previousGenerator","timeout","setTimeout","mapUpdateInterval","clearTimeout","_useOrderedResolve","loading","EmptyMapLayout","emptyMap","stmts","parseErrors","_prev_ui","execResult","prev1","_prev_ui1","mapResultMain","csvData","csvFilename","_ref","features","mapChildren","MapComponent","exportImageRef","mapsRef","mapsContainerRef","wholeRenderRef","insetsFeatures","bbox","insetFeatures","poly","boundingBox","insetMaps","insets","InsetMap","visibleInsets","colorbar","screenshotMode","setScreenshotMode","restoreMaps","r","prepareMapForImageExport","Promise","resolve","screencapElement","canonicalWidth","exportPixelRatio","elementCanvas","_styleFromBasemap","backgroundColor","bannerUrl","bannerImage","bannerHeight","bannerWidth","bannerSquish","resultCanvas","ctx","colorThemes","Color","loadImage","restore","OverrideTheme","MapTextBoxComponent","AddTextBox","ScreenshotContext","MapLayout","computeUSS","getAllParseErrors","executeAsync","generateMapperCSVData","loadMapResult","opaqueType","value","geographyKind","scale","interpolations","points","polys","polygons","instantiate","val","doRender","dataValue","_cache_geo","idxLink","articles","centroids","geo","indexLink","loadProtobuf","loadCentroids","centroidsByName","Map","point","centroid","fs","clickable","PointFeatureCollection","universeIdx","shapes","polygonsByName","consolidatedShapeLink","geometry","polygon","PolygonFeatureCollection","BasemapComponent","fn","map","resetAttrib","originalPixelRatio","attrib","prevDisplay","maps","aspectRatio","TransformConstantWidth","RelativeLoader","children","layout","setLayout","ref","childRef","updateScale","_Math","MapperPanel","DisplayMap","Symbol","accept","inputElement"],"mappings":"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"}